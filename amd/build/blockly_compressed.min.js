function _typeof(e){if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(e){return typeof e}}else{_typeof=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(e)}define ("mod_ejsapp/blockly_compressed",[],function(){'use strict';var o={constants:{},LINE_MODE_MULTIPLIER:40,PAGE_MODE_MULTIPLIER:125,DRAG_RADIUS:5,FLYOUT_DRAG_RADIUS:10,SNAP_RADIUS:28};o.CONNECTING_SNAP_RADIUS=o.SNAP_RADIUS;o.CURRENT_CONNECTION_PREFERENCE=8;o.INSERTION_MARKER_COLOUR="#000000";o.BUMP_DELAY=250;o.BUMP_RANDOMNESS=10;o.COLLAPSE_CHARS=30;o.LONGPRESS=750;o.SOUND_LIMIT=100;o.DRAG_STACK=!0;o.HSV_SATURATION=.45;o.HSV_VALUE=.65;o.SPRITE={width:96,height:124,url:"sprites.png"};o.INPUT_VALUE=1;o.OUTPUT_VALUE=2;o.NEXT_STATEMENT=3;o.PREVIOUS_STATEMENT=4;o.DUMMY_INPUT=5;o.ALIGN_LEFT=-1;o.ALIGN_CENTRE=0;o.ALIGN_RIGHT=1;o.DRAG_NONE=0;o.DRAG_STICKY=1;o.DRAG_BEGIN=1;o.DRAG_FREE=2;o.OPPOSITE_TYPE=[];o.OPPOSITE_TYPE[o.INPUT_VALUE]=o.OUTPUT_VALUE;o.OPPOSITE_TYPE[o.OUTPUT_VALUE]=o.INPUT_VALUE;o.OPPOSITE_TYPE[o.NEXT_STATEMENT]=o.PREVIOUS_STATEMENT;o.OPPOSITE_TYPE[o.PREVIOUS_STATEMENT]=o.NEXT_STATEMENT;o.TOOLBOX_AT_TOP=0;o.TOOLBOX_AT_BOTTOM=1;o.TOOLBOX_AT_LEFT=2;o.TOOLBOX_AT_RIGHT=3;o.DELETE_AREA_NONE=null;o.DELETE_AREA_TRASH=1;o.DELETE_AREA_TOOLBOX=2;o.VARIABLE_CATEGORY_NAME="VARIABLE";o.VARIABLE_DYNAMIC_CATEGORY_NAME="VARIABLE_DYNAMIC";o.PROCEDURE_CATEGORY_NAME="PROCEDURE";o.RENAME_VARIABLE_ID="RENAME_VARIABLE_ID";o.DELETE_VARIABLE_ID="DELETE_VARIABLE_ID";o.utils={};o.utils.global=function(){return"object"===("undefined"==typeof self?"undefined":_typeof(self))?self:"object"===("undefined"==typeof window?"undefined":_typeof(window))?window:"object"===("undefined"==typeof global?"undefined":_typeof(global))?global:this}();o.Msg={};o.utils.global.Blockly||(o.utils.global.Blockly={});o.utils.global.Blockly.Msg||(o.utils.global.Blockly.Msg=o.Msg);o.utils.colour={};o.utils.colour.parse=function(e){e=(e+"").toLowerCase().trim();var t=o.utils.colour.names[e];if(t)return t;t="0x"==e.substring(0,2)?"#"+e.substring(2):e;t="#"==t[0]?t:"#"+t;if(/^#[0-9a-f]{6}$/.test(t))return t;if(/^#[0-9a-f]{3}$/.test(t))return["#",t[1],t[1],t[2],t[2],t[3],t[3]].join("");var n=e.match(/^(?:rgb)?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/);return n&&(e=+n[1],t=+n[2],n=+n[3],0<=e&&256>e&&0<=t&&256>t&&0<=n&&256>n)?o.utils.colour.rgbToHex(e,t,n):null};o.utils.colour.rgbToHex=function(e,t,o){t=e<<16|t<<8|o;return 16>e?"#"+(16777216|t).toString(16).substr(1):"#"+t.toString(16)};o.utils.colour.hexToRgb=function(e){e=o.utils.colour.parse(e);if(!e)return[0,0,0];e=parseInt(e.substr(1),16);return[e>>16,255&e>>8,255&e]};o.utils.colour.hsvToHex=function(t,n,r){var i=0,s=0,l=0;if(0==n)l=s=i=r;else{var c=Math.floor(t/60),p=t/60-c;t=r*(1-n);var u=r*(1-n*p);n=r*(1-n*(1-p));switch(c){case 1:i=u;s=r;l=t;break;case 2:i=t;s=r;l=n;break;case 3:i=t;s=u;l=r;break;case 4:i=n;s=t;l=r;break;case 5:i=r;s=t;l=u;break;case 6:case 0:i=r,s=n,l=t;}}return o.utils.colour.rgbToHex(Math.floor(i),Math.floor(s),Math.floor(l))};o.utils.colour.blend=function(e,t,n){e=o.utils.colour.parse(e);if(!e)return null;t=o.utils.colour.parse(t);if(!t)return null;e=o.utils.colour.hexToRgb(e);t=o.utils.colour.hexToRgb(t);return o.utils.colour.rgbToHex(Math.round(t[0]+n*(e[0]-t[0])),Math.round(t[1]+n*(e[1]-t[1])),Math.round(t[2]+n*(e[2]-t[2])))};o.utils.colour.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"};o.utils.Coordinate=function(e,t){this.x=e;this.y=t};o.utils.Coordinate.equals=function(e,t){return e==t?!0:e&&t?e.x==t.x&&e.y==t.y:!1};o.utils.Coordinate.distance=function(e,t){var o=e.x-t.x;e=e.y-t.y;return Math.sqrt(o*o+e*e)};o.utils.Coordinate.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)};o.utils.Coordinate.difference=function(e,t){return new o.utils.Coordinate(e.x-t.x,e.y-t.y)};o.utils.Coordinate.sum=function(e,t){return new o.utils.Coordinate(e.x+t.x,e.y+t.y)};o.utils.Coordinate.prototype.scale=function(e){this.x*=e;this.y*=e;return this};o.utils.Coordinate.prototype.translate=function(e,t){this.x+=e;this.y+=t;return this};o.utils.string={};o.utils.string.startsWith=function(e,t){return 0==e.lastIndexOf(t,0)};o.utils.string.shortestStringLength=function(e){return e.length?e.reduce(function(e,t){return e.length<t.length?e:t}).length:0};o.utils.string.commonWordPrefix=function(t,n){if(!t.length)return 0;if(1==t.length)return t[0].length;var r=0;n=n||o.utils.string.shortestStringLength(t);for(var i=0;i<n;i++){for(var s=t[0][i],l=1;l<t.length;l++){if(s!=t[l][i])return r}" "==s&&(r=i+1)}for(l=1;l<t.length;l++){if((s=t[l][i])&&" "!=s)return r}return n};o.utils.string.commonWordSuffix=function(t,n){if(!t.length)return 0;if(1==t.length)return t[0].length;var r=0;n=n||o.utils.string.shortestStringLength(t);for(var i=0;i<n;i++){for(var s=t[0].substr(-i-1,1),l=1;l<t.length;l++){if(s!=t[l].substr(-i-1,1))return r}" "==s&&(r=i+1)}for(l=1;l<t.length;l++){if((s=t[l].charAt(t[l].length-i-1))&&" "!=s)return r}return n};o.utils.string.wrap=function(e,t){e=e.split("\n");for(var n=0;n<e.length;n++){e[n]=o.utils.string.wrapLine_(e[n],t)}return e.join("\n")};o.utils.string.wrapLine_=function(t,n){if(t.length<=n)return t;for(var r=t.trim().split(/\s+/),i=0;i<r.length;i++){r[i].length>n&&(n=r[i].length)}i=-Infinity;var s=1;do{var l=i,c=t;t=[];var p=r.length/s,u=1;for(i=0;i<r.length-1;i++){u<(i+1.5)/p?(u++,t[i]=!0):t[i]=!1}t=o.utils.string.wrapMutate_(r,t,n);i=o.utils.string.wrapScore_(r,t,n);t=o.utils.string.wrapToText_(r,t);s++}while(i>l);return c};o.utils.string.wrapScore_=function(t,o,n){for(var r=[0],i=[],e=0;e<t.length;e++){r[r.length-1]+=t[e].length,!0===o[e]?(r.push(0),i.push(t[e].charAt(t[e].length-1))):!1===o[e]&&r[r.length-1]++}t=Math.max.apply(Math,r);for(e=o=0;e<r.length;e++){o-=2*Math.pow(Math.abs(n-r[e]),1.5),o-=Math.pow(t-r[e],1.5),-1!=".?!".indexOf(i[e])?o+=n/3:-1!=",;)]}".indexOf(i[e])&&(o+=n/4)}1<r.length&&r[r.length-1]<=r[r.length-2]&&(o+=.5);return o};o.utils.string.wrapMutate_=function(t,n,r){for(var i=o.utils.string.wrapScore_(t,n,r),s,l=0;l<n.length-1;l++){if(n[l]!=n[l+1]){var a=[].concat(n);a[l]=!a[l];a[l+1]=!a[l+1];var c=o.utils.string.wrapScore_(t,a,r);c>i&&(i=c,s=a)}}return s?o.utils.string.wrapMutate_(t,s,r):n};o.utils.string.wrapToText_=function(e,t){for(var o=[],n=0;n<e.length;n++){o.push(e[n]),void 0!==t[n]&&o.push(t[n]?"\n":" ")}return o.join("")};o.utils.Size=function(e,t){this.width=e;this.height=t};o.utils.Size.equals=function(e,t){return e==t?!0:e&&t?e.width==t.width&&e.height==t.height:!1};o.utils.style={};o.utils.style.getSize=function(t){if("none"!=o.utils.style.getStyle_(t,"display"))return o.utils.style.getSizeWithDisplay_(t);var n=t.style,r=n.display,i=n.visibility,s=n.position;n.visibility="hidden";n.position="absolute";n.display="inline";var e=t.offsetWidth;t=t.offsetHeight;n.display=r;n.position=s;n.visibility=i;return new o.utils.Size(e,t)};o.utils.style.getSizeWithDisplay_=function(e){return new o.utils.Size(e.offsetWidth,e.offsetHeight)};o.utils.style.getStyle_=function(e,t){return o.utils.style.getComputedStyle(e,t)||o.utils.style.getCascadedStyle(e,t)||e.style&&e.style[t]};o.utils.style.getComputedStyle=function(e,t){return document.defaultView&&document.defaultView.getComputedStyle&&(e=document.defaultView.getComputedStyle(e,null))?e[t]||e.getPropertyValue(t)||"":""};o.utils.style.getCascadedStyle=function(e,t){return e.currentStyle?e.currentStyle[t]:null};o.utils.style.getPageOffset=function(e){var t=new o.utils.Coordinate(0,0);e=e.getBoundingClientRect();var n=document.documentElement;n=new o.utils.Coordinate(window.pageXOffset||n.scrollLeft,window.pageYOffset||n.scrollTop);t.x=e.left+n.x;t.y=e.top+n.y;return t};o.utils.style.getViewportPageOffset=function(){var e=document.body,t=document.documentElement;return new o.utils.Coordinate(e.scrollLeft||t.scrollLeft,e.scrollTop||t.scrollTop)};o.utils.style.setElementShown=function(e,t){e.style.display=t?"":"none"};o.utils.style.isRightToLeft=function(e){return"rtl"==o.utils.style.getStyle_(e,"direction")};o.utils.style.getBorderBox=function(e){var t=o.utils.style.getComputedStyle(e,"borderLeftWidth"),n=o.utils.style.getComputedStyle(e,"borderRightWidth"),r=o.utils.style.getComputedStyle(e,"borderTopWidth");e=o.utils.style.getComputedStyle(e,"borderBottomWidth");return{top:parseFloat(r),right:parseFloat(n),bottom:parseFloat(e),left:parseFloat(t)}};o.utils.style.scrollIntoContainerView=function(e,t,n){e=o.utils.style.getContainerOffsetToScrollInto(e,t,n);t.scrollLeft=e.x;t.scrollTop=e.y};o.utils.style.getContainerOffsetToScrollInto=function(t,n,r){var i=o.utils.style.getPageOffset(t),s=o.utils.style.getPageOffset(n),l=o.utils.style.getBorderBox(n),c=i.x-s.x-l.left;i=i.y-s.y-l.top;s=o.utils.style.getSizeWithDisplay_(t);t=n.clientWidth-s.width;s=n.clientHeight-s.height;l=n.scrollLeft;n=n.scrollTop;r?(l+=c-t/2,n+=i-s/2):(l+=Math.min(c,Math.max(c-t,0)),n+=Math.min(i,Math.max(i-s,0)));return new o.utils.Coordinate(l,n)};o.utils.userAgent={};(function(e){function t(e){return-1!=n.indexOf(e.toUpperCase())}o.utils.userAgent.raw=e;var n=o.utils.userAgent.raw.toUpperCase();o.utils.userAgent.IE=t("Trident")||t("MSIE");o.utils.userAgent.EDGE=t("Edge");o.utils.userAgent.JAVA_FX=t("JavaFX");o.utils.userAgent.CHROME=(t("Chrome")||t("CriOS"))&&!o.utils.userAgent.EDGE;o.utils.userAgent.WEBKIT=t("WebKit")&&!o.utils.userAgent.EDGE;o.utils.userAgent.GECKO=t("Gecko")&&!o.utils.userAgent.WEBKIT&&!o.utils.userAgent.IE&&!o.utils.userAgent.EDGE;o.utils.userAgent.ANDROID=t("Android");o.utils.userAgent.IPAD=t("iPad");o.utils.userAgent.IPOD=t("iPod");o.utils.userAgent.IPHONE=t("iPhone")&&!o.utils.userAgent.IPAD&&!o.utils.userAgent.IPOD;o.utils.userAgent.MAC=t("Macintosh");o.utils.userAgent.TABLET=o.utils.userAgent.IPAD||o.utils.userAgent.ANDROID&&!t("Mobile")||t("Silk");o.utils.userAgent.MOBILE=!o.utils.userAgent.TABLET&&(o.utils.userAgent.IPOD||o.utils.userAgent.IPHONE||o.utils.userAgent.ANDROID||t("IEMobile"))})(o.utils.global.navigator&&o.utils.global.navigator.userAgent||"");o.utils.noEvent=function(e){e.preventDefault();e.stopPropagation()};o.utils.isTargetInput=function(e){return"textarea"==e.target.type||"text"==e.target.type||"number"==e.target.type||"email"==e.target.type||"password"==e.target.type||"search"==e.target.type||"tel"==e.target.type||"url"==e.target.type||e.target.isContentEditable};o.utils.getRelativeXY=function(e){var t=new o.utils.Coordinate(0,0),n=e.getAttribute("x");n&&(t.x=parseInt(n,10));if(n=e.getAttribute("y"))t.y=parseInt(n,10);if(n=(n=e.getAttribute("transform"))&&n.match(o.utils.getRelativeXY.XY_REGEX_))t.x+=+n[1],n[3]&&(t.y+=+n[3]);(e=e.getAttribute("style"))&&-1<e.indexOf("translate")&&(e=e.match(o.utils.getRelativeXY.XY_STYLE_REGEX_))&&(t.x+=+e[1],e[3]&&(t.y+=+e[3]));return t};o.utils.getInjectionDivXY_=function(e){for(var t=0,n=0,r;e;){r=o.utils.getRelativeXY(e);t+=r.x;n+=r.y;if(-1!=(" "+(e.getAttribute("class")||"")+" ").indexOf(" injectionDiv "))break;e=e.parentNode}return new o.utils.Coordinate(t,n)};o.utils.getRelativeXY.XY_REGEX_=/translate\(\s*([-+\d.e]+)([ ,]\s*([-+\d.e]+)\s*)?/;o.utils.getRelativeXY.XY_STYLE_REGEX_=/transform:\s*translate(?:3d)?\(\s*([-+\d.e]+)\s*px([ ,]\s*([-+\d.e]+)\s*px)?/;o.utils.isRightButton=function(e){return e.ctrlKey&&o.utils.userAgent.MAC?!0:2==e.button};o.utils.mouseToSvg=function(e,t,o){var n=t.createSVGPoint();n.x=e.clientX;n.y=e.clientY;o||(o=t.getScreenCTM().inverse());return n.matrixTransform(o)};o.utils.getScrollDeltaPixels=function(e){switch(e.deltaMode){default:return{x:e.deltaX,y:e.deltaY};case 1:return{x:e.deltaX*o.LINE_MODE_MULTIPLIER,y:e.deltaY*o.LINE_MODE_MULTIPLIER};case 2:return{x:e.deltaX*o.PAGE_MODE_MULTIPLIER,y:e.deltaY*o.PAGE_MODE_MULTIPLIER};}};o.utils.tokenizeInterpolation=function(e){return o.utils.tokenizeInterpolation_(e,!0)};o.utils.replaceMessageReferences=function(e){if("string"!=typeof e)return e;e=o.utils.tokenizeInterpolation_(e,!1);return e.length?e[0]+"":""};o.utils.checkMessageReferences=function(t){for(var n=!0,r=o.Msg,i=t.match(/%{BKY_[A-Z]\w*}/ig),s=0,l;s<i.length;s++){l=i[s].toUpperCase();void 0==r[l.slice(6,-1)]&&(console.log("WARNING: No message string for "+i[s]+" in "+t),n=!1)}return n};o.utils.tokenizeInterpolation_=function(t,n){var r=[],i=t.split("");i.push("");var s=0;t=[];for(var l=null,c=0,p;c<i.length;c++){p=i[c];0==s?"%"==p?((p=t.join(""))&&r.push(p),t.length=0,s=1):t.push(p):1==s?"%"==p?(t.push(p),s=0):n&&"0"<=p&&"9">=p?(s=2,l=p,(p=t.join(""))&&r.push(p),t.length=0):"{"==p?s=3:(t.push("%",p),s=0):2==s?"0"<=p&&"9">=p?l+=p:(r.push(parseInt(l,10)),c--,s=0):3==s&&(""==p?(t.splice(0,0,"%{"),c--,s=0):"}"!=p?t.push(p):(s=t.join(""),/[A-Z]\w*/i.test(s)?(p=s.toUpperCase(),(p=o.utils.string.startsWith(p,"BKY_")?p.substring(4):null)&&p in o.Msg?(s=o.Msg[p],"string"==typeof s?Array.prototype.push.apply(r,o.utils.tokenizeInterpolation_(s,n)):n?r.push(s+""):r.push(s)):r.push("%{"+s+"}")):r.push("%{"+s+"}"),s=t.length=0))}(p=t.join(""))&&r.push(p);n=[];for(c=t.length=0;c<r.length;++c){"string"==typeof r[c]?t.push(r[c]):((p=t.join(""))&&n.push(p),t.length=0,n.push(r[c]))}(p=t.join(""))&&n.push(p);t.length=0;return n};o.utils.genUid=function(){for(var e=o.utils.genUid.soup_.length,t=[],n=0;20>n;n++){t[n]=o.utils.genUid.soup_.charAt(Math.random()*e)}return t.join("")};o.utils.genUid.soup_="!#$%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";o.utils.is3dSupported=function(){if(void 0!==o.utils.is3dSupported.cached_)return o.utils.is3dSupported.cached_;if(!o.utils.global.getComputedStyle)return!1;var e=document.createElement("p"),t="none",n={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(e,null);for(var r in n){if(void 0!==e.style[r]){e.style[r]="translate3d(1px,1px,1px)";t=o.utils.global.getComputedStyle(e);if(!t)return document.body.removeChild(e),!1;t=t.getPropertyValue(n[r])}}document.body.removeChild(e);o.utils.is3dSupported.cached_="none"!==t;return o.utils.is3dSupported.cached_};o.utils.runAfterPageLoad=function(e){if("object"!=("undefined"==typeof document?"undefined":_typeof(document)))throw Error("Blockly.utils.runAfterPageLoad() requires browser document.");if("complete"==document.readyState)e();else var t=setInterval(function(){"complete"==document.readyState&&(clearInterval(t),e())},10)};o.utils.getViewportBBox=function(){var e=o.utils.style.getViewportPageOffset();return{right:document.documentElement.clientWidth+e.x,bottom:document.documentElement.clientHeight+e.y,top:e.y,left:e.x}};o.utils.arrayRemove=function(e,t){t=e.indexOf(t);if(-1==t)return!1;e.splice(t,1);return!0};o.utils.getDocumentScroll=function(){var e=document.documentElement,t=window;return o.utils.userAgent.IE&&t.pageYOffset!=e.scrollTop?new o.utils.Coordinate(e.scrollLeft,e.scrollTop):new o.utils.Coordinate(t.pageXOffset||e.scrollLeft,t.pageYOffset||e.scrollTop)};o.utils.getBlockTypeCounts=function(e,t){var o=Object.create(null),n=e.getDescendants(!0);t&&(e=e.getNextBlock())&&(e=n.indexOf(e),n.splice(e,n.length-e));for(e=0;t=n[e];e++){o[t.type]?o[t.type]++:o[t.type]=1}return o};o.utils.screenToWsCoordinates=function(e,t){var n=t.x;t=t.y;var r=e.getInjectionDiv().getBoundingClientRect();n=new o.utils.Coordinate(n-r.left,t-r.top);t=e.getOriginOffsetInPixels();return o.utils.Coordinate.difference(n,t).scale(1/e.scale)};o.utils.parseBlockColour=function(e){var t="string"==typeof e?o.utils.replaceMessageReferences(e):e,n=+t;if(!isNaN(n)&&0<=n&&360>=n)return{hue:n,hex:o.utils.colour.hsvToHex(n,o.HSV_SATURATION,255*o.HSV_VALUE)};if(n=o.utils.colour.parse(t))return{hue:null,hex:n};n="Invalid colour: \""+t+"\"";e!=t&&(n+=" (from \""+e+"\")");throw Error(n)};o.Events={};o.Events.group_="";o.Events.recordUndo=!0;o.Events.disabled_=0;o.Events.CREATE="create";o.Events.BLOCK_CREATE=o.Events.CREATE;o.Events.DELETE="delete";o.Events.BLOCK_DELETE=o.Events.DELETE;o.Events.CHANGE="change";o.Events.BLOCK_CHANGE=o.Events.CHANGE;o.Events.MOVE="move";o.Events.BLOCK_MOVE=o.Events.MOVE;o.Events.VAR_CREATE="var_create";o.Events.VAR_DELETE="var_delete";o.Events.VAR_RENAME="var_rename";o.Events.UI="ui";o.Events.COMMENT_CREATE="comment_create";o.Events.COMMENT_DELETE="comment_delete";o.Events.COMMENT_CHANGE="comment_change";o.Events.COMMENT_MOVE="comment_move";o.Events.FINISHED_LOADING="finished_loading";o.Events.BUMP_EVENTS=[o.Events.BLOCK_CREATE,o.Events.BLOCK_MOVE,o.Events.COMMENT_CREATE,o.Events.COMMENT_MOVE];o.Events.FIRE_QUEUE_=[];o.Events.fire=function(e){o.Events.isEnabled()&&(o.Events.FIRE_QUEUE_.length||setTimeout(o.Events.fireNow_,0),o.Events.FIRE_QUEUE_.push(e))};o.Events.fireNow_=function(){for(var e=o.Events.filter(o.Events.FIRE_QUEUE_,!0),t=o.Events.FIRE_QUEUE_.length=0,n;n=e[t];t++){if(n.workspaceId){var r=o.Workspace.getById(n.workspaceId);r&&r.fireChangeListener(n)}}};o.Events.filter=function(t,n){t=t.slice();n||t.reverse();for(var r=[],i=Object.create(null),s=0,l;l=t[s];s++){if(!l.isNull()){var c=[l.type,l.blockId,l.workspaceId].join(" "),p=i[c],d=p?p.event:null;if(!p)i[c]={event:l,index:s},r.push(l);else if(l.type==o.Events.MOVE&&p.index==s-1)d.newParentId=l.newParentId,d.newInputName=l.newInputName,d.newCoordinate=l.newCoordinate,p.index=s;else if(l.type==o.Events.CHANGE&&l.element==d.element&&l.name==d.name)d.newValue=l.newValue;else if(l.type!=o.Events.UI||"click"!=l.element||"commentOpen"!=d.element&&"mutatorOpen"!=d.element&&"warningOpen"!=d.element)i[c]={event:l,index:1},r.push(l)}}t=r.filter(function(e){return!e.isNull()});n||t.reverse();for(s=1;l=t[s];s++){l.type==o.Events.CHANGE&&"mutation"==l.element&&t.unshift(t.splice(s,1)[0])}return t};o.Events.clearPendingUndo=function(){for(var e=0,t;t=o.Events.FIRE_QUEUE_[e];e++){t.recordUndo=!1}};o.Events.disable=function(){o.Events.disabled_++};o.Events.enable=function(){o.Events.disabled_--};o.Events.isEnabled=function(){return 0==o.Events.disabled_};o.Events.getGroup=function(){return o.Events.group_};o.Events.setGroup=function(e){o.Events.group_="boolean"==typeof e?e?o.utils.genUid():"":e};o.Events.getDescendantIds=function(e){var t=[];e=e.getDescendants(!1);for(var o=0,n;n=e[o];o++){t[o]=n.id}return t};o.Events.fromJson=function(e,t){switch(e.type){case o.Events.CREATE:var n=new o.Events.Create(null);break;case o.Events.DELETE:n=new o.Events.Delete(null);break;case o.Events.CHANGE:n=new o.Events.Change(null,"","","","");break;case o.Events.MOVE:n=new o.Events.Move(null);break;case o.Events.VAR_CREATE:n=new o.Events.VarCreate(null);break;case o.Events.VAR_DELETE:n=new o.Events.VarDelete(null);break;case o.Events.VAR_RENAME:n=new o.Events.VarRename(null,"");break;case o.Events.UI:n=new o.Events.Ui(null,"","","");break;case o.Events.COMMENT_CREATE:n=new o.Events.CommentCreate(null);break;case o.Events.COMMENT_CHANGE:n=new o.Events.CommentChange(null,"","");break;case o.Events.COMMENT_MOVE:n=new o.Events.CommentMove(null);break;case o.Events.COMMENT_DELETE:n=new o.Events.CommentDelete(null);break;case o.Events.FINISHED_LOADING:n=new o.Events.FinishedLoading(t);break;default:throw Error("Unknown event type.");}n.fromJson(e);n.workspaceId=t.id;return n};o.Events.disableOrphans=function(e){if((e.type==o.Events.MOVE||e.type==o.Events.CREATE)&&e.workspaceId){var t=o.Workspace.getById(e.workspaceId);if(e=t.getBlockById(e.blockId)){var n=e.getParent();if(n&&n.isEnabled())for(t=e.getDescendants(!1),e=0;n=t[e];e++){n.setEnabled(!0)}else if((e.outputConnection||e.previousConnection)&&!t.isDragging()){do{e.setEnabled(!1),e=e.getNextBlock()}while(e)}}}};o.Events.Abstract=function(){this.workspaceId=void 0;this.group=o.Events.getGroup();this.recordUndo=o.Events.recordUndo};o.Events.Abstract.prototype.toJson=function(){var e={type:this.type};this.group&&(e.group=this.group);return e};o.Events.Abstract.prototype.fromJson=function(e){this.group=e.group};o.Events.Abstract.prototype.isNull=function(){return!1};o.Events.Abstract.prototype.run=function(){};o.Events.Abstract.prototype.getEventWorkspace_=function(){if(this.workspaceId)var e=o.Workspace.getById(this.workspaceId);if(!e)throw Error("Workspace is null. Event must have been generated from real Blockly events.");return e};o.utils.object={};o.utils.object.inherits=function(e,t){e.superClass_=t.prototype;e.prototype=Object.create(t.prototype);e.prototype.constructor=e};o.utils.object.mixin=function(e,t){for(var o in t){e[o]=t[o]}};o.utils.object.values=function(e){return Object.values?Object.values(e):Object.keys(e).map(function(t){return e[t]})};o.Events.Ui=function(e,t,n,r){o.Events.Ui.superClass_.constructor.call(this);this.blockId=e?e.id:null;this.workspaceId=e?e.workspace.id:void 0;this.element=t;this.oldValue=n;this.newValue=r;this.recordUndo=!1};o.utils.object.inherits(o.Events.Ui,o.Events.Abstract);o.Events.Ui.prototype.type=o.Events.UI;o.Events.Ui.prototype.toJson=function(){var e=o.Events.Ui.superClass_.toJson.call(this);e.element=this.element;void 0!==this.newValue&&(e.newValue=this.newValue);this.blockId&&(e.blockId=this.blockId);return e};o.Events.Ui.prototype.fromJson=function(e){o.Events.Ui.superClass_.fromJson.call(this,e);this.element=e.element;this.newValue=e.newValue;this.blockId=e.blockId};o.utils.dom={};o.utils.dom.SVG_NS="http://www.w3.org/2000/svg";o.utils.dom.HTML_NS="http://www.w3.org/1999/xhtml";o.utils.dom.XLINK_NS="http://www.w3.org/1999/xlink";o.utils.dom.Node={ELEMENT_NODE:1,TEXT_NODE:3,COMMENT_NODE:8,DOCUMENT_POSITION_CONTAINED_BY:16};o.utils.dom.cacheWidths_=null;o.utils.dom.cacheReference_=0;o.utils.dom.canvasContext_=null;o.utils.dom.createSvgElement=function(e,t,n){e=document.createElementNS(o.utils.dom.SVG_NS,e);for(var r in t){e.setAttribute(r,t[r])}document.body.runtimeStyle&&(e.runtimeStyle=e.currentStyle=e.style);n&&n.appendChild(e);return e};o.utils.dom.addClass=function(e,t){var o=e.getAttribute("class")||"";if(-1!=(" "+o+" ").indexOf(" "+t+" "))return!1;o&&(o+=" ");e.setAttribute("class",o+t);return!0};o.utils.dom.removeClass=function(e,t){var o=e.getAttribute("class");if(-1==(" "+o+" ").indexOf(" "+t+" "))return!1;o=o.split(/\s+/);for(var n=0;n<o.length;n++){o[n]&&o[n]!=t||(o.splice(n,1),n--)}o.length?e.setAttribute("class",o.join(" ")):e.removeAttribute("class");return!0};o.utils.dom.hasClass=function(e,t){return-1!=(" "+e.getAttribute("class")+" ").indexOf(" "+t+" ")};o.utils.dom.removeNode=function(e){return e&&e.parentNode?e.parentNode.removeChild(e):null};o.utils.dom.insertAfter=function(e,t){var o=t.nextSibling;t=t.parentNode;if(!t)throw Error("Reference node has no parent.");o?t.insertBefore(e,o):t.appendChild(e)};o.utils.dom.containsNode=function(e,t){return!!(e.compareDocumentPosition(t)&o.utils.dom.Node.DOCUMENT_POSITION_CONTAINED_BY)};o.utils.dom.setCssTransform=function(e,t){e.style.transform=t;e.style["-webkit-transform"]=t};o.utils.dom.startTextWidthCache=function(){o.utils.dom.cacheReference_++;o.utils.dom.cacheWidths_||(o.utils.dom.cacheWidths_={})};o.utils.dom.stopTextWidthCache=function(){o.utils.dom.cacheReference_--;o.utils.dom.cacheReference_||(o.utils.dom.cacheWidths_=null)};o.utils.dom.getTextWidth=function(e){var t=e.textContent+"\n"+e.className.baseVal,n;if(o.utils.dom.cacheWidths_&&(n=o.utils.dom.cacheWidths_[t]))return n;try{n=o.utils.userAgent.IE||o.utils.userAgent.EDGE?e.getBBox().width:e.getComputedTextLength()}catch(t){return 8*e.textContent.length}o.utils.dom.cacheWidths_&&(o.utils.dom.cacheWidths_[t]=n);return n};o.utils.dom.getFastTextWidth=function(t,n,r,i){var s=t.textContent;t=s+"\n"+t.className.baseVal;var e;if(o.utils.dom.cacheWidths_&&(e=o.utils.dom.cacheWidths_[t]))return e;o.utils.dom.canvasContext_||(e=document.createElement("canvas"),e.className="blocklyComputeCanvas",document.body.appendChild(e),o.utils.dom.canvasContext_=e.getContext("2d"));o.utils.dom.canvasContext_.font=r+" "+n+"pt "+i;e=o.utils.dom.canvasContext_.measureText(s).width;o.utils.dom.cacheWidths_&&(o.utils.dom.cacheWidths_[t]=e);return e};o.BlockDragSurfaceSvg=function(e){this.container_=e;this.createDom()};o.BlockDragSurfaceSvg.prototype.SVG_=null;o.BlockDragSurfaceSvg.prototype.dragGroup_=null;o.BlockDragSurfaceSvg.prototype.container_=null;o.BlockDragSurfaceSvg.prototype.scale_=1;o.BlockDragSurfaceSvg.prototype.surfaceXY_=null;o.BlockDragSurfaceSvg.prototype.createDom=function(){this.SVG_||(this.SVG_=o.utils.dom.createSvgElement("svg",{xmlns:o.utils.dom.SVG_NS,"xmlns:html":o.utils.dom.HTML_NS,"xmlns:xlink":o.utils.dom.XLINK_NS,version:"1.1",class:"blocklyBlockDragSurface"},this.container_),this.dragGroup_=o.utils.dom.createSvgElement("g",{},this.SVG_))};o.BlockDragSurfaceSvg.prototype.setBlocksAndShow=function(e){if(this.dragGroup_.childNodes.length)throw Error("Already dragging a block.");this.dragGroup_.appendChild(e);this.SVG_.style.display="block";this.surfaceXY_=new o.utils.Coordinate(0,0)};o.BlockDragSurfaceSvg.prototype.translateAndScaleGroup=function(e,t,o){this.scale_=o;e=e.toFixed(0);t=t.toFixed(0);this.dragGroup_.setAttribute("transform","translate("+e+","+t+") scale("+o+")")};o.BlockDragSurfaceSvg.prototype.translateSurfaceInternal_=function(){var e=this.surfaceXY_.x,t=this.surfaceXY_.y;e=e.toFixed(0);t=t.toFixed(0);this.SVG_.style.display="block";o.utils.dom.setCssTransform(this.SVG_,"translate3d("+e+"px, "+t+"px, 0px)")};o.BlockDragSurfaceSvg.prototype.translateSurface=function(e,t){this.surfaceXY_=new o.utils.Coordinate(e*this.scale_,t*this.scale_);this.translateSurfaceInternal_()};o.BlockDragSurfaceSvg.prototype.getSurfaceTranslation=function(){var e=o.utils.getRelativeXY(this.SVG_);return new o.utils.Coordinate(e.x/this.scale_,e.y/this.scale_)};o.BlockDragSurfaceSvg.prototype.getGroup=function(){return this.dragGroup_};o.BlockDragSurfaceSvg.prototype.getCurrentBlock=function(){return this.dragGroup_.firstChild};o.BlockDragSurfaceSvg.prototype.clearAndHide=function(e){e?e.appendChild(this.getCurrentBlock()):this.dragGroup_.removeChild(this.getCurrentBlock());this.SVG_.style.display="none";if(this.dragGroup_.childNodes.length)throw Error("Drag group was not cleared.");this.surfaceXY_=null};o.utils.IdGenerator={};o.utils.IdGenerator.nextId_=0;o.utils.IdGenerator.getNextUniqueId=function(){return"blockly:"+(o.utils.IdGenerator.nextId_++).toString(36)};o.Component=function(){this.rightToLeft_=o.Component.defaultRightToLeft;this.id_=null;this.inDocument_=!1;this.parent_=this.element_=null;this.children_=[];this.childIndex_={}};o.Component.defaultRightToLeft=!1;o.Component.Error={ALREADY_RENDERED:"Component already rendered",PARENT_UNABLE_TO_BE_SET:"Unable to set parent component",CHILD_INDEX_OUT_OF_BOUNDS:"Child component index out of bounds"};o.Component.prototype.getId=function(){return this.id_||(this.id_=o.utils.IdGenerator.getNextUniqueId())};o.Component.prototype.getElement=function(){return this.element_};o.Component.prototype.setElementInternal=function(e){this.element_=e};o.Component.prototype.setParent=function(e){if(this==e)throw Error(o.Component.Error.PARENT_UNABLE_TO_BE_SET);if(e&&this.parent_&&this.id_&&this.parent_.getChild(this.id_)&&this.parent_!=e)throw Error(o.Component.Error.PARENT_UNABLE_TO_BE_SET);this.parent_=e};o.Component.prototype.getParent=function(){return this.parent_};o.Component.prototype.isInDocument=function(){return this.inDocument_};o.Component.prototype.createDom=function(){this.element_=document.createElement("div")};o.Component.prototype.render=function(e){this.render_(e)};o.Component.prototype.renderBefore=function(e){this.render_(e.parentNode,e)};o.Component.prototype.render_=function(e,t){if(this.inDocument_)throw Error(o.Component.Error.ALREADY_RENDERED);this.element_||this.createDom();e?e.insertBefore(this.element_,t||null):document.body.appendChild(this.element_);this.parent_&&!this.parent_.isInDocument()||this.enterDocument()};o.Component.prototype.enterDocument=function(){this.inDocument_=!0;this.forEachChild(function(e){!e.isInDocument()&&e.getElement()&&e.enterDocument()})};o.Component.prototype.exitDocument=function(){this.forEachChild(function(e){e.isInDocument()&&e.exitDocument()});this.inDocument_=!1};o.Component.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())};o.Component.prototype.disposeInternal=function(){this.inDocument_&&this.exitDocument();this.forEachChild(function(e){e.dispose()});this.element_&&o.utils.dom.removeNode(this.element_);this.parent_=this.element_=this.childIndex_=this.children_=null};o.Component.prototype.addChild=function(e,t){this.addChildAt(e,this.getChildCount(),t)};o.Component.prototype.addChildAt=function(e,t,n){if(e.inDocument_&&(n||!this.inDocument_))throw Error(o.Component.Error.ALREADY_RENDERED);if(0>t||t>this.getChildCount())throw Error(o.Component.Error.CHILD_INDEX_OUT_OF_BOUNDS);this.childIndex_[e.getId()]=e;if(e.getParent()==this){var r=this.children_.indexOf(e);-1<r&&this.children_.splice(r,1)}e.setParent(this);this.children_.splice(t,0,e);e.inDocument_&&this.inDocument_&&e.getParent()==this?(n=this.getContentElement(),t=n.childNodes[t]||null,t!=e.getElement()&&n.insertBefore(e.getElement(),t)):n?(this.element_||this.createDom(),t=this.getChildAt(t+1),e.render_(this.getContentElement(),t?t.element_:null)):this.inDocument_&&!e.inDocument_&&e.element_&&e.element_.parentNode&&e.element_.parentNode.nodeType==o.utils.dom.Node.ELEMENT_NODE&&e.enterDocument()};o.Component.prototype.getContentElement=function(){return this.element_};o.Component.prototype.isRightToLeft=function(){return this.rightToLeft_};o.Component.prototype.setRightToLeft=function(e){if(this.inDocument_)throw Error(o.Component.Error.ALREADY_RENDERED);this.rightToLeft_=e};o.Component.prototype.hasChildren=function(){return 0!=this.children_.length};o.Component.prototype.getChildCount=function(){return this.children_.length};o.Component.prototype.getChild=function(e){return e?this.childIndex_[e]||null:null};o.Component.prototype.getChildAt=function(e){return this.children_[e]||null};o.Component.prototype.forEachChild=function(e,t){for(var o=0;o<this.children_.length;o++){e.call(t,this.children_[o],o)}};o.Component.prototype.indexOfChild=function(e){return this.children_.indexOf(e)};o.Css={};o.Css.injected_=!1;o.Css.register=function(e){if(o.Css.injected_)throw Error("CSS already injected");Array.prototype.push.apply(o.Css.CONTENT,e);e.length=0};o.Css.inject=function(e,t){if(!o.Css.injected_){o.Css.injected_=!0;var n=o.Css.CONTENT.join("\n");o.Css.CONTENT.length=0;e&&(e=t.replace(/[\\/]$/,""),n=n.replace(/<<<PATH>>>/g,e),e=document.createElement("style"),e.id="blockly-common-style",n=document.createTextNode(n),e.appendChild(n),document.head.insertBefore(e,document.head.firstChild))}};o.Css.setCursor=function(){console.warn("Deprecated call to Blockly.Css.setCursor. See https://github.com/google/blockly/issues/981 for context")};o.Css.CONTENT=[".blocklySvg {","background-color: #fff;","outline: none;","overflow: hidden;","position: absolute;","display: block;","}",".blocklyWidgetDiv {","display: none;","position: absolute;","z-index: 99999;","}",".injectionDiv {","height: 100%;","position: relative;","overflow: hidden;","touch-action: none;","}",".blocklyNonSelectable {","user-select: none;","-ms-user-select: none;","-webkit-user-select: none;","}",".blocklyWsDragSurface {","display: none;","position: absolute;","top: 0;","left: 0;","}",".blocklyWsDragSurface.blocklyOverflowVisible {","overflow: visible;","}",".blocklyBlockDragSurface {","display: none;","position: absolute;","top: 0;","left: 0;","right: 0;","bottom: 0;","overflow: visible !important;","z-index: 50;","}",".blocklyBlockCanvas.blocklyCanvasTransitioning,",".blocklyBubbleCanvas.blocklyCanvasTransitioning {","transition: transform .5s;","}",".blocklyTooltipDiv {","background-color: #ffffc7;","border: 1px solid #ddc;","box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);","color: #000;","display: none;","font-family: sans-serif;","font-size: 9pt;","opacity: .9;","padding: 2px;","position: absolute;","z-index: 100000;","}",".blocklyDropDownDiv {","position: absolute;","left: 0;","top: 0;","z-index: 1000;","display: none;","border: 1px solid;","border-color: #dadce0;","background-color: #fff;","border-radius: 2px;","padding: 4px;","box-shadow: 0px 0px 3px 1px rgba(0,0,0,.3);","}",".blocklyDropDownDiv.focused {","box-shadow: 0px 0px 6px 1px rgba(0,0,0,.3);","}",".blocklyDropDownContent {","max-height: 300px;","overflow: auto;","overflow-x: hidden;","}",".blocklyDropDownArrow {","position: absolute;","left: 0;","top: 0;","width: 16px;","height: 16px;","z-index: -1;","background-color: inherit;","border-color: inherit;","}",".blocklyDropDownButton {","display: inline-block;","float: left;","padding: 0;","margin: 4px;","border-radius: 4px;","outline: none;","border: 1px solid;","transition: box-shadow .1s;","cursor: pointer;","}",".blocklyArrowTop {","border-top: 1px solid;","border-left: 1px solid;","border-top-left-radius: 4px;","border-color: inherit;","}",".blocklyArrowBottom {","border-bottom: 1px solid;","border-right: 1px solid;","border-bottom-right-radius: 4px;","border-color: inherit;","}",".blocklyResizeSE {","cursor: se-resize;","fill: #aaa;","}",".blocklyResizeSW {","cursor: sw-resize;","fill: #aaa;","}",".blocklyResizeLine {","stroke: #515A5A;","stroke-width: 1;","}",".blocklyHighlightedConnectionPath {","fill: none;","stroke: #fc3;","stroke-width: 4px;","}",".blocklyPathLight {","fill: none;","stroke-linecap: round;","stroke-width: 1;","}",".blocklySelected>.blocklyPathLight {","display: none;","}",".blocklyDraggable {","cursor: url(\"<<<PATH>>>/handopen.cur\"), auto;","cursor: grab;","cursor: -webkit-grab;","}",".blocklyDragging {","cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;","cursor: grabbing;","cursor: -webkit-grabbing;","}",".blocklyDraggable:active {","cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;","cursor: grabbing;","cursor: -webkit-grabbing;","}",".blocklyBlockDragSurface .blocklyDraggable {","cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;","cursor: grabbing;","cursor: -webkit-grabbing;","}",".blocklyDragging.blocklyDraggingDelete {","cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;","}",".blocklyDragging>.blocklyPath,",".blocklyDragging>.blocklyPathLight {","fill-opacity: .8;","stroke-opacity: .8;","}",".blocklyDragging>.blocklyPathDark {","display: none;","}",".blocklyDisabled>.blocklyPath {","fill-opacity: .5;","stroke-opacity: .5;","}",".blocklyDisabled>.blocklyPathLight,",".blocklyDisabled>.blocklyPathDark {","display: none;","}",".blocklyInsertionMarker>.blocklyPath,",".blocklyInsertionMarker>.blocklyPathLight,",".blocklyInsertionMarker>.blocklyPathDark {","fill-opacity: .2;","stroke: none","}",".blocklyMultilineText {","font-family: monospace;","}",".blocklyNonEditableText>text {","pointer-events: none;","}",".blocklyBubbleText {","fill: #000;","}",".blocklyFlyout {","position: absolute;","z-index: 20;","}",".blocklyText text {","cursor: default;","}",".blocklySvg text, .blocklyBlockDragSurface text {","user-select: none;","-ms-user-select: none;","-webkit-user-select: none;","cursor: inherit;","}",".blocklyHidden {","display: none;","}",".blocklyFieldDropdown:not(.blocklyHidden) {","display: block;","}",".blocklyIconGroup {","cursor: default;","}",".blocklyIconGroup:not(:hover),",".blocklyIconGroupReadonly {","opacity: .6;","}",".blocklyIconShape {","fill: #00f;","stroke: #fff;","stroke-width: 1px;","}",".blocklyIconSymbol {","fill: #fff;","}",".blocklyMinimalBody {","margin: 0;","padding: 0;","}",".blocklyHtmlInput {","border: none;","border-radius: 4px;","height: 100%;","margin: 0;","outline: none;","padding: 0;","width: 100%;","text-align: center;","display: block;","box-sizing: border-box;","}",".blocklyHtmlInput::-ms-clear {","display: none;","}",".blocklyMainBackground {","stroke-width: 1;","stroke: #c6c6c6;","}",".blocklyMutatorBackground {","fill: #fff;","stroke: #ddd;","stroke-width: 1;","}",".blocklyFlyoutBackground {","fill: #ddd;","fill-opacity: .8;","}",".blocklyMainWorkspaceScrollbar {","z-index: 20;","}",".blocklyFlyoutScrollbar {","z-index: 30;","}",".blocklyScrollbarHorizontal, .blocklyScrollbarVertical {","position: absolute;","outline: none;","}",".blocklyScrollbarBackground {","opacity: 0;","}",".blocklyScrollbarHandle {","fill: #ccc;","}",".blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,",".blocklyScrollbarHandle:hover {","fill: #bbb;","}",".blocklyFlyout .blocklyScrollbarHandle {","fill: #bbb;","}",".blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,",".blocklyFlyout .blocklyScrollbarHandle:hover {","fill: #aaa;","}",".blocklyInvalidInput {","background: #faa;","}",".blocklyContextMenu {","border-radius: 4px;","max-height: 100%;","}",".blocklyDropdownMenu {","border-radius: 2px;","padding: 0 !important;","}",".blocklyWidgetDiv .blocklyDropdownMenu .goog-menuitem,",".blocklyDropDownDiv .blocklyDropdownMenu .goog-menuitem {","padding-left: 28px;","}",".blocklyWidgetDiv .blocklyDropdownMenu .goog-menuitem.goog-menuitem-rtl,",".blocklyDropDownDiv .blocklyDropdownMenu .goog-menuitem.goog-menuitem-rtl {","padding-left: 5px;","padding-right: 28px;","}",".blocklyVerticalMarker {","stroke-width: 3px;","fill: rgba(255,255,255,.5);","}",".blocklyWidgetDiv .goog-option-selected .goog-menuitem-checkbox,",".blocklyWidgetDiv .goog-option-selected .goog-menuitem-icon,",".blocklyDropDownDiv .goog-option-selected .goog-menuitem-checkbox,",".blocklyDropDownDiv .goog-option-selected .goog-menuitem-icon {","background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;","}",".blocklyWidgetDiv .goog-menu {","background: #fff;","border-color: transparent;","border-style: solid;","border-width: 1px;","cursor: default;","font: normal 13px Arial, sans-serif;","margin: 0;","outline: none;","padding: 4px 0;","position: absolute;","overflow-y: auto;","overflow-x: hidden;","max-height: 100%;","z-index: 20000;","box-shadow: 0px 0px 3px 1px rgba(0,0,0,.3);","}",".blocklyWidgetDiv .goog-menu.focused {","box-shadow: 0px 0px 6px 1px rgba(0,0,0,.3);","}",".blocklyDropDownDiv .goog-menu {","cursor: default;","font: normal 13px \"Helvetica Neue\", Helvetica, sans-serif;","outline: none;","z-index: 20000;","}",".blocklyWidgetDiv .goog-menuitem,",".blocklyDropDownDiv .goog-menuitem {","color: #000;","font: normal 13px Arial, sans-serif;","list-style: none;","margin: 0;","min-width: 7em;","border: none;","padding: 6px 15px;","white-space: nowrap;","cursor: pointer;","}",".blocklyWidgetDiv .goog-menu-nocheckbox .goog-menuitem,",".blocklyWidgetDiv .goog-menu-noicon .goog-menuitem,",".blocklyDropDownDiv .goog-menu-nocheckbox .goog-menuitem,",".blocklyDropDownDiv .goog-menu-noicon .goog-menuitem {","padding-left: 12px;","}",".blocklyWidgetDiv .goog-menuitem-content,",".blocklyDropDownDiv .goog-menuitem-content {","font-family: Arial, sans-serif;","font-size: 13px;","}",".blocklyWidgetDiv .goog-menuitem-content {","color: #000;","}",".blocklyDropDownDiv .goog-menuitem-content {","color: #000;","}",".blocklyWidgetDiv .goog-menuitem-disabled,",".blocklyDropDownDiv .goog-menuitem-disabled {","cursor: inherit;","}",".blocklyWidgetDiv .goog-menuitem-disabled .goog-menuitem-content,",".blocklyDropDownDiv .goog-menuitem-disabled .goog-menuitem-content {","color: #ccc !important;","}",".blocklyWidgetDiv .goog-menuitem-disabled .goog-menuitem-icon,",".blocklyDropDownDiv .goog-menuitem-disabled .goog-menuitem-icon {","opacity: .3;","filter: alpha(opacity=30);","}",".blocklyWidgetDiv .goog-menuitem-highlight ,",".blocklyDropDownDiv .goog-menuitem-highlight {","background-color: rgba(0,0,0,.1);","}",".blocklyWidgetDiv .goog-menuitem-checkbox,",".blocklyWidgetDiv .goog-menuitem-icon,",".blocklyDropDownDiv .goog-menuitem-checkbox,",".blocklyDropDownDiv .goog-menuitem-icon {","background-repeat: no-repeat;","height: 16px;","left: 6px;","position: absolute;","right: auto;","vertical-align: middle;","width: 16px;","}",".blocklyWidgetDiv .goog-menuitem-rtl .goog-menuitem-checkbox,",".blocklyWidgetDiv .goog-menuitem-rtl .goog-menuitem-icon,",".blocklyDropDownDiv .goog-menuitem-rtl .goog-menuitem-checkbox,",".blocklyDropDownDiv .goog-menuitem-rtl .goog-menuitem-icon {","left: auto;","right: 6px;","}",".blocklyWidgetDiv .goog-option-selected .goog-menuitem-checkbox,",".blocklyWidgetDiv .goog-option-selected .goog-menuitem-icon,",".blocklyDropDownDiv .goog-option-selected .goog-menuitem-checkbox,",".blocklyDropDownDiv .goog-option-selected .goog-menuitem-icon {","position: static;","float: left;","margin-left: -24px;","}",".blocklyWidgetDiv .goog-menuitem-rtl .goog-menuitem-checkbox,",".blocklyWidgetDiv .goog-menuitem-rtl .goog-menuitem-icon,",".blocklyDropDownDiv .goog-menuitem-rtl .goog-menuitem-checkbox,",".blocklyDropDownDiv .goog-menuitem-rtl .goog-menuitem-icon {","float: right;","margin-right: -24px;","}",".blocklyComputeCanvas {","position: absolute;","width: 0;","height: 0;","}",".blocklyNoPointerEvents {","pointer-events: none;","}"];o.utils.math={};o.utils.math.toRadians=function(e){return e*Math.PI/180};o.utils.math.toDegrees=function(e){return 180*e/Math.PI};o.utils.math.clamp=function(e,t,o){if(o<e){var n=o;o=e;e=n}return Math.max(e,Math.min(t,o))};o.DropDownDiv=function(){};o.DropDownDiv.boundsElement_=null;o.DropDownDiv.owner_=null;o.DropDownDiv.positionToField_=null;o.DropDownDiv.ARROW_SIZE=16;o.DropDownDiv.BORDER_SIZE=1;o.DropDownDiv.ARROW_HORIZONTAL_PADDING=12;o.DropDownDiv.PADDING_Y=16;o.DropDownDiv.ANIMATION_TIME=.25;o.DropDownDiv.animateOutTimer_=null;o.DropDownDiv.onHide_=null;o.DropDownDiv.rendererClassName_=null;o.DropDownDiv.themeClassName_=null;o.DropDownDiv.createDom=function(){if(!o.DropDownDiv.DIV_){var e=document.createElement("div");e.className="blocklyDropDownDiv";document.body.appendChild(e);o.DropDownDiv.DIV_=e;var t=document.createElement("div");t.className="blocklyDropDownContent";e.appendChild(t);o.DropDownDiv.content_=t;t=document.createElement("div");t.className="blocklyDropDownArrow";e.appendChild(t);o.DropDownDiv.arrow_=t;o.DropDownDiv.DIV_.style.opacity=0;o.DropDownDiv.DIV_.style.transition="transform "+o.DropDownDiv.ANIMATION_TIME+"s, opacity "+o.DropDownDiv.ANIMATION_TIME+"s";e.addEventListener("focusin",function(){o.utils.dom.addClass(e,"focused")});e.addEventListener("focusout",function(){o.utils.dom.removeClass(e,"focused")})}};o.DropDownDiv.setBoundsElement=function(e){o.DropDownDiv.boundsElement_=e};o.DropDownDiv.getContentDiv=function(){return o.DropDownDiv.content_};o.DropDownDiv.clearContent=function(){o.DropDownDiv.content_.innerHTML="";o.DropDownDiv.content_.style.width=""};o.DropDownDiv.setColour=function(e,t){o.DropDownDiv.DIV_.style.backgroundColor=e;o.DropDownDiv.DIV_.style.borderColor=t};o.DropDownDiv.showPositionedByBlock=function(e,t,n,r){return o.DropDownDiv.showPositionedByRect_(o.DropDownDiv.getScaledBboxOfBlock_(t),e,n,r)};o.DropDownDiv.showPositionedByField=function(e,t,n){o.DropDownDiv.positionToField_=!0;return o.DropDownDiv.showPositionedByRect_(o.DropDownDiv.getScaledBboxOfField_(e),e,t,n)};o.DropDownDiv.getScaledBboxOfBlock_=function(e){var t=e.getSvgRoot(),n=t.getBBox(),r=e.workspace.scale;e=n.height*r;n=n.width*r;t=o.utils.style.getPageOffset(t);return new o.utils.Rect(t.y,t.y+e,t.x,t.x+n)};o.DropDownDiv.getScaledBboxOfField_=function(e){e=e.getScaledBBox();return new o.utils.Rect(e.top,e.bottom,e.left,e.right)};o.DropDownDiv.showPositionedByRect_=function(t,n,r,i){var s=t.left+(t.right-t.left)/2,e=t.bottom;t=t.top;i&&(t+=i);i=n.getSourceBlock();o.DropDownDiv.setBoundsElement(i.workspace.getParentSvg().parentNode);return o.DropDownDiv.show(n,i.RTL,s,e,s,t,r)};o.DropDownDiv.show=function(t,n,r,i,s,e,l){o.DropDownDiv.owner_=t;o.DropDownDiv.onHide_=l||null;t=o.DropDownDiv.DIV_;t.style.direction=n?"rtl":"ltr";o.DropDownDiv.rendererClassName_=o.getMainWorkspace().getRenderer().name+"-renderer";o.DropDownDiv.themeClassName_=o.getMainWorkspace().getTheme().name+"-theme";o.utils.dom.addClass(t,o.DropDownDiv.rendererClassName_);o.utils.dom.addClass(t,o.DropDownDiv.themeClassName_);return o.DropDownDiv.positionInternal_(r,i,s,e)};o.DropDownDiv.getBoundsInfo_=function(){var e=o.utils.style.getPageOffset(o.DropDownDiv.boundsElement_),t=o.utils.style.getSize(o.DropDownDiv.boundsElement_);return{left:e.x,right:e.x+t.width,top:e.y,bottom:e.y+t.height,width:t.width,height:t.height}};o.DropDownDiv.getPositionMetrics_=function(t,n,r,i){var s=o.DropDownDiv.getBoundsInfo_(),e=o.utils.style.getSize(o.DropDownDiv.DIV_);return n+e.height<s.bottom?o.DropDownDiv.getPositionBelowMetrics_(t,n,s,e):i-e.height>s.top?o.DropDownDiv.getPositionAboveMetrics_(r,i,s,e):n+e.height<document.documentElement.clientHeight?o.DropDownDiv.getPositionBelowMetrics_(t,n,s,e):i-e.height>document.documentElement.clientTop?o.DropDownDiv.getPositionAboveMetrics_(r,i,s,e):o.DropDownDiv.getPositionTopOfPageMetrics_(t,s,e)};o.DropDownDiv.getPositionBelowMetrics_=function(e,t,n,r){e=o.DropDownDiv.getPositionX(e,n.left,n.right,r.width);return{initialX:e.divX,initialY:t,finalX:e.divX,finalY:t+o.DropDownDiv.PADDING_Y,arrowX:e.arrowX,arrowY:-(o.DropDownDiv.ARROW_SIZE/2+o.DropDownDiv.BORDER_SIZE),arrowAtTop:!0,arrowVisible:!0}};o.DropDownDiv.getPositionAboveMetrics_=function(e,t,n,r){e=o.DropDownDiv.getPositionX(e,n.left,n.right,r.width);return{initialX:e.divX,initialY:t-r.height,finalX:e.divX,finalY:t-r.height-o.DropDownDiv.PADDING_Y,arrowX:e.arrowX,arrowY:r.height-2*o.DropDownDiv.BORDER_SIZE-o.DropDownDiv.ARROW_SIZE/2,arrowAtTop:!1,arrowVisible:!0}};o.DropDownDiv.getPositionTopOfPageMetrics_=function(e,t,n){e=o.DropDownDiv.getPositionX(e,t.left,t.right,n.width);return{initialX:e.divX,initialY:0,finalX:e.divX,finalY:0,arrowVisible:!1}};o.DropDownDiv.getPositionX=function(t,n,r,i){var s=t;t=o.utils.math.clamp(n,t-i/2,r-i);s-=o.DropDownDiv.ARROW_SIZE/2;n=o.DropDownDiv.ARROW_HORIZONTAL_PADDING;i=o.utils.math.clamp(n,s-t,i-n-o.DropDownDiv.ARROW_SIZE);return{arrowX:i,divX:t}};o.DropDownDiv.isVisible=function(){return!!o.DropDownDiv.owner_};o.DropDownDiv.hideIfOwner=function(e,t){return o.DropDownDiv.owner_===e?(t?o.DropDownDiv.hideWithoutAnimation():o.DropDownDiv.hide(),!0):!1};o.DropDownDiv.hide=function(){var e=o.DropDownDiv.DIV_;e.style.transform="translate(0, 0)";e.style.opacity=0;o.DropDownDiv.animateOutTimer_=setTimeout(function(){o.DropDownDiv.hideWithoutAnimation()},1E3*o.DropDownDiv.ANIMATION_TIME);o.DropDownDiv.onHide_&&(o.DropDownDiv.onHide_(),o.DropDownDiv.onHide_=null)};o.DropDownDiv.hideWithoutAnimation=function(){if(o.DropDownDiv.isVisible()){o.DropDownDiv.animateOutTimer_&&clearTimeout(o.DropDownDiv.animateOutTimer_);var e=o.DropDownDiv.DIV_;e.style.transform="";e.style.left="";e.style.top="";e.style.opacity=0;e.style.display="none";e.style.backgroundColor="";e.style.borderColor="";o.DropDownDiv.onHide_&&(o.DropDownDiv.onHide_(),o.DropDownDiv.onHide_=null);o.DropDownDiv.clearContent();o.DropDownDiv.owner_=null;o.DropDownDiv.rendererClassName_&&(o.utils.dom.removeClass(e,o.DropDownDiv.rendererClassName_),o.DropDownDiv.rendererClassName_=null);o.DropDownDiv.themeClassName_&&(o.utils.dom.removeClass(e,o.DropDownDiv.themeClassName_),o.DropDownDiv.themeClassName_=null);o.getMainWorkspace().markFocused()}};o.DropDownDiv.positionInternal_=function(t,n,r,i){t=o.DropDownDiv.getPositionMetrics_(t,n,r,i);t.arrowVisible?(o.DropDownDiv.arrow_.style.display="",o.DropDownDiv.arrow_.style.transform="translate("+t.arrowX+"px,"+t.arrowY+"px) rotate(45deg)",o.DropDownDiv.arrow_.setAttribute("class",t.arrowAtTop?"blocklyDropDownArrow blocklyArrowTop":"blocklyDropDownArrow blocklyArrowBottom")):o.DropDownDiv.arrow_.style.display="none";n=Math.floor(t.initialX);r=Math.floor(t.initialY);i=Math.floor(t.finalX);var s=Math.floor(t.finalY),e=o.DropDownDiv.DIV_;e.style.left=n+"px";e.style.top=r+"px";e.style.display="block";e.style.opacity=1;e.style.transform="translate("+(i-n)+"px,"+(s-r)+"px)";return t.arrowAtTop};o.DropDownDiv.repositionForWindowResize=function(){if(o.DropDownDiv.owner_){var e=o.DropDownDiv.owner_,t=o.DropDownDiv.owner_.getSourceBlock();e=o.DropDownDiv.positionToField_?o.DropDownDiv.getScaledBboxOfField_(e):o.DropDownDiv.getScaledBboxOfBlock_(t);t=e.left+(e.right-e.left)/2;o.DropDownDiv.positionInternal_(t,e.bottom,t,e.top)}else o.DropDownDiv.hide()};o.Grid=function(e,t){this.gridPattern_=e;this.spacing_=t.spacing;this.length_=t.length;this.line2_=(this.line1_=e.firstChild)&&this.line1_.nextSibling;this.snapToGrid_=t.snap};o.Grid.prototype.scale_=1;o.Grid.prototype.dispose=function(){this.gridPattern_=null};o.Grid.prototype.shouldSnap=function(){return this.snapToGrid_};o.Grid.prototype.getSpacing=function(){return this.spacing_};o.Grid.prototype.getPatternId=function(){return this.gridPattern_.id};o.Grid.prototype.update=function(e){this.scale_=e;var t=this.spacing_*e||100;this.gridPattern_.setAttribute("width",t);this.gridPattern_.setAttribute("height",t);t=Math.floor(this.spacing_/2)+.5;var o=t-this.length_/2,n=t+this.length_/2;t*=e;o*=e;n*=e;this.setLineAttributes_(this.line1_,e,o,n,t,t);this.setLineAttributes_(this.line2_,e,t,t,o,n)};o.Grid.prototype.setLineAttributes_=function(t,o,n,r,i,e){t&&(t.setAttribute("stroke-width",o),t.setAttribute("x1",n),t.setAttribute("y1",i),t.setAttribute("x2",r),t.setAttribute("y2",e))};o.Grid.prototype.moveTo=function(e,t){this.gridPattern_.setAttribute("x",e);this.gridPattern_.setAttribute("y",t);(o.utils.userAgent.IE||o.utils.userAgent.EDGE)&&this.update(this.scale_)};o.Grid.createDom=function(e,t,n){e=o.utils.dom.createSvgElement("pattern",{id:"blocklyGridPattern"+e,patternUnits:"userSpaceOnUse"},n);0<t.length&&0<t.spacing?(o.utils.dom.createSvgElement("line",{stroke:t.colour},e),1<t.length&&o.utils.dom.createSvgElement("line",{stroke:t.colour},e)):o.utils.dom.createSvgElement("line",{},e);return e};o.Theme=function(e,t,o,n){this.name=e;this.blockStyles=t;this.categoryStyles=o;this.componentStyles_=n||Object.create(null)};o.Theme.prototype.getComponentStyle=function(e){return(e=this.componentStyles_[e])&&"string"==typeof propertyValue&&this.getComponentStyle(e)?this.getComponentStyle(e):e?e+"":null};o.Theme.prototype.setComponentStyle=function(e,t){this.componentStyles_[e]=t};o.Themes={};o.Themes.Classic={};o.Themes.Classic.defaultBlockStyles={colour_blocks:{colourPrimary:"20"},list_blocks:{colourPrimary:"260"},logic_blocks:{colourPrimary:"210"},loop_blocks:{colourPrimary:"120"},math_blocks:{colourPrimary:"230"},procedure_blocks:{colourPrimary:"290"},text_blocks:{colourPrimary:"160"},variable_blocks:{colourPrimary:"330"},variable_dynamic_blocks:{colourPrimary:"310"},hat_blocks:{colourPrimary:"330",hat:"cap"}};o.Themes.Classic.categoryStyles={colour_category:{colour:"20"},list_category:{colour:"260"},logic_category:{colour:"210"},loop_category:{colour:"120"},math_category:{colour:"230"},procedure_category:{colour:"290"},text_category:{colour:"160"},variable_category:{colour:"330"},variable_dynamic_category:{colour:"310"}};o.Themes.Classic=new o.Theme("classic",o.Themes.Classic.defaultBlockStyles,o.Themes.Classic.categoryStyles);o.utils.KeyCodes={WIN_KEY_FF_LINUX:0,MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS_SIGN:43,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,FF_SEMICOLON:59,FF_EQUALS:61,FF_DASH:173,FF_HASH:163,QUESTION_MARK:63,AT_SIGN:64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLL_LOCK:145,FIRST_MEDIA_KEY:166,LAST_MEDIA_KEY:183,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,TILDE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,MAC_WK_CMD_LEFT:91,MAC_WK_CMD_RIGHT:93,WIN_IME:229,VK_NONAME:252,PHANTOM:255};o.user={};o.user.keyMap={};o.user.keyMap.map_={};o.user.keyMap.modifierKeys={SHIFT:"Shift",CONTROL:"Control",ALT:"Alt",META:"Meta"};o.user.keyMap.setActionForKey=function(e,t){var n=o.user.keyMap.getKeyByAction(t);n&&delete o.user.keyMap.map_[n];o.user.keyMap.map_[e]=t};o.user.keyMap.setKeyMap=function(e){o.user.keyMap.map_=e};o.user.keyMap.getKeyMap=function(){var e={};o.utils.object.mixin(e,o.user.keyMap.map_);return e};o.user.keyMap.getActionByKeyCode=function(e){return o.user.keyMap.map_[e]};o.user.keyMap.getKeyByAction=function(e){for(var t=Object.keys(o.user.keyMap.map_),n=0,r;r=t[n];n++){if(o.user.keyMap.map_[r].name===e.name)return r}return null};o.user.keyMap.serializeKeyEvent=function(t){for(var n=o.utils.object.values(o.user.keyMap.modifierKeys),r="",i=0,s;s=n[i];i++){t.getModifierState(s)&&(r+=s)}return r+=t.keyCode};o.user.keyMap.checkModifiers_=function(e,t){for(var o=0,n;n=e[o];o++){if(0>t.indexOf(n))throw Error(n+" is not a valid modifier key.")}};o.user.keyMap.createSerializedKey=function(t,n){var r="",i=o.utils.object.values(o.user.keyMap.modifierKeys);o.user.keyMap.checkModifiers_(n,i);for(var s=0,l;l=i[s];s++){-1<n.indexOf(l)&&(r+=l)}return r+t};o.user.keyMap.createDefaultKeyMap=function(){var t={},n=o.user.keyMap.createSerializedKey(o.utils.KeyCodes.K,[o.user.keyMap.modifierKeys.CONTROL,o.user.keyMap.modifierKeys.SHIFT]),r=o.user.keyMap.createSerializedKey(o.utils.KeyCodes.W,[o.user.keyMap.modifierKeys.SHIFT]),i=o.user.keyMap.createSerializedKey(o.utils.KeyCodes.A,[o.user.keyMap.modifierKeys.SHIFT]),s=o.user.keyMap.createSerializedKey(o.utils.KeyCodes.S,[o.user.keyMap.modifierKeys.SHIFT]),e=o.user.keyMap.createSerializedKey(o.utils.KeyCodes.D,[o.user.keyMap.modifierKeys.SHIFT]);t[o.utils.KeyCodes.W]=o.navigation.ACTION_PREVIOUS;t[o.utils.KeyCodes.A]=o.navigation.ACTION_OUT;t[o.utils.KeyCodes.S]=o.navigation.ACTION_NEXT;t[o.utils.KeyCodes.D]=o.navigation.ACTION_IN;t[o.utils.KeyCodes.I]=o.navigation.ACTION_INSERT;t[o.utils.KeyCodes.ENTER]=o.navigation.ACTION_MARK;t[o.utils.KeyCodes.X]=o.navigation.ACTION_DISCONNECT;t[o.utils.KeyCodes.T]=o.navigation.ACTION_TOOLBOX;t[o.utils.KeyCodes.E]=o.navigation.ACTION_EXIT;t[o.utils.KeyCodes.ESC]=o.navigation.ACTION_EXIT;t[n]=o.navigation.ACTION_TOGGLE_KEYBOARD_NAV;t[r]=o.navigation.ACTION_MOVE_WS_CURSOR_UP;t[i]=o.navigation.ACTION_MOVE_WS_CURSOR_LEFT;t[s]=o.navigation.ACTION_MOVE_WS_CURSOR_DOWN;t[e]=o.navigation.ACTION_MOVE_WS_CURSOR_RIGHT;return t};o.utils.xml={};o.utils.xml.NAME_SPACE="https://developers.google.com/blockly/xml";o.utils.xml.document=function(){return document};o.utils.xml.createElement=function(e){return o.utils.xml.document().createElementNS(o.utils.xml.NAME_SPACE,e)};o.utils.xml.createTextNode=function(e){return o.utils.xml.document().createTextNode(e)};o.utils.xml.textToDomDocument=function(e){return new DOMParser().parseFromString(e,"text/xml")};o.utils.xml.domToText=function(e){return new XMLSerializer().serializeToString(e)};o.Events.BlockBase=function(e){o.Events.BlockBase.superClass_.constructor.call(this);this.blockId=e.id;this.workspaceId=e.workspace.id};o.utils.object.inherits(o.Events.BlockBase,o.Events.Abstract);o.Events.BlockBase.prototype.toJson=function(){var e=o.Events.BlockBase.superClass_.toJson.call(this);e.blockId=this.blockId;return e};o.Events.BlockBase.prototype.fromJson=function(e){o.Events.BlockBase.superClass_.fromJson.call(this,e);this.blockId=e.blockId};o.Events.Change=function(t,n,r,i,s){t&&(o.Events.Change.superClass_.constructor.call(this,t),this.element=n,this.name=r,this.oldValue=i,this.newValue=s)};o.utils.object.inherits(o.Events.Change,o.Events.BlockBase);o.Events.BlockChange=o.Events.Change;o.Events.Change.prototype.type=o.Events.CHANGE;o.Events.Change.prototype.toJson=function(){var e=o.Events.Change.superClass_.toJson.call(this);e.element=this.element;this.name&&(e.name=this.name);e.newValue=this.newValue;return e};o.Events.Change.prototype.fromJson=function(e){o.Events.Change.superClass_.fromJson.call(this,e);this.element=e.element;this.name=e.name;this.newValue=e.newValue};o.Events.Change.prototype.isNull=function(){return this.oldValue==this.newValue};o.Events.Change.prototype.run=function(e){var t=this.getEventWorkspace_().getBlockById(this.blockId);if(t)switch(t.mutator&&t.mutator.setVisible(!1),e=e?this.newValue:this.oldValue,this.element){case"field":(t=t.getField(this.name))?t.setValue(e):console.warn("Can't set non-existent field: "+this.name);break;case"comment":t.setCommentText(e||null);break;case"collapsed":t.setCollapsed(!!e);break;case"disabled":t.setEnabled(!e);break;case"inline":t.setInputsInline(!!e);break;case"mutation":var n="";t.mutationToDom&&(n=(n=t.mutationToDom())&&o.Xml.domToText(n));if(t.domToMutation){var r=o.Xml.textToDom(e||"<mutation/>");t.domToMutation(r)}o.Events.fire(new o.Events.Change(t,"mutation",null,n,e));break;default:console.warn("Unknown change type: "+this.element);}else console.warn("Can't change non-existent block: "+this.blockId)};o.Events.Create=function(e){e&&(o.Events.Create.superClass_.constructor.call(this,e),this.xml=e.workspace.rendered?o.Xml.blockToDomWithXY(e):o.Xml.blockToDom(e),this.ids=o.Events.getDescendantIds(e))};o.utils.object.inherits(o.Events.Create,o.Events.BlockBase);o.Events.BlockCreate=o.Events.Create;o.Events.Create.prototype.type=o.Events.CREATE;o.Events.Create.prototype.toJson=function(){var e=o.Events.Create.superClass_.toJson.call(this);e.xml=o.Xml.domToText(this.xml);e.ids=this.ids;return e};o.Events.Create.prototype.fromJson=function(e){o.Events.Create.superClass_.fromJson.call(this,e);this.xml=o.Xml.textToDom(e.xml);this.ids=e.ids};o.Events.Create.prototype.run=function(e){var t=this.getEventWorkspace_();if(e)e=o.utils.xml.createElement("xml"),e.appendChild(this.xml),o.Xml.domToWorkspace(e,t);else{e=0;for(var n,r;n=this.ids[e];e++){r=t.getBlockById(n);r?r.dispose(!1):n==this.blockId&&console.warn("Can't uncreate non-existent block: "+n)}}};o.Events.Delete=function(e){if(e){if(e.getParent())throw Error("Connected blocks cannot be deleted.");o.Events.Delete.superClass_.constructor.call(this,e);this.oldXml=e.workspace.rendered?o.Xml.blockToDomWithXY(e):o.Xml.blockToDom(e);this.ids=o.Events.getDescendantIds(e)}};o.utils.object.inherits(o.Events.Delete,o.Events.BlockBase);o.Events.BlockDelete=o.Events.Delete;o.Events.Delete.prototype.type=o.Events.DELETE;o.Events.Delete.prototype.toJson=function(){var e=o.Events.Delete.superClass_.toJson.call(this);e.ids=this.ids;return e};o.Events.Delete.prototype.fromJson=function(e){o.Events.Delete.superClass_.fromJson.call(this,e);this.ids=e.ids};o.Events.Delete.prototype.run=function(e){var t=this.getEventWorkspace_();if(e){e=0;for(var n,r;n=this.ids[e];e++){r=t.getBlockById(n);r?r.dispose(!1):n==this.blockId&&console.warn("Can't delete non-existent block: "+n)}}else e=o.utils.xml.createElement("xml"),e.appendChild(this.oldXml),o.Xml.domToWorkspace(e,t)};o.Events.Move=function(e){e&&(o.Events.Move.superClass_.constructor.call(this,e),e=this.currentLocation_(),this.oldParentId=e.parentId,this.oldInputName=e.inputName,this.oldCoordinate=e.coordinate)};o.utils.object.inherits(o.Events.Move,o.Events.BlockBase);o.Events.BlockMove=o.Events.Move;o.Events.Move.prototype.type=o.Events.MOVE;o.Events.Move.prototype.toJson=function(){var e=o.Events.Move.superClass_.toJson.call(this);this.newParentId&&(e.newParentId=this.newParentId);this.newInputName&&(e.newInputName=this.newInputName);this.newCoordinate&&(e.newCoordinate=Math.round(this.newCoordinate.x)+","+Math.round(this.newCoordinate.y));return e};o.Events.Move.prototype.fromJson=function(e){o.Events.Move.superClass_.fromJson.call(this,e);this.newParentId=e.newParentId;this.newInputName=e.newInputName;e.newCoordinate&&(e=e.newCoordinate.split(","),this.newCoordinate=new o.utils.Coordinate(+e[0],+e[1]))};o.Events.Move.prototype.recordNew=function(){var e=this.currentLocation_();this.newParentId=e.parentId;this.newInputName=e.inputName;this.newCoordinate=e.coordinate};o.Events.Move.prototype.currentLocation_=function(){var e=this.getEventWorkspace_().getBlockById(this.blockId),t={},o=e.getParent();if(o){if(t.parentId=o.id,e=o.getInputWithBlock(e))t.inputName=e.name}else t.coordinate=e.getRelativeToSurfaceXY();return t};o.Events.Move.prototype.isNull=function(){return this.oldParentId==this.newParentId&&this.oldInputName==this.newInputName&&o.utils.Coordinate.equals(this.oldCoordinate,this.newCoordinate)};o.Events.Move.prototype.run=function(t){var n=this.getEventWorkspace_(),r=n.getBlockById(this.blockId);if(r){var i=t?this.newParentId:this.oldParentId,s=t?this.newInputName:this.oldInputName;t=t?this.newCoordinate:this.oldCoordinate;var l=null;if(i&&(l=n.getBlockById(i),!l)){console.warn("Can't connect to non-existent block: "+i);return}r.getParent()&&r.unplug();if(t)s=r.getRelativeToSurfaceXY(),r.moveBy(t.x-s.x,t.y-s.y);else{r=r.outputConnection||r.previousConnection;if(s){if(n=l.getInput(s))var p=n.connection}else r.type==o.PREVIOUS_STATEMENT&&(p=l.nextConnection);p?r.connect(p):console.warn("Can't connect to non-existent input: "+s)}}else console.warn("Can't move non-existent block: "+this.blockId)};o.Events.FinishedLoading=function(e){this.workspaceId=e.id;this.group=o.Events.getGroup();this.recordUndo=!1};o.utils.object.inherits(o.Events.FinishedLoading,o.Events.Ui);o.Events.FinishedLoading.prototype.type=o.Events.FINISHED_LOADING;o.Events.FinishedLoading.prototype.toJson=function(){var e={type:this.type};this.group&&(e.group=this.group);this.workspaceId&&(e.workspaceId=this.workspaceId);return e};o.Events.FinishedLoading.prototype.fromJson=function(e){this.workspaceId=e.workspaceId;this.group=e.group};o.Events.VarBase=function(e){o.Events.VarBase.superClass_.constructor.call(this);this.varId=e.getId();this.workspaceId=e.workspace.id};o.utils.object.inherits(o.Events.VarBase,o.Events.Abstract);o.Events.VarBase.prototype.toJson=function(){var e=o.Events.VarBase.superClass_.toJson.call(this);e.varId=this.varId;return e};o.Events.VarBase.prototype.fromJson=function(e){o.Events.VarBase.superClass_.toJson.call(this);this.varId=e.varId};o.Events.VarCreate=function(e){e&&(o.Events.VarCreate.superClass_.constructor.call(this,e),this.varType=e.type,this.varName=e.name)};o.utils.object.inherits(o.Events.VarCreate,o.Events.VarBase);o.Events.VarCreate.prototype.type=o.Events.VAR_CREATE;o.Events.VarCreate.prototype.toJson=function(){var e=o.Events.VarCreate.superClass_.toJson.call(this);e.varType=this.varType;e.varName=this.varName;return e};o.Events.VarCreate.prototype.fromJson=function(e){o.Events.VarCreate.superClass_.fromJson.call(this,e);this.varType=e.varType;this.varName=e.varName};o.Events.VarCreate.prototype.run=function(e){var t=this.getEventWorkspace_();e?t.createVariable(this.varName,this.varType,this.varId):t.deleteVariableById(this.varId)};o.Events.VarDelete=function(e){e&&(o.Events.VarDelete.superClass_.constructor.call(this,e),this.varType=e.type,this.varName=e.name)};o.utils.object.inherits(o.Events.VarDelete,o.Events.VarBase);o.Events.VarDelete.prototype.type=o.Events.VAR_DELETE;o.Events.VarDelete.prototype.toJson=function(){var e=o.Events.VarDelete.superClass_.toJson.call(this);e.varType=this.varType;e.varName=this.varName;return e};o.Events.VarDelete.prototype.fromJson=function(e){o.Events.VarDelete.superClass_.fromJson.call(this,e);this.varType=e.varType;this.varName=e.varName};o.Events.VarDelete.prototype.run=function(e){var t=this.getEventWorkspace_();e?t.deleteVariableById(this.varId):t.createVariable(this.varName,this.varType,this.varId)};o.Events.VarRename=function(e,t){e&&(o.Events.VarRename.superClass_.constructor.call(this,e),this.oldName=e.name,this.newName=t)};o.utils.object.inherits(o.Events.VarRename,o.Events.VarBase);o.Events.VarRename.prototype.type=o.Events.VAR_RENAME;o.Events.VarRename.prototype.toJson=function(){var e=o.Events.VarRename.superClass_.toJson.call(this);e.oldName=this.oldName;e.newName=this.newName;return e};o.Events.VarRename.prototype.fromJson=function(e){o.Events.VarRename.superClass_.fromJson.call(this,e);this.oldName=e.oldName;this.newName=e.newName};o.Events.VarRename.prototype.run=function(e){var t=this.getEventWorkspace_();e?t.renameVariableById(this.varId,this.newName):t.renameVariableById(this.varId,this.oldName)};o.Xml={};o.Xml.workspaceToDom=function(t,n){var r=o.utils.xml.createElement("xml"),i=o.Xml.variablesToDom(o.Variables.allUsedVarModels(t));i.hasChildNodes()&&r.appendChild(i);var s=t.getTopComments(!0);i=0;for(var l;l=s[i];i++){r.appendChild(l.toXmlWithXY(n))}t=t.getTopBlocks(!0);for(i=0;s=t[i];i++){r.appendChild(o.Xml.blockToDomWithXY(s,n))}return r};o.Xml.variablesToDom=function(t){for(var n=o.utils.xml.createElement("variables"),r=0,i,s;i=t[r];r++){s=o.utils.xml.createElement("variable");s.appendChild(o.utils.xml.createTextNode(i.name));i.type&&s.setAttribute("type",i.type);s.id=i.getId();n.appendChild(s)}return n};o.Xml.blockToDomWithXY=function(e,t){var n;e.workspace.RTL&&(n=e.workspace.getWidth());t=o.Xml.blockToDom(e,t);var r=e.getRelativeToSurfaceXY();t.setAttribute("x",Math.round(e.workspace.RTL?n-r.x:r.x));t.setAttribute("y",Math.round(r.y));return t};o.Xml.fieldToDom_=function(e){if(e.isSerializable()){var t=o.utils.xml.createElement("field");t.setAttribute("name",e.name||"");return e.toXml(t)}return null};o.Xml.allFieldsToDom_=function(t,n){for(var r=0,i;i=t.inputList[r];r++){for(var s=0,l;l=i.fieldRow[s];s++){(l=o.Xml.fieldToDom_(l))&&n.appendChild(l)}}};o.Xml.blockToDom=function(t,n){var r=o.utils.xml.createElement(t.isShadow()?"shadow":"block");r.setAttribute("type",t.type);n||r.setAttribute("id",t.id);if(t.mutationToDom){var i=t.mutationToDom();i&&(i.hasChildNodes()||i.hasAttributes())&&r.appendChild(i)}o.Xml.allFieldsToDom_(t,r);if(i=t.getCommentText()){var s=t.commentModel.size,l=t.commentModel.pinned,a=o.utils.xml.createElement("comment");a.appendChild(o.utils.xml.createTextNode(i));a.setAttribute("pinned",l);a.setAttribute("h",s.height);a.setAttribute("w",s.width);r.appendChild(a)}t.data&&(i=o.utils.xml.createElement("data"),i.appendChild(o.utils.xml.createTextNode(t.data)),r.appendChild(i));for(s=0;l=t.inputList[s];s++){var c;a=!0;if(l.type!=o.DUMMY_INPUT){var p=l.connection.targetBlock();l.type==o.INPUT_VALUE?c=o.utils.xml.createElement("value"):l.type==o.NEXT_STATEMENT&&(c=o.utils.xml.createElement("statement"));i=l.connection.getShadowDom();!i||p&&p.isShadow()||c.appendChild(o.Xml.cloneShadow_(i,n));p&&(c.appendChild(o.Xml.blockToDom(p,n)),a=!1);c.setAttribute("name",l.name);a||r.appendChild(c)}}void 0!=t.inputsInline&&t.inputsInline!=t.inputsInlineDefault&&r.setAttribute("inline",t.inputsInline);t.isCollapsed()&&r.setAttribute("collapsed",!0);t.isEnabled()||r.setAttribute("disabled",!0);t.isDeletable()||t.isShadow()||r.setAttribute("deletable",!1);t.isMovable()||t.isShadow()||r.setAttribute("movable",!1);t.isEditable()||r.setAttribute("editable",!1);if(s=t.getNextBlock())c=o.utils.xml.createElement("next"),c.appendChild(o.Xml.blockToDom(s,n)),r.appendChild(c);i=t.nextConnection&&t.nextConnection.getShadowDom();!i||s&&s.isShadow()||c.appendChild(o.Xml.cloneShadow_(i,n));return r};o.Xml.cloneShadow_=function(e,t){for(var n=e=e.cloneNode(!0),r;n;){if(t&&"shadow"==n.nodeName&&n.removeAttribute("id"),n.firstChild)n=n.firstChild;else{for(;n&&!n.nextSibling;){r=n,n=n.parentNode,r.nodeType==o.utils.dom.Node.TEXT_NODE&&""==r.data.trim()&&n.firstChild!=r&&o.utils.dom.removeNode(r)}n&&(r=n,n=n.nextSibling,r.nodeType==o.utils.dom.Node.TEXT_NODE&&""==r.data.trim()&&o.utils.dom.removeNode(r))}}return e};o.Xml.domToText=function(e){e=o.utils.xml.domToText(e);var t=/(<[^/](?:[^>]*[^/])?>[^<]*)\n([^<]*<\/)/;do{var n=e;e=e.replace(t,"$1&#10;$2")}while(e!=n);return e};o.Xml.domToPrettyText=function(e){e=o.Xml.domToText(e).split("<");for(var t="",n=1,r;n<e.length;n++){r=e[n];"/"==r[0]&&(t=t.substring(2));e[n]=t+"<"+r;"/"!=r[0]&&"/>"!=r.slice(-2)&&(t+="  ")}e=e.join("\n");e=e.replace(/(<(\w+)\b[^>]*>[^\n]*)\n *<\/\2>/g,"$1</$2>");return e.replace(/^\n/,"")};o.Xml.textToDom=function(e){var t=o.utils.xml.textToDomDocument(e);if(!t||!t.documentElement||t.getElementsByTagName("parsererror").length)throw Error("textToDom was unable to parse: "+e);return t.documentElement};o.Xml.clearWorkspaceAndLoadFromXml=function(e,t){t.setResizesEnabled(!1);t.clear();e=o.Xml.domToWorkspace(e,t);t.setResizesEnabled(!0);return e};o.Xml.domToWorkspace=function(t,r){if(t instanceof o.Workspace){var i=t;t=r;r=i;console.warn("Deprecated call to Blockly.Xml.domToWorkspace, swap the arguments.")}var s;r.RTL&&(s=r.getWidth());i=[];o.utils.dom.startTextWidthCache();var u=o.Events.getGroup();u||o.Events.setGroup(!0);r.setResizesEnabled&&r.setResizesEnabled(!1);var e=!0;try{for(var _=0,y;y=t.childNodes[_];_++){var T=y.nodeName.toLowerCase(),k=y;if("block"==T||"shadow"==T&&!o.Events.recordUndo){var l=o.Xml.domToBlock(k,r);i.push(l.id);var m=k.hasAttribute("x")?parseInt(k.getAttribute("x"),10):10,n=k.hasAttribute("y")?parseInt(k.getAttribute("y"),10):10;isNaN(m)||isNaN(n)||l.moveBy(r.RTL?s-m:m,n);e=!1}else{if("shadow"==T)throw TypeError("Shadow block cannot be a top-level block.");if("comment"==T)r.rendered?o.WorkspaceCommentSvg?o.WorkspaceCommentSvg.fromXml(k,r,s):console.warn("Missing require for Blockly.WorkspaceCommentSvg, ignoring workspace comment."):o.WorkspaceComment?o.WorkspaceComment.fromXml(k,r):console.warn("Missing require for Blockly.WorkspaceComment, ignoring workspace comment.");else if("variables"==T){if(e)o.Xml.domToVariables(k,r);else throw Error("'variables' tag must exist once before block and shadow tag elements in the workspace XML, but it was found in another location.");e=!1}}}}finally{u||o.Events.setGroup(!1),o.utils.dom.stopTextWidthCache()}r.setResizesEnabled&&r.setResizesEnabled(!0);o.Events.fire(new o.Events.FinishedLoading(r));return i};o.Xml.appendDomToWorkspace=function(t,n){var r;n.hasOwnProperty("scale")&&(r=n.getBlocksBoundingBox());t=o.Xml.domToWorkspace(t,n);if(r&&r.top!=r.bottom){var i=r.bottom,s=n.RTL?r.right:r.left,l=1/0,p=-Infinity,u=1/0;for(r=0;r<t.length;r++){var _=n.getBlockById(t[r]).getRelativeToSurfaceXY();_.y<u&&(u=_.y);_.x<l&&(l=_.x);_.x>p&&(p=_.x)}i=i-u+10;s=n.RTL?s-p:s-l;for(r=0;r<t.length;r++){n.getBlockById(t[r]).moveBy(s,i)}}return t};o.Xml.domToBlock=function(t,n){if(t instanceof o.Workspace){var r=t;t=n;n=r;console.warn("Deprecated call to Blockly.Xml.domToBlock, swap the arguments.")}o.Events.disable();r=n.getAllVariables();try{var i=o.Xml.domToBlockHeadless_(t,n),s=i.getDescendants(!1);if(n.rendered){i.setConnectionTracking(!1);for(var e=s.length-1;0<=e;e--){s[e].initSvg()}for(e=s.length-1;0<=e;e--){s[e].render(!1)}setTimeout(function(){i.disposed||i.setConnectionTracking(!0)},1);i.updateDisabled();n.resizeContents()}else for(e=s.length-1;0<=e;e--){s[e].initModel()}}finally{o.Events.enable()}if(o.Events.isEnabled()){t=o.Variables.getAddedVariables(n,r);for(e=0;e<t.length;e++){o.Events.fire(new o.Events.VarCreate(t[e]))}o.Events.fire(new o.Events.BlockCreate(i))}return i};o.Xml.domToVariables=function(t,n){for(var r=0,i;i=t.childNodes[r];r++){if(i.nodeType==o.utils.dom.Node.ELEMENT_NODE){var s=i.getAttribute("type"),e=i.getAttribute("id");n.createVariable(i.textContent,s,e)}}};o.Xml.domToBlockHeadless_=function(t,n){var r=null,i=t.getAttribute("type");if(!i)throw TypeError("Block type unspecified: "+t.outerHTML);var s=t.getAttribute("id");r=n.newBlock(i,s);var p=null;s=0;for(var d;d=t.childNodes[s];s++){if(d.nodeType!=o.utils.dom.Node.TEXT_NODE){for(var u=p=null,_=0,y;y=d.childNodes[_];_++){y.nodeType==o.utils.dom.Node.ELEMENT_NODE&&("block"==y.nodeName.toLowerCase()?p=y:"shadow"==y.nodeName.toLowerCase()&&(u=y))}!p&&u&&(p=u);y=d.getAttribute("name");_=d;switch(d.nodeName.toLowerCase()){case"mutation":r.domToMutation&&(r.domToMutation(_),r.initSvg&&r.initSvg());break;case"comment":if(!o.Comment){console.warn("Missing require for Blockly.Comment, ignoring block comment.");break}p=_.textContent;u="true"==_.getAttribute("pinned");d=parseInt(_.getAttribute("w"),10);_=parseInt(_.getAttribute("h"),10);r.setCommentText(p);r.commentModel.pinned=u;isNaN(d)||isNaN(_)||(r.commentModel.size=new o.utils.Size(d,_));u&&r.getCommentIcon&&!r.isInFlyout&&setTimeout(function(){r.getCommentIcon().setVisible(!0)},1);break;case"data":r.data=d.textContent;break;case"title":case"field":o.Xml.domToField_(r,y,_);break;case"value":case"statement":_=r.getInput(y);if(!_){console.warn("Ignoring non-existent input "+y+" in block "+i);break}u&&_.connection.setShadowDom(u);if(p)if(p=o.Xml.domToBlockHeadless_(p,n),p.outputConnection)_.connection.connect(p.outputConnection);else if(p.previousConnection)_.connection.connect(p.previousConnection);else throw TypeError("Child block does not have output or previous statement.");break;case"next":u&&r.nextConnection&&r.nextConnection.setShadowDom(u);if(p){if(!r.nextConnection)throw TypeError("Next statement does not exist.");if(r.nextConnection.isConnected())throw TypeError("Next statement is already connected.");p=o.Xml.domToBlockHeadless_(p,n);if(!p.previousConnection)throw TypeError("Next block does not have previous statement.");r.nextConnection.connect(p.previousConnection)}break;default:console.warn("Ignoring unknown tag: "+d.nodeName);}}}(s=t.getAttribute("inline"))&&r.setInputsInline("true"==s);(s=t.getAttribute("disabled"))&&r.setEnabled("true"!=s&&"disabled"!=s);(s=t.getAttribute("deletable"))&&r.setDeletable("true"==s);(s=t.getAttribute("movable"))&&r.setMovable("true"==s);(s=t.getAttribute("editable"))&&r.setEditable("true"==s);(s=t.getAttribute("collapsed"))&&r.setCollapsed("true"==s);if("shadow"==t.nodeName.toLowerCase()){t=r.getChildren(!1);for(s=0;n=t[s];s++){if(!n.isShadow())throw TypeError("Shadow block not allowed non-shadow child.")}if(r.getVarModels().length)throw TypeError("Shadow blocks cannot have variable references.");r.setShadow(!0)}return r};o.Xml.domToField_=function(e,t,o){var n=e.getField(t);n?n.fromXml(o):console.warn("Ignoring non-existent field "+t+" in block "+e.type)};o.Xml.deleteNext=function(e){for(var t=0,o;o=e.childNodes[t];t++){if("next"==o.nodeName.toLowerCase()){e.removeChild(o);break}}};o.Options=function(i){var s=!!i.readOnly;if(s)var a=null,_=!1,b=!1,y=!1,T=!1,C=!1,E=!1;else{a=o.Options.parseToolboxTree(i.toolbox||null);_=!(!a||!a.getElementsByTagName("category").length);b=i.trashcan;void 0===b&&(b=_);var S=i.maxTrashcanContents;b?void 0===S&&(S=32):S=0;y=i.collapse;void 0===y&&(y=_);T=i.comments;void 0===T&&(T=_);C=i.disable;void 0===C&&(C=_);E=i.sounds;void 0===E&&(E=!0)}var R=!!i.rtl,m=i.horizontalLayout;void 0===m&&(m=!1);var D=i.toolboxPosition;D="end"!==D;D=m?D?o.TOOLBOX_AT_TOP:o.TOOLBOX_AT_BOTTOM:D==R?o.TOOLBOX_AT_RIGHT:o.TOOLBOX_AT_LEFT;var I=i.css;void 0===I&&(I=!0);var w="https://blockly-demo.appspot.com/static/media/";i.media?w=i.media:i.path&&(w=i.path+"media/");var A=void 0===i.oneBasedIndex?!0:!!i.oneBasedIndex,t=i.keyMap||o.user.keyMap.createDefaultKeyMap(),u=i.renderer||"geras";this.RTL=R;this.oneBasedIndex=A;this.collapse=y;this.comments=T;this.disable=C;this.readOnly=s;this.maxBlocks=i.maxBlocks||1/0;this.maxInstances=i.maxInstances;this.pathToMedia=w;this.hasCategories=_;this.moveOptions=o.Options.parseMoveOptions(i,_);this.hasScrollbars=this.moveOptions.scrollbars;this.hasTrashcan=b;this.maxTrashcanContents=S;this.hasSounds=E;this.hasCss=I;this.horizontalLayout=m;this.languageTree=a;this.gridOptions=o.Options.parseGridOptions_(i);this.zoomOptions=o.Options.parseZoomOptions_(i);this.toolboxPosition=D;this.theme=o.Options.parseThemeOptions_(i);this.keyMap=t;this.renderer=u;this.gridPattern=void 0;this.parentWorkspace=i.parentWorkspace};o.BlocklyOptions=function(){};o.Options.parseMoveOptions=function(e,t){var o=e.move||{},n={};n.scrollbars=void 0===o.scrollbars&&void 0===e.scrollbars?t:!!o.scrollbars||!!e.scrollbars;n.wheel=n.scrollbars&&void 0!==o.wheel?!!o.wheel:!1;n.drag=n.scrollbars?void 0===o.drag?!0:!!o.drag:!1;return n};o.Options.parseZoomOptions_=function(e){e=e.zoom||{};var t={controls:void 0===e.controls?!1:!!e.controls,wheel:void 0===e.wheel?!1:!!e.wheel,startScale:void 0===e.startScale?1:+e.startScale,maxScale:void 0===e.maxScale?3:+e.maxScale,minScale:void 0===e.minScale?.3:+e.minScale,scaleSpeed:void 0===e.scaleSpeed?1.2:+e.scaleSpeed};t.pinch=void 0===e.pinch?t.wheel||t.controls:!!e.pinch;return t};o.Options.parseGridOptions_=function(e){e=e.grid||{};var t={spacing:+e.spacing||0,colour:e.colour||"#888",length:void 0===e.length?1:+e.length};t.snap=0<t.spacing&&!!e.snap;return t};o.Options.parseThemeOptions_=function(e){e=e.theme||o.Themes.Classic;return e instanceof o.Theme?e:new o.Theme("builtin",e.blockStyles,e.categoryStyles,e.componentStyles)};o.Options.parseToolboxTree=function(e){if(e){if("string"!=typeof e&&(o.utils.userAgent.IE&&e.outerHTML?e=e.outerHTML:e instanceof Element||(e=null)),"string"==typeof e&&(e=o.Xml.textToDom(e),"xml"!=e.nodeName.toLowerCase()))throw TypeError("Toolbox should be an <xml> document.")}else e=null;return e};o.Touch={};o.Touch.TOUCH_ENABLED="ontouchstart"in o.utils.global||!!(o.utils.global.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!o.utils.global.navigator||!o.utils.global.navigator.maxTouchPoints&&!o.utils.global.navigator.msMaxTouchPoints);o.Touch.touchIdentifier_=null;o.Touch.TOUCH_MAP={};o.utils.global.PointerEvent?o.Touch.TOUCH_MAP={mousedown:["pointerdown"],mouseenter:["pointerenter"],mouseleave:["pointerleave"],mousemove:["pointermove"],mouseout:["pointerout"],mouseover:["pointerover"],mouseup:["pointerup","pointercancel"],touchend:["pointerup"],touchcancel:["pointercancel"]}:o.Touch.TOUCH_ENABLED&&(o.Touch.TOUCH_MAP={mousedown:["touchstart"],mousemove:["touchmove"],mouseup:["touchend","touchcancel"]});o.longPid_=0;o.longStart=function(e,t){o.longStop_();e.changedTouches&&1!=e.changedTouches.length||(o.longPid_=setTimeout(function(){e.changedTouches&&(e.button=2,e.clientX=e.changedTouches[0].clientX,e.clientY=e.changedTouches[0].clientY);t&&t.handleRightClick(e)},o.LONGPRESS))};o.longStop_=function(){o.longPid_&&(clearTimeout(o.longPid_),o.longPid_=0)};o.Touch.clearTouchIdentifier=function(){o.Touch.touchIdentifier_=null};o.Touch.shouldHandleEvent=function(e){return!o.Touch.isMouseOrTouchEvent(e)||o.Touch.checkTouchIdentifier(e)};o.Touch.getTouchIdentifierFromEvent=function(e){return void 0!=e.pointerId?e.pointerId:e.changedTouches&&e.changedTouches[0]&&void 0!==e.changedTouches[0].identifier&&null!==e.changedTouches[0].identifier?e.changedTouches[0].identifier:"mouse"};o.Touch.checkTouchIdentifier=function(e){var t=o.Touch.getTouchIdentifierFromEvent(e);return void 0!==o.Touch.touchIdentifier_&&null!==o.Touch.touchIdentifier_?o.Touch.touchIdentifier_==t:"mousedown"==e.type||"touchstart"==e.type||"pointerdown"==e.type?(o.Touch.touchIdentifier_=t,!0):!1};o.Touch.setClientFromTouch=function(e){if(o.utils.string.startsWith(e.type,"touch")){var t=e.changedTouches[0];e.clientX=t.clientX;e.clientY=t.clientY}};o.Touch.isMouseOrTouchEvent=function(e){return o.utils.string.startsWith(e.type,"touch")||o.utils.string.startsWith(e.type,"mouse")||o.utils.string.startsWith(e.type,"pointer")};o.Touch.isTouchEvent=function(e){return o.utils.string.startsWith(e.type,"touch")||o.utils.string.startsWith(e.type,"pointer")};o.Touch.splitEventByTouches=function(e){var t=[];if(e.changedTouches)for(var o=0;o<e.changedTouches.length;o++){t[o]={type:e.type,changedTouches:[e.changedTouches[o]],target:e.target,stopPropagation:function stopPropagation(){e.stopPropagation()},preventDefault:function preventDefault(){e.preventDefault()}}}else t.push(e);return t};o.ScrollbarPair=function(e){this.workspace_=e;this.hScroll=new o.Scrollbar(e,!0,!0,"blocklyMainWorkspaceScrollbar");this.vScroll=new o.Scrollbar(e,!1,!0,"blocklyMainWorkspaceScrollbar");this.corner_=o.utils.dom.createSvgElement("rect",{height:o.Scrollbar.scrollbarThickness,width:o.Scrollbar.scrollbarThickness,class:"blocklyScrollbarBackground"},null);o.utils.dom.insertAfter(this.corner_,e.getBubbleCanvas())};o.ScrollbarPair.prototype.oldHostMetrics_=null;o.ScrollbarPair.prototype.dispose=function(){o.utils.dom.removeNode(this.corner_);this.oldHostMetrics_=this.workspace_=this.corner_=null;this.hScroll.dispose();this.hScroll=null;this.vScroll.dispose();this.vScroll=null};o.ScrollbarPair.prototype.resize=function(){var e=this.workspace_.getMetrics();if(e){var t=!1,o=!1;this.oldHostMetrics_&&this.oldHostMetrics_.viewWidth==e.viewWidth&&this.oldHostMetrics_.viewHeight==e.viewHeight&&this.oldHostMetrics_.absoluteTop==e.absoluteTop&&this.oldHostMetrics_.absoluteLeft==e.absoluteLeft?(this.oldHostMetrics_&&this.oldHostMetrics_.contentWidth==e.contentWidth&&this.oldHostMetrics_.viewLeft==e.viewLeft&&this.oldHostMetrics_.contentLeft==e.contentLeft||(t=!0),this.oldHostMetrics_&&this.oldHostMetrics_.contentHeight==e.contentHeight&&this.oldHostMetrics_.viewTop==e.viewTop&&this.oldHostMetrics_.contentTop==e.contentTop||(o=!0)):o=t=!0;t&&this.hScroll.resize(e);o&&this.vScroll.resize(e);this.oldHostMetrics_&&this.oldHostMetrics_.viewWidth==e.viewWidth&&this.oldHostMetrics_.absoluteLeft==e.absoluteLeft||this.corner_.setAttribute("x",this.vScroll.position_.x);this.oldHostMetrics_&&this.oldHostMetrics_.viewHeight==e.viewHeight&&this.oldHostMetrics_.absoluteTop==e.absoluteTop||this.corner_.setAttribute("y",this.hScroll.position_.y);this.oldHostMetrics_=e}};o.ScrollbarPair.prototype.set=function(e,t){var o={};e*=this.hScroll.ratio_;t*=this.vScroll.ratio_;var n=this.vScroll.scrollViewSize_;o.x=this.getRatio_(e,this.hScroll.scrollViewSize_);o.y=this.getRatio_(t,n);this.workspace_.setMetrics(o);this.hScroll.setHandlePosition(e);this.vScroll.setHandlePosition(t)};o.ScrollbarPair.prototype.getRatio_=function(e,t){e/=t;return isNaN(e)?0:e};o.Scrollbar=function(e,t,n,r){this.workspace_=e;this.pair_=n||!1;this.horizontal_=t;this.oldHostMetrics_=null;this.createDom_(r);this.position_=new o.utils.Coordinate(0,0);e=o.Scrollbar.scrollbarThickness;t?(this.svgBackground_.setAttribute("height",e),this.outerSvg_.setAttribute("height",e),this.svgHandle_.setAttribute("height",e-5),this.svgHandle_.setAttribute("y",2.5),this.lengthAttribute_="width",this.positionAttribute_="x"):(this.svgBackground_.setAttribute("width",e),this.outerSvg_.setAttribute("width",e),this.svgHandle_.setAttribute("width",e-5),this.svgHandle_.setAttribute("x",2.5),this.lengthAttribute_="height",this.positionAttribute_="y");this.onMouseDownBarWrapper_=o.bindEventWithChecks_(this.svgBackground_,"mousedown",this,this.onMouseDownBar_);this.onMouseDownHandleWrapper_=o.bindEventWithChecks_(this.svgHandle_,"mousedown",this,this.onMouseDownHandle_)};o.Scrollbar.prototype.origin_=new o.utils.Coordinate(0,0);o.Scrollbar.prototype.startDragMouse_=0;o.Scrollbar.prototype.scrollViewSize_=0;o.Scrollbar.prototype.handleLength_=0;o.Scrollbar.prototype.handlePosition_=0;o.Scrollbar.prototype.isVisible_=!0;o.Scrollbar.prototype.containerVisible_=!0;o.Scrollbar.scrollbarThickness=15;o.Touch.TOUCH_ENABLED&&(o.Scrollbar.scrollbarThickness=25);o.Scrollbar.metricsAreEquivalent_=function(e,t){return e&&t&&e.viewWidth==t.viewWidth&&e.viewHeight==t.viewHeight&&e.viewLeft==t.viewLeft&&e.viewTop==t.viewTop&&e.absoluteTop==t.absoluteTop&&e.absoluteLeft==t.absoluteLeft&&e.contentWidth==t.contentWidth&&e.contentHeight==t.contentHeight&&e.contentLeft==t.contentLeft&&e.contentTop==t.contentTop?!0:!1};o.Scrollbar.prototype.dispose=function(){this.cleanUp_();o.unbindEvent_(this.onMouseDownBarWrapper_);this.onMouseDownBarWrapper_=null;o.unbindEvent_(this.onMouseDownHandleWrapper_);this.onMouseDownHandleWrapper_=null;o.utils.dom.removeNode(this.outerSvg_);this.svgBackground_=this.svgGroup_=this.outerSvg_=null;this.svgHandle_&&(this.workspace_.getThemeManager().unsubscribe(this.svgHandle_),this.svgHandle_=null);this.workspace_=null};o.Scrollbar.prototype.setHandleLength_=function(e){this.handleLength_=e;this.svgHandle_.setAttribute(this.lengthAttribute_,this.handleLength_)};o.Scrollbar.prototype.setHandlePosition=function(e){this.handlePosition_=e;this.svgHandle_.setAttribute(this.positionAttribute_,this.handlePosition_)};o.Scrollbar.prototype.setScrollViewSize_=function(e){this.scrollViewSize_=e;this.outerSvg_.setAttribute(this.lengthAttribute_,this.scrollViewSize_);this.svgBackground_.setAttribute(this.lengthAttribute_,this.scrollViewSize_)};o.ScrollbarPair.prototype.setContainerVisible=function(e){this.hScroll.setContainerVisible(e);this.vScroll.setContainerVisible(e)};o.Scrollbar.prototype.setPosition_=function(e,t){this.position_.x=e;this.position_.y=t;o.utils.dom.setCssTransform(this.outerSvg_,"translate("+(this.position_.x+this.origin_.x)+"px,"+(this.position_.y+this.origin_.y)+"px)")};o.Scrollbar.prototype.resize=function(e){if(!e&&(e=this.workspace_.getMetrics(),!e))return;o.Scrollbar.metricsAreEquivalent_(e,this.oldHostMetrics_)||(this.oldHostMetrics_=e,this.horizontal_?this.resizeHorizontal_(e):this.resizeVertical_(e),this.onScroll_())};o.Scrollbar.prototype.resizeHorizontal_=function(e){this.resizeViewHorizontal(e)};o.Scrollbar.prototype.resizeViewHorizontal=function(e){var t=e.viewWidth-1;this.pair_&&(t-=o.Scrollbar.scrollbarThickness);this.setScrollViewSize_(Math.max(0,t));t=e.absoluteLeft+.5;this.pair_&&this.workspace_.RTL&&(t+=o.Scrollbar.scrollbarThickness);this.setPosition_(t,e.absoluteTop+e.viewHeight-o.Scrollbar.scrollbarThickness-.5);this.resizeContentHorizontal(e)};o.Scrollbar.prototype.resizeContentHorizontal=function(e){this.pair_||this.setVisible(this.scrollViewSize_<e.contentWidth);this.ratio_=this.scrollViewSize_/e.contentWidth;if(-Infinity==this.ratio_||1/0==this.ratio_||isNaN(this.ratio_))this.ratio_=0;this.setHandleLength_(Math.max(0,e.viewWidth*this.ratio_));this.setHandlePosition(this.constrainHandle_((e.viewLeft-e.contentLeft)*this.ratio_))};o.Scrollbar.prototype.resizeVertical_=function(e){this.resizeViewVertical(e)};o.Scrollbar.prototype.resizeViewVertical=function(e){var t=e.viewHeight-1;this.pair_&&(t-=o.Scrollbar.scrollbarThickness);this.setScrollViewSize_(Math.max(0,t));t=e.absoluteLeft+.5;this.workspace_.RTL||(t+=e.viewWidth-o.Scrollbar.scrollbarThickness-1);this.setPosition_(t,e.absoluteTop+.5);this.resizeContentVertical(e)};o.Scrollbar.prototype.resizeContentVertical=function(e){this.pair_||this.setVisible(this.scrollViewSize_<e.contentHeight);this.ratio_=this.scrollViewSize_/e.contentHeight;if(-Infinity==this.ratio_||1/0==this.ratio_||isNaN(this.ratio_))this.ratio_=0;this.setHandleLength_(Math.max(0,e.viewHeight*this.ratio_));this.setHandlePosition(this.constrainHandle_((e.viewTop-e.contentTop)*this.ratio_))};o.Scrollbar.prototype.createDom_=function(e){var t="blocklyScrollbar"+(this.horizontal_?"Horizontal":"Vertical");e&&(t+=" "+e);this.outerSvg_=o.utils.dom.createSvgElement("svg",{class:t},null);this.svgGroup_=o.utils.dom.createSvgElement("g",{},this.outerSvg_);this.svgBackground_=o.utils.dom.createSvgElement("rect",{class:"blocklyScrollbarBackground"},this.svgGroup_);e=Math.floor((o.Scrollbar.scrollbarThickness-5)/2);this.svgHandle_=o.utils.dom.createSvgElement("rect",{class:"blocklyScrollbarHandle",rx:e,ry:e},this.svgGroup_);this.workspace_.getThemeManager().subscribe(this.svgHandle_,"scrollbarColour","fill");this.workspace_.getThemeManager().subscribe(this.svgHandle_,"scrollbarOpacity","fill-opacity");o.utils.dom.insertAfter(this.outerSvg_,this.workspace_.getParentSvg())};o.Scrollbar.prototype.isVisible=function(){return this.isVisible_};o.Scrollbar.prototype.setContainerVisible=function(e){var t=e!=this.containerVisible_;this.containerVisible_=e;t&&this.updateDisplay_()};o.Scrollbar.prototype.setVisible=function(e){var t=e!=this.isVisible();if(this.pair_)throw Error("Unable to toggle visibility of paired scrollbars.");this.isVisible_=e;t&&this.updateDisplay_()};o.Scrollbar.prototype.updateDisplay_=function(){this.containerVisible_&&this.isVisible()?this.outerSvg_.setAttribute("display","block"):this.outerSvg_.setAttribute("display","none")};o.Scrollbar.prototype.onMouseDownBar_=function(t){this.workspace_.markFocused();o.Touch.clearTouchIdentifier();this.cleanUp_();if(o.utils.isRightButton(t))t.stopPropagation();else{var n=o.utils.mouseToSvg(t,this.workspace_.getParentSvg(),this.workspace_.getInverseScreenCTM());n=this.horizontal_?n.x:n.y;var r=o.utils.getInjectionDivXY_(this.svgHandle_);r=this.horizontal_?r.x:r.y;var i=this.handlePosition_,s=.95*this.handleLength_;n<=r?i-=s:n>=r+this.handleLength_&&(i+=s);this.setHandlePosition(this.constrainHandle_(i));this.onScroll_();t.stopPropagation();t.preventDefault()}};o.Scrollbar.prototype.onMouseDownHandle_=function(e){this.workspace_.markFocused();this.cleanUp_();o.utils.isRightButton(e)?e.stopPropagation():(this.startDragHandle=this.handlePosition_,this.workspace_.setupDragSurface(),this.startDragMouse_=this.horizontal_?e.clientX:e.clientY,o.Scrollbar.onMouseUpWrapper_=o.bindEventWithChecks_(document,"mouseup",this,this.onMouseUpHandle_),o.Scrollbar.onMouseMoveWrapper_=o.bindEventWithChecks_(document,"mousemove",this,this.onMouseMoveHandle_),e.stopPropagation(),e.preventDefault())};o.Scrollbar.prototype.onMouseMoveHandle_=function(e){this.setHandlePosition(this.constrainHandle_(this.startDragHandle+((this.horizontal_?e.clientX:e.clientY)-this.startDragMouse_)));this.onScroll_()};o.Scrollbar.prototype.onMouseUpHandle_=function(){this.workspace_.resetDragSurface();o.Touch.clearTouchIdentifier();this.cleanUp_()};o.Scrollbar.prototype.cleanUp_=function(){o.hideChaff(!0);o.Scrollbar.onMouseUpWrapper_&&(o.unbindEvent_(o.Scrollbar.onMouseUpWrapper_),o.Scrollbar.onMouseUpWrapper_=null);o.Scrollbar.onMouseMoveWrapper_&&(o.unbindEvent_(o.Scrollbar.onMouseMoveWrapper_),o.Scrollbar.onMouseMoveWrapper_=null)};o.Scrollbar.prototype.constrainHandle_=function(e){return e=0>=e||isNaN(e)||this.scrollViewSize_<this.handleLength_?0:Math.min(e,this.scrollViewSize_-this.handleLength_)};o.Scrollbar.prototype.onScroll_=function(){var e=this.handlePosition_/this.scrollViewSize_;isNaN(e)&&(e=0);var t={};this.horizontal_?t.x=e:t.y=e;this.workspace_.setMetrics(t)};o.Scrollbar.prototype.set=function(e){this.setHandlePosition(this.constrainHandle_(e*this.ratio_));this.onScroll_()};o.Scrollbar.prototype.setOrigin=function(e,t){this.origin_=new o.utils.Coordinate(e,t)};o.Tooltip={};o.Tooltip.visible=!1;o.Tooltip.blocked_=!1;o.Tooltip.LIMIT=50;o.Tooltip.mouseOutPid_=0;o.Tooltip.showPid_=0;o.Tooltip.lastX_=0;o.Tooltip.lastY_=0;o.Tooltip.element_=null;o.Tooltip.poisonedElement_=null;o.Tooltip.OFFSET_X=0;o.Tooltip.OFFSET_Y=10;o.Tooltip.RADIUS_OK=10;o.Tooltip.HOVER_MS=750;o.Tooltip.MARGINS=5;o.Tooltip.DIV=null;o.Tooltip.createDom=function(){o.Tooltip.DIV||(o.Tooltip.DIV=document.createElement("div"),o.Tooltip.DIV.className="blocklyTooltipDiv",document.body.appendChild(o.Tooltip.DIV))};o.Tooltip.bindMouseEvents=function(e){o.bindEvent_(e,"mouseover",null,o.Tooltip.onMouseOver_);o.bindEvent_(e,"mouseout",null,o.Tooltip.onMouseOut_);e.addEventListener("mousemove",o.Tooltip.onMouseMove_,!1)};o.Tooltip.onMouseOver_=function(e){if(!o.Tooltip.blocked_){for(e=e.currentTarget;"string"!=typeof e.tooltip&&"function"!=typeof e.tooltip;){e=e.tooltip}o.Tooltip.element_!=e&&(o.Tooltip.hide(),o.Tooltip.poisonedElement_=null,o.Tooltip.element_=e);clearTimeout(o.Tooltip.mouseOutPid_)}};o.Tooltip.onMouseOut_=function(){o.Tooltip.blocked_||(o.Tooltip.mouseOutPid_=setTimeout(function(){o.Tooltip.element_=null;o.Tooltip.poisonedElement_=null;o.Tooltip.hide()},1),clearTimeout(o.Tooltip.showPid_))};o.Tooltip.onMouseMove_=function(e){if(o.Tooltip.element_&&o.Tooltip.element_.tooltip&&!o.Tooltip.blocked_)if(o.Tooltip.visible){var t=o.Tooltip.lastX_-e.pageX;e=o.Tooltip.lastY_-e.pageY;Math.sqrt(t*t+e*e)>o.Tooltip.RADIUS_OK&&o.Tooltip.hide()}else o.Tooltip.poisonedElement_!=o.Tooltip.element_&&(clearTimeout(o.Tooltip.showPid_),o.Tooltip.lastX_=e.pageX,o.Tooltip.lastY_=e.pageY,o.Tooltip.showPid_=setTimeout(o.Tooltip.show_,o.Tooltip.HOVER_MS))};o.Tooltip.hide=function(){o.Tooltip.visible&&(o.Tooltip.visible=!1,o.Tooltip.DIV&&(o.Tooltip.DIV.style.display="none"));o.Tooltip.showPid_&&clearTimeout(o.Tooltip.showPid_)};o.Tooltip.block=function(){o.Tooltip.hide();o.Tooltip.blocked_=!0};o.Tooltip.unblock=function(){o.Tooltip.blocked_=!1};o.Tooltip.show_=function(){if(!o.Tooltip.blocked_&&(o.Tooltip.poisonedElement_=o.Tooltip.element_,o.Tooltip.DIV)){o.Tooltip.DIV.innerHTML="";for(var t=o.Tooltip.element_.tooltip;"function"==typeof t;){t=t()}t=o.utils.string.wrap(t,o.Tooltip.LIMIT);t=t.split("\n");for(var n=0,r;n<t.length;n++){r=document.createElement("div");r.appendChild(document.createTextNode(t[n]));o.Tooltip.DIV.appendChild(r)}t=o.Tooltip.element_.RTL;n=document.documentElement.clientWidth;r=document.documentElement.clientHeight;o.Tooltip.DIV.style.direction=t?"rtl":"ltr";o.Tooltip.DIV.style.display="block";o.Tooltip.visible=!0;var i=o.Tooltip.lastX_;i=t?i-(o.Tooltip.OFFSET_X+o.Tooltip.DIV.offsetWidth):i+o.Tooltip.OFFSET_X;var s=o.Tooltip.lastY_+o.Tooltip.OFFSET_Y;s+o.Tooltip.DIV.offsetHeight>r+window.scrollY&&(s-=o.Tooltip.DIV.offsetHeight+2*o.Tooltip.OFFSET_Y);t?i=Math.max(o.Tooltip.MARGINS-window.scrollX,i):i+o.Tooltip.DIV.offsetWidth>n+window.scrollX-2*o.Tooltip.MARGINS&&(i=n-o.Tooltip.DIV.offsetWidth-2*o.Tooltip.MARGINS);o.Tooltip.DIV.style.top=s+"px";o.Tooltip.DIV.style.left=i+"px"}};o.WorkspaceDragSurfaceSvg=function(e){this.container_=e;this.createDom()};o.WorkspaceDragSurfaceSvg.prototype.SVG_=null;o.WorkspaceDragSurfaceSvg.prototype.dragGroup_=null;o.WorkspaceDragSurfaceSvg.prototype.container_=null;o.WorkspaceDragSurfaceSvg.prototype.createDom=function(){this.SVG_||(this.SVG_=o.utils.dom.createSvgElement("svg",{xmlns:o.utils.dom.SVG_NS,"xmlns:html":o.utils.dom.HTML_NS,"xmlns:xlink":o.utils.dom.XLINK_NS,version:"1.1",class:"blocklyWsDragSurface blocklyOverflowVisible"},null),this.container_.appendChild(this.SVG_))};o.WorkspaceDragSurfaceSvg.prototype.translateSurface=function(e,t){e=e.toFixed(0);t=t.toFixed(0);this.SVG_.style.display="block";o.utils.dom.setCssTransform(this.SVG_,"translate3d("+e+"px, "+t+"px, 0px)")};o.WorkspaceDragSurfaceSvg.prototype.getSurfaceTranslation=function(){return o.utils.getRelativeXY(this.SVG_)};o.WorkspaceDragSurfaceSvg.prototype.clearAndHide=function(e){if(!e)throw Error("Couldn't clear and hide the drag surface: missing new surface.");var t=this.SVG_.childNodes[0],n=this.SVG_.childNodes[1];if(!(t&&n&&o.utils.dom.hasClass(t,"blocklyBlockCanvas")&&o.utils.dom.hasClass(n,"blocklyBubbleCanvas")))throw Error("Couldn't clear and hide the drag surface. A node was missing.");null!=this.previousSibling_?o.utils.dom.insertAfter(t,this.previousSibling_):e.insertBefore(t,e.firstChild);o.utils.dom.insertAfter(n,t);this.SVG_.style.display="none";if(this.SVG_.childNodes.length)throw Error("Drag surface was not cleared.");o.utils.dom.setCssTransform(this.SVG_,"");this.previousSibling_=null};o.WorkspaceDragSurfaceSvg.prototype.setContentsAndShow=function(t,o,n,r,i,e){if(this.SVG_.childNodes.length)throw Error("Already dragging a block.");this.previousSibling_=n;t.setAttribute("transform","translate(0, 0) scale("+e+")");o.setAttribute("transform","translate(0, 0) scale("+e+")");this.SVG_.setAttribute("width",r);this.SVG_.setAttribute("height",i);this.SVG_.appendChild(t);this.SVG_.appendChild(o);this.SVG_.style.display="block"};o.ASTNode=function(e,t,n){if(!t)throw Error("Cannot create a node without a location.");this.type_=e;this.isConnection_=o.ASTNode.isConnectionType_(e);this.location_=t;this.processParams_(n||null)};o.ASTNode.types={FIELD:"field",BLOCK:"block",INPUT:"input",OUTPUT:"output",NEXT:"next",PREVIOUS:"previous",STACK:"stack",WORKSPACE:"workspace"};o.ASTNode.NAVIGATE_ALL_FIELDS=!1;o.ASTNode.DEFAULT_OFFSET_Y=-20;o.ASTNode.isConnectionType_=function(e){switch(e){case o.ASTNode.types.PREVIOUS:case o.ASTNode.types.NEXT:case o.ASTNode.types.INPUT:case o.ASTNode.types.OUTPUT:return!0;}return!1};o.ASTNode.createFieldNode=function(e){return e?new o.ASTNode(o.ASTNode.types.FIELD,e):null};o.ASTNode.createConnectionNode=function(e){return e?e.type==o.INPUT_VALUE||e.type==o.NEXT_STATEMENT&&e.getParentInput()?o.ASTNode.createInputNode(e.getParentInput()):e.type==o.NEXT_STATEMENT?new o.ASTNode(o.ASTNode.types.NEXT,e):e.type==o.OUTPUT_VALUE?new o.ASTNode(o.ASTNode.types.OUTPUT,e):e.type==o.PREVIOUS_STATEMENT?new o.ASTNode(o.ASTNode.types.PREVIOUS,e):null:null};o.ASTNode.createInputNode=function(e){return e&&e.connection?new o.ASTNode(o.ASTNode.types.INPUT,e.connection):null};o.ASTNode.createBlockNode=function(e){return e?new o.ASTNode(o.ASTNode.types.BLOCK,e):null};o.ASTNode.createStackNode=function(e){return e?new o.ASTNode(o.ASTNode.types.STACK,e):null};o.ASTNode.createWorkspaceNode=function(e,t){return t&&e?new o.ASTNode(o.ASTNode.types.WORKSPACE,e,{wsCoordinate:t}):null};o.ASTNode.prototype.processParams_=function(e){e&&e.wsCoordinate&&(this.wsCoordinate_=e.wsCoordinate)};o.ASTNode.prototype.getLocation=function(){return this.location_};o.ASTNode.prototype.getType=function(){return this.type_};o.ASTNode.prototype.getWsCoordinate=function(){return this.wsCoordinate_};o.ASTNode.prototype.isConnection=function(){return this.isConnection_};o.ASTNode.prototype.findNextForInput_=function(){var t=this.location_.getParentInput(),n=t.getSourceBlock();t=n.inputList.indexOf(t)+1;for(var r;r=n.inputList[t];t++){for(var i=r.fieldRow,s=0,l;l=i[s];s++){if(l.isClickable()||o.ASTNode.NAVIGATE_ALL_FIELDS)return o.ASTNode.createFieldNode(l)}if(r.connection)return o.ASTNode.createInputNode(r)}return null};o.ASTNode.prototype.findNextForField_=function(){var t=this.location_,n=t.getParentInput(),r=t.getSourceBlock(),i=r.inputList.indexOf(n);for(t=n.fieldRow.indexOf(t)+1;n=r.inputList[i];i++){for(var s=n.fieldRow;t<s.length;){if(s[t].isClickable()||o.ASTNode.NAVIGATE_ALL_FIELDS)return o.ASTNode.createFieldNode(s[t]);t++}t=0;if(n.connection)return o.ASTNode.createInputNode(n)}return null};o.ASTNode.prototype.findPrevForInput_=function(){for(var t=this.location_.getParentInput(),n=t.getSourceBlock(),r=n.inputList.indexOf(t),i;i=n.inputList[r];r--){if(i.connection&&i!==t)return o.ASTNode.createInputNode(i);i=i.fieldRow;for(var s=i.length-1,l;l=i[s];s--){if(l.isClickable()||o.ASTNode.NAVIGATE_ALL_FIELDS)return o.ASTNode.createFieldNode(l)}}return null};o.ASTNode.prototype.findPrevForField_=function(){var t=this.location_,n=t.getParentInput(),r=t.getSourceBlock(),i=r.inputList.indexOf(n);t=n.fieldRow.indexOf(t)-1;for(var s;s=r.inputList[i];i--){if(s.connection&&s!==n)return o.ASTNode.createInputNode(s);for(s=s.fieldRow;-1<t;){if(s[t].isClickable()||o.ASTNode.NAVIGATE_ALL_FIELDS)return o.ASTNode.createFieldNode(s[t]);t--}0<=i-1&&(t=r.inputList[i-1].fieldRow.length-1)}return null};o.ASTNode.prototype.navigateBetweenStacks_=function(t){var n=this.getLocation();n instanceof o.Block||(n=n.getSourceBlock());if(!n||!n.workspace)return null;var r=n.getRootBlock();n=r.workspace.getTopBlocks(!0);for(var i=0,s;s=n[i];i++){if(r.id==s.id)return t=i+(t?1:-1),-1==t||t==n.length?null:o.ASTNode.createStackNode(n[t])}throw Error("Couldn't find "+(t?"next":"previous")+" stack?!")};o.ASTNode.prototype.findTopASTNodeForBlock_=function(e){var t=e.previousConnection||e.outputConnection;return t?o.ASTNode.createConnectionNode(t):o.ASTNode.createBlockNode(e)};o.ASTNode.prototype.getOutAstNodeForBlock_=function(e){if(!e)return null;e=e.getTopStackBlock();var t=e.previousConnection||e.outputConnection;return t&&t.targetConnection&&t.targetConnection.getParentInput()?o.ASTNode.createInputNode(t.targetConnection.getParentInput()):o.ASTNode.createStackNode(e)};o.ASTNode.prototype.findFirstFieldOrInput_=function(t){t=t.inputList;for(var n=0,r;r=t[n];n++){for(var i=r.fieldRow,s=0,l;l=i[s];s++){if(l.isClickable()||o.ASTNode.NAVIGATE_ALL_FIELDS)return o.ASTNode.createFieldNode(l)}if(r.connection)return o.ASTNode.createInputNode(r)}return null};o.ASTNode.prototype.getSourceBlock=function(){return this.getType()===o.ASTNode.types.BLOCK?this.getLocation():this.getType()===o.ASTNode.types.STACK?this.getLocation():this.getType()===o.ASTNode.types.WORKSPACE?null:this.getLocation().getSourceBlock()};o.ASTNode.prototype.next=function(){switch(this.type_){case o.ASTNode.types.STACK:return this.navigateBetweenStacks_(!0);case o.ASTNode.types.OUTPUT:return o.ASTNode.createBlockNode(this.location_.getSourceBlock());case o.ASTNode.types.FIELD:return this.findNextForField_();case o.ASTNode.types.INPUT:return this.findNextForInput_();case o.ASTNode.types.BLOCK:return o.ASTNode.createConnectionNode(this.location_.nextConnection);case o.ASTNode.types.PREVIOUS:return o.ASTNode.createBlockNode(this.location_.getSourceBlock());case o.ASTNode.types.NEXT:return o.ASTNode.createConnectionNode(this.location_.targetConnection);}return null};o.ASTNode.prototype.in=function(){switch(this.type_){case o.ASTNode.types.WORKSPACE:var e=this.location_.getTopBlocks(!0);if(0<e.length)return o.ASTNode.createStackNode(e[0]);break;case o.ASTNode.types.STACK:return e=this.location_,this.findTopASTNodeForBlock_(e);case o.ASTNode.types.BLOCK:return e=this.location_,this.findFirstFieldOrInput_(e);case o.ASTNode.types.INPUT:return o.ASTNode.createConnectionNode(this.location_.targetConnection);}return null};o.ASTNode.prototype.prev=function(){switch(this.type_){case o.ASTNode.types.STACK:return this.navigateBetweenStacks_(!1);case o.ASTNode.types.FIELD:return this.findPrevForField_();case o.ASTNode.types.INPUT:return this.findPrevForInput_();case o.ASTNode.types.BLOCK:var e=this.location_;return o.ASTNode.createConnectionNode(e.previousConnection||e.outputConnection);case o.ASTNode.types.PREVIOUS:if((e=this.location_.targetConnection)&&!e.getParentInput())return o.ASTNode.createConnectionNode(e);break;case o.ASTNode.types.NEXT:return o.ASTNode.createBlockNode(this.location_.getSourceBlock());}return null};o.ASTNode.prototype.out=function(){switch(this.type_){case o.ASTNode.types.STACK:var e=this.location_.getRelativeToSurfaceXY();e=new o.utils.Coordinate(e.x,e.y+o.ASTNode.DEFAULT_OFFSET_Y);return o.ASTNode.createWorkspaceNode(this.location_.workspace,e);case o.ASTNode.types.OUTPUT:return(e=this.location_.targetConnection)?o.ASTNode.createConnectionNode(e):o.ASTNode.createStackNode(this.location_.getSourceBlock());case o.ASTNode.types.FIELD:return o.ASTNode.createBlockNode(this.location_.getSourceBlock());case o.ASTNode.types.INPUT:return o.ASTNode.createBlockNode(this.location_.getSourceBlock());case o.ASTNode.types.BLOCK:return this.getOutAstNodeForBlock_(this.location_);case o.ASTNode.types.PREVIOUS:return this.getOutAstNodeForBlock_(this.location_.getSourceBlock());case o.ASTNode.types.NEXT:return this.getOutAstNodeForBlock_(this.location_.getSourceBlock());}return null};o.Blocks=Object.create(null);o.Connection=function(e,t){this.sourceBlock_=e;this.type=t};o.Connection.CAN_CONNECT=0;o.Connection.REASON_SELF_CONNECTION=1;o.Connection.REASON_WRONG_TYPE=2;o.Connection.REASON_TARGET_NULL=3;o.Connection.REASON_CHECKS_FAILED=4;o.Connection.REASON_DIFFERENT_WORKSPACES=5;o.Connection.REASON_SHADOW_PARENT=6;o.Connection.prototype.targetConnection=null;o.Connection.prototype.disposed=!1;o.Connection.prototype.check_=null;o.Connection.prototype.shadowDom_=null;o.Connection.prototype.x=0;o.Connection.prototype.y=0;o.Connection.prototype.connect_=function(t){var n=this,r=n.getSourceBlock(),i=t.getSourceBlock();t.isConnected()&&t.disconnect();if(n.isConnected()){var s=n.targetBlock(),a=n.getShadowDom();n.setShadowDom(null);if(s.isShadow())a=o.Xml.blockToDom(s),s.dispose(!1),s=null;else if(n.type==o.INPUT_VALUE){if(!s.outputConnection)throw Error("Orphan block does not have an output connection.");var c=o.Connection.lastConnectionInRow(i,s);c&&(s.outputConnection.connect(c),s=null)}else if(n.type==o.NEXT_STATEMENT){if(!s.previousConnection)throw Error("Orphan block does not have a previous connection.");for(c=i;c.nextConnection;){var p=c.getNextBlock();if(p&&!p.isShadow())c=p;else{s.previousConnection.checkType(c.nextConnection)&&(c.nextConnection.connect(s.previousConnection),s=null);break}}}if(s&&(n.disconnect(),o.Events.recordUndo)){var d=o.Events.getGroup();setTimeout(function(){if(s.workspace&&!s.getParent()){o.Events.setGroup(d);if(s.outputConnection)s.outputConnection.onFailedConnect(n);else if(s.previousConnection)s.previousConnection.onFailedConnect(n);o.Events.setGroup(!1)}},o.BUMP_DELAY)}n.setShadowDom(a)}var u;o.Events.isEnabled()&&(u=new o.Events.BlockMove(i));o.Connection.connectReciprocally_(n,t);i.setParent(r);u&&(u.recordNew(),o.Events.fire(u))};o.Connection.prototype.dispose=function(){if(this.isConnected()){this.setShadowDom(null);var e=this.targetBlock();e.isShadow()?e.dispose(!1):e.unplug()}this.disposed=!0};o.Connection.prototype.getSourceBlock=function(){return this.sourceBlock_};o.Connection.prototype.isSuperior=function(){return this.type==o.INPUT_VALUE||this.type==o.NEXT_STATEMENT};o.Connection.prototype.isConnected=function(){return!!this.targetConnection};o.Connection.prototype.canConnectWithReason=function(e){if(!e)return o.Connection.REASON_TARGET_NULL;if(this.isSuperior())var t=this.sourceBlock_,n=e.getSourceBlock();else n=this.sourceBlock_,t=e.getSourceBlock();return t&&t==n?o.Connection.REASON_SELF_CONNECTION:e.type!=o.OPPOSITE_TYPE[this.type]?o.Connection.REASON_WRONG_TYPE:t&&n&&t.workspace!==n.workspace?o.Connection.REASON_DIFFERENT_WORKSPACES:this.checkType(e)?t.isShadow()&&!n.isShadow()?o.Connection.REASON_SHADOW_PARENT:o.Connection.CAN_CONNECT:o.Connection.REASON_CHECKS_FAILED};o.Connection.prototype.checkConnection=function(e){switch(this.canConnectWithReason(e)){case o.Connection.CAN_CONNECT:break;case o.Connection.REASON_SELF_CONNECTION:throw Error("Attempted to connect a block to itself.");case o.Connection.REASON_DIFFERENT_WORKSPACES:throw Error("Blocks not on same workspace.");case o.Connection.REASON_WRONG_TYPE:throw Error("Attempt to connect incompatible types.");case o.Connection.REASON_TARGET_NULL:throw Error("Target connection is null.");case o.Connection.REASON_CHECKS_FAILED:throw Error("Connection checks failed. "+(this+" expected "+this.check_+", found "+e.check_));case o.Connection.REASON_SHADOW_PARENT:throw Error("Connecting non-shadow to shadow block.");default:throw Error("Unknown connection failure: this should never happen!");}};o.Connection.prototype.canConnectToPrevious_=function(e){if(this.targetConnection||-1!=o.draggingConnections.indexOf(e))return!1;if(!e.targetConnection)return!0;e=e.targetBlock();return e.isInsertionMarker()?!e.getPreviousBlock():!1};o.Connection.prototype.isConnectionAllowed=function(e){if(e.sourceBlock_.isInsertionMarker()||this.canConnectWithReason(e)!=o.Connection.CAN_CONNECT)return!1;switch(e.type){case o.PREVIOUS_STATEMENT:return this.canConnectToPrevious_(e);case o.OUTPUT_VALUE:if(e.isConnected()&&!e.targetBlock().isInsertionMarker()||this.isConnected())return!1;break;case o.INPUT_VALUE:if(e.isConnected()&&!e.targetBlock().isMovable()&&!e.targetBlock().isShadow())return!1;break;case o.NEXT_STATEMENT:if(e.isConnected()&&!this.sourceBlock_.nextConnection&&!e.targetBlock().isShadow()&&e.targetBlock().nextConnection)return!1;break;default:throw Error("Unknown connection type in isConnectionAllowed");}return-1!=o.draggingConnections.indexOf(e)?!1:!0};o.Connection.prototype.onFailedConnect=function(){};o.Connection.prototype.connect=function(e){if(this.targetConnection!=e){this.checkConnection(e);var t=o.Events.getGroup();t||o.Events.setGroup(!0);this.isSuperior()?this.connect_(e):e.connect_(this);t||o.Events.setGroup(!1)}};o.Connection.connectReciprocally_=function(e,t){if(!e||!t)throw Error("Cannot connect null connections.");e.targetConnection=t;t.targetConnection=e};o.Connection.singleConnection_=function(t,n){for(var r=null,i=0,s;i<t.inputList.length;i++){s=t.inputList[i].connection;if(s&&s.type==o.INPUT_VALUE&&n.outputConnection.checkType(s)){if(r)return null;r=s}}return r};o.Connection.lastConnectionInRow=function(e,t){for(var n;n=o.Connection.singleConnection_(e,t);){if(e=n.targetBlock(),!e||e.isShadow())return n}return null};o.Connection.prototype.disconnect=function(){var e=this.targetConnection;if(!e)throw Error("Source connection not connected.");if(e.targetConnection!=this)throw Error("Target connection not connected to source connection.");if(this.isSuperior()){var t=this.sourceBlock_,n=e.getSourceBlock();e=this}else t=e.getSourceBlock(),n=this.sourceBlock_;var r=o.Events.getGroup();r||o.Events.setGroup(!0);this.disconnectInternal_(t,n);e.respawnShadow_();r||o.Events.setGroup(!1)};o.Connection.prototype.disconnectInternal_=function(e,t){var n;o.Events.isEnabled()&&(n=new o.Events.BlockMove(t));this.targetConnection=this.targetConnection.targetConnection=null;t.setParent(null);n&&(n.recordNew(),o.Events.fire(n))};o.Connection.prototype.respawnShadow_=function(){var e=this.getSourceBlock(),t=this.getShadowDom();if(e.workspace&&t&&o.Events.recordUndo)if(e=o.Xml.domToBlock(t,e.workspace),e.outputConnection)this.connect(e.outputConnection);else if(e.previousConnection)this.connect(e.previousConnection);else throw Error("Child block does not have output or previous statement.")};o.Connection.prototype.targetBlock=function(){return this.isConnected()?this.targetConnection.getSourceBlock():null};o.Connection.prototype.checkType=function(e){if(!this.check_||!e.check_)return!0;for(var t=0;t<this.check_.length;t++){if(-1!=e.check_.indexOf(this.check_[t]))return!0}return!1};o.Connection.prototype.checkType_=function(e){console.warn("Deprecated call to Blockly.Connection.prototype.checkType_, use Blockly.Connection.prototype.checkType instead.");return this.checkType(e)};o.Connection.prototype.onCheckChanged_=function(){!this.isConnected()||this.targetConnection&&this.checkType(this.targetConnection)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()};o.Connection.prototype.setCheck=function(e){e?(Array.isArray(e)||(e=[e]),this.check_=e,this.onCheckChanged_()):this.check_=null;return this};o.Connection.prototype.getCheck=function(){return this.check_};o.Connection.prototype.setShadowDom=function(e){this.shadowDom_=e};o.Connection.prototype.getShadowDom=function(){return this.shadowDom_};o.Connection.prototype.neighbours=function(){return[]};o.Connection.prototype.getParentInput=function(){for(var e=null,t=this.sourceBlock_,o=t.inputList,n=0;n<t.inputList.length;n++){if(o[n].connection===this){e=o[n];break}}return e};o.Connection.prototype.toString=function(){var e=this.sourceBlock_;if(e){if(e.outputConnection==this)var t="Output Connection of ";else if(e.previousConnection==this)t="Previous Connection of ";else if(e.nextConnection==this)t="Next Connection of ";else{t=null;for(var o=0,n;n=e.inputList[o];o++){if(n.connection==this){t=n;break}}if(t)t="Input \""+t.name+"\" connection on ";else return console.warn("Connection not actually connected to sourceBlock_"),"Orphan Connection"}}else return"Orphan Connection";return t+e.toDevString()};o.Extensions={};o.Extensions.ALL_={};o.Extensions.register=function(e,t){if("string"!=typeof e||""==e.trim())throw Error("Error: Invalid extension name \""+e+"\"");if(o.Extensions.ALL_[e])throw Error("Error: Extension \""+e+"\" is already registered.");if("function"!=typeof t)throw Error("Error: Extension \""+e+"\" must be a function");o.Extensions.ALL_[e]=t};o.Extensions.registerMixin=function(e,t){if(!t||"object"!=_typeof(t))throw Error("Error: Mixin \""+e+"\" must be a object");o.Extensions.register(e,function(){this.mixin(t)})};o.Extensions.registerMutator=function(t,n,r,i){var s="Error when registering mutator \""+t+"\": ";o.Extensions.checkHasFunction_(s,n.domToMutation,"domToMutation");o.Extensions.checkHasFunction_(s,n.mutationToDom,"mutationToDom");var e=o.Extensions.checkMutatorDialog_(n,s);if(r&&"function"!=typeof r)throw Error("Extension \""+t+"\" is not a function");o.Extensions.register(t,function(){if(e){if(!o.Mutator)throw Error(s+"Missing require for Blockly.Mutator");this.setMutator(new o.Mutator(i||[]))}this.mixin(n);r&&r.apply(this)})};o.Extensions.unregister=function(e){o.Extensions.ALL_[e]?delete o.Extensions.ALL_[e]:console.warn("No extension mapping for name \""+e+"\" found to unregister")};o.Extensions.apply=function(t,n,r){var i=o.Extensions.ALL_[t];if("function"!=typeof i)throw Error("Error: Extension \""+t+"\" not found.");if(r)o.Extensions.checkNoMutatorProperties_(t,n);else var s=o.Extensions.getMutatorProperties_(n);i.apply(n);if(r)o.Extensions.checkBlockHasMutatorProperties_("Error after applying mutator \""+t+"\": ",n);else if(!o.Extensions.mutatorPropertiesMatch_(s,n))throw Error("Error when applying extension \""+t+"\": mutation properties changed when applying a non-mutator extension.")};o.Extensions.checkHasFunction_=function(e,t,o){if(!t)throw Error(e+"missing required property \""+o+"\"");if("function"!=typeof t)throw Error(e+"\" required property \""+o+"\" must be a function")};o.Extensions.checkNoMutatorProperties_=function(e,t){if(o.Extensions.getMutatorProperties_(t).length)throw Error("Error: tried to apply mutation \""+e+"\" to a block that already has mutator functions.  Block id: "+t.id)};o.Extensions.checkMutatorDialog_=function(e,t){var o=void 0!==e.compose,n=void 0!==e.decompose;if(o&&n){if("function"!=typeof e.compose)throw Error(t+"compose must be a function.");if("function"!=typeof e.decompose)throw Error(t+"decompose must be a function.");return!0}if(o||n)throw Error(t+"Must have both or neither of \"compose\" and \"decompose\"");return!1};o.Extensions.checkBlockHasMutatorProperties_=function(e,t){if("function"!=typeof t.domToMutation)throw Error(e+"Applying a mutator didn't add \"domToMutation\"");if("function"!=typeof t.mutationToDom)throw Error(e+"Applying a mutator didn't add \"mutationToDom\"");o.Extensions.checkMutatorDialog_(t,e)};o.Extensions.getMutatorProperties_=function(e){var t=[];void 0!==e.domToMutation&&t.push(e.domToMutation);void 0!==e.mutationToDom&&t.push(e.mutationToDom);void 0!==e.compose&&t.push(e.compose);void 0!==e.decompose&&t.push(e.decompose);return t};o.Extensions.mutatorPropertiesMatch_=function(e,t){t=o.Extensions.getMutatorProperties_(t);if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++){if(e[n]!=t[n])return!1}return!0};o.Extensions.buildTooltipForDropdown=function(t,n){var r=[];"object"==("undefined"==typeof document?"undefined":_typeof(document))&&o.utils.runAfterPageLoad(function(){for(var e in n){o.utils.checkMessageReferences(n[e])}});return function(){this.type&&-1==r.indexOf(this.type)&&(o.Extensions.checkDropdownOptionsInTable_(this,t,n),r.push(this.type));this.setTooltip(function(){var i=this.getFieldValue(t)+"",s=n[i];null==s?-1==r.indexOf(this.type)&&(i="No tooltip mapping for value "+i+" of field "+t,null!=this.type&&(i+=" of block type "+this.type),console.warn(i+".")):s=o.utils.replaceMessageReferences(s);return s}.bind(this))}};o.Extensions.checkDropdownOptionsInTable_=function(t,o,n){var r=t.getField(o);if(!r.isOptionListDynamic()){r=r.getOptions();for(var i=0,s;i<r.length;++i){s=r[i][1];null==n[s]&&console.warn("No tooltip mapping for value "+s+" of field "+o+" of block type "+t.type)}}};o.Extensions.buildTooltipWithFieldText=function(e,t){"object"==("undefined"==typeof document?"undefined":_typeof(document))&&o.utils.runAfterPageLoad(function(){o.utils.checkMessageReferences(e)});return function(){this.setTooltip(function(){var n=this.getField(t);return o.utils.replaceMessageReferences(e).replace("%1",n?n.getText():"")}.bind(this))}};o.Extensions.extensionParentTooltip_=function(){this.tooltipWhenNotConnected_=this.tooltip;this.setTooltip(function(){var e=this.getParent();return e&&e.getInputsInline()&&e.tooltip||this.tooltipWhenNotConnected_}.bind(this))};o.Extensions.register("parent_tooltip_when_inline",o.Extensions.extensionParentTooltip_);o.fieldRegistry={};o.fieldRegistry.typeMap_={};o.fieldRegistry.register=function(e,t){if("string"!=typeof e||""==e.trim())throw Error("Invalid field type \""+e+"\". The type must be a non-empty string.");if(o.fieldRegistry.typeMap_[e])throw Error("Error: Field \""+e+"\" is already registered.");if(!t||"function"!=typeof t.fromJson)throw Error("Field \""+t+"\" must have a fromJson function");e=e.toLowerCase();o.fieldRegistry.typeMap_[e]=t};o.fieldRegistry.unregister=function(e){o.fieldRegistry.typeMap_[e]?delete o.fieldRegistry.typeMap_[e]:console.warn("No field mapping for type \""+e+"\" found to unregister")};o.fieldRegistry.fromJson=function(e){var t=e.type.toLowerCase();t=o.fieldRegistry.typeMap_[t];return t?t.fromJson(e):(console.warn("Blockly could not create a field of type "+e.type+". The field is probably not being registered. This could be because the file is not loaded, the field does not register itself (Issue #1584), or the registration is not being reached."),null)};o.blockAnimations={};o.blockAnimations.disconnectPid_=0;o.blockAnimations.disconnectGroup_=null;o.blockAnimations.disposeUiEffect=function(e){var t=e.workspace,n=e.getSvgRoot();t.getAudioManager().play("delete");e=t.getSvgXY(n);n=n.cloneNode(!0);n.translateX_=e.x;n.translateY_=e.y;n.setAttribute("transform","translate("+e.x+","+e.y+")");t.getParentSvg().appendChild(n);n.bBox_=n.getBBox();o.blockAnimations.disposeUiStep_(n,t.RTL,new Date,t.scale)};o.blockAnimations.disposeUiStep_=function(t,n,r,i){var s=(new Date-r)/150;1<s?o.utils.dom.removeNode(t):(t.setAttribute("transform","translate("+(t.translateX_+(n?-1:1)*t.bBox_.width*i/2*s)+","+(t.translateY_+t.bBox_.height*i*s)+") scale("+(1-s)*i+")"),setTimeout(o.blockAnimations.disposeUiStep_,10,t,n,r,i))};o.blockAnimations.connectionUiEffect=function(e){var t=e.workspace,n=t.scale;t.getAudioManager().play("click");if(!(1>n)){var r=t.getSvgXY(e.getSvgRoot());e.outputConnection?(r.x+=(e.RTL?3:-3)*n,r.y+=13*n):e.previousConnection&&(r.x+=(e.RTL?-23:23)*n,r.y+=3*n);e=o.utils.dom.createSvgElement("circle",{cx:r.x,cy:r.y,r:0,fill:"none",stroke:"#888","stroke-width":10},t.getParentSvg());o.blockAnimations.connectionUiStep_(e,new Date,n)}};o.blockAnimations.connectionUiStep_=function(e,t,n){var r=(new Date-t)/150;1<r?o.utils.dom.removeNode(e):(e.setAttribute("r",25*r*n),e.style.opacity=1-r,o.blockAnimations.disconnectPid_=setTimeout(o.blockAnimations.connectionUiStep_,10,e,t,n))};o.blockAnimations.disconnectUiEffect=function(e){e.workspace.getAudioManager().play("disconnect");if(!(1>e.workspace.scale)){var t=e.getHeightWidth().height;t=180*(Math.atan(10/t)/Math.PI);e.RTL||(t*=-1);o.blockAnimations.disconnectUiStep_(e.getSvgRoot(),t,new Date)}};o.blockAnimations.disconnectUiStep_=function(e,t,n){var r=(new Date-n)/200;1<r?e.skew_="":(e.skew_="skewX("+Math.round(Math.sin(3*(r*Math.PI))*(1-r)*t)+")",o.blockAnimations.disconnectGroup_=e,o.blockAnimations.disconnectPid_=setTimeout(o.blockAnimations.disconnectUiStep_,10,e,t,n));e.setAttribute("transform",e.translate_+e.skew_)};o.blockAnimations.disconnectUiStop=function(){if(o.blockAnimations.disconnectGroup_){clearTimeout(o.blockAnimations.disconnectPid_);var e=o.blockAnimations.disconnectGroup_;e.skew_="";e.setAttribute("transform",e.translate_);o.blockAnimations.disconnectGroup_=null}};o.InsertionMarkerManager=function(e){this.topBlock_=o.selected=e;this.workspace_=e.workspace;this.lastMarker_=this.lastOnStack_=null;this.firstMarker_=this.createMarkerBlock_(this.topBlock_);this.localConnection_=this.closestConnection_=null;this.wouldDeleteBlock_=!1;this.markerConnection_=null;this.highlightingBlock_=!1;this.highlightedBlock_=null;this.availableConnections_=this.initAvailableConnections_()};o.InsertionMarkerManager.prototype.dispose=function(){this.availableConnections_.length=0;o.Events.disable();try{this.firstMarker_&&this.firstMarker_.dispose(),this.lastMarker_&&this.lastMarker_.dispose()}finally{o.Events.enable()}};o.InsertionMarkerManager.prototype.wouldDeleteBlock=function(){return this.wouldDeleteBlock_};o.InsertionMarkerManager.prototype.wouldConnectBlock=function(){return!!this.closestConnection_};o.InsertionMarkerManager.prototype.applyConnections=function(){if(this.closestConnection_&&(o.Events.disable(),this.hidePreview_(),o.Events.enable(),this.localConnection_.connect(this.closestConnection_),this.topBlock_.rendered)){var e=this.localConnection_.isSuperior()?this.closestConnection_:this.localConnection_;o.blockAnimations.connectionUiEffect(e.getSourceBlock());this.topBlock_.getRootBlock().bringToFront()}};o.InsertionMarkerManager.prototype.update=function(e,t){var n=this.getCandidate_(e);if((this.wouldDeleteBlock_=this.shouldDelete_(n,t))||this.shouldUpdatePreviews_(n,e))o.Events.disable(),this.maybeHidePreview_(n),this.maybeShowPreview_(n),o.Events.enable()};o.InsertionMarkerManager.prototype.createMarkerBlock_=function(t){var n=t.type;o.Events.disable();try{var r=this.workspace_.newBlock(n);r.setInsertionMarker(!0);if(t.mutationToDom){var i=t.mutationToDom();i&&r.domToMutation(i)}r.setCollapsed(t.isCollapsed());for(n=0;n<t.inputList.length;n++){var s=t.inputList[n],e=r.inputList[n];for(i=0;i<s.fieldRow.length;i++){e.fieldRow[i].setValue(s.fieldRow[i].getValue())}}r.initSvg();r.getSvgRoot().setAttribute("visibility","hidden")}finally{o.Events.enable()}return r};o.InsertionMarkerManager.prototype.initAvailableConnections_=function(){var e=this.topBlock_.getConnections_(!1),t=this.topBlock_.lastConnectionInStack();t&&t!=this.topBlock_.nextConnection&&(e.push(t),this.lastOnStack_=t,this.lastMarker_=this.createMarkerBlock_(t.getSourceBlock()));return e};o.InsertionMarkerManager.prototype.shouldUpdatePreviews_=function(e,t){var n=e.local,r=e.closest;e=e.radius;if(n&&r){if(this.localConnection_&&this.closestConnection_){if(this.closestConnection_==r&&this.localConnection_==n)return!1;n=this.localConnection_.x+t.x-this.closestConnection_.x;t=this.localConnection_.y+t.y-this.closestConnection_.y;t=Math.sqrt(n*n+t*t);return!(r&&e>t-o.CURRENT_CONNECTION_PREFERENCE)}if(this.localConnection_||this.closestConnection_)console.error("Only one of localConnection_ and closestConnection_ was set.");else return!0}else return!(!this.localConnection_||!this.closestConnection_);console.error("Returning true from shouldUpdatePreviews, but it's not clear why.");return!0};o.InsertionMarkerManager.prototype.getCandidate_=function(t){for(var o=this.getStartRadius_(),n=null,r=null,i=0;i<this.availableConnections_.length;i++){var s=this.availableConnections_[i],l=s.closest(o,t);l.connection&&(n=l.connection,r=s,o=l.radius)}return{closest:n,local:r,radius:o}};o.InsertionMarkerManager.prototype.getStartRadius_=function(){return this.closestConnection_&&this.localConnection_?o.CONNECTING_SNAP_RADIUS:o.SNAP_RADIUS};o.InsertionMarkerManager.prototype.shouldReplace_=function(){var e=this.closestConnection_,t=this.localConnection_;return t.type==o.OUTPUT_VALUE?e&&this.workspace_.getRenderer().shouldInsertDraggedBlock(this.topBlock_,e)?!1:!0:t==t.getSourceBlock().getFirstStatementConnection()?!1:!this.topBlock_.nextConnection&&t.type==o.PREVIOUS_STATEMENT&&e.isConnected()?!0:!1};o.InsertionMarkerManager.prototype.shouldDelete_=function(e,t){e=e&&!!e.closest&&t!=o.DELETE_AREA_TOOLBOX;return!!t&&!this.topBlock_.getParent()&&this.topBlock_.isDeletable()&&!e};o.InsertionMarkerManager.prototype.maybeShowPreview_=function(e){if(!this.wouldDeleteBlock_){var t=e.closest;e=e.local;t&&(t==this.closestConnection_||t.getSourceBlock().isInsertionMarker()?console.log("Trying to connect to an insertion marker"):(this.closestConnection_=t,this.localConnection_=e,this.showPreview_()))}};o.InsertionMarkerManager.prototype.showPreview_=function(){this.shouldReplace_()?this.highlightBlock_():this.connectMarker_();this.closestConnection_&&this.closestConnection_.targetBlock()&&this.workspace_.getRenderer().shouldHighlightConnection(this.closestConnection_)&&this.closestConnection_.highlight()};o.InsertionMarkerManager.prototype.maybeHidePreview_=function(e){if(e.closest){var t=this.closestConnection_!=e.closest;e=this.localConnection_!=e.local;this.closestConnection_&&this.localConnection_&&(t||e||this.wouldDeleteBlock_)&&this.hidePreview_()}else this.hidePreview_();this.localConnection_=this.closestConnection_=this.markerConnection_=null};o.InsertionMarkerManager.prototype.hidePreview_=function(){this.closestConnection_&&this.closestConnection_.targetBlock()&&this.workspace_.getRenderer().shouldHighlightConnection(this.closestConnection_)&&this.closestConnection_.unhighlight();this.highlightingBlock_?this.unhighlightBlock_():this.markerConnection_&&this.disconnectMarker_()};o.InsertionMarkerManager.prototype.highlightBlock_=function(){var e=this.closestConnection_,t=this.localConnection_;e.targetBlock()?(this.highlightedBlock_=e.targetBlock(),e.targetBlock().highlightForReplacement(!0)):t.type==o.OUTPUT_VALUE&&(this.highlightedBlock_=e.getSourceBlock(),e.getSourceBlock().highlightShapeForInput(e,!0));this.highlightingBlock_=!0};o.InsertionMarkerManager.prototype.unhighlightBlock_=function(){var e=this.closestConnection_;e.type!=o.INPUT_VALUE||e.isConnected()?this.highlightedBlock_.highlightForReplacement(!1):this.highlightedBlock_.highlightShapeForInput(e,!1);this.highlightedBlock_=null;this.highlightingBlock_=!1};o.InsertionMarkerManager.prototype.disconnectMarker_=function(){if(this.markerConnection_){var t=this.markerConnection_,n=t.getSourceBlock(),r=n.nextConnection,i=n.previousConnection,s=n.outputConnection;s=t.type==o.INPUT_VALUE&&!(s&&s.targetConnection);!(t!=r||i&&i.targetConnection)||s?t.targetBlock().unplug(!1):t.type==o.NEXT_STATEMENT&&t!=r?(r=t.targetConnection,r.getSourceBlock().unplug(!1),i=i?i.targetConnection:null,n.unplug(!0),i&&i.connect(r)):n.unplug(!0);if(t.targetConnection)throw Error("markerConnection_ still connected at the end of disconnectInsertionMarker");this.markerConnection_=null;n.getSvgRoot().setAttribute("visibility","hidden")}else console.log("No insertion marker connection to disconnect")};o.InsertionMarkerManager.prototype.connectMarker_=function(){var e=this.localConnection_,t=this.closestConnection_,o=this.lastOnStack_&&e==this.lastOnStack_?this.lastMarker_:this.firstMarker_;e=o.getMatchingConnection(e.getSourceBlock(),e);if(e==this.markerConnection_)throw Error("Made it to connectMarker_ even though the marker isn't changing");o.render();o.rendered=!0;o.getSvgRoot().setAttribute("visibility","visible");e&&t&&o.positionNearConnection(e,t);t&&e.connect(t);this.markerConnection_=e};o.InsertionMarkerManager.prototype.getInsertionMarkers=function(){var e=[];this.firstMarker_&&e.push(this.firstMarker_);this.lastMarker_&&e.push(this.lastMarker_);return e};o.BlockDragger=function(e,t){this.draggingBlock_=e;this.workspace_=t;this.draggedConnectionManager_=new o.InsertionMarkerManager(this.draggingBlock_);this.deleteArea_=null;this.wouldDeleteBlock_=!1;this.startXY_=this.draggingBlock_.getRelativeToSurfaceXY();this.dragIconData_=o.BlockDragger.initIconData_(e)};o.BlockDragger.prototype.dispose=function(){this.dragIconData_.length=0;this.draggedConnectionManager_&&this.draggedConnectionManager_.dispose()};o.BlockDragger.initIconData_=function(t){var o=[];t=t.getDescendants(!1);for(var n=0,r;r=t[n];n++){r=r.getIcons();for(var i=0,s;i<r.length;i++){s={location:r[i].getIconLocation(),icon:r[i]};o.push(s)}}return o};o.BlockDragger.prototype.startBlockDrag=function(e,t){o.Events.getGroup()||o.Events.setGroup(!0);this.fireDragStartEvent_();this.workspace_.isMutator&&this.draggingBlock_.bringToFront();o.utils.dom.startTextWidthCache();this.workspace_.setResizesEnabled(!1);o.blockAnimations.disconnectUiStop();if(this.draggingBlock_.getParent()||t&&this.draggingBlock_.nextConnection&&this.draggingBlock_.nextConnection.targetBlock())this.draggingBlock_.unplug(t),e=this.pixelsToWorkspaceUnits_(e),e=o.utils.Coordinate.sum(this.startXY_,e),this.draggingBlock_.translate(e.x,e.y),o.blockAnimations.disconnectUiEffect(this.draggingBlock_);this.draggingBlock_.setDragging(!0);this.draggingBlock_.moveToDragSurface();if(e=this.workspace_.getToolbox())t=this.draggingBlock_.isDeletable()?"blocklyToolboxDelete":"blocklyToolboxGrab",e.addStyle(t)};o.BlockDragger.prototype.fireDragStartEvent_=function(){var e=new o.Events.Ui(this.draggingBlock_,"dragStart",null,this.draggingBlock_.getDescendants(!1));o.Events.fire(e)};o.BlockDragger.prototype.dragBlock=function(e,t){t=this.pixelsToWorkspaceUnits_(t);var n=o.utils.Coordinate.sum(this.startXY_,t);this.draggingBlock_.moveDuringDrag(n);this.dragIcons_(t);this.deleteArea_=this.workspace_.isDeleteArea(e);this.draggedConnectionManager_.update(t,this.deleteArea_);this.updateCursorDuringBlockDrag_()};o.BlockDragger.prototype.endBlockDrag=function(e,t){this.dragBlock(e,t);this.dragIconData_=[];this.fireDragEndEvent_();o.utils.dom.stopTextWidthCache();o.blockAnimations.disconnectUiStop();e=this.pixelsToWorkspaceUnits_(t);t=o.utils.Coordinate.sum(this.startXY_,e);this.draggingBlock_.moveOffDragSurface(t);this.maybeDeleteBlock_()||(this.draggingBlock_.moveConnections(e.x,e.y),this.draggingBlock_.setDragging(!1),this.fireMoveEvent_(),this.draggedConnectionManager_.wouldConnectBlock()?this.draggedConnectionManager_.applyConnections():this.draggingBlock_.render(),this.draggingBlock_.scheduleSnapAndBump());this.workspace_.setResizesEnabled(!0);if(e=this.workspace_.getToolbox())t=this.draggingBlock_.isDeletable()?"blocklyToolboxDelete":"blocklyToolboxGrab",e.removeStyle(t);o.Events.setGroup(!1)};o.BlockDragger.prototype.fireDragEndEvent_=function(){var e=new o.Events.Ui(this.draggingBlock_,"dragStop",this.draggingBlock_.getDescendants(!1),null);o.Events.fire(e)};o.BlockDragger.prototype.fireMoveEvent_=function(){var e=new o.Events.BlockMove(this.draggingBlock_);e.oldCoordinate=this.startXY_;e.recordNew();o.Events.fire(e)};o.BlockDragger.prototype.maybeDeleteBlock_=function(){var e=this.workspace_.trashcan;this.wouldDeleteBlock_?(e&&setTimeout(e.close.bind(e),100),this.fireMoveEvent_(),this.draggingBlock_.dispose(!1,!0)):e&&e.close();return this.wouldDeleteBlock_};o.BlockDragger.prototype.updateCursorDuringBlockDrag_=function(){this.wouldDeleteBlock_=this.draggedConnectionManager_.wouldDeleteBlock();var e=this.workspace_.trashcan;this.wouldDeleteBlock_?(this.draggingBlock_.setDeleteStyle(!0),this.deleteArea_==o.DELETE_AREA_TRASH&&e&&e.setOpen(!0)):(this.draggingBlock_.setDeleteStyle(!1),e&&e.setOpen(!1))};o.BlockDragger.prototype.pixelsToWorkspaceUnits_=function(e){e=new o.utils.Coordinate(e.x/this.workspace_.scale,e.y/this.workspace_.scale);this.workspace_.isMutator&&e.scale(1/this.workspace_.options.parentWorkspace.scale);return e};o.BlockDragger.prototype.dragIcons_=function(e){for(var t=0,n;t<this.dragIconData_.length;t++){n=this.dragIconData_[t];n.icon.setIconLocation(o.utils.Coordinate.sum(n.location,e))}};o.BlockDragger.prototype.getInsertionMarkers=function(){return this.draggedConnectionManager_&&this.draggedConnectionManager_.getInsertionMarkers?this.draggedConnectionManager_.getInsertionMarkers():[]};o.VariableMap=function(e){this.variableMap_=Object.create(null);this.workspace=e};o.VariableMap.prototype.clear=function(){this.variableMap_=Object.create(null)};o.VariableMap.prototype.renameVariable=function(e,t){var n=this.getVariable(t,e.type),r=this.workspace.getAllBlocks(!1);o.Events.setGroup(!0);try{n&&n.getId()!=e.getId()?this.renameVariableWithConflict_(e,t,n,r):this.renameVariableAndUses_(e,t,r)}finally{o.Events.setGroup(!1)}};o.VariableMap.prototype.renameVariableById=function(e,t){var o=this.getVariableById(e);if(!o)throw Error("Tried to rename a variable that didn't exist. ID: "+e);this.renameVariable(o,t)};o.VariableMap.prototype.renameVariableAndUses_=function(e,t,n){o.Events.fire(new o.Events.VarRename(e,t));e.name=t;for(t=0;t<n.length;t++){n[t].updateVarName(e)}};o.VariableMap.prototype.renameVariableWithConflict_=function(t,n,r,i){var s=t.type;n!=r.name&&this.renameVariableAndUses_(r,n,i);for(n=0;n<i.length;n++){i[n].renameVarById(t.getId(),r.getId())}o.Events.fire(new o.Events.VarDelete(t));t=this.getVariablesOfType(s).indexOf(t);this.variableMap_[s].splice(t,1)};o.VariableMap.prototype.createVariable=function(e,t,n){var r=this.getVariable(e,t);if(r){if(n&&r.getId()!=n)throw Error("Variable \""+e+"\" is already in use and its id is \""+r.getId()+"\" which conflicts with the passed in id, \""+n+"\".");return r}if(n&&this.getVariableById(n))throw Error("Variable id, \""+n+"\", is already in use.");r=n||o.utils.genUid();t=t||"";r=new o.VariableModel(this.workspace,e,t,r);e=this.variableMap_[t]||[];e.push(r);delete this.variableMap_[t];this.variableMap_[t]=e;return r};o.VariableMap.prototype.deleteVariable=function(e){for(var t=this.variableMap_[e.type],n=0,r;r=t[n];n++){if(r.getId()==e.getId()){t.splice(n,1);o.Events.fire(new o.Events.VarDelete(e));break}}};o.VariableMap.prototype.deleteVariableById=function(t){var n=this.getVariableById(t);if(n){var r=n.name,i=this.getVariableUsesById(t);t=0;for(var s;s=i[t];t++){if("procedures_defnoreturn"==s.type||"procedures_defreturn"==s.type){t=s.getFieldValue("NAME");r=o.Msg.CANNOT_DELETE_VARIABLE_PROCEDURE.replace("%1",r).replace("%2",t);o.alert(r);return}}var l=this;1<i.length?(r=o.Msg.DELETE_VARIABLE_CONFIRMATION.replace("%1",i.length+"").replace("%2",r),o.confirm(r,function(e){e&&n&&l.deleteVariableInternal(n,i)})):l.deleteVariableInternal(n,i)}else console.warn("Can't delete non-existent variable: "+t)};o.VariableMap.prototype.deleteVariableInternal=function(e,t){var n=o.Events.getGroup();n||o.Events.setGroup(!0);try{for(var r=0;r<t.length;r++){t[r].dispose(!0)}this.deleteVariable(e)}finally{n||o.Events.setGroup(!1)}};o.VariableMap.prototype.getVariable=function(e,t){if(t=this.variableMap_[t||""])for(var n=0,r;r=t[n];n++){if(o.Names.equals(r.name,e))return r}return null};o.VariableMap.prototype.getVariableById=function(t){for(var o=Object.keys(this.variableMap_),n=0;n<o.length;n++){for(var r=o[n],i=0,s;s=this.variableMap_[r][i];i++){if(s.getId()==t)return s}}return null};o.VariableMap.prototype.getVariablesOfType=function(e){return(e=this.variableMap_[e||""])?e.slice():[]};o.VariableMap.prototype.getVariableTypes=function(e){var t={};o.utils.object.mixin(t,this.variableMap_);e&&e.getPotentialVariableMap()&&o.utils.object.mixin(t,e.getPotentialVariableMap().variableMap_);e=Object.keys(t);t=!1;for(var n=0;n<e.length;n++){""==e[n]&&(t=!0)}t||e.push("");return e};o.VariableMap.prototype.getAllVariables=function(){var e=[],t;for(t in this.variableMap_){e=e.concat(this.variableMap_[t])}return e};o.VariableMap.prototype.getAllVariableNames=function(){var t=[],o;for(o in this.variableMap_){for(var n=this.variableMap_[o],r=0,i;i=n[r];r++){t.push(i.name)}}return t};o.VariableMap.prototype.getVariableUsesById=function(t){for(var o=[],n=this.workspace.getAllBlocks(!1),r=0,i;r<n.length;r++){i=n[r].getVarModels();if(i)for(var s=0;s<i.length;s++){i[s].getId()==t&&o.push(n[r])}}return o};o.Workspace=function(e){this.id=o.utils.genUid();o.Workspace.WorkspaceDB_[this.id]=this;this.options=e||new o.Options({});this.RTL=!!this.options.RTL;this.horizontalLayout=!!this.options.horizontalLayout;this.toolboxPosition=this.options.toolboxPosition;this.topBlocks_=[];this.topComments_=[];this.commentDB_=Object.create(null);this.listeners_=[];this.undoStack_=[];this.redoStack_=[];this.blockDB_=Object.create(null);this.typedBlocksDB_=Object.create(null);this.variableMap_=new o.VariableMap(this);this.potentialVariableMap_=null};o.Workspace.prototype.rendered=!1;o.Workspace.prototype.isClearing=!1;o.Workspace.prototype.MAX_UNDO=1024;o.Workspace.prototype.connectionDBList=null;o.Workspace.prototype.dispose=function(){this.listeners_.length=0;this.clear();delete o.Workspace.WorkspaceDB_[this.id]};o.Workspace.SCAN_ANGLE=3;o.Workspace.prototype.sortObjects_=function(e,t){e=e.getRelativeToSurfaceXY();t=t.getRelativeToSurfaceXY();return e.y+o.Workspace.prototype.sortObjects_.offset*e.x-(t.y+o.Workspace.prototype.sortObjects_.offset*t.x)};o.Workspace.prototype.addTopBlock=function(e){this.topBlocks_.push(e)};o.Workspace.prototype.removeTopBlock=function(e){if(!o.utils.arrayRemove(this.topBlocks_,e))throw Error("Block not present in workspace's list of top-most blocks.")};o.Workspace.prototype.getTopBlocks=function(e){var t=[].concat(this.topBlocks_);e&&1<t.length&&(this.sortObjects_.offset=Math.sin(o.utils.math.toRadians(o.Workspace.SCAN_ANGLE)),this.RTL&&(this.sortObjects_.offset*=-1),t.sort(this.sortObjects_));return t};o.Workspace.prototype.addTypedBlock=function(e){this.typedBlocksDB_[e.type]||(this.typedBlocksDB_[e.type]=[]);this.typedBlocksDB_[e.type].push(e)};o.Workspace.prototype.removeTypedBlock=function(e){this.typedBlocksDB_[e.type].splice(this.typedBlocksDB_[e.type].indexOf(e),1);this.typedBlocksDB_[e.type].length||delete this.typedBlocksDB_[e.type]};o.Workspace.prototype.getBlocksByType=function(e,t){if(!this.typedBlocksDB_[e])return[];e=this.typedBlocksDB_[e].slice(0);t&&1<e.length&&(this.sortObjects_.offset=Math.sin(o.utils.math.toRadians(o.Workspace.SCAN_ANGLE)),this.RTL&&(this.sortObjects_.offset*=-1),e.sort(this.sortObjects_));return e};o.Workspace.prototype.addTopComment=function(e){this.topComments_.push(e);this.commentDB_[e.id]&&console.warn("Overriding an existing comment on this workspace, with id \""+e.id+"\"");this.commentDB_[e.id]=e};o.Workspace.prototype.removeTopComment=function(e){if(!o.utils.arrayRemove(this.topComments_,e))throw Error("Comment not present in workspace's list of top-most comments.");delete this.commentDB_[e.id]};o.Workspace.prototype.getTopComments=function(e){var t=[].concat(this.topComments_);e&&1<t.length&&(this.sortObjects_.offset=Math.sin(o.utils.math.toRadians(o.Workspace.SCAN_ANGLE)),this.RTL&&(this.sortObjects_.offset*=-1),t.sort(this.sortObjects_));return t};o.Workspace.prototype.getAllBlocks=function(e){if(e){e=this.getTopBlocks(!0);for(var t=[],o=0;o<e.length;o++){t.push.apply(t,e[o].getDescendants(!0))}}else for(t=this.getTopBlocks(!1),o=0;o<t.length;o++){t.push.apply(t,t[o].getChildren(!1))}return t.filter(function(e){return!e.isInsertionMarker()})};o.Workspace.prototype.clear=function(){this.isClearing=!0;try{var e=o.Events.getGroup();for(e||o.Events.setGroup(!0);this.topBlocks_.length;){this.topBlocks_[0].dispose(!1)}for(;this.topComments_.length;){this.topComments_[this.topComments_.length-1].dispose(!1)}e||o.Events.setGroup(!1);this.variableMap_.clear();this.potentialVariableMap_&&this.potentialVariableMap_.clear()}finally{this.isClearing=!1}};o.Workspace.prototype.renameVariableById=function(e,t){this.variableMap_.renameVariableById(e,t)};o.Workspace.prototype.createVariable=function(e,t,o){return this.variableMap_.createVariable(e,t,o)};o.Workspace.prototype.getVariableUsesById=function(e){return this.variableMap_.getVariableUsesById(e)};o.Workspace.prototype.deleteVariableById=function(e){this.variableMap_.deleteVariableById(e)};o.Workspace.prototype.deleteVariableInternal_=function(e,t){this.variableMap_.deleteVariableInternal(e,t)};o.Workspace.prototype.variableIndexOf=function(){console.warn("Deprecated call to Blockly.Workspace.prototype.variableIndexOf");return-1};o.Workspace.prototype.getVariable=function(e,t){return this.variableMap_.getVariable(e,t)};o.Workspace.prototype.getVariableById=function(e){return this.variableMap_.getVariableById(e)};o.Workspace.prototype.getVariablesOfType=function(e){return this.variableMap_.getVariablesOfType(e)};o.Workspace.prototype.getVariableTypes=function(){return this.variableMap_.getVariableTypes(this)};o.Workspace.prototype.getAllVariables=function(){return this.variableMap_.getAllVariables()};o.Workspace.prototype.getAllVariableNames=function(){return this.variableMap_.getAllVariableNames()};o.Workspace.prototype.getWidth=function(){return 0};o.Workspace.prototype.newBlock=function(e,t){return new o.Block(this,e,t)};o.Workspace.prototype.remainingCapacity=function(){return isNaN(this.options.maxBlocks)?1/0:this.options.maxBlocks-this.getAllBlocks(!1).length};o.Workspace.prototype.remainingCapacityOfType=function(e){return this.options.maxInstances?(this.options.maxInstances[e]||1/0)-this.getBlocksByType(e,!1).length:1/0};o.Workspace.prototype.isCapacityAvailable=function(e){if(!this.hasBlockLimits())return!0;var t=0,o;for(o in e){if(e[o]>this.remainingCapacityOfType(o))return!1;t+=e[o]}return t>this.remainingCapacity()?!1:!0};o.Workspace.prototype.hasBlockLimits=function(){return 1/0!=this.options.maxBlocks||!!this.options.maxInstances};o.Workspace.prototype.undo=function(t){var n=t?this.redoStack_:this.undoStack_,r=t?this.undoStack_:this.redoStack_,i=n.pop();if(i){for(var s=[i];n.length&&i.group&&i.group==n[n.length-1].group;){s.push(n.pop())}for(n=0;i=s[n];n++){r.push(i)}s=o.Events.filter(s,t);o.Events.recordUndo=!1;try{for(n=0;i=s[n];n++){i.run(t)}}finally{o.Events.recordUndo=!0}}};o.Workspace.prototype.clearUndo=function(){this.undoStack_.length=0;this.redoStack_.length=0;o.Events.clearPendingUndo()};o.Workspace.prototype.addChangeListener=function(e){this.listeners_.push(e);return e};o.Workspace.prototype.removeChangeListener=function(e){o.utils.arrayRemove(this.listeners_,e)};o.Workspace.prototype.fireChangeListener=function(e){if(e.recordUndo)for(this.undoStack_.push(e),this.redoStack_.length=0;this.undoStack_.length>this.MAX_UNDO&&0<=this.MAX_UNDO;){this.undoStack_.shift()}for(var t=0,o;o=this.listeners_[t];t++){o(e)}};o.Workspace.prototype.getBlockById=function(e){return this.blockDB_[e]||null};o.Workspace.prototype.setBlockById=function(e,t){this.blockDB_[e]=t};o.Workspace.prototype.removeBlockById=function(e){delete this.blockDB_[e]};o.Workspace.prototype.getCommentById=function(e){return this.commentDB_[e]||null};o.Workspace.prototype.allInputsFilled=function(e){for(var t=this.getTopBlocks(!1),o=0,n;n=t[o];o++){if(!n.allInputsFilled(e))return!1}return!0};o.Workspace.prototype.getPotentialVariableMap=function(){return this.potentialVariableMap_};o.Workspace.prototype.createPotentialVariableMap=function(){this.potentialVariableMap_=new o.VariableMap(this)};o.Workspace.prototype.getVariableMap=function(){return this.variableMap_};o.Workspace.prototype.setVariableMap=function(e){this.variableMap_=e};o.Workspace.WorkspaceDB_=Object.create(null);o.Workspace.getById=function(e){return o.Workspace.WorkspaceDB_[e]||null};o.Workspace.getAll=function(){var e=[],t;for(t in o.Workspace.WorkspaceDB_){e.push(o.Workspace.WorkspaceDB_[t])}return e};o.Bubble=function(t,n,r,i,s,l){this.workspace_=t;this.content_=n;this.shape_=r;this.onMouseDownResizeWrapper_=this.onMouseDownBubbleWrapper_=this.moveCallback_=this.resizeCallback_=null;this.disposed=!1;r=o.Bubble.ARROW_ANGLE;this.workspace_.RTL&&(r=-r);this.arrow_radians_=o.utils.math.toRadians(r);t.getBubbleCanvas().appendChild(this.createDom_(n,!(!s||!l)));this.setAnchorLocation(i);s&&l||(t=this.content_.getBBox(),s=t.width+2*o.Bubble.BORDER_WIDTH,l=t.height+2*o.Bubble.BORDER_WIDTH);this.setBubbleSize(s,l);this.positionBubble_();this.renderArrow_();this.rendered_=!0};o.Bubble.BORDER_WIDTH=6;o.Bubble.ARROW_THICKNESS=5;o.Bubble.ARROW_ANGLE=20;o.Bubble.ARROW_BEND=4;o.Bubble.ANCHOR_RADIUS=8;o.Bubble.onMouseUpWrapper_=null;o.Bubble.onMouseMoveWrapper_=null;o.Bubble.unbindDragEvents_=function(){o.Bubble.onMouseUpWrapper_&&(o.unbindEvent_(o.Bubble.onMouseUpWrapper_),o.Bubble.onMouseUpWrapper_=null);o.Bubble.onMouseMoveWrapper_&&(o.unbindEvent_(o.Bubble.onMouseMoveWrapper_),o.Bubble.onMouseMoveWrapper_=null)};o.Bubble.bubbleMouseUp_=function(){o.Touch.clearTouchIdentifier();o.Bubble.unbindDragEvents_()};o.Bubble.prototype.rendered_=!1;o.Bubble.prototype.anchorXY_=null;o.Bubble.prototype.relativeLeft_=0;o.Bubble.prototype.relativeTop_=0;o.Bubble.prototype.width_=0;o.Bubble.prototype.height_=0;o.Bubble.prototype.autoLayout_=!0;o.Bubble.prototype.createDom_=function(e,t){this.bubbleGroup_=o.utils.dom.createSvgElement("g",{},null);var n={filter:"url(#"+this.workspace_.getRenderer().getConstants().embossFilterId+")"};o.utils.userAgent.JAVA_FX&&(n={});n=o.utils.dom.createSvgElement("g",n,this.bubbleGroup_);this.bubbleArrow_=o.utils.dom.createSvgElement("path",{},n);this.bubbleBack_=o.utils.dom.createSvgElement("rect",{class:"blocklyDraggable",x:0,y:0,rx:o.Bubble.BORDER_WIDTH,ry:o.Bubble.BORDER_WIDTH},n);t?(this.resizeGroup_=o.utils.dom.createSvgElement("g",{class:this.workspace_.RTL?"blocklyResizeSW":"blocklyResizeSE"},this.bubbleGroup_),t=2*o.Bubble.BORDER_WIDTH,o.utils.dom.createSvgElement("polygon",{points:"0,x x,x x,0".replace(/x/g,t.toString())},this.resizeGroup_),o.utils.dom.createSvgElement("line",{class:"blocklyResizeLine",x1:t/3,y1:t-1,x2:t-1,y2:t/3},this.resizeGroup_),o.utils.dom.createSvgElement("line",{class:"blocklyResizeLine",x1:2*t/3,y1:t-1,x2:t-1,y2:2*t/3},this.resizeGroup_)):this.resizeGroup_=null;this.workspace_.options.readOnly||(this.onMouseDownBubbleWrapper_=o.bindEventWithChecks_(this.bubbleBack_,"mousedown",this,this.bubbleMouseDown_),this.resizeGroup_&&(this.onMouseDownResizeWrapper_=o.bindEventWithChecks_(this.resizeGroup_,"mousedown",this,this.resizeMouseDown_)));this.bubbleGroup_.appendChild(e);return this.bubbleGroup_};o.Bubble.prototype.getSvgRoot=function(){return this.bubbleGroup_};o.Bubble.prototype.setSvgId=function(e){this.bubbleGroup_.dataset&&(this.bubbleGroup_.dataset.blockId=e)};o.Bubble.prototype.bubbleMouseDown_=function(e){var t=this.workspace_.getGesture(e);t&&t.handleBubbleStart(e,this)};o.Bubble.prototype.showContextMenu=function(){};o.Bubble.prototype.isDeletable=function(){return!1};o.Bubble.prototype.resizeMouseDown_=function(e){this.promote();o.Bubble.unbindDragEvents_();o.utils.isRightButton(e)||(this.workspace_.startDrag(e,new o.utils.Coordinate(this.workspace_.RTL?-this.width_:this.width_,this.height_)),o.Bubble.onMouseUpWrapper_=o.bindEventWithChecks_(document,"mouseup",this,o.Bubble.bubbleMouseUp_),o.Bubble.onMouseMoveWrapper_=o.bindEventWithChecks_(document,"mousemove",this,this.resizeMouseMove_),o.hideChaff());e.stopPropagation()};o.Bubble.prototype.resizeMouseMove_=function(e){this.autoLayout_=!1;e=this.workspace_.moveDrag(e);this.setBubbleSize(this.workspace_.RTL?-e.x:e.x,e.y);this.workspace_.RTL&&this.positionBubble_()};o.Bubble.prototype.registerResizeEvent=function(e){this.resizeCallback_=e};o.Bubble.prototype.registerMoveEvent=function(e){this.moveCallback_=e};o.Bubble.prototype.promote=function(){var e=this.bubbleGroup_.parentNode;return e.lastChild!==this.bubbleGroup_?(e.appendChild(this.bubbleGroup_),!0):!1};o.Bubble.prototype.setAnchorLocation=function(e){this.anchorXY_=e;this.rendered_&&this.positionBubble_()};o.Bubble.prototype.layoutBubble_=function(){var t=this.workspace_.getMetrics();t.viewLeft/=this.workspace_.scale;t.viewWidth/=this.workspace_.scale;t.viewTop/=this.workspace_.scale;t.viewHeight/=this.workspace_.scale;var o=this.getOptimalRelativeLeft_(t),n=this.getOptimalRelativeTop_(t),r=this.shape_.getBBox(),i={x:o,y:-this.height_-this.workspace_.getRenderer().getConstants().MIN_BLOCK_HEIGHT},e={x:-this.width_-30,y:n};n={x:r.width,y:n};var s={x:o,y:r.height};o=r.width<r.height?n:s;r=r.width<r.height?s:n;n=this.getOverlap_(i,t);s=this.getOverlap_(e,t);var l=this.getOverlap_(o,t);t=this.getOverlap_(r,t);t=Math.max(n,s,l,t);n==t?(this.relativeLeft_=i.x,this.relativeTop_=i.y):s==t?(this.relativeLeft_=e.x,this.relativeTop_=e.y):l==t?(this.relativeLeft_=o.x,this.relativeTop_=o.y):(this.relativeLeft_=r.x,this.relativeTop_=r.y)};o.Bubble.prototype.getOverlap_=function(e,t){var o=this.workspace_.RTL?this.anchorXY_.x-e.x-this.width_:e.x+this.anchorXY_.x;e=e.y+this.anchorXY_.y;return Math.max(0,Math.min(1,(Math.min(o+this.width_,t.viewLeft+t.viewWidth)-Math.max(o,t.viewLeft))*(Math.min(e+this.height_,t.viewTop+t.viewHeight)-Math.max(e,t.viewTop))/(this.width_*this.height_)))};o.Bubble.prototype.getOptimalRelativeLeft_=function(t){var n=-this.width_/4;if(this.width_>t.viewWidth)return n;if(this.workspace_.RTL)var r=this.anchorXY_.x-n,i=r-this.width_,s=t.viewLeft+t.viewWidth,l=t.viewLeft+o.Scrollbar.scrollbarThickness/this.workspace_.scale;else i=n+this.anchorXY_.x,r=i+this.width_,l=t.viewLeft,s=t.viewLeft+t.viewWidth-o.Scrollbar.scrollbarThickness/this.workspace_.scale;this.workspace_.RTL?i<l?n=-(l-this.anchorXY_.x+this.width_):r>s&&(n=-(s-this.anchorXY_.x)):i<l?n=l-this.anchorXY_.x:r>s&&(n=s-this.anchorXY_.x-this.width_);return n};o.Bubble.prototype.getOptimalRelativeTop_=function(t){var n=-this.height_/4;if(this.height_>t.viewHeight)return n;var r=this.anchorXY_.y+n,i=r+this.height_,s=t.viewTop;t=t.viewTop+t.viewHeight-o.Scrollbar.scrollbarThickness/this.workspace_.scale;var e=this.anchorXY_.y;r<s?n=s-e:i>t&&(n=t-e-this.height_);return n};o.Bubble.prototype.positionBubble_=function(){var e=this.anchorXY_.x;e=this.workspace_.RTL?e-(this.relativeLeft_+this.width_):e+this.relativeLeft_;this.moveTo(e,this.relativeTop_+this.anchorXY_.y)};o.Bubble.prototype.moveTo=function(e,t){this.bubbleGroup_.setAttribute("transform","translate("+e+","+t+")")};o.Bubble.prototype.setDragging=function(e){!e&&this.moveCallback_&&this.moveCallback_()};o.Bubble.prototype.getBubbleSize=function(){return new o.utils.Size(this.width_,this.height_)};o.Bubble.prototype.setBubbleSize=function(e,t){var n=2*o.Bubble.BORDER_WIDTH;e=Math.max(e,n+45);t=Math.max(t,n+20);this.width_=e;this.height_=t;this.bubbleBack_.setAttribute("width",e);this.bubbleBack_.setAttribute("height",t);this.resizeGroup_&&(this.workspace_.RTL?this.resizeGroup_.setAttribute("transform","translate("+2*o.Bubble.BORDER_WIDTH+","+(t-n)+") scale(-1 1)"):this.resizeGroup_.setAttribute("transform","translate("+(e-n)+","+(t-n)+")"));this.autoLayout_&&this.layoutBubble_();this.positionBubble_();this.renderArrow_();this.resizeCallback_&&this.resizeCallback_()};o.Bubble.prototype.renderArrow_=function(){var t=[],r=this.width_/2,i=this.height_/2,s=-this.relativeLeft_,a=-this.relativeTop_;if(r==s&&i==a)t.push("M "+r+","+i);else{a-=i;s-=r;this.workspace_.RTL&&(s*=-1);var p=Math.sqrt(a*a+s*s),u=Math.acos(s/p);0>a&&(u=2*Math.PI-u);var _=u+Math.PI/2;_>2*Math.PI&&(_-=2*Math.PI);var y=Math.sin(_),T=Math.cos(_),l=this.getBubbleSize();_=(l.width+l.height)/o.Bubble.ARROW_THICKNESS;_=Math.min(_,l.width,l.height)/4;l=1-o.Bubble.ANCHOR_RADIUS/p;s=r+l*s;a=i+l*a;l=r+_*T;var C=i+_*y;r-=_*T;i-=_*y;y=u+this.arrow_radians_;y>2*Math.PI&&(y-=2*Math.PI);u=Math.sin(y)*p/o.Bubble.ARROW_BEND;p=Math.cos(y)*p/o.Bubble.ARROW_BEND;t.push("M"+l+","+C);t.push("C"+(l+p)+","+(C+u)+" "+s+","+a+" "+s+","+a);t.push("C"+s+","+a+" "+(r+p)+","+(i+u)+" "+r+","+i)}t.push("z");this.bubbleArrow_.setAttribute("d",t.join(" "))};o.Bubble.prototype.setColour=function(e){this.bubbleBack_.setAttribute("fill",e);this.bubbleArrow_.setAttribute("fill",e)};o.Bubble.prototype.dispose=function(){this.onMouseDownBubbleWrapper_&&o.unbindEvent_(this.onMouseDownBubbleWrapper_);this.onMouseDownResizeWrapper_&&o.unbindEvent_(this.onMouseDownResizeWrapper_);o.Bubble.unbindDragEvents_();o.utils.dom.removeNode(this.bubbleGroup_);this.disposed=!0};o.Bubble.prototype.moveDuringDrag=function(e,t){e?e.translateSurface(t.x,t.y):this.moveTo(t.x,t.y);this.relativeLeft_=this.workspace_.RTL?this.anchorXY_.x-t.x-this.width_:t.x-this.anchorXY_.x;this.relativeTop_=t.y-this.anchorXY_.y;this.renderArrow_()};o.Bubble.prototype.getRelativeToSurfaceXY=function(){return new o.utils.Coordinate(this.workspace_.RTL?-this.relativeLeft_+this.anchorXY_.x-this.width_:this.anchorXY_.x+this.relativeLeft_,this.anchorXY_.y+this.relativeTop_)};o.Bubble.prototype.setAutoLayout=function(e){this.autoLayout_=e};o.Events.CommentBase=function(e){this.commentId=e.id;this.workspaceId=e.workspace.id;this.group=o.Events.getGroup();this.recordUndo=o.Events.recordUndo};o.utils.object.inherits(o.Events.CommentBase,o.Events.Abstract);o.Events.CommentBase.prototype.toJson=function(){var e=o.Events.CommentBase.superClass_.toJson.call(this);this.commentId&&(e.commentId=this.commentId);return e};o.Events.CommentBase.prototype.fromJson=function(e){o.Events.CommentBase.superClass_.fromJson.call(this,e);this.commentId=e.commentId};o.Events.CommentChange=function(e,t,n){e&&(o.Events.CommentChange.superClass_.constructor.call(this,e),this.oldContents_=t,this.newContents_=n)};o.utils.object.inherits(o.Events.CommentChange,o.Events.CommentBase);o.Events.CommentChange.prototype.type=o.Events.COMMENT_CHANGE;o.Events.CommentChange.prototype.toJson=function(){var e=o.Events.CommentChange.superClass_.toJson.call(this);e.newContents=this.newContents_;return e};o.Events.CommentChange.prototype.fromJson=function(e){o.Events.CommentChange.superClass_.fromJson.call(this,e);this.newContents_=e.newValue};o.Events.CommentChange.prototype.isNull=function(){return this.oldContents_==this.newContents_};o.Events.CommentChange.prototype.run=function(e){var t=this.getEventWorkspace_().getCommentById(this.commentId);t?t.setContent(e?this.newContents_:this.oldContents_):console.warn("Can't change non-existent comment: "+this.commentId)};o.Events.CommentCreate=function(e){e&&(o.Events.CommentCreate.superClass_.constructor.call(this,e),this.xml=e.toXmlWithXY())};o.utils.object.inherits(o.Events.CommentCreate,o.Events.CommentBase);o.Events.CommentCreate.prototype.type=o.Events.COMMENT_CREATE;o.Events.CommentCreate.prototype.toJson=function(){var e=o.Events.CommentCreate.superClass_.toJson.call(this);e.xml=o.Xml.domToText(this.xml);return e};o.Events.CommentCreate.prototype.fromJson=function(e){o.Events.CommentCreate.superClass_.fromJson.call(this,e);this.xml=o.Xml.textToDom(e.xml)};o.Events.CommentCreate.prototype.run=function(e){o.Events.CommentCreateDeleteHelper(this,e)};o.Events.CommentCreateDeleteHelper=function(e,t){var n=e.getEventWorkspace_();t?(t=o.utils.xml.createElement("xml"),t.appendChild(e.xml),o.Xml.domToWorkspace(t,n)):(n=n.getCommentById(e.commentId))?n.dispose(!1,!1):console.warn("Can't uncreate non-existent comment: "+e.commentId)};o.Events.CommentDelete=function(e){e&&(o.Events.CommentDelete.superClass_.constructor.call(this,e),this.xml=e.toXmlWithXY())};o.utils.object.inherits(o.Events.CommentDelete,o.Events.CommentBase);o.Events.CommentDelete.prototype.type=o.Events.COMMENT_DELETE;o.Events.CommentDelete.prototype.toJson=function(){return o.Events.CommentDelete.superClass_.toJson.call(this)};o.Events.CommentDelete.prototype.fromJson=function(e){o.Events.CommentDelete.superClass_.fromJson.call(this,e)};o.Events.CommentDelete.prototype.run=function(e){o.Events.CommentCreateDeleteHelper(this,!e)};o.Events.CommentMove=function(e){e&&(o.Events.CommentMove.superClass_.constructor.call(this,e),this.comment_=e,this.oldCoordinate_=e.getXY(),this.newCoordinate_=null)};o.utils.object.inherits(o.Events.CommentMove,o.Events.CommentBase);o.Events.CommentMove.prototype.recordNew=function(){if(!this.comment_)throw Error("Tried to record the new position of a comment on the same event twice.");this.newCoordinate_=this.comment_.getXY();this.comment_=null};o.Events.CommentMove.prototype.type=o.Events.COMMENT_MOVE;o.Events.CommentMove.prototype.setOldCoordinate=function(e){this.oldCoordinate_=e};o.Events.CommentMove.prototype.toJson=function(){var e=o.Events.CommentMove.superClass_.toJson.call(this);this.newCoordinate_&&(e.newCoordinate=Math.round(this.newCoordinate_.x)+","+Math.round(this.newCoordinate_.y));return e};o.Events.CommentMove.prototype.fromJson=function(e){o.Events.CommentMove.superClass_.fromJson.call(this,e);e.newCoordinate&&(e=e.newCoordinate.split(","),this.newCoordinate_=new o.utils.Coordinate(+e[0],+e[1]))};o.Events.CommentMove.prototype.isNull=function(){return o.utils.Coordinate.equals(this.oldCoordinate_,this.newCoordinate_)};o.Events.CommentMove.prototype.run=function(e){var t=this.getEventWorkspace_().getCommentById(this.commentId);if(t){e=e?this.newCoordinate_:this.oldCoordinate_;var o=t.getXY();t.moveBy(e.x-o.x,e.y-o.y)}else console.warn("Can't move non-existent comment: "+this.commentId)};o.BubbleDragger=function(e,t){this.draggingBubble_=e;this.workspace_=t;this.deleteArea_=null;this.wouldDeleteBubble_=!1;this.startXY_=this.draggingBubble_.getRelativeToSurfaceXY();this.dragSurface_=o.utils.is3dSupported()&&t.getBlockDragSurface()?t.getBlockDragSurface():null};o.BubbleDragger.prototype.dispose=function(){this.dragSurface_=this.workspace_=this.draggingBubble_=null};o.BubbleDragger.prototype.startBubbleDrag=function(){o.Events.getGroup()||o.Events.setGroup(!0);this.workspace_.setResizesEnabled(!1);this.draggingBubble_.setAutoLayout(!1);this.dragSurface_&&this.moveToDragSurface_();this.draggingBubble_.setDragging&&this.draggingBubble_.setDragging(!0);var e=this.workspace_.getToolbox();if(e){var t=this.draggingBubble_.isDeletable()?"blocklyToolboxDelete":"blocklyToolboxGrab";e.addStyle(t)}};o.BubbleDragger.prototype.dragBubble=function(e,t){t=this.pixelsToWorkspaceUnits_(t);t=o.utils.Coordinate.sum(this.startXY_,t);this.draggingBubble_.moveDuringDrag(this.dragSurface_,t);this.draggingBubble_.isDeletable()&&(this.deleteArea_=this.workspace_.isDeleteArea(e),this.updateCursorDuringBubbleDrag_())};o.BubbleDragger.prototype.maybeDeleteBubble_=function(){var e=this.workspace_.trashcan;this.wouldDeleteBubble_?(e&&setTimeout(e.close.bind(e),100),this.fireMoveEvent_(),this.draggingBubble_.dispose(!1,!0)):e&&e.close();return this.wouldDeleteBubble_};o.BubbleDragger.prototype.updateCursorDuringBubbleDrag_=function(){this.wouldDeleteBubble_=this.deleteArea_!=o.DELETE_AREA_NONE;var e=this.workspace_.trashcan;this.wouldDeleteBubble_?(this.draggingBubble_.setDeleteStyle(!0),this.deleteArea_==o.DELETE_AREA_TRASH&&e&&e.setOpen(!0)):(this.draggingBubble_.setDeleteStyle(!1),e&&e.setOpen(!1))};o.BubbleDragger.prototype.endBubbleDrag=function(e,t){this.dragBubble(e,t);e=this.pixelsToWorkspaceUnits_(t);e=o.utils.Coordinate.sum(this.startXY_,e);this.draggingBubble_.moveTo(e.x,e.y);this.maybeDeleteBubble_()||(this.dragSurface_&&this.dragSurface_.clearAndHide(this.workspace_.getBubbleCanvas()),this.draggingBubble_.setDragging&&this.draggingBubble_.setDragging(!1),this.fireMoveEvent_());this.workspace_.setResizesEnabled(!0);this.workspace_.getToolbox()&&(e=this.draggingBubble_.isDeletable()?"blocklyToolboxDelete":"blocklyToolboxGrab",this.workspace_.getToolbox().removeStyle(e));o.Events.setGroup(!1)};o.BubbleDragger.prototype.fireMoveEvent_=function(){if(this.draggingBubble_.isComment){var e=new o.Events.CommentMove(this.draggingBubble_);e.setOldCoordinate(this.startXY_);e.recordNew();o.Events.fire(e)}};o.BubbleDragger.prototype.pixelsToWorkspaceUnits_=function(e){e=new o.utils.Coordinate(e.x/this.workspace_.scale,e.y/this.workspace_.scale);this.workspace_.isMutator&&e.scale(1/this.workspace_.options.parentWorkspace.scale);return e};o.BubbleDragger.prototype.moveToDragSurface_=function(){this.draggingBubble_.moveTo(0,0);this.dragSurface_.translateSurface(this.startXY_.x,this.startXY_.y);this.dragSurface_.setBlocksAndShow(this.draggingBubble_.getSvgRoot())};o.WorkspaceDragger=function(e){this.workspace_=e;this.startScrollXY_=new o.utils.Coordinate(e.scrollX,e.scrollY)};o.WorkspaceDragger.prototype.dispose=function(){this.workspace_=null};o.WorkspaceDragger.prototype.startDrag=function(){o.selected&&o.selected.unselect();this.workspace_.setupDragSurface()};o.WorkspaceDragger.prototype.endDrag=function(e){this.drag(e);this.workspace_.resetDragSurface()};o.WorkspaceDragger.prototype.drag=function(e){e=o.utils.Coordinate.sum(this.startScrollXY_,e);this.workspace_.scroll(e.x,e.y)};o.FlyoutDragger=function(e){o.FlyoutDragger.superClass_.constructor.call(this,e.getWorkspace());this.scrollbar_=e.scrollbar_;this.horizontalLayout_=e.horizontalLayout_};o.utils.object.inherits(o.FlyoutDragger,o.WorkspaceDragger);o.FlyoutDragger.prototype.drag=function(e){e=o.utils.Coordinate.sum(this.startScrollXY_,e);this.horizontalLayout_?this.scrollbar_.set(-e.x):this.scrollbar_.set(-e.y)};o.Action=function(e,t){this.name=e;this.desc=t};o.navigation={};o.navigation.loggingCallback=null;o.navigation.STATE_FLYOUT=1;o.navigation.STATE_WS=2;o.navigation.STATE_TOOLBOX=3;o.navigation.WS_MOVE_DISTANCE=40;o.navigation.currentState_=o.navigation.STATE_WS;o.navigation.actionNames={PREVIOUS:"previous",NEXT:"next",IN:"in",OUT:"out",INSERT:"insert",MARK:"mark",DISCONNECT:"disconnect",TOOLBOX:"toolbox",EXIT:"exit",TOGGLE_KEYBOARD_NAV:"toggle_keyboard_nav",MOVE_WS_CURSOR_UP:"move workspace cursor up",MOVE_WS_CURSOR_DOWN:"move workspace cursor down",MOVE_WS_CURSOR_LEFT:"move workspace cursor left",MOVE_WS_CURSOR_RIGHT:"move workspace cursor right"};o.navigation.MARKER_NAME="local_marker_1";o.navigation.getMarker=function(){return o.getMainWorkspace().getMarker(o.navigation.MARKER_NAME)};o.navigation.focusToolbox_=function(){var e=o.getMainWorkspace().getToolbox();e&&(o.navigation.currentState_=o.navigation.STATE_TOOLBOX,o.navigation.resetFlyout_(!1),o.navigation.getMarker().getCurNode()||o.navigation.markAtCursor_(),e.selectFirstCategory())};o.navigation.focusFlyout_=function(){o.navigation.currentState_=o.navigation.STATE_FLYOUT;var e=o.getMainWorkspace(),t=e.getToolbox();e=t?t.flyout_:e.getFlyout();o.navigation.getMarker().getCurNode()||o.navigation.markAtCursor_();e&&e.getWorkspace()&&(e=e.getWorkspace().getTopBlocks(!0),0<e.length&&(e=e[0],e=o.ASTNode.createStackNode(e),o.navigation.getFlyoutCursor_().setCurNode(e)))};o.navigation.focusWorkspace_=function(){o.hideChaff();var e=o.getMainWorkspace(),t=e.getCursor(),n=!!e.getToolbox(),r=e.getTopBlocks(!0);o.navigation.resetFlyout_(n);o.navigation.currentState_=o.navigation.STATE_WS;0<r.length?t.setCurNode(o.navigation.getTopNode(r[0])):(n=new o.utils.Coordinate(100,100),e=o.ASTNode.createWorkspaceNode(e,n),t.setCurNode(e))};o.navigation.getFlyoutCursor_=function(){var e=o.getMainWorkspace(),t=null;e.rendered&&(t=(e=(t=e.getToolbox())?t.flyout_:e.getFlyout())?e.workspace_.getCursor():null);return t};o.navigation.insertFromFlyout=function(){var e=o.getMainWorkspace(),t=e.getFlyout();if(t&&t.isVisible()){var n=o.navigation.getFlyoutCursor_().getCurNode().getLocation();n.isEnabled()?(t=t.createBlock(n),t.render(),t.setConnectionTracking(!0),e.getCursor().setCurNode(o.ASTNode.createBlockNode(t)),o.navigation.modify_()||o.navigation.warn_("Something went wrong while inserting a block from the flyout."),o.navigation.focusWorkspace_(),e.getCursor().setCurNode(o.navigation.getTopNode(t)),o.navigation.removeMark_()):o.navigation.warn_("Can't insert a disabled block.")}else o.navigation.warn_("Trying to insert from the flyout when the flyout does not  exist or is not visible")};o.navigation.resetFlyout_=function(e){o.navigation.getFlyoutCursor_()&&(o.navigation.getFlyoutCursor_().hide(),e&&o.getMainWorkspace().getFlyout().hide())};o.navigation.modifyWarn_=function(){var e=o.navigation.getMarker().getCurNode(),t=o.getMainWorkspace().getCursor().getCurNode();if(!e)return o.navigation.warn_("Cannot insert with no marked node."),!1;if(!t)return o.navigation.warn_("Cannot insert with no cursor node."),!1;e=e.getType();t=t.getType();return e==o.ASTNode.types.FIELD?(o.navigation.warn_("Should not have been able to mark a field."),!1):e==o.ASTNode.types.BLOCK?(o.navigation.warn_("Should not have been able to mark a block."),!1):e==o.ASTNode.types.STACK?(o.navigation.warn_("Should not have been able to mark a stack."),!1):t==o.ASTNode.types.FIELD?(o.navigation.warn_("Cannot attach a field to anything else."),!1):t==o.ASTNode.types.WORKSPACE?(o.navigation.warn_("Cannot attach a workspace to anything else."),!1):!0};o.navigation.moveBlockToWorkspace_=function(e,t){if(!e)return!1;if(e.isShadow())return o.navigation.warn_("Cannot move a shadow block to the workspace."),!1;e.getParent()&&e.unplug(!1);e.moveTo(t.getWsCoordinate());return!0};o.navigation.modify_=function(){var t=o.navigation.getMarker().getCurNode(),n=o.getMainWorkspace().getCursor().getCurNode();if(!o.navigation.modifyWarn_())return!1;var r=t.getType(),i=n.getType(),s=n.getLocation(),e=t.getLocation();if(t.isConnection()&&n.isConnection())return o.navigation.connect_(s,e);if(t.isConnection()&&(i==o.ASTNode.types.BLOCK||i==o.ASTNode.types.STACK))return o.navigation.insertBlock(s,e);if(r==o.ASTNode.types.WORKSPACE)return n=n?n.getSourceBlock():null,o.navigation.moveBlockToWorkspace_(n,t);o.navigation.warn_("Unexpected state in Blockly.navigation.modify_.");return!1};o.navigation.disconnectChild_=function(e,t){var n=e.getSourceBlock(),r=t.getSourceBlock();n.getRootBlock()==r.getRootBlock()&&(-1<n.getDescendants(!1).indexOf(r)?o.navigation.getInferiorConnection_(t).disconnect():o.navigation.getInferiorConnection_(e).disconnect())};o.navigation.moveAndConnect_=function(e,t){if(!e||!t)return!1;var n=e.getSourceBlock();return t.canConnectWithReason(e)==o.Connection.CAN_CONNECT?(o.navigation.disconnectChild_(e,t),t.isSuperior()||n.getRootBlock().positionNearConnection(e,t),t.connect(e),!0):!1};o.navigation.getInferiorConnection_=function(e){var t=e.getSourceBlock();return e.isSuperior()?t.previousConnection?t.previousConnection:t.outputConnection?t.outputConnection:null:e};o.navigation.getSuperiorConnection_=function(e){return e.isSuperior()?e:e.targetConnection?e.targetConnection:null};o.navigation.connect_=function(t,n){if(!t||!n)return!1;var r=o.navigation.getInferiorConnection_(t),i=o.navigation.getSuperiorConnection_(n),s=o.navigation.getSuperiorConnection_(t),e=o.navigation.getInferiorConnection_(n);if(r&&i&&o.navigation.moveAndConnect_(r,i)||s&&e&&o.navigation.moveAndConnect_(s,e)||o.navigation.moveAndConnect_(t,n))return!0;try{n.checkConnection(t)}catch(e){o.navigation.warn_("Connection failed with error: "+e)}return!1};o.navigation.insertBlock=function(e,t){switch(t.type){case o.PREVIOUS_STATEMENT:if(o.navigation.connect_(e.nextConnection,t))return!0;break;case o.NEXT_STATEMENT:if(o.navigation.connect_(e.previousConnection,t))return!0;break;case o.INPUT_VALUE:if(o.navigation.connect_(e.outputConnection,t))return!0;break;case o.OUTPUT_VALUE:for(var n=0,r;n<e.inputList.length;n++){r=e.inputList[n].connection;if(r&&r.type===o.INPUT_VALUE&&o.navigation.connect_(r,t))return!0}if(e.outputConnection&&o.navigation.connect_(e.outputConnection,t))return!0;}o.navigation.warn_("This block can not be inserted at the marked location.");return!1};o.navigation.disconnectBlocks_=function(){var e=o.getMainWorkspace(),t=e.getCursor().getCurNode();if(t.isConnection()){var n=t.getLocation();n.isConnected()?(t=n.isSuperior()?n:n.targetConnection,n=n.isSuperior()?n.targetConnection:n,n.getSourceBlock().isShadow()?o.navigation.log_("Cannot disconnect a shadow block"):(t.disconnect(),n.bumpAwayFrom(t),t.getSourceBlock().getRootBlock().bringToFront(),t=o.ASTNode.createConnectionNode(t),e.getCursor().setCurNode(t))):o.navigation.log_("Cannot disconnect unconnected connection")}else o.navigation.log_("Cannot disconnect blocks when the cursor is not on a connection")};o.navigation.markAtCursor_=function(){o.navigation.getMarker().setCurNode(o.getMainWorkspace().getCursor().getCurNode())};o.navigation.removeMark_=function(){var e=o.navigation.getMarker();e.setCurNode(null);e.hide()};o.navigation.setState=function(e){o.navigation.currentState_=e};o.navigation.getTopNode=function(e){var t=e.previousConnection||e.outputConnection;return t?o.ASTNode.createConnectionNode(t):o.ASTNode.createBlockNode(e)};o.navigation.moveCursorOnBlockDelete=function(e){var t=o.getMainWorkspace();if(t&&(t=t.getCursor())){var n=t.getCurNode();n=n?n.getSourceBlock():null;n===e?n.getParent()?(e=n.previousConnection||n.outputConnection)&&t.setCurNode(o.ASTNode.createConnectionNode(e.targetConnection)):t.setCurNode(o.ASTNode.createWorkspaceNode(n.workspace,n.getRelativeToSurfaceXY())):n&&-1<e.getChildren(!1).indexOf(n)&&t.setCurNode(o.ASTNode.createWorkspaceNode(n.workspace,n.getRelativeToSurfaceXY()))}};o.navigation.moveCursorOnBlockMutation=function(e){var t=o.getMainWorkspace().getCursor();if(t){var n=t.getCurNode();n=n?n.getSourceBlock():null;n===e&&t.setCurNode(o.ASTNode.createBlockNode(n))}};o.navigation.enableKeyboardAccessibility=function(){o.getMainWorkspace().keyboardAccessibilityMode||(o.getMainWorkspace().keyboardAccessibilityMode=!0,o.navigation.focusWorkspace_())};o.navigation.disableKeyboardAccessibility=function(){if(o.getMainWorkspace().keyboardAccessibilityMode){var e=o.getMainWorkspace();o.getMainWorkspace().keyboardAccessibilityMode=!1;e.getCursor().hide();o.navigation.getMarker().hide();o.navigation.getFlyoutCursor_()&&o.navigation.getFlyoutCursor_().hide()}};o.navigation.log_=function(e){o.navigation.loggingCallback?o.navigation.loggingCallback("log",e):console.log(e)};o.navigation.warn_=function(e){o.navigation.loggingCallback?o.navigation.loggingCallback("warn",e):console.warn(e)};o.navigation.error_=function(e){o.navigation.loggingCallback?o.navigation.loggingCallback("error",e):console.error(e)};o.navigation.onKeyPress=function(e){e=o.user.keyMap.serializeKeyEvent(e);return(e=o.user.keyMap.getActionByKeyCode(e))?o.navigation.onBlocklyAction(e):!1};o.navigation.onBlocklyAction=function(e){var t=o.getMainWorkspace().options.readOnly,n=!1;o.getMainWorkspace().keyboardAccessibilityMode?t?-1<o.navigation.READONLY_ACTION_LIST.indexOf(e)&&(n=o.navigation.handleActions_(e)):n=o.navigation.handleActions_(e):e.name===o.navigation.actionNames.TOGGLE_KEYBOARD_NAV&&(o.navigation.enableKeyboardAccessibility(),n=!0);return n};o.navigation.handleActions_=function(e){return e.name==o.navigation.actionNames.TOOLBOX||o.navigation.currentState_==o.navigation.STATE_TOOLBOX?o.navigation.toolboxOnAction_(e):e.name==o.navigation.actionNames.TOGGLE_KEYBOARD_NAV?(o.navigation.disableKeyboardAccessibility(),!0):o.navigation.currentState_==o.navigation.STATE_WS?o.navigation.workspaceOnAction_(e):o.navigation.currentState_==o.navigation.STATE_FLYOUT?o.navigation.flyoutOnAction_(e):!1};o.navigation.flyoutOnAction_=function(e){var t=o.getMainWorkspace(),n=t.getToolbox();if((t=n?n.flyout_:t.getFlyout())&&t.onBlocklyAction(e))return!0;switch(e.name){case o.navigation.actionNames.OUT:return o.navigation.focusToolbox_(),!0;case o.navigation.actionNames.MARK:return o.navigation.insertFromFlyout(),!0;case o.navigation.actionNames.EXIT:return o.navigation.focusWorkspace_(),!0;default:return!1;}};o.navigation.toolboxOnAction_=function(e){var t=o.getMainWorkspace(),n=t.getToolbox();return n&&n.onBlocklyAction(e)?!0:e.name===o.navigation.actionNames.TOOLBOX?(t.getToolbox()?o.navigation.focusToolbox_():o.navigation.focusFlyout_(),!0):e.name===o.navigation.actionNames.IN?(o.navigation.focusFlyout_(),!0):e.name===o.navigation.actionNames.EXIT?(o.navigation.focusWorkspace_(),!0):!1};o.navigation.moveWSCursor_=function(e,t){var n=o.getMainWorkspace().getCursor(),r=o.getMainWorkspace().getCursor().getCurNode();if(r.getType()!==o.ASTNode.types.WORKSPACE)return!1;r=r.getWsCoordinate();e=e*o.navigation.WS_MOVE_DISTANCE+r.x;t=t*o.navigation.WS_MOVE_DISTANCE+r.y;n.setCurNode(o.ASTNode.createWorkspaceNode(o.getMainWorkspace(),new o.utils.Coordinate(e,t)));return!0};o.navigation.workspaceOnAction_=function(e){if(o.getMainWorkspace().getCursor().onBlocklyAction(e))return!0;switch(e.name){case o.navigation.actionNames.INSERT:return o.navigation.modify_(),!0;case o.navigation.actionNames.MARK:return o.navigation.handleEnterForWS_(),!0;case o.navigation.actionNames.DISCONNECT:return o.navigation.disconnectBlocks_(),!0;case o.navigation.actionNames.MOVE_WS_CURSOR_UP:return o.navigation.moveWSCursor_(0,-1);case o.navigation.actionNames.MOVE_WS_CURSOR_DOWN:return o.navigation.moveWSCursor_(0,1);case o.navigation.actionNames.MOVE_WS_CURSOR_LEFT:return o.navigation.moveWSCursor_(-1,0);case o.navigation.actionNames.MOVE_WS_CURSOR_RIGHT:return o.navigation.moveWSCursor_(1,0);default:return!1;}};o.navigation.handleEnterForWS_=function(){var e=o.getMainWorkspace().getCursor().getCurNode(),t=e.getType();t==o.ASTNode.types.FIELD?e.getLocation().showEditor():e.isConnection()||t==o.ASTNode.types.WORKSPACE?o.navigation.markAtCursor_():t==o.ASTNode.types.BLOCK?o.navigation.warn_("Cannot mark a block."):t==o.ASTNode.types.STACK&&o.navigation.warn_("Cannot mark a stack.")};o.navigation.ACTION_PREVIOUS=new o.Action(o.navigation.actionNames.PREVIOUS,"Go to the previous location.");o.navigation.ACTION_OUT=new o.Action(o.navigation.actionNames.OUT,"Go to the parent of the current location.");o.navigation.ACTION_NEXT=new o.Action(o.navigation.actionNames.NEXT,"Go to the next location.");o.navigation.ACTION_IN=new o.Action(o.navigation.actionNames.IN,"Go to the first child of the current location.");o.navigation.ACTION_INSERT=new o.Action(o.navigation.actionNames.INSERT,"Connect the current location to the marked location.");o.navigation.ACTION_MARK=new o.Action(o.navigation.actionNames.MARK,"Mark the current location.");o.navigation.ACTION_DISCONNECT=new o.Action(o.navigation.actionNames.DISCONNECT,"Disconnect the block at the current location from its parent.");o.navigation.ACTION_TOOLBOX=new o.Action(o.navigation.actionNames.TOOLBOX,"Open the toolbox.");o.navigation.ACTION_EXIT=new o.Action(o.navigation.actionNames.EXIT,"Close the current modal, such as a toolbox or field editor.");o.navigation.ACTION_TOGGLE_KEYBOARD_NAV=new o.Action(o.navigation.actionNames.TOGGLE_KEYBOARD_NAV,"Turns on and off keyboard navigation.");o.navigation.ACTION_MOVE_WS_CURSOR_LEFT=new o.Action(o.navigation.actionNames.MOVE_WS_CURSOR_LEFT,"Move the workspace cursor to the lefts.");o.navigation.ACTION_MOVE_WS_CURSOR_RIGHT=new o.Action(o.navigation.actionNames.MOVE_WS_CURSOR_RIGHT,"Move the workspace cursor to the right.");o.navigation.ACTION_MOVE_WS_CURSOR_UP=new o.Action(o.navigation.actionNames.MOVE_WS_CURSOR_UP,"Move the workspace cursor up.");o.navigation.ACTION_MOVE_WS_CURSOR_DOWN=new o.Action(o.navigation.actionNames.MOVE_WS_CURSOR_DOWN,"Move the workspace cursor down.");o.navigation.READONLY_ACTION_LIST=[o.navigation.ACTION_PREVIOUS,o.navigation.ACTION_OUT,o.navigation.ACTION_IN,o.navigation.ACTION_NEXT,o.navigation.ACTION_TOGGLE_KEYBOARD_NAV];o.Gesture=function(e,t){this.mouseDownXY_=null;this.currentDragDeltaXY_=new o.utils.Coordinate(0,0);this.startWorkspace_=this.targetBlock_=this.startBlock_=this.startField_=this.startBubble_=null;this.creatorWorkspace_=t;this.isDraggingBubble_=this.isDraggingBlock_=this.isDraggingWorkspace_=this.hasExceededDragRadius_=!1;this.mostRecentEvent_=e;this.flyout_=this.workspaceDragger_=this.blockDragger_=this.bubbleDragger_=this.onUpWrapper_=this.onMoveWrapper_=null;this.isEnding_=this.hasStarted_=this.calledUpdateIsDragging_=!1;this.healStack_=!o.DRAG_STACK};o.Gesture.prototype.dispose=function(){o.Touch.clearTouchIdentifier();o.Tooltip.unblock();this.creatorWorkspace_.clearGesture();this.onMoveWrapper_&&o.unbindEvent_(this.onMoveWrapper_);this.onUpWrapper_&&o.unbindEvent_(this.onUpWrapper_);this.blockDragger_&&this.blockDragger_.dispose();this.workspaceDragger_&&this.workspaceDragger_.dispose();this.bubbleDragger_&&this.bubbleDragger_.dispose()};o.Gesture.prototype.updateFromEvent_=function(e){var t=new o.utils.Coordinate(e.clientX,e.clientY);this.updateDragDelta_(t)&&(this.updateIsDragging_(),o.longStop_());this.mostRecentEvent_=e};o.Gesture.prototype.updateDragDelta_=function(e){this.currentDragDeltaXY_=o.utils.Coordinate.difference(e,this.mouseDownXY_);return this.hasExceededDragRadius_?!1:this.hasExceededDragRadius_=o.utils.Coordinate.magnitude(this.currentDragDeltaXY_)>(this.flyout_?o.FLYOUT_DRAG_RADIUS:o.DRAG_RADIUS)};o.Gesture.prototype.updateIsDraggingFromFlyout_=function(){return this.targetBlock_&&this.flyout_.isBlockCreatable_(this.targetBlock_)?!this.flyout_.isScrollable()||this.flyout_.isDragTowardWorkspace(this.currentDragDeltaXY_)?(this.startWorkspace_=this.flyout_.targetWorkspace_,this.startWorkspace_.updateScreenCalculationsIfScrolled(),o.Events.getGroup()||o.Events.setGroup(!0),this.startBlock_=null,this.targetBlock_=this.flyout_.createBlock(this.targetBlock_),this.targetBlock_.select(),!0):!1:!1};o.Gesture.prototype.updateIsDraggingBubble_=function(){if(!this.startBubble_)return!1;this.isDraggingBubble_=!0;this.startDraggingBubble_();return!0};o.Gesture.prototype.updateIsDraggingBlock_=function(){if(!this.targetBlock_)return!1;this.flyout_?this.isDraggingBlock_=this.updateIsDraggingFromFlyout_():this.targetBlock_.isMovable()&&(this.isDraggingBlock_=!0);return this.isDraggingBlock_?(this.startDraggingBlock_(),!0):!1};o.Gesture.prototype.updateIsDraggingWorkspace_=function(){if(this.flyout_?this.flyout_.isScrollable():this.startWorkspace_&&this.startWorkspace_.isDraggable())this.workspaceDragger_=this.flyout_?new o.FlyoutDragger(this.flyout_):new o.WorkspaceDragger(this.startWorkspace_),this.isDraggingWorkspace_=!0,this.workspaceDragger_.startDrag()};o.Gesture.prototype.updateIsDragging_=function(){if(this.calledUpdateIsDragging_)throw Error("updateIsDragging_ should only be called once per gesture.");this.calledUpdateIsDragging_=!0;this.updateIsDraggingBubble_()||this.updateIsDraggingBlock_()||this.updateIsDraggingWorkspace_()};o.Gesture.prototype.startDraggingBlock_=function(){this.blockDragger_=new o.BlockDragger(this.targetBlock_,this.startWorkspace_);this.blockDragger_.startBlockDrag(this.currentDragDeltaXY_,this.healStack_);this.blockDragger_.dragBlock(this.mostRecentEvent_,this.currentDragDeltaXY_)};o.Gesture.prototype.startDraggingBubble_=function(){this.bubbleDragger_=new o.BubbleDragger(this.startBubble_,this.startWorkspace_);this.bubbleDragger_.startBubbleDrag();this.bubbleDragger_.dragBubble(this.mostRecentEvent_,this.currentDragDeltaXY_)};o.Gesture.prototype.doStart=function(e){o.utils.isTargetInput(e)?this.cancel():(this.hasStarted_=!0,o.blockAnimations.disconnectUiStop(),this.startWorkspace_.updateScreenCalculationsIfScrolled(),this.startWorkspace_.isMutator&&this.startWorkspace_.resize(),o.hideChaff(!!this.flyout_),this.startWorkspace_.markFocused(),this.mostRecentEvent_=e,o.Tooltip.block(),this.targetBlock_&&(!this.targetBlock_.isInFlyout&&e.shiftKey&&this.targetBlock_.workspace.keyboardAccessibilityMode?this.creatorWorkspace_.getCursor().setCurNode(o.navigation.getTopNode(this.targetBlock_)):this.targetBlock_.select()),o.utils.isRightButton(e)?this.handleRightClick(e):("touchstart"!=e.type.toLowerCase()&&"pointerdown"!=e.type.toLowerCase()||"mouse"==e.pointerType||o.longStart(e,this),this.mouseDownXY_=new o.utils.Coordinate(e.clientX,e.clientY),this.healStack_=e.altKey||e.ctrlKey||e.metaKey,this.bindMouseEvents(e)))};o.Gesture.prototype.bindMouseEvents=function(e){this.onMoveWrapper_=o.bindEventWithChecks_(document,"mousemove",null,this.handleMove.bind(this));this.onUpWrapper_=o.bindEventWithChecks_(document,"mouseup",null,this.handleUp.bind(this));e.preventDefault();e.stopPropagation()};o.Gesture.prototype.handleMove=function(e){this.updateFromEvent_(e);this.isDraggingWorkspace_?this.workspaceDragger_.drag(this.currentDragDeltaXY_):this.isDraggingBlock_?this.blockDragger_.dragBlock(this.mostRecentEvent_,this.currentDragDeltaXY_):this.isDraggingBubble_&&this.bubbleDragger_.dragBubble(this.mostRecentEvent_,this.currentDragDeltaXY_);e.preventDefault();e.stopPropagation()};o.Gesture.prototype.handleUp=function(e){this.updateFromEvent_(e);o.longStop_();this.isEnding_?console.log("Trying to end a gesture recursively."):(this.isEnding_=!0,this.isDraggingBubble_?this.bubbleDragger_.endBubbleDrag(e,this.currentDragDeltaXY_):this.isDraggingBlock_?this.blockDragger_.endBlockDrag(e,this.currentDragDeltaXY_):this.isDraggingWorkspace_?this.workspaceDragger_.endDrag(this.currentDragDeltaXY_):this.isBubbleClick_()?this.doBubbleClick_():this.isFieldClick_()?this.doFieldClick_():this.isBlockClick_()?this.doBlockClick_():this.isWorkspaceClick_()&&this.doWorkspaceClick_(e),e.preventDefault(),e.stopPropagation(),this.dispose())};o.Gesture.prototype.cancel=function(){this.isEnding_||(o.longStop_(),this.isDraggingBubble_?this.bubbleDragger_.endBubbleDrag(this.mostRecentEvent_,this.currentDragDeltaXY_):this.isDraggingBlock_?this.blockDragger_.endBlockDrag(this.mostRecentEvent_,this.currentDragDeltaXY_):this.isDraggingWorkspace_&&this.workspaceDragger_.endDrag(this.currentDragDeltaXY_),this.dispose())};o.Gesture.prototype.handleRightClick=function(e){this.targetBlock_?(this.bringBlockToFront_(),o.hideChaff(!!this.flyout_),this.targetBlock_.showContextMenu(e)):this.startBubble_?this.startBubble_.showContextMenu(e):this.startWorkspace_&&!this.flyout_&&(o.hideChaff(),this.startWorkspace_.showContextMenu(e));e.preventDefault();e.stopPropagation();this.dispose()};o.Gesture.prototype.handleWsStart=function(e,t){if(this.hasStarted_)throw Error("Tried to call gesture.handleWsStart, but the gesture had already been started.");this.setStartWorkspace_(t);this.mostRecentEvent_=e;this.doStart(e);this.startWorkspace_.keyboardAccessibilityMode&&o.navigation.setState(o.navigation.STATE_WS)};o.Gesture.prototype.handleFlyoutStart=function(e,t){if(this.hasStarted_)throw Error("Tried to call gesture.handleFlyoutStart, but the gesture had already been started.");this.setStartFlyout_(t);this.handleWsStart(e,t.getWorkspace())};o.Gesture.prototype.handleBlockStart=function(e,t){if(this.hasStarted_)throw Error("Tried to call gesture.handleBlockStart, but the gesture had already been started.");this.setStartBlock(t);this.mostRecentEvent_=e};o.Gesture.prototype.handleBubbleStart=function(e,t){if(this.hasStarted_)throw Error("Tried to call gesture.handleBubbleStart, but the gesture had already been started.");this.setStartBubble(t);this.mostRecentEvent_=e};o.Gesture.prototype.doBubbleClick_=function(){this.startBubble_.setFocus&&this.startBubble_.setFocus();this.startBubble_.select&&this.startBubble_.select()};o.Gesture.prototype.doFieldClick_=function(){this.startField_.showEditor(this.mostRecentEvent_);this.bringBlockToFront_()};o.Gesture.prototype.doBlockClick_=function(){this.flyout_&&this.flyout_.autoClose?this.targetBlock_.isEnabled()&&(o.Events.getGroup()||o.Events.setGroup(!0),this.flyout_.createBlock(this.targetBlock_).scheduleSnapAndBump()):o.Events.fire(new o.Events.Ui(this.startBlock_,"click",void 0,void 0));this.bringBlockToFront_();o.Events.setGroup(!1)};o.Gesture.prototype.doWorkspaceClick_=function(e){var t=this.creatorWorkspace_;e.shiftKey&&t.keyboardAccessibilityMode?(e=new o.utils.Coordinate(e.clientX,e.clientY),e=o.utils.screenToWsCoordinates(t,e),e=o.ASTNode.createWorkspaceNode(t,e),t.getCursor().setCurNode(e)):o.selected&&o.selected.unselect()};o.Gesture.prototype.bringBlockToFront_=function(){this.targetBlock_&&!this.flyout_&&this.targetBlock_.bringToFront()};o.Gesture.prototype.setStartField=function(e){if(this.hasStarted_)throw Error("Tried to call gesture.setStartField, but the gesture had already been started.");this.startField_||(this.startField_=e)};o.Gesture.prototype.setStartBubble=function(e){this.startBubble_||(this.startBubble_=e)};o.Gesture.prototype.setStartBlock=function(e){this.startBlock_||this.startBubble_||(this.startBlock_=e,e.isInFlyout&&e!=e.getRootBlock()?this.setTargetBlock_(e.getRootBlock()):this.setTargetBlock_(e))};o.Gesture.prototype.setTargetBlock_=function(e){e.isShadow()?this.setTargetBlock_(e.getParent()):this.targetBlock_=e};o.Gesture.prototype.setStartWorkspace_=function(e){this.startWorkspace_||(this.startWorkspace_=e)};o.Gesture.prototype.setStartFlyout_=function(e){this.flyout_||(this.flyout_=e)};o.Gesture.prototype.isBubbleClick_=function(){return!!this.startBubble_&&!this.hasExceededDragRadius_};o.Gesture.prototype.isBlockClick_=function(){return!!this.startBlock_&&!this.hasExceededDragRadius_&&!this.isFieldClick_()};o.Gesture.prototype.isFieldClick_=function(){return(this.startField_?this.startField_.isClickable():!1)&&!this.hasExceededDragRadius_&&(!this.flyout_||!this.flyout_.autoClose)};o.Gesture.prototype.isWorkspaceClick_=function(){return!this.startBlock_&&!this.startBubble_&&!this.startField_&&!this.hasExceededDragRadius_};o.Gesture.prototype.isDragging=function(){return this.isDraggingWorkspace_||this.isDraggingBlock_||this.isDraggingBubble_};o.Gesture.prototype.hasStarted=function(){return this.hasStarted_};o.Gesture.prototype.getInsertionMarkers=function(){return this.blockDragger_?this.blockDragger_.getInsertionMarkers():[]};o.Gesture.inProgress=function(){for(var e=o.Workspace.getAll(),t=0,n;n=e[t];t++){if(n.currentGesture_)return!0}return!1};o.Field=function(e,t,n){this.tooltip_=this.validator_=this.value_=null;this.size_=new o.utils.Size(0,0);this.constants_=this.mouseDownWrapper_=this.textContent_=this.textElement_=this.borderRect_=this.fieldGroup_=this.markerSvg_=this.cursorSvg_=null;n&&this.configure_(n);this.setValue(e);t&&this.setValidator(t)};o.Field.prototype.name=void 0;o.Field.prototype.disposed=!1;o.Field.prototype.maxDisplayLength=50;o.Field.prototype.sourceBlock_=null;o.Field.prototype.isDirty_=!0;o.Field.prototype.visible_=!0;o.Field.prototype.clickTarget_=null;o.Field.NBSP="\xA0";o.Field.prototype.EDITABLE=!0;o.Field.prototype.SERIALIZABLE=!1;o.Field.prototype.configure_=function(e){var t=e.tooltip;"string"==typeof t&&(t=o.utils.replaceMessageReferences(e.tooltip));t&&this.setTooltip(t)};o.Field.prototype.setSourceBlock=function(e){if(this.sourceBlock_)throw Error("Field already bound to a block.");this.sourceBlock_=e;e.workspace.rendered&&(this.constants_=e.workspace.getRenderer().getConstants())};o.Field.prototype.getSourceBlock=function(){return this.sourceBlock_};o.Field.prototype.init=function(){this.fieldGroup_||(this.fieldGroup_=o.utils.dom.createSvgElement("g",{},null),this.isVisible()||(this.fieldGroup_.style.display="none"),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.initView(),this.updateEditable(),this.setTooltip(this.tooltip_),this.bindEvents_(),this.initModel())};o.Field.prototype.initView=function(){this.createBorderRect_();this.createTextElement_()};o.Field.prototype.initModel=function(){};o.Field.prototype.createBorderRect_=function(){this.size_.height=Math.max(this.size_.height,this.constants_.FIELD_BORDER_RECT_HEIGHT);this.size_.width=Math.max(this.size_.width,2*this.constants_.FIELD_BORDER_RECT_X_PADDING);this.borderRect_=o.utils.dom.createSvgElement("rect",{rx:this.constants_.FIELD_BORDER_RECT_RADIUS,ry:this.constants_.FIELD_BORDER_RECT_RADIUS,x:0,y:0,height:this.size_.height,width:this.size_.width,class:"blocklyFieldRect"},this.fieldGroup_)};o.Field.prototype.createTextElement_=function(){var e=this.borderRect_?this.constants_.FIELD_BORDER_RECT_X_PADDING:0,t=this.constants_.FIELD_TEXT_BASELINE_CENTER,n=this.constants_.FIELD_TEXT_BASELINE_Y;this.size_.height=Math.max(this.size_.height,t?this.constants_.FIELD_TEXT_HEIGHT:n);this.size_.height>this.constants_.FIELD_TEXT_HEIGHT&&(n+=(this.size_.height-n)/2);this.textElement_=o.utils.dom.createSvgElement("text",{class:"blocklyText",y:t?this.size_.height/2:n,dy:this.constants_.FIELD_TEXT_Y_OFFSET,x:e},this.fieldGroup_);t&&this.textElement_.setAttribute("dominant-baseline","central");this.textContent_=document.createTextNode("");this.textElement_.appendChild(this.textContent_)};o.Field.prototype.bindEvents_=function(){o.Tooltip.bindMouseEvents(this.getClickTarget_());this.mouseDownWrapper_=o.bindEventWithChecks_(this.getClickTarget_(),"mousedown",this,this.onMouseDown_)};o.Field.prototype.fromXml=function(e){this.setValue(e.textContent)};o.Field.prototype.toXml=function(e){e.textContent=this.getValue();return e};o.Field.prototype.dispose=function(){o.DropDownDiv.hideIfOwner(this);o.WidgetDiv.hideIfOwner(this);this.mouseDownWrapper_&&o.unbindEvent_(this.mouseDownWrapper_);o.utils.dom.removeNode(this.fieldGroup_);this.disposed=!0};o.Field.prototype.updateEditable=function(){var e=this.fieldGroup_;this.EDITABLE&&e&&(this.sourceBlock_.isEditable()?(o.utils.dom.addClass(e,"blocklyEditableText"),o.utils.dom.removeClass(e,"blocklyNonEditableText"),e.style.cursor=this.CURSOR):(o.utils.dom.addClass(e,"blocklyNonEditableText"),o.utils.dom.removeClass(e,"blocklyEditableText"),e.style.cursor=""))};o.Field.prototype.isClickable=function(){return!!this.sourceBlock_&&this.sourceBlock_.isEditable()&&!!this.showEditor_&&"function"==typeof this.showEditor_};o.Field.prototype.isCurrentlyEditable=function(){return this.EDITABLE&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()};o.Field.prototype.isSerializable=function(){var e=!1;this.name&&(this.SERIALIZABLE?e=!0:this.EDITABLE&&(console.warn("Detected an editable field that was not serializable. Please define SERIALIZABLE property as true on all editable custom fields. Proceeding with serialization."),e=!0));return e};o.Field.prototype.isVisible=function(){return this.visible_};o.Field.prototype.setVisible=function(e){if(this.visible_!=e){this.visible_=e;var t=this.getSvgRoot();t&&(t.style.display=e?"block":"none")}};o.Field.prototype.setValidator=function(e){this.validator_=e};o.Field.prototype.getValidator=function(){return this.validator_};o.Field.prototype.classValidator=function(e){return e};o.Field.prototype.callValidator=function(e){var t=this.classValidator(e);if(null===t)return null;void 0!==t&&(e=t);if(t=this.getValidator()){t=t.call(this,e);if(null===t)return null;void 0!==t&&(e=t)}return e};o.Field.prototype.getSvgRoot=function(){return this.fieldGroup_};o.Field.prototype.applyColour=function(){};o.Field.prototype.render_=function(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_(),this.updateSize_())};o.Field.prototype.showEditor=function(e){this.isClickable()&&this.showEditor_(e)};o.Field.prototype.updateWidth=function(){console.warn("Deprecated call to updateWidth, call Blockly.Field.updateSize_ to force an update to the size of the field, or Blockly.utils.dom.getTextWidth() to check the size of the field.");this.updateSize_()};o.Field.prototype.updateSize_=function(){var e=o.utils.dom.getFastTextWidth(this.textElement_,this.constants_.FIELD_TEXT_FONTSIZE,this.constants_.FIELD_TEXT_FONTWEIGHT,this.constants_.FIELD_TEXT_FONTFAMILY);this.borderRect_&&(e+=2*this.constants_.FIELD_BORDER_RECT_X_PADDING,this.borderRect_.setAttribute("width",e));this.size_.width=e};o.Field.prototype.getSize=function(){if(!this.isVisible())return new o.utils.Size(0,0);this.isDirty_?(this.render_(),this.isDirty_=!1):this.visible_&&0==this.size_.width&&(console.warn("Deprecated use of setting size_.width to 0 to rerender a field. Set field.isDirty_ to true instead."),this.render_());return this.size_};o.Field.prototype.getScaledBBox=function(){if(this.borderRect_)e=this.borderRect_.getBoundingClientRect(),n=o.utils.style.getPageOffset(this.borderRect_),r=e.width,e=e.height;else{var e=this.sourceBlock_.getHeightWidth(),t=this.sourceBlock_.workspace.scale,n=this.getAbsoluteXY_(),r=e.width*t;e=e.height*t;o.utils.userAgent.GECKO?(n.x+=1.5*t,n.y+=1.5*t):o.utils.userAgent.EDGE||o.utils.userAgent.IE||(n.x-=.5*t,n.y-=.5*t);r+=1*t;e+=1*t}return{top:n.y,bottom:n.y+e,left:n.x,right:n.x+r}};o.Field.prototype.getDisplayText_=function(){var e=this.getText();if(!e)return o.Field.NBSP;e.length>this.maxDisplayLength&&(e=e.substring(0,this.maxDisplayLength-2)+"\u2026");e=e.replace(/\s/g,o.Field.NBSP);this.sourceBlock_&&this.sourceBlock_.RTL&&(e+="\u200F");return e};o.Field.prototype.getText=function(){if(this.getText_){var e=this.getText_.call(this);if(null!==e)return e+""}return this.getValue()+""};o.Field.prototype.setText=function(){throw Error("setText method is deprecated")};o.Field.prototype.markDirty=function(){this.isDirty_=!0};o.Field.prototype.forceRerender=function(){this.isDirty_=!0;this.sourceBlock_&&this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours())};o.Field.prototype.setValue=function(e){if(null!==e){var t=this.doClassValidation_(e);e=this.processValidation_(e,t);if(!(e instanceof Error)){if(t=this.getValidator())if(t=t.call(this,e),e=this.processValidation_(e,t),e instanceof Error)return;t=this.getValue();t!==e&&(this.sourceBlock_&&o.Events.isEnabled()&&o.Events.fire(new o.Events.BlockChange(this.sourceBlock_,"field",this.name||null,t,e)),this.doValueUpdate_(e),this.isDirty_&&this.forceRerender())}}};o.Field.prototype.processValidation_=function(e,t){if(null===t)return this.doValueInvalid_(e),this.isDirty_&&this.forceRerender(),Error();void 0!==t&&(e=t);return e};o.Field.prototype.getValue=function(){return this.value_};o.Field.prototype.doClassValidation_=function(e){return null===e||void 0===e?null:e=this.classValidator(e)};o.Field.prototype.doValueUpdate_=function(e){this.value_=e;this.isDirty_=!0};o.Field.prototype.doValueInvalid_=function(){};o.Field.prototype.onMouseDown_=function(e){this.sourceBlock_&&this.sourceBlock_.workspace&&(e=this.sourceBlock_.workspace.getGesture(e))&&e.setStartField(this)};o.Field.prototype.setTooltip=function(e){var t=this.getClickTarget_();t?t.tooltip=e||""===e?e:this.sourceBlock_:this.tooltip_=e};o.Field.prototype.getClickTarget_=function(){return this.clickTarget_||this.getSvgRoot()};o.Field.prototype.getAbsoluteXY_=function(){return o.utils.style.getPageOffset(this.getClickTarget_())};o.Field.prototype.referencesVariables=function(){return!1};o.Field.prototype.getParentInput=function(){for(var t=null,o=this.sourceBlock_,n=o.inputList,r=0;r<o.inputList.length;r++){for(var i=n[r],e=i.fieldRow,s=0;s<e.length;s++){if(e[s]===this){t=i;break}}}return t};o.Field.prototype.getFlipRtl=function(){return!1};o.Field.prototype.isTabNavigable=function(){return!1};o.Field.prototype.onBlocklyAction=function(){return!1};o.Field.prototype.setCursorSvg=function(e){e?(this.fieldGroup_.appendChild(e),this.cursorSvg_=e):this.cursorSvg_=null};o.Field.prototype.setMarkerSvg=function(e){e?(this.fieldGroup_.appendChild(e),this.markerSvg_=e):this.markerSvg_=null};o.FieldLabel=function(e,t,n){this.class_=null;null==e&&(e="");o.FieldLabel.superClass_.constructor.call(this,e,null,n);n||(this.class_=t||null)};o.utils.object.inherits(o.FieldLabel,o.Field);o.FieldLabel.fromJson=function(e){var t=o.utils.replaceMessageReferences(e.text);return new o.FieldLabel(t,void 0,e)};o.FieldLabel.prototype.EDITABLE=!1;o.FieldLabel.prototype.configure_=function(e){o.FieldLabel.superClass_.configure_.call(this,e);this.class_=e["class"]};o.FieldLabel.prototype.initView=function(){this.createTextElement_();this.class_&&o.utils.dom.addClass(this.textElement_,this.class_)};o.FieldLabel.prototype.doClassValidation_=function(e){return null===e||void 0===e?null:e+""};o.FieldLabel.prototype.setClass=function(e){this.textElement_&&(this.class_&&o.utils.dom.removeClass(this.textElement_,this.class_),e&&o.utils.dom.addClass(this.textElement_,e));this.class_=e};o.fieldRegistry.register("field_label",o.FieldLabel);o.Input=function(e,t,n,r){if(e!=o.DUMMY_INPUT&&!t)throw Error("Value inputs and statement inputs must have non-empty name.");this.type=e;this.name=t;this.sourceBlock_=n;this.connection=r;this.fieldRow=[]};o.Input.prototype.align=o.ALIGN_LEFT;o.Input.prototype.visible_=!0;o.Input.prototype.getSourceBlock=function(){return this.sourceBlock_};o.Input.prototype.appendField=function(e,t){this.insertFieldAt(this.fieldRow.length,e,t);return this};o.Input.prototype.insertFieldAt=function(e,t,n){if(0>e||e>this.fieldRow.length)throw Error("index "+e+" out of bounds.");if(!(t||""==t&&n))return e;"string"==typeof t&&(t=new o.FieldLabel(t));t.setSourceBlock(this.sourceBlock_);this.sourceBlock_.rendered&&t.init();t.name=n;t.prefixField&&(e=this.insertFieldAt(e,t.prefixField));this.fieldRow.splice(e,0,t);++e;t.suffixField&&(e=this.insertFieldAt(e,t.suffixField));this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours());return e};o.Input.prototype.removeField=function(e){for(var t=0,o;o=this.fieldRow[t];t++){if(o.name===e){o.dispose();this.fieldRow.splice(t,1);this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours());return}}throw Error("Field \"%s\" not found.",e)};o.Input.prototype.isVisible=function(){return this.visible_};o.Input.prototype.setVisible=function(t){var o=[];if(this.visible_==t)return o;for(var n=(this.visible_=t)?"block":"none",r=0,i;i=this.fieldRow[r];r++){i.setVisible(t)}this.connection&&(t?o=this.connection.startTrackingAll():this.connection.stopTrackingAll(),r=this.connection.targetBlock())&&(r.getSvgRoot().style.display=n,t||(r.rendered=!1));return o};o.Input.prototype.markDirty=function(){for(var e=0,t;t=this.fieldRow[e];e++){t.markDirty()}};o.Input.prototype.setCheck=function(e){if(!this.connection)throw Error("This input does not have a connection.");this.connection.setCheck(e);return this};o.Input.prototype.setAlign=function(e){this.align=e;this.sourceBlock_.rendered&&this.sourceBlock_.render();return this};o.Input.prototype.init=function(){if(this.sourceBlock_.workspace.rendered)for(var e=0;e<this.fieldRow.length;e++){this.fieldRow[e].init()}};o.Input.prototype.dispose=function(){for(var e=0,t;t=this.fieldRow[e];e++){t.dispose()}this.connection&&this.connection.dispose();this.sourceBlock_=null};o.Block=function(e,t,n){if(o.Generator&&"undefined"!=typeof o.Generator.prototype[t])throw Error("Block prototypeName \""+t+"\" conflicts with Blockly.Generator members.");this.id=n&&!e.getBlockById(n)?n:o.utils.genUid();e.setBlockById(this.id,this);this.previousConnection=this.nextConnection=this.outputConnection=null;this.inputList=[];this.inputsInline=void 0;this.disabled=!1;this.tooltip="";this.contextMenu=!0;this.parentBlock_=null;this.childBlocks_=[];this.editable_=this.movable_=this.deletable_=!0;this.collapsed_=this.isShadow_=!1;this.comment=this.outputShape_=null;this.commentModel={text:null,pinned:!1,size:new o.utils.Size(160,80)};this.xy_=new o.utils.Coordinate(0,0);this.workspace=e;this.isInFlyout=e.isFlyout;this.isInMutator=e.isMutator;this.RTL=e.RTL;this.isInsertionMarker_=!1;this.hat=void 0;if(t){this.type=t;n=o.Blocks[t];if(!n||"object"!=_typeof(n))throw TypeError("Unknown block type: "+t);o.utils.object.mixin(this,n)}e.addTopBlock(this);e.addTypedBlock(this);"function"==typeof this.init&&this.init();this.inputsInlineDefault=this.inputsInline;if(o.Events.isEnabled()){(e=o.Events.getGroup())||o.Events.setGroup(!0);try{o.Events.fire(new o.Events.BlockCreate(this))}finally{e||o.Events.setGroup(!1)}}"function"==typeof this.onchange&&this.setOnChange(this.onchange)};o.Block.prototype.data=null;o.Block.prototype.disposed=!1;o.Block.prototype.hue_=null;o.Block.prototype.colour_="#000000";o.Block.prototype.styleName_=null;o.Block.prototype.dispose=function(t){if(this.workspace){this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_);this.unplug(t);o.Events.isEnabled()&&o.Events.fire(new o.Events.BlockDelete(this));o.Events.disable();try{this.workspace&&(this.workspace.removeTopBlock(this),this.workspace.removeTypedBlock(this),this.workspace.removeBlockById(this.id),this.workspace=null);o.selected==this&&(o.selected=null);for(var n=this.childBlocks_.length-1;0<=n;n--){this.childBlocks_[n].dispose(!1)}n=0;for(var r;r=this.inputList[n];n++){r.dispose()}this.inputList.length=0;var i=this.getConnections_(!0);n=0;for(var s;s=i[n];n++){s.dispose()}}finally{o.Events.enable(),this.disposed=!0}}};o.Block.prototype.initModel=function(){for(var e=0,t;t=this.inputList[e];e++){for(var o=0,n;n=t.fieldRow[o];o++){n.initModel&&n.initModel()}}};o.Block.prototype.unplug=function(e){this.outputConnection?this.unplugFromRow_(e):this.previousConnection&&this.unplugFromStack_(e)};o.Block.prototype.unplugFromRow_=function(e){var t=null;this.outputConnection.isConnected()&&(t=this.outputConnection.targetConnection,this.outputConnection.disconnect());if(t&&e&&(e=this.getOnlyValueConnection_())&&e.isConnected()&&!e.targetBlock().isShadow())if(e=e.targetConnection,e.disconnect(),e.checkType(t))t.connect(e);else e.onFailedConnect(t)};o.Block.prototype.getOnlyValueConnection_=function(){for(var e=null,t=0,n;t<this.inputList.length;t++){n=this.inputList[t].connection;if(n&&n.type==o.INPUT_VALUE&&n.targetConnection){if(e)return null;e=n}}return e};o.Block.prototype.unplugFromStack_=function(e){var t=null;this.previousConnection.isConnected()&&(t=this.previousConnection.targetConnection,this.previousConnection.disconnect());var o=this.getNextBlock();e&&o&&!o.isShadow()&&(e=this.nextConnection.targetConnection,e.disconnect(),t&&t.checkType(e)&&t.connect(e))};o.Block.prototype.getConnections_=function(e){e=[];this.outputConnection&&e.push(this.outputConnection);this.previousConnection&&e.push(this.previousConnection);this.nextConnection&&e.push(this.nextConnection);for(var t=0,o;o=this.inputList[t];t++){o.connection&&e.push(o.connection)}return e};o.Block.prototype.lastConnectionInStack=function(){for(var e=this.nextConnection,t;e;){t=e.targetBlock();if(!t)return e;e=t.nextConnection}return null};o.Block.prototype.bumpNeighbours=function(){console.warn("Not expected to reach Block.bumpNeighbours function. BlockSvg.bumpNeighbours was expected to be called instead.")};o.Block.prototype.getParent=function(){return this.parentBlock_};o.Block.prototype.getInputWithBlock=function(e){for(var t=0,o;o=this.inputList[t];t++){if(o.connection&&o.connection.targetBlock()==e)return o}return null};o.Block.prototype.getSurroundParent=function(){var e=this;do{var t=e;e=e.getParent();if(!e)return null}while(e.getNextBlock()==t);return e};o.Block.prototype.getNextBlock=function(){return this.nextConnection&&this.nextConnection.targetBlock()};o.Block.prototype.getPreviousBlock=function(){return this.previousConnection&&this.previousConnection.targetBlock()};o.Block.prototype.getFirstStatementConnection=function(){for(var e=0,t;t=this.inputList[e];e++){if(t.connection&&t.connection.type==o.NEXT_STATEMENT)return t.connection}return null};o.Block.prototype.getRootBlock=function(){var e=this;do{var t=e;e=t.parentBlock_}while(e);return t};o.Block.prototype.getTopStackBlock=function(){var e=this;do{var t=e.getPreviousBlock()}while(t&&t.getNextBlock()==e&&(e=t));return e};o.Block.prototype.getChildren=function(e){if(!e)return this.childBlocks_;e=[];for(var t=0,o;o=this.inputList[t];t++){o.connection&&(o=o.connection.targetBlock())&&e.push(o)}(t=this.getNextBlock())&&e.push(t);return e};o.Block.prototype.setParent=function(e){if(e!=this.parentBlock_){if(this.parentBlock_){o.utils.arrayRemove(this.parentBlock_.childBlocks_,this);if(this.previousConnection&&this.previousConnection.isConnected())throw Error("Still connected to previous block.");if(this.outputConnection&&this.outputConnection.isConnected())throw Error("Still connected to parent block.");this.parentBlock_=null}else this.workspace.removeTopBlock(this);(this.parentBlock_=e)?e.childBlocks_.push(this):this.workspace.addTopBlock(this)}};o.Block.prototype.getDescendants=function(t){for(var o=[this],n=this.getChildren(t),r,i=0;r=n[i];i++){o.push.apply(o,r.getDescendants(t))}return o};o.Block.prototype.isDeletable=function(){return this.deletable_&&!this.isShadow_&&!(this.workspace&&this.workspace.options.readOnly)};o.Block.prototype.setDeletable=function(e){this.deletable_=e};o.Block.prototype.isMovable=function(){return this.movable_&&!this.isShadow_&&!(this.workspace&&this.workspace.options.readOnly)};o.Block.prototype.setMovable=function(e){this.movable_=e};o.Block.prototype.isDuplicatable=function(){return this.workspace.hasBlockLimits()?this.workspace.isCapacityAvailable(o.utils.getBlockTypeCounts(this,!0)):!0};o.Block.prototype.isShadow=function(){return this.isShadow_};o.Block.prototype.setShadow=function(e){this.isShadow_=e};o.Block.prototype.isInsertionMarker=function(){return this.isInsertionMarker_};o.Block.prototype.setInsertionMarker=function(e){this.isInsertionMarker_=e};o.Block.prototype.isEditable=function(){return this.editable_&&!(this.workspace&&this.workspace.options.readOnly)};o.Block.prototype.setEditable=function(e){this.editable_=e;e=0;for(var t;t=this.inputList[e];e++){for(var o=0,n;n=t.fieldRow[o];o++){n.updateEditable()}}};o.Block.prototype.isDisposed=function(){return this.disposed};o.Block.prototype.getMatchingConnection=function(e,t){var o=this.getConnections_(!0);e=e.getConnections_(!0);if(o.length!=e.length)throw Error("Connection lists did not match in length.");for(var n=0;n<e.length;n++){if(e[n]==t)return o[n]}return null};o.Block.prototype.setHelpUrl=function(e){this.helpUrl=e};o.Block.prototype.setTooltip=function(e){this.tooltip=e};o.Block.prototype.getColour=function(){return this.colour_};o.Block.prototype.getStyleName=function(){return this.styleName_};o.Block.prototype.getHue=function(){return this.hue_};o.Block.prototype.setColour=function(e){e=o.utils.parseBlockColour(e);this.hue_=e.hue;this.colour_=e.hex};o.Block.prototype.setStyle=function(e){this.styleName_=e};o.Block.prototype.setOnChange=function(e){if(e&&"function"!=typeof e)throw Error("onchange must be a function.");this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_);if(this.onchange=e)this.onchangeWrapper_=e.bind(this),this.workspace.addChangeListener(this.onchangeWrapper_)};o.Block.prototype.getField=function(t){for(var o=0,n;n=this.inputList[o];o++){for(var r=0,i;i=n.fieldRow[r];r++){if(i.name==t)return i}}return null};o.Block.prototype.getVars=function(){for(var t=[],o=0,n;n=this.inputList[o];o++){for(var r=0,i;i=n.fieldRow[r];r++){i.referencesVariables()&&t.push(i.getValue())}}return t};o.Block.prototype.getVarModels=function(){for(var t=[],o=0,n;n=this.inputList[o];o++){for(var r=0,i;i=n.fieldRow[r];r++){i.referencesVariables()&&(i=this.workspace.getVariableById(i.getValue()))&&t.push(i)}}return t};o.Block.prototype.updateVarName=function(t){for(var o=0,n;n=this.inputList[o];o++){for(var r=0,i;i=n.fieldRow[r];r++){i.referencesVariables()&&t.getId()==i.getValue()&&i.refreshVariableName()}}};o.Block.prototype.renameVarById=function(t,o){for(var n=0,r;r=this.inputList[n];n++){for(var i=0,s;s=r.fieldRow[i];i++){s.referencesVariables()&&t==s.getValue()&&s.setValue(o)}}};o.Block.prototype.getFieldValue=function(e){return(e=this.getField(e))?e.getValue():null};o.Block.prototype.setFieldValue=function(e,t){var o=this.getField(t);if(!o)throw Error("Field \""+t+"\" not found.");o.setValue(e)};o.Block.prototype.setPreviousStatement=function(e,t){if(e){void 0===t&&(t=null);if(!this.previousConnection){if(this.outputConnection)throw Error("Remove output connection prior to adding previous connection.");this.previousConnection=this.makeConnection_(o.PREVIOUS_STATEMENT)}this.previousConnection.setCheck(t)}else if(this.previousConnection){if(this.previousConnection.isConnected())throw Error("Must disconnect previous statement before removing connection.");this.previousConnection.dispose();this.previousConnection=null}};o.Block.prototype.setNextStatement=function(e,t){if(e)void 0===t&&(t=null),this.nextConnection||(this.nextConnection=this.makeConnection_(o.NEXT_STATEMENT)),this.nextConnection.setCheck(t);else if(this.nextConnection){if(this.nextConnection.isConnected())throw Error("Must disconnect next statement before removing connection.");this.nextConnection.dispose();this.nextConnection=null}};o.Block.prototype.setOutput=function(e,t){if(e){void 0===t&&(t=null);if(!this.outputConnection){if(this.previousConnection)throw Error("Remove previous connection prior to adding output connection.");this.outputConnection=this.makeConnection_(o.OUTPUT_VALUE)}this.outputConnection.setCheck(t)}else if(this.outputConnection){if(this.outputConnection.isConnected())throw Error("Must disconnect output value before removing connection.");this.outputConnection.dispose();this.outputConnection=null}};o.Block.prototype.setInputsInline=function(e){this.inputsInline!=e&&(o.Events.fire(new o.Events.BlockChange(this,"inline",null,this.inputsInline,e)),this.inputsInline=e)};o.Block.prototype.getInputsInline=function(){if(void 0!=this.inputsInline)return this.inputsInline;for(var e=1;e<this.inputList.length;e++){if(this.inputList[e-1].type==o.DUMMY_INPUT&&this.inputList[e].type==o.DUMMY_INPUT)return!1}for(e=1;e<this.inputList.length;e++){if(this.inputList[e-1].type==o.INPUT_VALUE&&this.inputList[e].type==o.DUMMY_INPUT)return!0}return!1};o.Block.prototype.setOutputShape=function(e){this.outputShape_=e};o.Block.prototype.getOutputShape=function(){return this.outputShape_};o.Block.prototype.setDisabled=function(e){console.warn("Deprecated call to Blockly.Block.prototype.setDisabled, use Blockly.Block.prototype.setEnabled instead.");this.setEnabled(!e)};o.Block.prototype.isEnabled=function(){return!this.disabled};o.Block.prototype.setEnabled=function(e){this.isEnabled()!=e&&(o.Events.fire(new o.Events.BlockChange(this,"disabled",null,this.disabled,!e)),this.disabled=!e)};o.Block.prototype.getInheritedDisabled=function(){for(var e=this.getSurroundParent();e;){if(e.disabled)return!0;e=e.getSurroundParent()}return!1};o.Block.prototype.isCollapsed=function(){return this.collapsed_};o.Block.prototype.setCollapsed=function(e){this.collapsed_!=e&&(o.Events.fire(new o.Events.BlockChange(this,"collapsed",null,this.collapsed_,e)),this.collapsed_=e)};o.Block.prototype.toString=function(t,o){var n=[];if(this.collapsed_)n.push(this.getInput("_TEMP_COLLAPSED_INPUT").fieldRow[0].getText());else for(var r=0,i;i=this.inputList[r];r++){for(var s=0,l;l=i.fieldRow[s];s++){n.push(l.getText())}i.connection&&((i=i.connection.targetBlock())?n.push(i.toString(void 0,o)):n.push(o||"?"))}n=n.join(" ").trim()||"???";t&&n.length>t&&(n=n.substring(0,t-3)+"...");return n};o.Block.prototype.appendValueInput=function(e){return this.appendInput_(o.INPUT_VALUE,e)};o.Block.prototype.appendStatementInput=function(e){return this.appendInput_(o.NEXT_STATEMENT,e)};o.Block.prototype.appendDummyInput=function(e){return this.appendInput_(o.DUMMY_INPUT,e||"")};o.Block.prototype.jsonInit=function(e){var t=e.type?"Block \""+e.type+"\": ":"";if(e.output&&e.previousStatement)throw Error(t+"Must not have both an output and a previousStatement.");e.style&&e.style.hat&&(this.hat=e.style.hat,e.style=null);if(e.style&&e.colour)throw Error(t+"Must not have both a colour and a style.");e.style?this.jsonInitStyle_(e,t):this.jsonInitColour_(e,t);for(var n=0;void 0!==e["message"+n];){this.interpolate_(e["message"+n],e["args"+n]||[],e["lastDummyAlign"+n],t),n++}void 0!==e.inputsInline&&this.setInputsInline(e.inputsInline);void 0!==e.output&&this.setOutput(!0,e.output);void 0!==e.outputShape&&this.setOutputShape(e.outputShape);void 0!==e.previousStatement&&this.setPreviousStatement(!0,e.previousStatement);void 0!==e.nextStatement&&this.setNextStatement(!0,e.nextStatement);void 0!==e.tooltip&&(n=e.tooltip,n=o.utils.replaceMessageReferences(n),this.setTooltip(n));void 0!==e.enableContextMenu&&(n=e.enableContextMenu,this.contextMenu=!!n);void 0!==e.helpUrl&&(n=e.helpUrl,n=o.utils.replaceMessageReferences(n),this.setHelpUrl(n));"string"==typeof e.extensions&&(console.warn(t+"JSON attribute 'extensions' should be an array of strings. Found raw string in JSON for '"+e.type+"' block."),e.extensions=[e.extensions]);void 0!==e.mutator&&o.Extensions.apply(e.mutator,this,!0);if(Array.isArray(e.extensions))for(e=e.extensions,t=0;t<e.length;++t){o.Extensions.apply(e[t],this,!1)}};o.Block.prototype.jsonInitColour_=function(e,t){if("colour"in e)if(void 0===e.colour)console.warn(t+"Undefined colour value.");else{e=e.colour;try{this.setColour(e)}catch(o){console.warn(t+"Illegal colour value: ",e)}}};o.Block.prototype.jsonInitStyle_=function(e,t){e=e.style;try{this.setStyle(e)}catch(o){console.warn(t+"Style does not exist: ",e)}};o.Block.prototype.mixin=function(e,t){if(void 0!==t&&"boolean"!=typeof t)throw Error("opt_disableCheck must be a boolean if provided");if(!t){t=[];for(var n in e){void 0!==this[n]&&t.push(n)}if(t.length)throw Error("Mixin will overwrite block members: "+JSON.stringify(t))}o.utils.object.mixin(this,e)};o.Block.prototype.interpolate_=function(t,n,r,i){var s=o.utils.tokenizeInterpolation(t),l=[],p=0;t=[];for(var d=0,u;d<s.length;d++){u=s[d];if("number"==typeof u){if(0>=u||u>n.length)throw Error("Block \""+this.type+"\": Message index %"+u+" out of range.");if(l[u])throw Error("Block \""+this.type+"\": Message index %"+u+" duplicated.");l[u]=!0;p++;t.push(n[u-1])}else(u=u.trim())&&t.push(u)}if(p!=n.length)throw Error("Block \""+this.type+"\": Message does not reference all "+n.length+" arg(s).");t.length&&("string"==typeof t[t.length-1]||o.utils.string.startsWith(t[t.length-1].type,"field_"))&&(d={type:"input_dummy"},r&&(d.align=r),t.push(d));r={LEFT:o.ALIGN_LEFT,RIGHT:o.ALIGN_RIGHT,CENTRE:o.ALIGN_CENTRE,CENTER:o.ALIGN_CENTRE};n=[];for(d=0;d<t.length;d++){if(l=t[d],"string"==typeof l)n.push([l,void 0]);else{s=p=null;do{if(u=!1,"string"==typeof l)p=new o.FieldLabel(l);else switch(l.type){case"input_value":s=this.appendValueInput(l.name);break;case"input_statement":s=this.appendStatementInput(l.name);break;case"input_dummy":s=this.appendDummyInput(l.name);break;default:p=o.fieldRegistry.fromJson(l),!p&&l.alt&&(l=l.alt,u=!0);}}while(u);if(p)n.push([p,l.name]);else if(s){l.check&&s.setCheck(l.check);l.align&&(p=r[l.align.toUpperCase()],void 0===p?console.warn(i+"Illegal align value: ",l.align):s.setAlign(p));for(l=0;l<n.length;l++){s.appendField(n[l][0],n[l][1])}n.length=0}}}};o.Block.prototype.appendInput_=function(e,t){var n=null;if(e==o.INPUT_VALUE||e==o.NEXT_STATEMENT)n=this.makeConnection_(e);e=new o.Input(e,t,this,n);this.inputList.push(e);return e};o.Block.prototype.moveInputBefore=function(t,o){if(t!=o){for(var n=-1,r=o?-1:this.inputList.length,i=0,s;s=this.inputList[i];i++){if(s.name==t){if(n=i,-1!=r)break}else if(o&&s.name==o&&(r=i,-1!=n))break}if(-1==n)throw Error("Named input \""+t+"\" not found.");if(-1==r)throw Error("Reference input \""+o+"\" not found.");this.moveNumberedInputBefore(n,r)}};o.Block.prototype.moveNumberedInputBefore=function(e,t){if(e==t)throw Error("Can't move input to itself.");if(e>=this.inputList.length)throw RangeError("Input index "+e+" out of bounds.");if(t>this.inputList.length)throw RangeError("Reference input "+t+" out of bounds.");var o=this.inputList[e];this.inputList.splice(e,1);e<t&&t--;this.inputList.splice(t,0,o)};o.Block.prototype.removeInput=function(e,t){for(var o=0,n;n=this.inputList[o];o++){if(n.name==e){n.dispose();this.inputList.splice(o,1);return}}if(!t)throw Error("Input not found: "+e)};o.Block.prototype.getInput=function(e){for(var t=0,o;o=this.inputList[t];t++){if(o.name==e)return o}return null};o.Block.prototype.getInputTargetBlock=function(e){return(e=this.getInput(e))&&e.connection&&e.connection.targetBlock()};o.Block.prototype.getCommentText=function(){return this.commentModel.text};o.Block.prototype.setCommentText=function(e){this.commentModel.text!=e&&(o.Events.fire(new o.Events.BlockChange(this,"comment",null,this.commentModel.text,e)),this.comment=this.commentModel.text=e)};o.Block.prototype.setWarningText=function(){};o.Block.prototype.setMutator=function(){};o.Block.prototype.getRelativeToSurfaceXY=function(){return this.xy_};o.Block.prototype.moveBy=function(e,t){if(this.parentBlock_)throw Error("Block has parent.");var n=new o.Events.BlockMove(this);this.xy_.translate(e,t);n.recordNew();o.Events.fire(n)};o.Block.prototype.makeConnection_=function(e){return new o.Connection(this,e)};o.Block.prototype.allInputsFilled=function(e){void 0===e&&(e=!0);if(!e&&this.isShadow())return!1;for(var t=0,o;o=this.inputList[t];t++){if(o.connection&&(o=o.connection.targetBlock(),!o||!o.allInputsFilled(e)))return!1}return(t=this.getNextBlock())?t.allInputsFilled(e):!0};o.Block.prototype.toDevString=function(){var e=this.type?"\""+this.type+"\" block":"Block";this.id&&(e+=" (id=\""+this.id+"\")");return e};o.blockRendering={};o.blockRendering.IPathObject=function(){};o.utils.aria={};o.utils.aria.ARIA_PREFIX_="aria-";o.utils.aria.ROLE_ATTRIBUTE_="role";o.utils.aria.Role={GRID:"grid",GRIDCELL:"gridcell",GROUP:"group",LISTBOX:"listbox",MENU:"menu",MENUITEM:"menuitem",MENUITEMCHECKBOX:"menuitemcheckbox",OPTION:"option",PRESENTATION:"presentation",ROW:"row",TREE:"tree",TREEITEM:"treeitem"};o.utils.aria.State={ACTIVEDESCENDANT:"activedescendant",COLCOUNT:"colcount",EXPANDED:"expanded",INVALID:"invalid",LABEL:"label",LABELLEDBY:"labelledby",LEVEL:"level",ORIENTATION:"orientation",POSINSET:"posinset",ROWCOUNT:"rowcount",SELECTED:"selected",SETSIZE:"setsize",VALUEMAX:"valuemax",VALUEMIN:"valuemin"};o.utils.aria.setRole=function(e,t){e.setAttribute(o.utils.aria.ROLE_ATTRIBUTE_,t)};o.utils.aria.setState=function(e,t,n){Array.isArray(n)&&(n=n.join(" "));e.setAttribute(o.utils.aria.ARIA_PREFIX_+t,n)};o.Menu=function(){o.Component.call(this);this.openingCoords=null;this.highlightedIndex_=-1;this.onKeyDownWrapper_=this.mouseLeaveHandler_=this.mouseEnterHandler_=this.clickHandler_=this.mouseOverHandler_=null};o.utils.object.inherits(o.Menu,o.Component);o.Menu.prototype.createDom=function(){var e=document.createElement("div");e.id=this.getId();this.setElementInternal(e);e.className="goog-menu goog-menu-vertical blocklyNonSelectable";e.tabIndex=0;o.utils.aria.setRole(e,this.roleName_||o.utils.aria.Role.MENU)};o.Menu.prototype.focus=function(){var e=this.getElement();e&&(e.focus({preventScroll:!0}),o.utils.dom.addClass(e,"focused"))};o.Menu.prototype.blur=function(){var e=this.getElement();e&&(e.blur(),o.utils.dom.removeClass(e,"focused"))};o.Menu.prototype.setRole=function(e){this.roleName_=e};o.Menu.prototype.enterDocument=function(){o.Menu.superClass_.enterDocument.call(this);this.forEachChild(function(e){e.isInDocument()&&this.registerChildId_(e)},this);this.attachEvents_()};o.Menu.prototype.exitDocument=function(){this.setHighlightedIndex(-1);o.Menu.superClass_.exitDocument.call(this)};o.Menu.prototype.disposeInternal=function(){o.Menu.superClass_.disposeInternal.call(this);this.detachEvents_()};o.Menu.prototype.attachEvents_=function(){var e=this.getElement();this.mouseOverHandler_=o.bindEventWithChecks_(e,"mouseover",this,this.handleMouseOver_,!0);this.clickHandler_=o.bindEventWithChecks_(e,"click",this,this.handleClick_,!0);this.mouseEnterHandler_=o.bindEventWithChecks_(e,"mouseenter",this,this.handleMouseEnter_,!0);this.mouseLeaveHandler_=o.bindEventWithChecks_(e,"mouseleave",this,this.handleMouseLeave_,!0);this.onKeyDownWrapper_=o.bindEventWithChecks_(e,"keydown",this,this.handleKeyEvent)};o.Menu.prototype.detachEvents_=function(){this.mouseOverHandler_&&(o.unbindEvent_(this.mouseOverHandler_),this.mouseOverHandler_=null);this.clickHandler_&&(o.unbindEvent_(this.clickHandler_),this.clickHandler_=null);this.mouseEnterHandler_&&(o.unbindEvent_(this.mouseEnterHandler_),this.mouseEnterHandler_=null);this.mouseLeaveHandler_&&(o.unbindEvent_(this.mouseLeaveHandler_),this.mouseLeaveHandler_=null);this.onKeyDownWrapper_&&(o.unbindEvent_(this.onKeyDownWrapper_),this.onKeyDownWrapper_=null)};o.Menu.prototype.childElementIdMap_=null;o.Menu.prototype.registerChildId_=function(e){var t=e.getElement();t=t.id||(t.id=e.getId());this.childElementIdMap_||(this.childElementIdMap_={});this.childElementIdMap_[t]=e};o.Menu.prototype.getMenuItem=function(e){if(this.childElementIdMap_)for(var t=this.getElement(),o;e&&e!==t;){o=e.id;if(o in this.childElementIdMap_)return this.childElementIdMap_[o];e=e.parentNode}return null};o.Menu.prototype.unhighlightCurrent=function(){var e=this.getHighlighted();e&&e.setHighlighted(!1)};o.Menu.prototype.clearHighlighted=function(){this.unhighlightCurrent();this.setHighlightedIndex(-1)};o.Menu.prototype.getHighlighted=function(){return this.getChildAt(this.highlightedIndex_)};o.Menu.prototype.setHighlightedIndex=function(e){var t=this.getChildAt(e);t?(t.setHighlighted(!0),this.highlightedIndex_=e):-1<this.highlightedIndex_&&(this.getHighlighted().setHighlighted(!1),this.highlightedIndex_=-1);t&&o.utils.style.scrollIntoContainerView(t.getElement(),this.getElement())};o.Menu.prototype.setHighlighted=function(e){this.setHighlightedIndex(this.indexOfChild(e))};o.Menu.prototype.highlightNext=function(){this.unhighlightCurrent();this.highlightHelper(function(e,t){return(e+1)%t},this.highlightedIndex_)};o.Menu.prototype.highlightPrevious=function(){this.unhighlightCurrent();this.highlightHelper(function(e,t){e--;return 0>e?t-1:e},this.highlightedIndex_)};o.Menu.prototype.highlightHelper=function(t,o){o=0>o?-1:o;var n=this.getChildCount();o=t.call(this,o,n);for(var r=0,i;r<=n;){i=this.getChildAt(o);if(i&&this.canHighlightItem(i))return this.setHighlightedIndex(o),!0;r++;o=t.call(this,o,n)}return!1};o.Menu.prototype.canHighlightItem=function(e){return e.isEnabled()};o.Menu.prototype.handleMouseOver_=function(e){(e=this.getMenuItem(e.target))&&e.isEnabled()&&this.getHighlighted()!==e&&(this.unhighlightCurrent(),this.setHighlighted(e))};o.Menu.prototype.handleClick_=function(e){var t=this.openingCoords;this.openingCoords=null;if(t&&"number"==typeof e.clientX){var n=new o.utils.Coordinate(e.clientX,e.clientY);if(1>o.utils.Coordinate.distance(t,n))return}(t=this.getMenuItem(e.target))&&t.handleClick(e)&&e.preventDefault()};o.Menu.prototype.handleMouseEnter_=function(){this.focus()};o.Menu.prototype.handleMouseLeave_=function(){this.getElement()&&(this.blur(),this.clearHighlighted())};o.Menu.prototype.handleKeyEvent=function(e){return 0!=this.getChildCount()&&this.handleKeyEventInternal(e)?(e.preventDefault(),e.stopPropagation(),!0):!1};o.Menu.prototype.handleKeyEventInternal=function(e){var t=this.getHighlighted();if(t&&"function"==typeof t.handleKeyEvent&&t.handleKeyEvent(e))return!0;if(e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)return!1;switch(e.keyCode){case o.utils.KeyCodes.ENTER:t&&t.performActionInternal(e);break;case o.utils.KeyCodes.UP:this.highlightPrevious();break;case o.utils.KeyCodes.DOWN:this.highlightNext();break;default:return!1;}return!0};o.MenuItem=function(e,t){o.Component.call(this);this.setContentInternal(e);this.setValue(t);this.enabled_=!0};o.utils.object.inherits(o.MenuItem,o.Component);o.MenuItem.prototype.createDom=function(){var e=document.createElement("div");e.id=this.getId();this.setElementInternal(e);e.className="goog-menuitem goog-option "+(this.enabled_?"":"goog-menuitem-disabled ")+(this.checked_?"goog-option-selected ":"")+(this.isRightToLeft()?"goog-menuitem-rtl ":"");var t=this.getContentWrapperDom();e.appendChild(t);var n=this.getCheckboxDom();n&&t.appendChild(n);t.appendChild(this.getContentDom());o.utils.aria.setRole(e,this.roleName_||(this.checkable_?o.utils.aria.Role.MENUITEMCHECKBOX:o.utils.aria.Role.MENUITEM));o.utils.aria.setState(e,o.utils.aria.State.SELECTED,this.checkable_&&this.checked_||!1)};o.MenuItem.prototype.getCheckboxDom=function(){if(!this.checkable_)return null;var e=document.createElement("div");e.className="goog-menuitem-checkbox";return e};o.MenuItem.prototype.getContentDom=function(){var e=this.content_;"string"==typeof e&&(e=document.createTextNode(e));return e};o.MenuItem.prototype.getContentWrapperDom=function(){var e=document.createElement("div");e.className="goog-menuitem-content";return e};o.MenuItem.prototype.setContentInternal=function(e){this.content_=e};o.MenuItem.prototype.setValue=function(e){this.value_=e};o.MenuItem.prototype.getValue=function(){return this.value_};o.MenuItem.prototype.setRole=function(e){this.roleName_=e};o.MenuItem.prototype.setCheckable=function(e){this.checkable_=e};o.MenuItem.prototype.setChecked=function(e){if(this.checkable_){this.checked_=e;var t=this.getElement();t&&this.isEnabled()&&(e?(o.utils.dom.addClass(t,"goog-option-selected"),o.utils.aria.setState(t,o.utils.aria.State.SELECTED,!0)):(o.utils.dom.removeClass(t,"goog-option-selected"),o.utils.aria.setState(t,o.utils.aria.State.SELECTED,!1)))}};o.MenuItem.prototype.setHighlighted=function(e){this.highlight_=e;var t=this.getElement();t&&this.isEnabled()&&(e?o.utils.dom.addClass(t,"goog-menuitem-highlight"):o.utils.dom.removeClass(t,"goog-menuitem-highlight"))};o.MenuItem.prototype.isEnabled=function(){return this.enabled_};o.MenuItem.prototype.setEnabled=function(e){this.enabled_=e;(e=this.getElement())&&(this.enabled_?o.utils.dom.removeClass(e,"goog-menuitem-disabled"):o.utils.dom.addClass(e,"goog-menuitem-disabled"))};o.MenuItem.prototype.handleClick=function(){this.isEnabled()&&(this.setHighlighted(!0),this.performActionInternal())};o.MenuItem.prototype.performActionInternal=function(){this.checkable_&&this.setChecked(!this.checked_);this.actionHandler_&&this.actionHandler_.call(this.actionHandlerObj_,this)};o.MenuItem.prototype.onAction=function(e,t){this.actionHandler_=e;this.actionHandlerObj_=t};o.utils.uiMenu={};o.utils.uiMenu.getSize=function(e){e=e.getElement();var t=o.utils.style.getSize(e);t.height=e.scrollHeight;return t};o.utils.uiMenu.adjustBBoxesForRTL=function(e,t,o){t.left+=o.width;t.right+=o.width;e.left+=o.width;e.right+=o.width};o.ContextMenu={};o.ContextMenu.currentBlock=null;o.ContextMenu.eventWrapper_=null;o.ContextMenu.show=function(e,t,n){o.WidgetDiv.show(o.ContextMenu,n,null);if(t.length){var r=o.ContextMenu.populate_(t,n);o.ContextMenu.position_(r,e,n);setTimeout(function(){r.getElement().focus()},1);o.ContextMenu.currentBlock=null}else o.ContextMenu.hide()};o.ContextMenu.populate_=function(t,n){var r=new o.Menu;r.setRightToLeft(n);for(var i=0,s,l;s=t[i];i++){l=new o.MenuItem(s.text);l.setRightToLeft(n);r.addChild(l,!0);l.setEnabled(s.enabled);if(s.enabled)l.onAction(function(){o.ContextMenu.hide();this.callback()},s)}return r};o.ContextMenu.position_=function(t,n,r){var i=o.utils.getViewportBBox();n={top:n.clientY+i.top,bottom:n.clientY+i.top,left:n.clientX+i.left,right:n.clientX+i.left};o.ContextMenu.createWidget_(t);var s=o.utils.uiMenu.getSize(t);r&&o.utils.uiMenu.adjustBBoxesForRTL(i,n,s);o.WidgetDiv.positionWithAnchor(i,n,s,r);t.getElement().focus()};o.ContextMenu.createWidget_=function(e){e.render(o.WidgetDiv.DIV);var t=e.getElement();o.utils.dom.addClass(t,"blocklyContextMenu");o.bindEventWithChecks_(t,"contextmenu",null,o.utils.noEvent);e.focus()};o.ContextMenu.hide=function(){o.WidgetDiv.hideIfOwner(o.ContextMenu);o.ContextMenu.currentBlock=null;o.ContextMenu.eventWrapper_&&(o.unbindEvent_(o.ContextMenu.eventWrapper_),o.ContextMenu.eventWrapper_=null)};o.ContextMenu.callbackFactory=function(e,t){return function(){o.Events.disable();try{var n=o.Xml.domToBlock(t,e.workspace),r=e.getRelativeToSurfaceXY();r.x=e.RTL?r.x-o.SNAP_RADIUS:r.x+o.SNAP_RADIUS;r.y+=2*o.SNAP_RADIUS;n.moveBy(r.x,r.y)}finally{o.Events.enable()}o.Events.isEnabled()&&!n.isShadow()&&o.Events.fire(new o.Events.BlockCreate(n));n.select()}};o.ContextMenu.blockDeleteOption=function(e){var t=e.getDescendants(!1).length,n=e.getNextBlock();n&&(t-=n.getDescendants(!1).length);return{text:1==t?o.Msg.DELETE_BLOCK:o.Msg.DELETE_X_BLOCKS.replace("%1",t+""),enabled:!0,callback:function callback(){o.Events.setGroup(!0);e.dispose(!0,!0);o.Events.setGroup(!1)}}};o.ContextMenu.blockHelpOption=function(e){return{enabled:!("function"==typeof e.helpUrl?!e.helpUrl():!e.helpUrl),text:o.Msg.HELP,callback:function callback(){e.showHelp()}}};o.ContextMenu.blockDuplicateOption=function(e){var t=e.isDuplicatable();return{text:o.Msg.DUPLICATE_BLOCK,enabled:t,callback:function callback(){o.duplicate(e)}}};o.ContextMenu.blockCommentOption=function(e){var t={enabled:!o.utils.userAgent.IE};e.getCommentIcon()?(t.text=o.Msg.REMOVE_COMMENT,t.callback=function(){e.setCommentText(null)}):(t.text=o.Msg.ADD_COMMENT,t.callback=function(){e.setCommentText("")});return t};o.ContextMenu.commentDeleteOption=function(e){return{text:o.Msg.REMOVE_COMMENT,enabled:!0,callback:function callback(){o.Events.setGroup(!0);e.dispose(!0,!0);o.Events.setGroup(!1)}}};o.ContextMenu.commentDuplicateOption=function(e){return{text:o.Msg.DUPLICATE_COMMENT,enabled:!0,callback:function callback(){o.duplicate(e)}}};o.ContextMenu.workspaceCommentOption=function(t,n){if(!o.WorkspaceCommentSvg)throw Error("Missing require for Blockly.WorkspaceCommentSvg");var e={enabled:!o.utils.userAgent.IE,text:o.Msg.ADD_COMMENT,callback:function(){var r=new o.WorkspaceCommentSvg(t,o.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT,o.WorkspaceCommentSvg.DEFAULT_SIZE,o.WorkspaceCommentSvg.DEFAULT_SIZE),i=t.getInjectionDiv().getBoundingClientRect();i=new o.utils.Coordinate(n.clientX-i.left,n.clientY-i.top);var s=t.getOriginOffsetInPixels();i=o.utils.Coordinate.difference(i,s);i.scale(1/t.scale);r.moveBy(i.x,i.y);t.rendered&&(r.initSvg(),r.render(),r.select())}};return e};o.RenderedConnection=function(e,t){o.RenderedConnection.superClass_.constructor.call(this,e,t);this.db_=e.workspace.connectionDBList[t];this.dbOpposite_=e.workspace.connectionDBList[o.OPPOSITE_TYPE[t]];this.offsetInBlock_=new o.utils.Coordinate(0,0);this.trackedState_=o.RenderedConnection.TrackedState.WILL_TRACK};o.utils.object.inherits(o.RenderedConnection,o.Connection);o.RenderedConnection.TrackedState={WILL_TRACK:-1,UNTRACKED:0,TRACKED:1};o.RenderedConnection.prototype.dispose=function(){o.RenderedConnection.superClass_.dispose.call(this);this.trackedState_==o.RenderedConnection.TrackedState.TRACKED&&this.db_.removeConnection(this,this.y)};o.RenderedConnection.prototype.getSourceBlock=function(){return o.RenderedConnection.superClass_.getSourceBlock.call(this)};o.RenderedConnection.prototype.targetBlock=function(){return o.RenderedConnection.superClass_.targetBlock.call(this)};o.RenderedConnection.prototype.distanceFrom=function(e){var t=this.x-e.x;e=this.y-e.y;return Math.sqrt(t*t+e*e)};o.RenderedConnection.prototype.bumpAwayFrom=function(t){if(!this.sourceBlock_.workspace.isDragging()){var n=this.sourceBlock_.getRootBlock();if(!n.isInFlyout){var r=!1;if(!n.isMovable()){n=t.getSourceBlock().getRootBlock();if(!n.isMovable())return;t=this;r=!0}var i=o.selected==n;i||n.addSelect();var s=t.x+o.SNAP_RADIUS+Math.floor(Math.random()*o.BUMP_RANDOMNESS)-this.x,l=t.y+o.SNAP_RADIUS+Math.floor(Math.random()*o.BUMP_RANDOMNESS)-this.y;r&&(l=-l);n.RTL&&(s=t.x-o.SNAP_RADIUS-Math.floor(Math.random()*o.BUMP_RANDOMNESS)-this.x);n.moveBy(s,l);i||n.removeSelect()}}};o.RenderedConnection.prototype.moveTo=function(e,t){this.trackedState_==o.RenderedConnection.TrackedState.WILL_TRACK?(this.db_.addConnection(this,t),this.trackedState_=o.RenderedConnection.TrackedState.TRACKED):this.trackedState_==o.RenderedConnection.TrackedState.TRACKED&&(this.db_.removeConnection(this,this.y),this.db_.addConnection(this,t));this.x=e;this.y=t};o.RenderedConnection.prototype.moveBy=function(e,t){this.moveTo(this.x+e,this.y+t)};o.RenderedConnection.prototype.moveToOffset=function(e){this.moveTo(e.x+this.offsetInBlock_.x,e.y+this.offsetInBlock_.y)};o.RenderedConnection.prototype.setOffsetInBlock=function(e,t){this.offsetInBlock_.x=e;this.offsetInBlock_.y=t};o.RenderedConnection.prototype.getOffsetInBlock=function(){return this.offsetInBlock_};o.RenderedConnection.prototype.tighten=function(){var e=this.targetConnection.x-this.x,t=this.targetConnection.y-this.y;if(0!=e||0!=t){var n=this.targetBlock(),r=n.getSvgRoot();if(!r)throw Error("block is not rendered.");r=o.utils.getRelativeXY(r);n.getSvgRoot().setAttribute("transform","translate("+(r.x-e)+","+(r.y-t)+")");n.moveConnections(-e,-t)}};o.RenderedConnection.prototype.closest=function(e,t){return this.dbOpposite_.searchForClosest(this,e,t)};o.RenderedConnection.prototype.highlight=function(){var e=this.sourceBlock_.workspace.getRenderer().getConstants(),t=e.shapeFor(this);this.type==o.INPUT_VALUE||this.type==o.OUTPUT_VALUE?(e=e.TAB_OFFSET_FROM_TOP,t=o.utils.svgPaths.moveBy(0,-e)+o.utils.svgPaths.lineOnAxis("v",e)+t.pathDown+o.utils.svgPaths.lineOnAxis("v",e)):(e=e.NOTCH_OFFSET_LEFT-e.CORNER_RADIUS,t=o.utils.svgPaths.moveBy(-e,0)+o.utils.svgPaths.lineOnAxis("h",e)+t.pathLeft+o.utils.svgPaths.lineOnAxis("h",e));e=this.sourceBlock_.getRelativeToSurfaceXY();o.Connection.highlightedPath_=o.utils.dom.createSvgElement("path",{class:"blocklyHighlightedConnectionPath",d:t,transform:"translate("+(this.x-e.x)+","+(this.y-e.y)+")"+(this.sourceBlock_.RTL?" scale(-1 1)":"")},this.sourceBlock_.getSvgRoot())};o.RenderedConnection.prototype.unhighlight=function(){o.utils.dom.removeNode(o.Connection.highlightedPath_);delete o.Connection.highlightedPath_};o.RenderedConnection.prototype.setTracking=function(e){e&&this.trackedState_==o.RenderedConnection.TrackedState.TRACKED||!e&&this.trackedState_==o.RenderedConnection.TrackedState.UNTRACKED||this.sourceBlock_.isInFlyout||(e?(this.db_.addConnection(this,this.y),this.trackedState_=o.RenderedConnection.TrackedState.TRACKED):(this.trackedState_==o.RenderedConnection.TrackedState.TRACKED&&this.db_.removeConnection(this,this.y),this.trackedState_=o.RenderedConnection.TrackedState.UNTRACKED))};o.RenderedConnection.prototype.stopTrackingAll=function(){this.setTracking(!1);if(this.targetConnection)for(var t=this.targetBlock().getDescendants(!1),o=0;o<t.length;o++){for(var n=t[o],r=n.getConnections_(!0),i=0;i<r.length;i++){r[i].setTracking(!1)}n=n.getIcons();for(i=0;i<n.length;i++){n[i].setVisible(!1)}}};o.RenderedConnection.prototype.startTrackingAll=function(){this.setTracking(!0);var e=[];if(this.type!=o.INPUT_VALUE&&this.type!=o.NEXT_STATEMENT)return e;var t=this.targetBlock();if(t){if(t.isCollapsed()){var n=[];t.outputConnection&&n.push(t.outputConnection);t.nextConnection&&n.push(t.nextConnection);t.previousConnection&&n.push(t.previousConnection)}else n=t.getConnections_(!0);for(var r=0;r<n.length;r++){e.push.apply(e,n[r].startTrackingAll())}e.length||(e[0]=t)}return e};o.RenderedConnection.prototype.isConnectionAllowed=function(e,t){return this.distanceFrom(e)>t?!1:o.RenderedConnection.superClass_.isConnectionAllowed.call(this,e)};o.RenderedConnection.prototype.onFailedConnect=function(e){this.bumpAwayFrom(e)};o.RenderedConnection.prototype.disconnectInternal_=function(e,t){o.RenderedConnection.superClass_.disconnectInternal_.call(this,e,t);e.rendered&&e.render();t.rendered&&(t.updateDisabled(),t.render())};o.RenderedConnection.prototype.respawnShadow_=function(){var e=this.getSourceBlock(),t=this.getShadowDom();if(e.workspace&&t&&o.Events.recordUndo){o.RenderedConnection.superClass_.respawnShadow_.call(this);t=this.targetBlock();if(!t)throw Error("Couldn't respawn the shadow block that should exist here.");t.initSvg();t.render(!1);e.rendered&&e.render()}};o.RenderedConnection.prototype.neighbours=function(e){return this.dbOpposite_.getNeighbours(this,e)};o.RenderedConnection.prototype.connect_=function(e){o.RenderedConnection.superClass_.connect_.call(this,e);var t=this.getSourceBlock();e=e.getSourceBlock();t.rendered&&t.updateDisabled();e.rendered&&e.updateDisabled();t.rendered&&e.rendered&&(this.type==o.NEXT_STATEMENT||this.type==o.PREVIOUS_STATEMENT?e.render():t.render())};o.RenderedConnection.prototype.onCheckChanged_=function(){!this.isConnected()||this.targetConnection&&this.checkType(this.targetConnection)||((this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug(),this.sourceBlock_.bumpNeighbours())};o.Marker=function(){this.drawer_=this.curNode_=this.colour=null;this.type="marker"};o.Marker.prototype.setDrawer=function(e){this.drawer_=e};o.Marker.prototype.getDrawer=function(){return this.drawer_};o.Marker.prototype.getCurNode=function(){return this.curNode_};o.Marker.prototype.setCurNode=function(e){var t=this.curNode_;this.curNode_=e;this.drawer_&&this.drawer_.draw(t,this.curNode_)};o.Marker.prototype.draw=function(){this.drawer_&&this.drawer_.draw(this.curNode_,this.curNode_)};o.Marker.prototype.hide=function(){this.drawer_&&this.drawer_.hide()};o.Marker.prototype.dispose=function(){this.getDrawer()&&this.getDrawer().dispose()};o.Cursor=function(){o.Cursor.superClass_.constructor.call(this);this.type="cursor"};o.utils.object.inherits(o.Cursor,o.Marker);o.Cursor.prototype.next=function(){var e=this.getCurNode();if(!e)return null;for(e=e.next();e&&e.next()&&(e.getType()==o.ASTNode.types.NEXT||e.getType()==o.ASTNode.types.BLOCK);){e=e.next()}e&&this.setCurNode(e);return e};o.Cursor.prototype.in=function(){var e=this.getCurNode();if(!e)return null;if(e.getType()==o.ASTNode.types.PREVIOUS||e.getType()==o.ASTNode.types.OUTPUT)e=e.next();(e=e.in())&&this.setCurNode(e);return e};o.Cursor.prototype.prev=function(){var e=this.getCurNode();if(!e)return null;for(e=e.prev();e&&e.prev()&&(e.getType()==o.ASTNode.types.NEXT||e.getType()==o.ASTNode.types.BLOCK);){e=e.prev()}e&&this.setCurNode(e);return e};o.Cursor.prototype.out=function(){var e=this.getCurNode();if(!e)return null;(e=e.out())&&e.getType()==o.ASTNode.types.BLOCK&&(e=e.prev()||e);e&&this.setCurNode(e);return e};o.Cursor.prototype.onBlocklyAction=function(e){if(this.getCurNode()&&this.getCurNode().getType()===o.ASTNode.types.FIELD&&this.getCurNode().getLocation().onBlocklyAction(e))return!0;switch(e.name){case o.navigation.actionNames.PREVIOUS:return this.prev(),!0;case o.navigation.actionNames.OUT:return this.out(),!0;case o.navigation.actionNames.NEXT:return this.next(),!0;case o.navigation.actionNames.IN:return this.in(),!0;default:return!1;}};o.BasicCursor=function(){o.BasicCursor.superClass_.constructor.call(this)};o.utils.object.inherits(o.BasicCursor,o.Cursor);o.BasicCursor.prototype.next=function(){var e=this.getCurNode();if(!e)return null;(e=this.getNextNode_(e,this.validNode_))&&this.setCurNode(e);return e};o.BasicCursor.prototype.in=function(){return this.next()};o.BasicCursor.prototype.prev=function(){var e=this.getCurNode();if(!e)return null;(e=this.getPreviousNode_(e,this.validNode_))&&this.setCurNode(e);return e};o.BasicCursor.prototype.out=function(){return this.prev()};o.BasicCursor.prototype.getNextNode_=function(e,t){if(!e)return null;var o=e.in()||e.next();if(t(o))return o;if(o)return this.getNextNode_(o,t);e=this.findSiblingOrParent_(e.out());return t(e)?e:e?this.getNextNode_(e,t):null};o.BasicCursor.prototype.getPreviousNode_=function(e,t){if(!e)return null;var o=e.prev();o=o?this.getRightMostChild_(o):e.out();return t(o)?o:o?this.getPreviousNode_(o,t):null};o.BasicCursor.prototype.validNode_=function(e){var t=!1;e=e&&e.getType();if(e==o.ASTNode.types.OUTPUT||e==o.ASTNode.types.INPUT||e==o.ASTNode.types.FIELD||e==o.ASTNode.types.NEXT||e==o.ASTNode.types.PREVIOUS||e==o.ASTNode.types.WORKSPACE)t=!0;return t};o.BasicCursor.prototype.findSiblingOrParent_=function(e){if(!e)return null;var t=e.next();return t?t:this.findSiblingOrParent_(e.out())};o.BasicCursor.prototype.getRightMostChild_=function(e){if(!e.in())return e;for(e=e.in();e.next();){e=e.next()}return this.getRightMostChild_(e)};o.TabNavigateCursor=function(){o.TabNavigateCursor.superClass_.constructor.call(this)};o.utils.object.inherits(o.TabNavigateCursor,o.BasicCursor);o.TabNavigateCursor.prototype.validNode_=function(e){var t=!1,n=e&&e.getType();e&&(e=e.getLocation(),n==o.ASTNode.types.FIELD&&e&&e.isTabNavigable()&&e.isClickable()&&(t=!0));return t};o.utils.Rect=function(e,t,o,n){this.top=e;this.bottom=t;this.left=o;this.right=n};o.utils.Rect.prototype.contains=function(e,t){return e>=this.left&&e<=this.right&&t>=this.top&&t<=this.bottom};o.BlockSvg=function(e,t,n){this.svgGroup_=o.utils.dom.createSvgElement("g",{},null);this.svgGroup_.translate_="";this.style=e.getRenderer().getConstants().getBlockStyle(null);this.pathObject=e.getRenderer().makePathObject(this.svgGroup_,this.style);this.rendered=!1;this.workspace=e;this.previousConnection=this.nextConnection=this.outputConnection=null;this.useDragSurface_=o.utils.is3dSupported()&&!!e.getBlockDragSurface();var r=this.pathObject.svgPath;r.tooltip=this;o.Tooltip.bindMouseEvents(r);o.BlockSvg.superClass_.constructor.call(this,e,t,n);this.svgGroup_.dataset&&(this.svgGroup_.dataset.id=this.id)};o.utils.object.inherits(o.BlockSvg,o.Block);o.BlockSvg.prototype.height=0;o.BlockSvg.prototype.width=0;o.BlockSvg.prototype.dragStartXY_=null;o.BlockSvg.prototype.warningTextDb_=null;o.BlockSvg.INLINE=-1;o.BlockSvg.COLLAPSED_WARNING_ID="TEMP_COLLAPSED_WARNING_";o.BlockSvg.prototype.initSvg=function(){if(!this.workspace.rendered)throw TypeError("Workspace is headless.");for(var e=0,t;t=this.inputList[e];e++){t.init()}t=this.getIcons();for(e=0;e<t.length;e++){t[e].createIcon()}this.applyColour();this.pathObject.updateMovable(this.isMovable());e=this.getSvgRoot();this.workspace.options.readOnly||this.eventsInit_||!e||o.bindEventWithChecks_(e,"mousedown",this,this.onMouseDown_);this.eventsInit_=!0;e.parentNode||this.workspace.getCanvas().appendChild(e)};o.BlockSvg.prototype.getColourSecondary=function(){return this.style.colourSecondary};o.BlockSvg.prototype.getColourTertiary=function(){return this.style.colourTertiary};o.BlockSvg.prototype.getColourShadow=function(){return this.getColourSecondary()};o.BlockSvg.prototype.getColourBorder=function(){return{colourBorder:this.getColourTertiary(),colourLight:null,colourDark:null}};o.BlockSvg.prototype.select=function(){if(this.isShadow()&&this.getParent())this.getParent().select();else if(o.selected!=this){var e=null;if(o.selected){e=o.selected.id;o.Events.disable();try{o.selected.unselect()}finally{o.Events.enable()}}e=new o.Events.Ui(null,"selected",e,this.id);e.workspaceId=this.workspace.id;o.Events.fire(e);o.selected=this;this.addSelect()}};o.BlockSvg.prototype.unselect=function(){if(o.selected==this){var e=new o.Events.Ui(null,"selected",this.id,null);e.workspaceId=this.workspace.id;o.Events.fire(e);o.selected=null;this.removeSelect()}};o.BlockSvg.prototype.mutator=null;o.BlockSvg.prototype.comment=null;o.BlockSvg.prototype.commentIcon_=null;o.BlockSvg.prototype.warning=null;o.BlockSvg.prototype.getIcons=function(){var e=[];this.mutator&&e.push(this.mutator);this.commentIcon_&&e.push(this.commentIcon_);this.warning&&e.push(this.warning);return e};o.BlockSvg.prototype.setParent=function(e){var t=this.parentBlock_;if(e!=t){o.utils.dom.startTextWidthCache();o.BlockSvg.superClass_.setParent.call(this,e);o.utils.dom.stopTextWidthCache();var n=this.getSvgRoot();if(!this.workspace.isClearing&&n){var r=this.getRelativeToSurfaceXY();e?(e.getSvgRoot().appendChild(n),e=this.getRelativeToSurfaceXY(),this.moveConnections(e.x-r.x,e.y-r.y)):t&&(this.workspace.getCanvas().appendChild(n),this.translate(r.x,r.y));this.applyColour()}}};o.BlockSvg.prototype.getRelativeToSurfaceXY=function(){var t=0,n=0,r=this.useDragSurface_?this.workspace.getBlockDragSurface().getGroup():null,i=this.getSvgRoot();if(i){do{var s=o.utils.getRelativeXY(i);t+=s.x;n+=s.y;this.useDragSurface_&&this.workspace.getBlockDragSurface().getCurrentBlock()==i&&(s=this.workspace.getBlockDragSurface().getSurfaceTranslation(),t+=s.x,n+=s.y);i=i.parentNode}while(i&&i!=this.workspace.getCanvas()&&i!=r)}return new o.utils.Coordinate(t,n)};o.BlockSvg.prototype.moveBy=function(t,n){if(this.parentBlock_)throw Error("Block has parent.");var r=o.Events.isEnabled();if(r)var i=new o.Events.BlockMove(this);var s=this.getRelativeToSurfaceXY();this.translate(s.x+t,s.y+n);this.moveConnections(t,n);r&&(i.recordNew(),o.Events.fire(i));this.workspace.resizeContents()};o.BlockSvg.prototype.translate=function(e,t){this.getSvgRoot().setAttribute("transform","translate("+e+","+t+")")};o.BlockSvg.prototype.moveToDragSurface=function(){if(this.useDragSurface_){var e=this.getRelativeToSurfaceXY();this.clearTransformAttributes_();this.workspace.getBlockDragSurface().translateSurface(e.x,e.y);(e=this.getSvgRoot())&&this.workspace.getBlockDragSurface().setBlocksAndShow(e)}};o.BlockSvg.prototype.moveTo=function(e){var t=this.getRelativeToSurfaceXY();this.moveBy(e.x-t.x,e.y-t.y)};o.BlockSvg.prototype.moveOffDragSurface=function(e){this.useDragSurface_&&(this.translate(e.x,e.y),this.workspace.getBlockDragSurface().clearAndHide(this.workspace.getCanvas()))};o.BlockSvg.prototype.moveDuringDrag=function(e){this.useDragSurface_?this.workspace.getBlockDragSurface().translateSurface(e.x,e.y):(this.svgGroup_.translate_="translate("+e.x+","+e.y+")",this.svgGroup_.setAttribute("transform",this.svgGroup_.translate_+this.svgGroup_.skew_))};o.BlockSvg.prototype.clearTransformAttributes_=function(){this.getSvgRoot().removeAttribute("transform")};o.BlockSvg.prototype.snapToGrid=function(){if(this.workspace&&!this.workspace.isDragging()&&!this.getParent()&&!this.isInFlyout){var e=this.workspace.getGrid();if(e&&e.shouldSnap()){var t=e.getSpacing(),o=t/2,n=this.getRelativeToSurfaceXY();e=Math.round((n.x-o)/t)*t+o-n.x;t=Math.round((n.y-o)/t)*t+o-n.y;e=Math.round(e);t=Math.round(t);0==e&&0==t||this.moveBy(e,t)}}};o.BlockSvg.prototype.getBoundingRectangle=function(){var e=this.getRelativeToSurfaceXY(),t=this.getHeightWidth();if(this.RTL){var n=e.x-t.width,r=e.x}else n=e.x,r=e.x+t.width;return new o.utils.Rect(e.y,e.y+t.height,n,r)};o.BlockSvg.prototype.markDirty=function(){for(var e=0,t;t=this.inputList[e];e++){t.markDirty()}};o.BlockSvg.prototype.setCollapsed=function(t){if(this.collapsed_!=t){for(var n=[],r=0,i;i=this.inputList[r];r++){n.push.apply(n,i.setVisible(!t))}if(t){i=this.getIcons();for(r=0;r<i.length;r++){i[r].setVisible(!1)}r=this.toString(o.COLLAPSE_CHARS);this.appendDummyInput("_TEMP_COLLAPSED_INPUT").appendField(r).init();i=this.getDescendants(!0);if(r=this.getNextBlock())r=i.indexOf(r),i.splice(r,i.length-r);r=1;for(var s;s=i[r];r++){if(s.warning){this.setWarningText(o.Msg.COLLAPSED_WARNINGS_WARNING,o.BlockSvg.COLLAPSED_WARNING_ID);break}}}else this.removeInput("_TEMP_COLLAPSED_INPUT"),this.warning&&(this.warning.setText("",o.BlockSvg.COLLAPSED_WARNING_ID),Object.keys(this.warning.text_).length||this.setWarningText(null));o.BlockSvg.superClass_.setCollapsed.call(this,t);n.length||(n[0]=this);if(this.rendered)for(r=0;s=n[r];r++){s.render()}}};o.BlockSvg.prototype.tab=function(e,t){var n=new o.TabNavigateCursor;n.setCurNode(o.ASTNode.createFieldNode(e));e=n.getCurNode();n.onBlocklyAction(t?o.navigation.ACTION_NEXT:o.navigation.ACTION_PREVIOUS);(t=n.getCurNode())&&t!==e&&t.getLocation().showEditor()};o.BlockSvg.prototype.onMouseDown_=function(e){var t=this.workspace&&this.workspace.getGesture(e);t&&t.handleBlockStart(e,this)};o.BlockSvg.prototype.showHelp=function(){var e="function"==typeof this.helpUrl?this.helpUrl():this.helpUrl;e&&window.open(e)};o.BlockSvg.prototype.generateContextMenu=function(){if(this.workspace.options.readOnly||!this.contextMenu)return null;var e=this,t=[];if(!this.isInFlyout){this.isDeletable()&&this.isMovable()&&t.push(o.ContextMenu.blockDuplicateOption(e));this.workspace.options.comments&&!this.collapsed_&&this.isEditable()&&t.push(o.ContextMenu.blockCommentOption(e));if(this.isMovable())if(this.collapsed_)this.workspace.options.collapse&&(n={enabled:!0},n.text=o.Msg.EXPAND_BLOCK,n.callback=function(){e.setCollapsed(!1)},t.push(n));else{for(var n=1;n<this.inputList.length;n++){if(this.inputList[n-1].type!=o.NEXT_STATEMENT&&this.inputList[n].type!=o.NEXT_STATEMENT){n={enabled:!0};var r=this.getInputsInline();n.text=r?o.Msg.EXTERNAL_INPUTS:o.Msg.INLINE_INPUTS;n.callback=function(){e.setInputsInline(!r)};t.push(n);break}}this.workspace.options.collapse&&(n={enabled:!0},n.text=o.Msg.COLLAPSE_BLOCK,n.callback=function(){e.setCollapsed(!0)},t.push(n))}this.workspace.options.disable&&this.isEditable()&&(n={text:this.isEnabled()?o.Msg.DISABLE_BLOCK:o.Msg.ENABLE_BLOCK,enabled:!this.getInheritedDisabled(),callback:function callback(){var t=o.Events.getGroup();t||o.Events.setGroup(!0);e.setEnabled(!e.isEnabled());t||o.Events.setGroup(!1)}},t.push(n));this.isDeletable()&&t.push(o.ContextMenu.blockDeleteOption(e))}t.push(o.ContextMenu.blockHelpOption(e));this.customContextMenu&&this.customContextMenu(t);return t};o.BlockSvg.prototype.showContextMenu=function(e){var t=this.generateContextMenu();t&&t.length&&(o.ContextMenu.show(e,t,this.RTL),o.ContextMenu.currentBlock=this)};o.BlockSvg.prototype.moveConnections=function(e,t){if(this.rendered){for(var o=this.getConnections_(!1),n=0;n<o.length;n++){o[n].moveBy(e,t)}o=this.getIcons();for(n=0;n<o.length;n++){o[n].computeIconLocation()}for(n=0;n<this.childBlocks_.length;n++){this.childBlocks_[n].moveConnections(e,t)}}};o.BlockSvg.prototype.setDragging=function(e){if(e){var t=this.getSvgRoot();t.translate_="";t.skew_="";o.draggingConnections=o.draggingConnections.concat(this.getConnections_(!0));o.utils.dom.addClass(this.svgGroup_,"blocklyDragging")}else o.draggingConnections=[],o.utils.dom.removeClass(this.svgGroup_,"blocklyDragging");for(t=0;t<this.childBlocks_.length;t++){this.childBlocks_[t].setDragging(e)}};o.BlockSvg.prototype.setMovable=function(e){o.BlockSvg.superClass_.setMovable.call(this,e);this.pathObject.updateMovable(e)};o.BlockSvg.prototype.setEditable=function(e){o.BlockSvg.superClass_.setEditable.call(this,e);e=this.getIcons();for(var t=0;t<e.length;t++){e[t].updateEditable()}};o.BlockSvg.prototype.setShadow=function(e){o.BlockSvg.superClass_.setShadow.call(this,e);this.applyColour()};o.BlockSvg.prototype.setInsertionMarker=function(e){this.isInsertionMarker_!=e&&(this.isInsertionMarker_=e)&&(this.setColour(o.INSERTION_MARKER_COLOUR),this.pathObject.updateInsertionMarker(!0))};o.BlockSvg.prototype.getSvgRoot=function(){return this.svgGroup_};o.BlockSvg.prototype.dispose=function(e,t){if(this.workspace){o.Tooltip.hide();o.utils.dom.startTextWidthCache();var n=this.workspace;o.selected==this&&(this.unselect(),this.workspace.cancelCurrentGesture());o.ContextMenu.currentBlock==this&&o.ContextMenu.hide();this.workspace.keyboardAccessibilityMode&&o.navigation.moveCursorOnBlockDelete(this);t&&this.rendered&&(this.unplug(e),o.blockAnimations.disposeUiEffect(this));this.rendered=!1;if(this.warningTextDb_){for(var r in this.warningTextDb_){clearTimeout(this.warningTextDb_[r])}this.warningTextDb_=null}t=this.getIcons();for(r=0;r<t.length;r++){t[r].dispose()}o.BlockSvg.superClass_.dispose.call(this,!!e);o.utils.dom.removeNode(this.svgGroup_);n.resizeContents();this.svgGroup_=null;o.utils.dom.stopTextWidthCache()}};o.BlockSvg.prototype.applyColour=function(){this.pathObject.applyColour(this);for(var e=this.getIcons(),t=0;t<e.length;t++){e[t].applyColour()}for(e=0;t=this.inputList[e];e++){for(var o=0,n;n=t.fieldRow[o];o++){n.applyColour()}}};o.BlockSvg.prototype.updateDisabled=function(){var e=this.getChildren(!1);this.applyColour();for(var t=0,o;o=e[t];t++){o.updateDisabled()}};o.BlockSvg.prototype.getCommentIcon=function(){return this.commentIcon_};o.BlockSvg.prototype.setCommentText=function(e){if(!o.Comment)throw Error("Missing require for Blockly.Comment");this.commentModel.text!=e&&(o.BlockSvg.superClass_.setCommentText.call(this,e),e=null!=e,!!this.commentIcon_==e?this.commentIcon_.updateText():(e?this.comment=this.commentIcon_=new o.Comment(this):(this.commentIcon_.dispose(),this.comment=this.commentIcon_=null),this.rendered&&(this.render(),this.bumpNeighbours())))};o.BlockSvg.prototype.setWarningText=function(t,n){if(!o.Warning)throw Error("Missing require for Blockly.Warning");this.warningTextDb_||(this.warningTextDb_=Object.create(null));var r=n||"";if(r)this.warningTextDb_[r]&&(clearTimeout(this.warningTextDb_[r]),delete this.warningTextDb_[r]);else for(var i in this.warningTextDb_){clearTimeout(this.warningTextDb_[i]),delete this.warningTextDb_[i]}if(this.workspace.isDragging()){var s=this;this.warningTextDb_[r]=setTimeout(function(){s.workspace&&(delete s.warningTextDb_[r],s.setWarningText(t,r))},100)}else{this.isInFlyout&&(t=null);n=this.getSurroundParent();for(i=null;n;){n.isCollapsed()&&(i=n),n=n.getSurroundParent()}i&&i.setWarningText(o.Msg.COLLAPSED_WARNINGS_WARNING,o.BlockSvg.COLLAPSED_WARNING_ID);n=!1;"string"==typeof t?(this.warning||(this.warning=new o.Warning(this),n=!0),this.warning.setText(t,r)):this.warning&&!r?(this.warning.dispose(),n=!0):this.warning&&(n=this.warning.getText(),this.warning.setText("",r),(i=this.warning.getText())||this.warning.dispose(),n=n!=i);n&&this.rendered&&(this.render(),this.bumpNeighbours())}};o.BlockSvg.prototype.setMutator=function(e){this.mutator&&this.mutator!==e&&this.mutator.dispose();e&&(e.setBlock(this),this.mutator=e,e.createIcon());this.rendered&&(this.render(),this.bumpNeighbours())};o.BlockSvg.prototype.setDisabled=function(e){console.warn("Deprecated call to Blockly.BlockSvg.prototype.setDisabled, use Blockly.BlockSvg.prototype.setEnabled instead.");this.setEnabled(!e)};o.BlockSvg.prototype.setEnabled=function(e){this.isEnabled()!=e&&(o.BlockSvg.superClass_.setEnabled.call(this,e),this.rendered&&this.updateDisabled())};o.BlockSvg.prototype.setHighlighted=function(e){this.rendered&&this.pathObject.updateHighlighted(e)};o.BlockSvg.prototype.addSelect=function(){this.pathObject.updateSelected(!0)};o.BlockSvg.prototype.removeSelect=function(){this.pathObject.updateSelected(!1)};o.BlockSvg.prototype.setDeleteStyle=function(e){this.pathObject.updateDraggingDelete(e)};o.BlockSvg.prototype.getColour=function(){return this.style.colourPrimary};o.BlockSvg.prototype.setColour=function(e){o.BlockSvg.superClass_.setColour.call(this,e);e=this.workspace.getRenderer().getConstants().getBlockStyleForColour(this.colour_);this.pathObject.setStyle(e.style);this.style=e.style;this.styleName_=e.name;this.applyColour()};o.BlockSvg.prototype.setStyle=function(e){var t=this.workspace.getRenderer().getConstants().getBlockStyle(e);this.styleName_=e;if(t)this.hat=t.hat,this.pathObject.setStyle(t),this.colour_=t.colourPrimary,this.style=t,this.applyColour();else throw Error("Invalid style name: "+e)};o.BlockSvg.prototype.bringToFront=function(){var e=this;do{var t=e.getSvgRoot(),o=t.parentNode,n=o.childNodes;n[n.length-1]!==t&&o.appendChild(t);e=e.getParent()}while(e)};o.BlockSvg.prototype.setPreviousStatement=function(e,t){o.BlockSvg.superClass_.setPreviousStatement.call(this,e,t);this.rendered&&(this.render(),this.bumpNeighbours())};o.BlockSvg.prototype.setNextStatement=function(e,t){o.BlockSvg.superClass_.setNextStatement.call(this,e,t);this.rendered&&(this.render(),this.bumpNeighbours())};o.BlockSvg.prototype.setOutput=function(e,t){o.BlockSvg.superClass_.setOutput.call(this,e,t);this.rendered&&(this.render(),this.bumpNeighbours())};o.BlockSvg.prototype.setInputsInline=function(e){o.BlockSvg.superClass_.setInputsInline.call(this,e);this.rendered&&(this.render(),this.bumpNeighbours())};o.BlockSvg.prototype.removeInput=function(e,t){o.BlockSvg.superClass_.removeInput.call(this,e,t);this.rendered&&(this.render(),this.bumpNeighbours())};o.BlockSvg.prototype.moveNumberedInputBefore=function(e,t){o.BlockSvg.superClass_.moveNumberedInputBefore.call(this,e,t);this.rendered&&(this.render(),this.bumpNeighbours())};o.BlockSvg.prototype.appendInput_=function(e,t){e=o.BlockSvg.superClass_.appendInput_.call(this,e,t);this.rendered&&(this.render(),this.bumpNeighbours());return e};o.BlockSvg.prototype.setConnectionTracking=function(e){this.previousConnection&&this.previousConnection.setTracking(e);this.outputConnection&&this.outputConnection.setTracking(e);if(this.nextConnection){this.nextConnection.setTracking(e);var t=this.nextConnection.targetBlock();t&&t.setConnectionTracking(e)}if(!this.collapsed_)for(t=0;t<this.inputList.length;t++){var o=this.inputList[t].connection;o&&(o.setTracking(e),(o=o.targetBlock())&&o.setConnectionTracking(e))}};o.BlockSvg.prototype.getConnections_=function(e){var t=[];if(e||this.rendered)if(this.outputConnection&&t.push(this.outputConnection),this.previousConnection&&t.push(this.previousConnection),this.nextConnection&&t.push(this.nextConnection),e||!this.collapsed_){e=0;for(var o;o=this.inputList[e];e++){o.connection&&t.push(o.connection)}}return t};o.BlockSvg.prototype.lastConnectionInStack=function(){return o.BlockSvg.superClass_.lastConnectionInStack.call(this)};o.BlockSvg.prototype.getMatchingConnection=function(e,t){return o.BlockSvg.superClass_.getMatchingConnection.call(this,e,t)};o.BlockSvg.prototype.makeConnection_=function(e){return new o.RenderedConnection(this,e)};o.BlockSvg.prototype.bumpNeighbours=function(){if(this.workspace&&!this.workspace.isDragging()){var t=this.getRootBlock();if(!t.isInFlyout)for(var n=this.getConnections_(!1),r=0,i;i=n[r];r++){i.isConnected()&&i.isSuperior()&&i.targetBlock().bumpNeighbours();for(var s=i.neighbours(o.SNAP_RADIUS),e=0,l;l=s[e];e++){i.isConnected()&&l.isConnected()||l.getSourceBlock().getRootBlock()!=t&&(i.isSuperior()?l.bumpAwayFrom(i):i.bumpAwayFrom(l))}}}};o.BlockSvg.prototype.scheduleSnapAndBump=function(){var e=this,t=o.Events.getGroup();setTimeout(function(){o.Events.setGroup(t);e.snapToGrid();o.Events.setGroup(!1)},o.BUMP_DELAY/2);setTimeout(function(){o.Events.setGroup(t);e.bumpNeighbours();o.Events.setGroup(!1)},o.BUMP_DELAY)};o.BlockSvg.prototype.positionNearConnection=function(e,t){e.type!=o.NEXT_STATEMENT&&e.type!=o.INPUT_VALUE||this.moveBy(t.x-e.x,t.y-e.y)};o.BlockSvg.prototype.getParent=function(){return o.BlockSvg.superClass_.getParent.call(this)};o.BlockSvg.prototype.getRootBlock=function(){return o.BlockSvg.superClass_.getRootBlock.call(this)};o.BlockSvg.prototype.render=function(e){o.utils.dom.startTextWidthCache();this.rendered=!0;this.workspace.getRenderer().render(this);this.updateConnectionLocations_();!1!==e&&((e=this.getParent())?e.render(!0):this.workspace.resizeContents());o.utils.dom.stopTextWidthCache();e=this.workspace.getCursor();this.pathObject.cursorSvg_&&e.draw()};o.BlockSvg.prototype.updateConnectionLocations_=function(){var e=this.getRelativeToSurfaceXY();this.previousConnection&&this.previousConnection.moveToOffset(e);this.outputConnection&&this.outputConnection.moveToOffset(e);for(var t=0,o;t<this.inputList.length;t++){o=this.inputList[t].connection;o&&(o.moveToOffset(e),o.isConnected()&&o.tighten())}this.nextConnection&&(this.nextConnection.moveToOffset(e),this.nextConnection.isConnected()&&this.nextConnection.tighten())};o.BlockSvg.prototype.setCursorSvg=function(e){this.pathObject.setCursorSvg(e)};o.BlockSvg.prototype.setMarkerSvg=function(e){this.pathObject.setMarkerSvg(e)};o.BlockSvg.prototype.getHeightWidth=function(){var e=this.height,t=this.width,o=this.getNextBlock();if(o){o=o.getHeightWidth();var n=this.workspace.getRenderer().getConstants().NOTCH_HEIGHT;e+=o.height-n;t=Math.max(t,o.width)}return{height:e,width:t}};o.BlockSvg.prototype.highlightForReplacement=function(e){this.pathObject.updateReplacementHighlight(e)};o.BlockSvg.prototype.highlightShapeForInput=function(e,t){this.pathObject.updateShapeForInputHighlight(e,t)};o.blockRendering.rendererMap_={};o.blockRendering.useDebugger=!1;o.blockRendering.register=function(e,t){if(o.blockRendering.rendererMap_[e])throw Error("Renderer has already been registered.");o.blockRendering.rendererMap_[e]=t};o.blockRendering.unregister=function(e){o.blockRendering.rendererMap_[e]?delete o.blockRendering.rendererMap_[e]:console.warn("No renderer mapping for name \""+e+"\" found to unregister")};o.blockRendering.startDebugger=function(){o.blockRendering.useDebugger=!0};o.blockRendering.stopDebugger=function(){o.blockRendering.useDebugger=!1};o.blockRendering.init=function(e){if(!o.blockRendering.rendererMap_[e])throw Error("Renderer not registered: ",e);var t=function(e){t.superClass_.constructor.call(this,e)};o.utils.object.inherits(t,o.blockRendering.rendererMap_[e]);e=new t(e);e.init();return e};o.ConnectionDB=function(){this.connections_=[]};o.ConnectionDB.prototype.addConnection=function(e,t){t=this.calculateIndexForYPos_(t);this.connections_.splice(t,0,e)};o.ConnectionDB.prototype.findIndexOfConnection_=function(e,t){if(!this.connections_.length)return-1;var o=this.calculateIndexForYPos_(t);if(o>=this.connections_.length)return-1;t=e.y;for(var n=o;0<=n&&this.connections_[n].y==t;){if(this.connections_[n]==e)return n;n--}for(;o<this.connections_.length&&this.connections_[o].y==t;){if(this.connections_[o]==e)return o;o++}return-1};o.ConnectionDB.prototype.calculateIndexForYPos_=function(e){if(!this.connections_.length)return 0;for(var t=0,o=this.connections_.length,n;t<o;){n=Math.floor((t+o)/2);if(this.connections_[n].y<e)t=n+1;else if(this.connections_[n].y>e)o=n;else{t=n;break}}return t};o.ConnectionDB.prototype.removeConnection=function(e,t){e=this.findIndexOfConnection_(e,t);if(-1==e)throw Error("Unable to find connection in connectionDB.");this.connections_.splice(e,1)};o.ConnectionDB.prototype.getNeighbours=function(t,o){function n(t){var n=i-r[t].x,s=e-r[t].y;Math.sqrt(n*n+s*s)<=o&&p.push(r[t]);return s<o}var r=this.connections_,i=t.x,e=t.y;t=0;for(var s=r.length-2,l=s;t<l;){r[l].y<e?t=l:s=l,l=Math.floor((t+s)/2)}var p=[];s=t=l;if(r.length){for(;0<=t&&n(t);){t--}do{s++}while(s<r.length&&n(s))}return p};o.ConnectionDB.prototype.isInYRange_=function(e,t,o){return Math.abs(this.connections_[e].y-t)<=o};o.ConnectionDB.prototype.searchForClosest=function(t,o,n){if(!this.connections_.length)return{connection:null,radius:o};var r=t.y,i=t.x;t.x=i+n.x;t.y=r+n.y;var e=this.calculateIndexForYPos_(t.y);n=null;for(var s=o,l,a=e-1;0<=a&&this.isInYRange_(a,t.y,o);){l=this.connections_[a],t.isConnectionAllowed(l,s)&&(n=l,s=l.distanceFrom(t)),a--}for(;e<this.connections_.length&&this.isInYRange_(e,t.y,o);){l=this.connections_[e],t.isConnectionAllowed(l,s)&&(n=l,s=l.distanceFrom(t)),e++}t.x=i;t.y=r;return{connection:n,radius:s}};o.ConnectionDB.init=function(){var e=[];e[o.INPUT_VALUE]=new o.ConnectionDB;e[o.OUTPUT_VALUE]=new o.ConnectionDB;e[o.NEXT_STATEMENT]=new o.ConnectionDB;e[o.PREVIOUS_STATEMENT]=new o.ConnectionDB;return e};o.MarkerManager=function(e){this.cursorSvg_=this.cursor_=null;this.markers_={};this.workspace_=e};o.MarkerManager.prototype.registerMarker=function(e,t){this.markers_[e]&&this.unregisterMarker(e);t.setDrawer(this.workspace_.getRenderer().makeMarkerDrawer(this.workspace_,t));this.setMarkerSvg(t.getDrawer().createDom());this.markers_[e]=t};o.MarkerManager.prototype.unregisterMarker=function(e){var t=this.markers_[e];if(t)t.dispose(),delete this.markers_[e];else throw Error("Marker with id "+e+" does not exist. Can only unregistermarkers that exist.")};o.MarkerManager.prototype.getCursor=function(){return this.cursor_};o.MarkerManager.prototype.getMarker=function(e){return this.markers_[e]};o.MarkerManager.prototype.setCursor=function(e){this.cursor_&&this.cursor_.getDrawer()&&this.cursor_.getDrawer().dispose();if(this.cursor_=e)e=this.workspace_.getRenderer().makeMarkerDrawer(this.workspace_,this.cursor_),this.cursor_.setDrawer(e),this.setCursorSvg(this.cursor_.getDrawer().createDom())};o.MarkerManager.prototype.setCursorSvg=function(e){e?(this.workspace_.getBlockCanvas().appendChild(e),this.cursorSvg_=e):this.cursorSvg_=null};o.MarkerManager.prototype.setMarkerSvg=function(e){e?this.workspace_.getBlockCanvas()&&(this.cursorSvg_?this.workspace_.getBlockCanvas().insertBefore(e,this.cursorSvg_):this.workspace_.getBlockCanvas().appendChild(e)):this.markerSvg_=null};o.MarkerManager.prototype.dispose=function(){for(var e=Object.keys(this.markers_),t=0,o;o=e[t];t++){this.unregisterMarker(o)}this.markers_=null;this.cursor_.dispose();this.cursor_=null};o.ThemeManager=function(e,t){this.workspace_=e;this.theme_=t;this.subscribedWorkspaces_=[];this.componentDB_=Object.create(null)};o.ThemeManager.prototype.getTheme=function(){return this.theme_};o.ThemeManager.prototype.setTheme=function(t){if(this.theme_!==t){var n=this.theme_;this.theme_=t;if(t=this.workspace_.getInjectionDiv())n&&o.utils.dom.removeClass(t,n.name+"-theme"),o.utils.dom.addClass(t,this.theme_.name+"-theme");for(n=0;t=this.subscribedWorkspaces_[n];n++){t.refreshTheme()}n=0;t=Object.keys(this.componentDB_);for(var r;r=t[n];n++){for(var i=0,s,l;s=this.componentDB_[r][i];i++){l=s.element;s=s.propertyName;var p=this.theme_&&this.theme_.getComponentStyle(r);l.style[s]=p||""}}o.hideChaff()}};o.ThemeManager.prototype.subscribeWorkspace=function(e){this.subscribedWorkspaces_.push(e)};o.ThemeManager.prototype.unsubscribeWorkspace=function(e){e=this.subscribedWorkspaces_.indexOf(e);if(0>e)throw Error("Cannot unsubscribe a workspace that hasn't been subscribed.");this.subscribedWorkspaces_.splice(e,1)};o.ThemeManager.prototype.subscribe=function(e,t,o){this.componentDB_[t]||(this.componentDB_[t]=[]);this.componentDB_[t].push({element:e,propertyName:o});t=this.theme_&&this.theme_.getComponentStyle(t);e.style[o]=t||""};o.ThemeManager.prototype.unsubscribe=function(t){if(t)for(var o=Object.keys(this.componentDB_),n=0,r;r=o[n];n++){for(var i=this.componentDB_[r],e=i.length-1;0<=e;e--){i[e].element===t&&i.splice(e,1)}this.componentDB_[r].length||delete this.componentDB_[r]}};o.ThemeManager.prototype.dispose=function(){this.componentDB_=this.subscribedWorkspaces_=this.theme_=this.owner_=null};o.TouchGesture=function(e,t){o.TouchGesture.superClass_.constructor.call(this,e,t);this.isMultiTouch_=!1;this.cachedPoints_=Object.create(null);this.startDistance_=this.previousScale_=0;this.isPinchZoomEnabled_=this.onStartWrapper_=null};o.utils.object.inherits(o.TouchGesture,o.Gesture);o.TouchGesture.ZOOM_IN_MULTIPLIER=5;o.TouchGesture.ZOOM_OUT_MULTIPLIER=6;o.TouchGesture.prototype.doStart=function(e){this.isPinchZoomEnabled_=this.startWorkspace_.options.zoomOptions&&this.startWorkspace_.options.zoomOptions.pinch;o.TouchGesture.superClass_.doStart.call(this,e);!this.isEnding_&&o.Touch.isTouchEvent(e)&&this.handleTouchStart(e)};o.TouchGesture.prototype.bindMouseEvents=function(e){this.onStartWrapper_=o.bindEventWithChecks_(document,"mousedown",null,this.handleStart.bind(this),!0);this.onMoveWrapper_=o.bindEventWithChecks_(document,"mousemove",null,this.handleMove.bind(this),!0);this.onUpWrapper_=o.bindEventWithChecks_(document,"mouseup",null,this.handleUp.bind(this),!0);e.preventDefault();e.stopPropagation()};o.TouchGesture.prototype.handleStart=function(e){!this.isDragging()&&o.Touch.isTouchEvent(e)&&(this.handleTouchStart(e),this.isMultiTouch()&&o.longStop_())};o.TouchGesture.prototype.handleMove=function(e){this.isDragging()?o.Touch.shouldHandleEvent(e)&&o.TouchGesture.superClass_.handleMove.call(this,e):this.isMultiTouch()?(o.Touch.isTouchEvent(e)&&this.handleTouchMove(e),o.longStop_()):o.TouchGesture.superClass_.handleMove.call(this,e)};o.TouchGesture.prototype.handleUp=function(e){o.Touch.isTouchEvent(e)&&!this.isDragging()&&this.handleTouchEnd(e);!this.isMultiTouch()||this.isDragging()?o.Touch.shouldHandleEvent(e)&&o.TouchGesture.superClass_.handleUp.call(this,e):(e.preventDefault(),e.stopPropagation(),this.dispose())};o.TouchGesture.prototype.isMultiTouch=function(){return this.isMultiTouch_};o.TouchGesture.prototype.dispose=function(){o.TouchGesture.superClass_.dispose.call(this);this.onStartWrapper_&&o.unbindEvent_(this.onStartWrapper_)};o.TouchGesture.prototype.handleTouchStart=function(e){var t=o.Touch.getTouchIdentifierFromEvent(e);this.cachedPoints_[t]=this.getTouchPoint(e);t=Object.keys(this.cachedPoints_);2==t.length&&(this.startDistance_=o.utils.Coordinate.distance(this.cachedPoints_[t[0]],this.cachedPoints_[t[1]]),this.isMultiTouch_=!0,e.preventDefault())};o.TouchGesture.prototype.handleTouchMove=function(e){var t=o.Touch.getTouchIdentifierFromEvent(e);this.cachedPoints_[t]=this.getTouchPoint(e);t=Object.keys(this.cachedPoints_);this.isPinchZoomEnabled_&&2===t.length?this.handlePinch_(e):o.TouchGesture.superClass_.handleMove.call(this,e)};o.TouchGesture.prototype.handlePinch_=function(t){var n=Object.keys(this.cachedPoints_);n=o.utils.Coordinate.distance(this.cachedPoints_[n[0]],this.cachedPoints_[n[1]])/this.startDistance_;if(0<this.previousScale_&&1/0>this.previousScale_){var r=n-this.previousScale_;r=0<r?r*o.TouchGesture.ZOOM_IN_MULTIPLIER:r*o.TouchGesture.ZOOM_OUT_MULTIPLIER;var i=this.startWorkspace_,s=o.utils.mouseToSvg(t,i.getParentSvg(),i.getInverseScreenCTM());i.zoom(s.x,s.y,r)}this.previousScale_=n;t.preventDefault()};o.TouchGesture.prototype.handleTouchEnd=function(e){e=o.Touch.getTouchIdentifierFromEvent(e);this.cachedPoints_[e]&&delete this.cachedPoints_[e];2>Object.keys(this.cachedPoints_).length&&(this.cachedPoints_=Object.create(null),this.previousScale_=0)};o.TouchGesture.prototype.getTouchPoint=function(e){return this.startWorkspace_?new o.utils.Coordinate(e.pageX?e.pageX:e.changedTouches[0].pageX,e.pageY?e.pageY:e.changedTouches[0].pageY):null};o.WorkspaceAudio=function(e){this.parentWorkspace_=e;this.SOUNDS_=Object.create(null)};o.WorkspaceAudio.prototype.lastSound_=null;o.WorkspaceAudio.prototype.dispose=function(){this.SOUNDS_=this.parentWorkspace_=null};o.WorkspaceAudio.prototype.load=function(t,n){if(t.length){try{var r=new o.utils.global.Audio}catch(e){return}for(var i,s=0;s<t.length;s++){var l=t[s],a=l.match(/\.(\w+)$/);if(a&&r.canPlayType("audio/"+a[1])){i=new o.utils.global.Audio(l);break}}i&&i.play&&(this.SOUNDS_[n]=i)}};o.WorkspaceAudio.prototype.preload=function(){for(var e in this.SOUNDS_){var t=this.SOUNDS_[e];t.volume=.01;var n=t.play();void 0!==n?n.then(t.pause).catch(function(){}):t.pause();if(o.utils.userAgent.IPAD||o.utils.userAgent.IPHONE)break}};o.WorkspaceAudio.prototype.play=function(e,t){var n=this.SOUNDS_[e];n?(e=new Date,null!=this.lastSound_&&e-this.lastSound_<o.SOUND_LIMIT||(this.lastSound_=e,n=o.utils.userAgent.IPAD||o.utils.userAgent.ANDROID?n:n.cloneNode(),n.volume=void 0===t?1:t,n.play())):this.parentWorkspace_&&this.parentWorkspace_.getAudioManager().play(e,t)};o.WorkspaceSvg=function(e,t,n){o.WorkspaceSvg.superClass_.constructor.call(this,e);this.getMetrics=e.getMetrics||o.WorkspaceSvg.getTopLevelWorkspaceMetrics_;this.setMetrics=e.setMetrics||o.WorkspaceSvg.setTopLevelWorkspaceMetrics_;this.connectionDBList=o.ConnectionDB.init();t&&(this.blockDragSurface_=t);n&&(this.workspaceDragSurface_=n);this.useWorkspaceDragSurface_=!!this.workspaceDragSurface_&&o.utils.is3dSupported();this.highlightedBlocks_=[];this.audioManager_=new o.WorkspaceAudio(e.parentWorkspace);this.grid_=this.options.gridPattern?new o.Grid(e.gridPattern,e.gridOptions):null;this.markerManager_=new o.MarkerManager(this);o.Variables&&o.Variables.flyoutCategory&&this.registerToolboxCategoryCallback(o.VARIABLE_CATEGORY_NAME,o.Variables.flyoutCategory);o.VariablesDynamic&&o.VariablesDynamic.flyoutCategory&&this.registerToolboxCategoryCallback(o.VARIABLE_DYNAMIC_CATEGORY_NAME,o.VariablesDynamic.flyoutCategory);o.Procedures&&o.Procedures.flyoutCategory&&(this.registerToolboxCategoryCallback(o.PROCEDURE_CATEGORY_NAME,o.Procedures.flyoutCategory),this.addChangeListener(o.Procedures.mutatorOpenListener));this.themeManager_=this.options.parentWorkspace?this.options.parentWorkspace.getThemeManager():new o.ThemeManager(this,this.options.theme||o.Themes.Classic);this.renderer_=o.blockRendering.init(this.options.renderer||"geras");this.cachedParentSvg_=null;this.themeManager_.subscribeWorkspace(this);this.renderer_.getConstants().refreshTheme(this.getTheme());this.keyboardAccessibilityMode=!1};o.utils.object.inherits(o.WorkspaceSvg,o.Workspace);o.WorkspaceSvg.prototype.resizeHandlerWrapper_=null;o.WorkspaceSvg.prototype.rendered=!0;o.WorkspaceSvg.prototype.isVisible_=!0;o.WorkspaceSvg.prototype.isFlyout=!1;o.WorkspaceSvg.prototype.isMutator=!1;o.WorkspaceSvg.prototype.resizesEnabled_=!0;o.WorkspaceSvg.prototype.scrollX=0;o.WorkspaceSvg.prototype.scrollY=0;o.WorkspaceSvg.prototype.startScrollX=0;o.WorkspaceSvg.prototype.startScrollY=0;o.WorkspaceSvg.prototype.dragDeltaXY_=null;o.WorkspaceSvg.prototype.scale=1;o.WorkspaceSvg.prototype.trashcan=null;o.WorkspaceSvg.prototype.scrollbar=null;o.WorkspaceSvg.prototype.flyout_=null;o.WorkspaceSvg.prototype.toolbox_=null;o.WorkspaceSvg.prototype.currentGesture_=null;o.WorkspaceSvg.prototype.blockDragSurface_=null;o.WorkspaceSvg.prototype.workspaceDragSurface_=null;o.WorkspaceSvg.prototype.useWorkspaceDragSurface_=!1;o.WorkspaceSvg.prototype.isDragSurfaceActive_=!1;o.WorkspaceSvg.prototype.injectionDiv_=null;o.WorkspaceSvg.prototype.lastRecordedPageScroll_=null;o.WorkspaceSvg.prototype.flyoutButtonCallbacks_={};o.WorkspaceSvg.prototype.toolboxCategoryCallbacks_={};o.WorkspaceSvg.prototype.targetWorkspace=null;o.WorkspaceSvg.prototype.inverseScreenCTM_=null;o.WorkspaceSvg.prototype.inverseScreenCTMDirty_=!0;o.WorkspaceSvg.prototype.getMarkerManager=function(){return this.markerManager_};o.WorkspaceSvg.prototype.setCursorSvg=function(e){this.markerManager_.setCursorSvg(e)};o.WorkspaceSvg.prototype.setMarkerSvg=function(e){this.markerManager_.setMarkerSvg(e)};o.WorkspaceSvg.prototype.getMarker=function(e){return this.markerManager_?this.markerManager_.getMarker(e):null};o.WorkspaceSvg.prototype.getCursor=function(){return this.markerManager_?this.markerManager_.getCursor():null};o.WorkspaceSvg.prototype.getRenderer=function(){return this.renderer_};o.WorkspaceSvg.prototype.getThemeManager=function(){return this.themeManager_};o.WorkspaceSvg.prototype.getTheme=function(){return this.themeManager_.getTheme()};o.WorkspaceSvg.prototype.setTheme=function(e){e||(e=o.Themes.Classic);this.themeManager_.setTheme(e)};o.WorkspaceSvg.prototype.refreshTheme=function(){this.getRenderer().getConstants().refreshTheme(this.getTheme());this.updateBlockStyles_(this.getAllBlocks(!1).filter(function(e){return void 0!==e.getStyleName()}));this.refreshToolboxSelection();this.toolbox_&&this.toolbox_.updateColourFromTheme();var e=new o.Events.Ui(null,"theme",null,null);e.workspaceId=this.id;o.Events.fire(e)};o.WorkspaceSvg.prototype.updateBlockStyles_=function(e){for(var t=0,o,n;o=e[t];t++){n=o.getStyleName();n&&(o.setStyle(n),o.mutator&&o.mutator.updateBlockStyle())}};o.WorkspaceSvg.prototype.getInverseScreenCTM=function(){if(this.inverseScreenCTMDirty_){var e=this.getParentSvg().getScreenCTM();e&&(this.inverseScreenCTM_=e.inverse(),this.inverseScreenCTMDirty_=!1)}return this.inverseScreenCTM_};o.WorkspaceSvg.prototype.updateInverseScreenCTM=function(){this.inverseScreenCTMDirty_=!0};o.WorkspaceSvg.prototype.isVisible=function(){return this.isVisible_};o.WorkspaceSvg.prototype.getSvgXY=function(t){var n=0,r=0,i=1;if(o.utils.dom.containsNode(this.getCanvas(),t)||o.utils.dom.containsNode(this.getBubbleCanvas(),t))i=this.scale;do{var s=o.utils.getRelativeXY(t);if(t==this.getCanvas()||t==this.getBubbleCanvas())i=1;n+=s.x*i;r+=s.y*i;t=t.parentNode}while(t&&t!=this.getParentSvg());return new o.utils.Coordinate(n,r)};o.WorkspaceSvg.prototype.getOriginOffsetInPixels=function(){return o.utils.getInjectionDivXY_(this.getCanvas())};o.WorkspaceSvg.prototype.getInjectionDiv=function(){if(!this.injectionDiv_)for(var e=this.svgGroup_;e;){if(-1!=(" "+(e.getAttribute("class")||"")+" ").indexOf(" injectionDiv ")){this.injectionDiv_=e;break}e=e.parentNode}return this.injectionDiv_};o.WorkspaceSvg.prototype.getBlockCanvas=function(){return this.svgBlockCanvas_};o.WorkspaceSvg.prototype.setResizeHandlerWrapper=function(e){this.resizeHandlerWrapper_=e};o.WorkspaceSvg.prototype.createDom=function(e){this.svgGroup_=o.utils.dom.createSvgElement("g",{class:"blocklyWorkspace"},null);e&&(this.svgBackground_=o.utils.dom.createSvgElement("rect",{height:"100%",width:"100%",class:e},this.svgGroup_),"blocklyMainBackground"==e&&this.grid_?this.svgBackground_.style.fill="url(#"+this.grid_.getPatternId()+")":this.themeManager_.subscribe(this.svgBackground_,"workspaceBackgroundColour","fill"));this.svgBlockCanvas_=o.utils.dom.createSvgElement("g",{class:"blocklyBlockCanvas"},this.svgGroup_);this.svgBubbleCanvas_=o.utils.dom.createSvgElement("g",{class:"blocklyBubbleCanvas"},this.svgGroup_);this.isFlyout||(o.bindEventWithChecks_(this.svgGroup_,"mousedown",this,this.onMouseDown_,!1,!0),o.bindEventWithChecks_(this.svgGroup_,"wheel",this,this.onMouseWheel_));if(this.options.hasCategories){if(!o.Toolbox)throw Error("Missing require for Blockly.Toolbox");this.toolbox_=new o.Toolbox(this)}this.grid_&&this.grid_.update(this.scale);this.recordDeleteAreas();this.markerManager_.setCursor(new o.Cursor);this.markerManager_.registerMarker(o.navigation.MARKER_NAME,new o.Marker);e=this.getRenderer().getConstants();e.injectCSS(this.getRenderer().name);e.createDom(this.svgGroup_);return this.svgGroup_};o.WorkspaceSvg.prototype.dispose=function(){this.rendered=!1;this.currentGesture_&&this.currentGesture_.cancel();this.svgGroup_&&(o.utils.dom.removeNode(this.svgGroup_),this.svgGroup_=null);this.svgBubbleCanvas_=this.svgBlockCanvas_=null;this.toolbox_&&(this.toolbox_.dispose(),this.toolbox_=null);this.flyout_&&(this.flyout_.dispose(),this.flyout_=null);this.trashcan&&(this.trashcan.dispose(),this.trashcan=null);this.scrollbar&&(this.scrollbar.dispose(),this.scrollbar=null);this.zoomControls_&&(this.zoomControls_.dispose(),this.zoomControls_=null);this.audioManager_&&(this.audioManager_.dispose(),this.audioManager_=null);this.grid_&&(this.grid_.dispose(),this.grid_=null);this.renderer_.getConstants().dispose();this.themeManager_&&(this.themeManager_.unsubscribeWorkspace(this),this.themeManager_.unsubscribe(this.svgBackground_),this.options.parentWorkspace||(this.themeManager_.dispose(),this.themeManager_=null));this.markerManager_&&(this.markerManager_.dispose(),this.markerManager_=null);o.WorkspaceSvg.superClass_.dispose.call(this);this.flyoutButtonCallbacks_=this.toolboxCategoryCallbacks_=this.connectionDBList=null;if(!this.options.parentWorkspace){var e=this.getParentSvg().parentNode;e&&o.utils.dom.removeNode(e)}this.resizeHandlerWrapper_&&(o.unbindEvent_(this.resizeHandlerWrapper_),this.resizeHandlerWrapper_=null)};o.WorkspaceSvg.prototype.newBlock=function(e,t){return new o.BlockSvg(this,e,t)};o.WorkspaceSvg.prototype.addTrashcan=function(){if(!o.Trashcan)throw Error("Missing require for Blockly.Trashcan");this.trashcan=new o.Trashcan(this);var e=this.trashcan.createDom();this.svgGroup_.insertBefore(e,this.svgBlockCanvas_)};o.WorkspaceSvg.prototype.addZoomControls=function(){if(!o.ZoomControls)throw Error("Missing require for Blockly.ZoomControls");this.zoomControls_=new o.ZoomControls(this);var e=this.zoomControls_.createDom();this.svgGroup_.appendChild(e)};o.WorkspaceSvg.prototype.addFlyout=function(e){var t=new o.Options({parentWorkspace:this,rtl:this.RTL,oneBasedIndex:this.options.oneBasedIndex,horizontalLayout:this.horizontalLayout,renderer:this.options.renderer});t.toolboxPosition=this.options.toolboxPosition;if(this.horizontalLayout){if(!o.HorizontalFlyout)throw Error("Missing require for Blockly.HorizontalFlyout");this.flyout_=new o.HorizontalFlyout(t)}else{if(!o.VerticalFlyout)throw Error("Missing require for Blockly.VerticalFlyout");this.flyout_=new o.VerticalFlyout(t)}this.flyout_.autoClose=!1;return this.flyout_.createDom(e)};o.WorkspaceSvg.prototype.getFlyout=function(e){return this.flyout_||e?this.flyout_:this.toolbox_?this.toolbox_.getFlyout():null};o.WorkspaceSvg.prototype.getToolbox=function(){return this.toolbox_};o.WorkspaceSvg.prototype.updateScreenCalculations_=function(){this.updateInverseScreenCTM();this.recordDeleteAreas()};o.WorkspaceSvg.prototype.resizeContents=function(){this.resizesEnabled_&&this.rendered&&(this.scrollbar&&this.scrollbar.resize(),this.updateInverseScreenCTM())};o.WorkspaceSvg.prototype.resize=function(){this.toolbox_&&this.toolbox_.position();this.flyout_&&this.flyout_.position();this.trashcan&&this.trashcan.position();this.zoomControls_&&this.zoomControls_.position();this.scrollbar&&this.scrollbar.resize();this.updateScreenCalculations_()};o.WorkspaceSvg.prototype.updateScreenCalculationsIfScrolled=function(){var e=o.utils.getDocumentScroll();o.utils.Coordinate.equals(this.lastRecordedPageScroll_,e)||(this.lastRecordedPageScroll_=e,this.updateScreenCalculations_())};o.WorkspaceSvg.prototype.getCanvas=function(){return this.svgBlockCanvas_};o.WorkspaceSvg.prototype.getBubbleCanvas=function(){return this.svgBubbleCanvas_};o.WorkspaceSvg.prototype.getParentSvg=function(){if(!this.cachedParentSvg_)for(var e=this.svgGroup_;e;){if("svg"==e.tagName){this.cachedParentSvg_=e;break}e=e.parentNode}return this.cachedParentSvg_};o.WorkspaceSvg.prototype.translate=function(e,t){if(this.useWorkspaceDragSurface_&&this.isDragSurfaceActive_)this.workspaceDragSurface_.translateSurface(e,t);else{var o="translate("+e+","+t+") scale("+this.scale+")";this.svgBlockCanvas_.setAttribute("transform",o);this.svgBubbleCanvas_.setAttribute("transform",o)}this.blockDragSurface_&&this.blockDragSurface_.translateAndScaleGroup(e,t,this.scale);this.grid_&&this.grid_.moveTo(e,t)};o.WorkspaceSvg.prototype.resetDragSurface=function(){if(this.useWorkspaceDragSurface_){this.isDragSurfaceActive_=!1;var e=this.workspaceDragSurface_.getSurfaceTranslation();this.workspaceDragSurface_.clearAndHide(this.svgGroup_);e="translate("+e.x+","+e.y+") scale("+this.scale+")";this.svgBlockCanvas_.setAttribute("transform",e);this.svgBubbleCanvas_.setAttribute("transform",e)}};o.WorkspaceSvg.prototype.setupDragSurface=function(){if(this.useWorkspaceDragSurface_&&!this.isDragSurfaceActive_){this.isDragSurfaceActive_=!0;var e=this.svgBlockCanvas_.previousSibling,t=parseInt(this.getParentSvg().getAttribute("width"),10),n=parseInt(this.getParentSvg().getAttribute("height"),10),r=o.utils.getRelativeXY(this.getCanvas());this.workspaceDragSurface_.setContentsAndShow(this.getCanvas(),this.getBubbleCanvas(),e,t,n,this.scale);this.workspaceDragSurface_.translateSurface(r.x,r.y)}};o.WorkspaceSvg.prototype.getBlockDragSurface=function(){return this.blockDragSurface_};o.WorkspaceSvg.prototype.getWidth=function(){var e=this.getMetrics();return e?e.viewWidth/this.scale:0};o.WorkspaceSvg.prototype.setVisible=function(e){this.scrollbar&&this.scrollbar.setContainerVisible(e);this.getFlyout()&&this.getFlyout().setContainerVisible(e);this.getParentSvg().style.display=e?"block":"none";this.toolbox_&&(this.toolbox_.HtmlDiv.style.display=e?"block":"none");if(e){for(var t=this.getAllBlocks(!1),n=t.length-1;0<=n;n--){t[n].markDirty()}this.render();this.toolbox_&&this.toolbox_.position()}else o.hideChaff(!0);this.isVisible_=e};o.WorkspaceSvg.prototype.render=function(){for(var e=this.getAllBlocks(!1),t=e.length-1;0<=t;t--){e[t].render(!1)}if(this.currentGesture_)for(e=this.currentGesture_.getInsertionMarkers(),t=0;t<e.length;t++){e[t].render(!1)}};o.WorkspaceSvg.prototype.traceOn=function(){console.warn("Deprecated call to traceOn, delete this.")};o.WorkspaceSvg.prototype.highlightBlock=function(e,t){if(void 0===t){for(var n=0,r;r=this.highlightedBlocks_[n];n++){r.setHighlighted(!1)}this.highlightedBlocks_.length=0}if(r=e?this.getBlockById(e):null)(e=void 0===t||t)?-1==this.highlightedBlocks_.indexOf(r)&&this.highlightedBlocks_.push(r):o.utils.arrayRemove(this.highlightedBlocks_,r),r.setHighlighted(e)};o.WorkspaceSvg.prototype.paste=function(e){!this.rendered||e.getElementsByTagName("block").length>=this.remainingCapacity()||(this.currentGesture_&&this.currentGesture_.cancel(),"comment"==e.tagName.toLowerCase()?this.pasteWorkspaceComment_(e):this.pasteBlock_(e))};o.WorkspaceSvg.prototype.pasteBlock_=function(t){o.Events.disable();try{var n=o.Xml.domToBlock(t,this),r=this.getMarker(o.navigation.MARKER_NAME).getCurNode();if(this.keyboardAccessibilityMode&&r&&r.isConnection()){var i=r.getLocation();o.navigation.insertBlock(n,i);return}var s=parseInt(t.getAttribute("x"),10),p=parseInt(t.getAttribute("y"),10);if(!isNaN(s)&&!isNaN(p)){this.RTL&&(s=-s);do{t=!1;var d=this.getAllBlocks(!1);r=0;for(var u,g;u=d[r];r++){g=u.getRelativeToSurfaceXY();if(1>=Math.abs(s-g.x)&&1>=Math.abs(p-g.y)){t=!0;break}}if(!t){var _=n.getConnections_(!1);r=0;for(var l;l=_[r];r++){if(l.closest(o.SNAP_RADIUS,new o.utils.Coordinate(s,p)).connection){t=!0;break}}}t&&(s=this.RTL?s-o.SNAP_RADIUS:s+o.SNAP_RADIUS,p+=2*o.SNAP_RADIUS)}while(t);n.moveBy(s,p)}}finally{o.Events.enable()}o.Events.isEnabled()&&!n.isShadow()&&o.Events.fire(new o.Events.BlockCreate(n));n.select()};o.WorkspaceSvg.prototype.pasteWorkspaceComment_=function(e){o.Events.disable();try{var t=o.WorkspaceCommentSvg.fromXml(e,this),n=parseInt(e.getAttribute("x"),10),r=parseInt(e.getAttribute("y"),10);isNaN(n)||isNaN(r)||(this.RTL&&(n=-n),t.moveBy(n+50,r+50))}finally{o.Events.enable()}o.Events.isEnabled();t.select()};o.WorkspaceSvg.prototype.refreshToolboxSelection=function(){var e=this.isFlyout?this.targetWorkspace:this;e&&!e.currentGesture_&&e.toolbox_&&e.toolbox_.getFlyout()&&e.toolbox_.refreshSelection()};o.WorkspaceSvg.prototype.renameVariableById=function(e,t){o.WorkspaceSvg.superClass_.renameVariableById.call(this,e,t);this.refreshToolboxSelection()};o.WorkspaceSvg.prototype.deleteVariableById=function(e){o.WorkspaceSvg.superClass_.deleteVariableById.call(this,e);this.refreshToolboxSelection()};o.WorkspaceSvg.prototype.createVariable=function(e,t,n){e=o.WorkspaceSvg.superClass_.createVariable.call(this,e,t,n);this.refreshToolboxSelection();return e};o.WorkspaceSvg.prototype.recordDeleteAreas=function(){this.deleteAreaTrash_=this.trashcan&&this.svgGroup_.parentNode?this.trashcan.getClientRect():null;this.deleteAreaToolbox_=this.flyout_?this.flyout_.getClientRect():this.toolbox_?this.toolbox_.getClientRect():null};o.WorkspaceSvg.prototype.isDeleteArea=function(e){return this.deleteAreaTrash_&&this.deleteAreaTrash_.contains(e.clientX,e.clientY)?o.DELETE_AREA_TRASH:this.deleteAreaToolbox_&&this.deleteAreaToolbox_.contains(e.clientX,e.clientY)?o.DELETE_AREA_TOOLBOX:o.DELETE_AREA_NONE};o.WorkspaceSvg.prototype.onMouseDown_=function(e){var t=this.getGesture(e);t&&t.handleWsStart(e,this)};o.WorkspaceSvg.prototype.startDrag=function(e,t){e=o.utils.mouseToSvg(e,this.getParentSvg(),this.getInverseScreenCTM());e.x/=this.scale;e.y/=this.scale;this.dragDeltaXY_=o.utils.Coordinate.difference(t,e)};o.WorkspaceSvg.prototype.moveDrag=function(e){e=o.utils.mouseToSvg(e,this.getParentSvg(),this.getInverseScreenCTM());e.x/=this.scale;e.y/=this.scale;return o.utils.Coordinate.sum(this.dragDeltaXY_,e)};o.WorkspaceSvg.prototype.isDragging=function(){return null!=this.currentGesture_&&this.currentGesture_.isDragging()};o.WorkspaceSvg.prototype.isDraggable=function(){return this.options.moveOptions&&this.options.moveOptions.drag};o.WorkspaceSvg.prototype.isContentBounded=function(){return this.options.moveOptions&&this.options.moveOptions.scrollbars||this.options.moveOptions&&this.options.moveOptions.wheel||this.options.moveOptions&&this.options.moveOptions.drag||this.options.zoomOptions&&this.options.zoomOptions.controls||this.options.zoomOptions&&this.options.zoomOptions.wheel||this.options.zoomOptions&&this.options.zoomOptions.pinch};o.WorkspaceSvg.prototype.isMovable=function(){return this.options.moveOptions&&this.options.moveOptions.scrollbars||this.options.moveOptions&&this.options.moveOptions.wheel||this.options.moveOptions&&this.options.moveOptions.drag||this.options.zoomOptions&&this.options.zoomOptions.wheel||this.options.zoomOptions&&this.options.zoomOptions.pinch};o.WorkspaceSvg.prototype.onMouseWheel_=function(e){if(o.Gesture.inProgress())e.preventDefault(),e.stopPropagation();else{var t=this.options.zoomOptions&&this.options.zoomOptions.wheel,n=this.options.moveOptions&&this.options.moveOptions.wheel;if(t||n){var r=o.utils.getScrollDeltaPixels(e);!t||!e.ctrlKey&&n?(t=this.scrollX-r.x,n=this.scrollY-r.y,e.shiftKey&&!r.x&&(t=this.scrollX-r.y,n=this.scrollY),this.scroll(t,n)):(r=-r.y/50,t=o.utils.mouseToSvg(e,this.getParentSvg(),this.getInverseScreenCTM()),this.zoom(t.x,t.y,r));e.preventDefault()}}};o.WorkspaceSvg.prototype.getBlocksBoundingBox=function(){var e=this.getTopBlocks(!1),t=this.getTopComments(!1);e=e.concat(t);if(!e.length)return new o.utils.Rect(0,0,0,0);t=e[0].getBoundingRectangle();for(var n=1,r;n<e.length;n++){r=e[n].getBoundingRectangle();r.top<t.top&&(t.top=r.top);r.bottom>t.bottom&&(t.bottom=r.bottom);r.left<t.left&&(t.left=r.left);r.right>t.right&&(t.right=r.right)}return t};o.WorkspaceSvg.prototype.cleanUp=function(){this.setResizesEnabled(!1);o.Events.setGroup(!0);for(var t=this.getTopBlocks(!0),n=0,r=0,i;i=t[r];r++){if(i.isMovable()){var s=i.getRelativeToSurfaceXY();i.moveBy(-s.x,n-s.y);i.snapToGrid();n=i.getRelativeToSurfaceXY().y+i.getHeightWidth().height+this.renderer_.getConstants().MIN_BLOCK_HEIGHT}}o.Events.setGroup(!1);this.setResizesEnabled(!0)};o.WorkspaceSvg.prototype.showContextMenu=function(t){function r(e){if(e.isDeletable())n=n.concat(e.getDescendants(!1));else{e=e.getChildren(!1);for(var t=0;t<e.length;t++){r(e[t])}}}function i(){o.Events.setGroup(e);var t=n.shift();t&&(t.workspace?(t.dispose(!1,!0),setTimeout(i,10)):i());o.Events.setGroup(!1)}if(!this.options.readOnly&&!this.isFlyout){var s=[],u=this.getTopBlocks(!0),e=o.utils.genUid(),a=this,c={};c.text=o.Msg.UNDO;c.enabled=0<this.undoStack_.length;c.callback=this.undo.bind(this,!1);s.push(c);c={};c.text=o.Msg.REDO;c.enabled=0<this.redoStack_.length;c.callback=this.undo.bind(this,!0);s.push(c);this.isMovable()&&(c={},c.text=o.Msg.CLEAN_UP,c.enabled=1<u.length,c.callback=this.cleanUp.bind(this),s.push(c));if(this.options.collapse){for(var d=c=!1,g=0;g<u.length;g++){for(var _=u[g];_;){_.isCollapsed()?c=!0:d=!0,_=_.getNextBlock()}}var b=function(e){for(var t=0,o=0;o<u.length;o++){for(var n=u[o];n;){setTimeout(n.setCollapsed.bind(n,e),t),n=n.getNextBlock(),t+=10}}};d={enabled:d};d.text=o.Msg.COLLAPSE_ALL;d.callback=function(){b(!0)};s.push(d);c={enabled:c};c.text=o.Msg.EXPAND_ALL;c.callback=function(){b(!1)};s.push(c)}var n=[];for(g=0;g<u.length;g++){r(u[g])}c={text:1==n.length?o.Msg.DELETE_BLOCK:o.Msg.DELETE_X_BLOCKS.replace("%1",n.length+""),enabled:0<n.length,callback:function callback(){a.currentGesture_&&a.currentGesture_.cancel();2>n.length?i():o.confirm(o.Msg.DELETE_ALL_BLOCKS.replace("%1",n.length),function(e){e&&i()})}};s.push(c);this.configureContextMenu&&this.configureContextMenu(s);o.ContextMenu.show(t,s,this.RTL)}};o.WorkspaceSvg.prototype.updateToolbox=function(e){if(e=o.Options.parseToolboxTree(e)){if(!this.options.languageTree)throw Error("Existing toolbox is null.  Can't create new toolbox.");if(e.getElementsByTagName("category").length){if(!this.toolbox_)throw Error("Existing toolbox has no categories.  Can't change mode.");this.options.languageTree=e;this.toolbox_.renderTree(e)}else{if(!this.flyout_)throw Error("Existing toolbox has categories.  Can't change mode.");this.options.languageTree=e;this.flyout_.show(e.childNodes)}}else if(this.options.languageTree)throw Error("Can't nullify an existing toolbox.")};o.WorkspaceSvg.prototype.markFocused=function(){this.options.parentWorkspace?this.options.parentWorkspace.markFocused():(o.mainWorkspace=this,this.setBrowserFocus())};o.WorkspaceSvg.prototype.setBrowserFocus=function(){document.activeElement&&document.activeElement.blur();try{this.getParentSvg().focus({preventScroll:!0})}catch(e){try{this.getParentSvg().parentNode.setActive()}catch(e){this.getParentSvg().parentNode.focus({preventScroll:!0})}}};o.WorkspaceSvg.prototype.zoom=function(t,o,n){n=Math.pow(this.options.zoomOptions.scaleSpeed,n);var r=this.scale*n;if(this.scale!=r){r>this.options.zoomOptions.maxScale?n=this.options.zoomOptions.maxScale/this.scale:r<this.options.zoomOptions.minScale&&(n=this.options.zoomOptions.minScale/this.scale);var i=this.getCanvas().getCTM(),s=this.getParentSvg().createSVGPoint();s.x=t;s.y=o;s=s.matrixTransform(i.inverse());t=s.x;o=s.y;i=i.translate(t*(1-n),o*(1-n)).scale(n);this.scrollX=i.e;this.scrollY=i.f;this.setScale(r)}};o.WorkspaceSvg.prototype.zoomCenter=function(e){var t=this.getMetrics();if(this.flyout_){var o=t.svgWidth/2;t=t.svgHeight/2}else o=t.viewWidth/2+t.absoluteLeft,t=t.viewHeight/2+t.absoluteTop;this.zoom(o,t,e)};o.WorkspaceSvg.prototype.zoomToFit=function(){if(this.isMovable()){var e=this.getMetrics(),t=e.viewWidth;e=e.viewHeight;var o=this.getBlocksBoundingBox(),n=o.right-o.left;o=o.bottom-o.top;n&&(this.flyout_&&(this.horizontalLayout?(e+=this.flyout_.getHeight(),o+=this.flyout_.getHeight()/this.scale):(t+=this.flyout_.getWidth(),n+=this.flyout_.getWidth()/this.scale)),this.setScale(Math.min(t/n,e/o)),this.scrollCenter())}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")};o.WorkspaceSvg.prototype.beginCanvasTransition=function(){o.utils.dom.addClass(this.svgBlockCanvas_,"blocklyCanvasTransitioning");o.utils.dom.addClass(this.svgBubbleCanvas_,"blocklyCanvasTransitioning")};o.WorkspaceSvg.prototype.endCanvasTransition=function(){o.utils.dom.removeClass(this.svgBlockCanvas_,"blocklyCanvasTransitioning");o.utils.dom.removeClass(this.svgBubbleCanvas_,"blocklyCanvasTransitioning")};o.WorkspaceSvg.prototype.scrollCenter=function(){if(this.isMovable()){var e=this.getMetrics(),t=(e.contentWidth-e.viewWidth)/2,o=(e.contentHeight-e.viewHeight)/2;t=-t-e.contentLeft;o=-o-e.contentTop;this.scroll(t,o)}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")};o.WorkspaceSvg.prototype.centerOnBlock=function(e){if(this.isMovable()){if(e=e?this.getBlockById(e):null){var t=e.getRelativeToSurfaceXY(),n=e.getHeightWidth(),r=this.scale;e=(t.x+(this.RTL?-1:1)*n.width/2)*r;t=(t.y+n.height/2)*r;n=this.getMetrics();e=-(e-n.contentLeft-n.viewWidth/2)-n.contentLeft;t=-(t-n.contentTop-n.viewHeight/2)-n.contentTop;o.hideChaff();this.scroll(e,t)}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")};o.WorkspaceSvg.prototype.setScale=function(e){this.options.zoomOptions.maxScale&&e>this.options.zoomOptions.maxScale?e=this.options.zoomOptions.maxScale:this.options.zoomOptions.minScale&&e<this.options.zoomOptions.minScale&&(e=this.options.zoomOptions.minScale);this.scale=e;o.hideChaff(!1);this.flyout_&&(this.flyout_.reflow(),this.recordDeleteAreas());this.grid_&&this.grid_.update(this.scale);e=this.getMetrics();this.scrollX-=e.absoluteLeft;this.scrollY-=e.absoluteTop;e.viewLeft+=e.absoluteLeft;e.viewTop+=e.absoluteTop;this.scroll(this.scrollX,this.scrollY);this.scrollbar&&(this.flyout_?(this.scrollbar.hScroll.resizeViewHorizontal(e),this.scrollbar.vScroll.resizeViewVertical(e)):(this.scrollbar.hScroll.resizeContentHorizontal(e),this.scrollbar.vScroll.resizeContentVertical(e)))};o.WorkspaceSvg.prototype.scroll=function(t,n){o.hideChaff(!0);var r=this.getMetrics(),i=r.contentWidth+r.contentLeft-r.viewWidth,s=r.contentHeight+r.contentTop-r.viewHeight;t=Math.min(t,-r.contentLeft);n=Math.min(n,-r.contentTop);t=Math.max(t,-i);n=Math.max(n,-s);this.scrollX=t;this.scrollY=n;this.scrollbar&&(this.scrollbar.hScroll.setHandlePosition(-(t+r.contentLeft)*this.scrollbar.hScroll.ratio_),this.scrollbar.vScroll.setHandlePosition(-(n+r.contentTop)*this.scrollbar.vScroll.ratio_));t+=r.absoluteLeft;n+=r.absoluteTop;this.translate(t,n)};o.WorkspaceSvg.getDimensionsPx_=function(e){var t=0,o=0;e&&(t=e.getWidth(),o=e.getHeight());return{width:t,height:o}};o.WorkspaceSvg.getContentDimensions_=function(e,t){return e.isContentBounded()?o.WorkspaceSvg.getContentDimensionsBounded_(e,t):o.WorkspaceSvg.getContentDimensionsExact_(e)};o.WorkspaceSvg.getContentDimensionsExact_=function(t){var o=t.getBlocksBoundingBox(),n=t.scale;t=o.top*n;var r=o.bottom*n,i=o.left*n;o=o.right*n;return{top:t,bottom:r,left:i,right:o,width:o-i,height:r-t}};o.WorkspaceSvg.getContentDimensionsBounded_=function(t,n){t=o.WorkspaceSvg.getContentDimensionsExact_(t);var r=n.width;n=n.height;var i=r/2,s=n/2,e=Math.min(t.left-i,t.right-r),l=Math.min(t.top-s,t.bottom-n);return{left:e,top:l,height:Math.max(t.bottom+s,t.top+n)-l,width:Math.max(t.right+i,t.left+r)-e}};o.WorkspaceSvg.getTopLevelWorkspaceMetrics_=function(){var t=o.WorkspaceSvg.getDimensionsPx_(this.toolbox_),n=o.WorkspaceSvg.getDimensionsPx_(this.flyout_),r=o.svgSize(this.getParentSvg()),i={height:r.height,width:r.width};if(this.toolbox_){if(this.toolboxPosition==o.TOOLBOX_AT_TOP||this.toolboxPosition==o.TOOLBOX_AT_BOTTOM)i.height-=t.height;else{if(this.toolboxPosition==o.TOOLBOX_AT_LEFT||this.toolboxPosition==o.TOOLBOX_AT_RIGHT)i.width-=t.width}}else if(this.flyout_)if(this.toolboxPosition==o.TOOLBOX_AT_TOP||this.toolboxPosition==o.TOOLBOX_AT_BOTTOM)i.height-=n.height;else if(this.toolboxPosition==o.TOOLBOX_AT_LEFT||this.toolboxPosition==o.TOOLBOX_AT_RIGHT)i.width-=n.width;var s=o.WorkspaceSvg.getContentDimensions_(this,i),e=0;this.toolbox_&&this.toolboxPosition==o.TOOLBOX_AT_LEFT?e=t.width:this.flyout_&&this.toolboxPosition==o.TOOLBOX_AT_LEFT&&(e=n.width);var l=0;this.toolbox_&&this.toolboxPosition==o.TOOLBOX_AT_TOP?l=t.height:this.flyout_&&this.toolboxPosition==o.TOOLBOX_AT_TOP&&(l=n.height);return{contentHeight:s.height,contentWidth:s.width,contentTop:s.top,contentLeft:s.left,viewHeight:i.height,viewWidth:i.width,viewTop:-this.scrollY,viewLeft:-this.scrollX,absoluteTop:l,absoluteLeft:e,svgHeight:r.height,svgWidth:r.width,toolboxWidth:t.width,toolboxHeight:t.height,flyoutWidth:n.width,flyoutHeight:n.height,toolboxPosition:this.toolboxPosition}};o.WorkspaceSvg.setTopLevelWorkspaceMetrics_=function(e){var t=this.getMetrics();"number"==typeof e.x&&(this.scrollX=-t.contentWidth*e.x-t.contentLeft);"number"==typeof e.y&&(this.scrollY=-t.contentHeight*e.y-t.contentTop);this.translate(this.scrollX+t.absoluteLeft,this.scrollY+t.absoluteTop)};o.WorkspaceSvg.prototype.getBlockById=function(e){return o.WorkspaceSvg.superClass_.getBlockById.call(this,e)};o.WorkspaceSvg.prototype.getTopBlocks=function(e){return o.WorkspaceSvg.superClass_.getTopBlocks.call(this,e)};o.WorkspaceSvg.prototype.setResizesEnabled=function(e){var t=!this.resizesEnabled_&&e;this.resizesEnabled_=e;t&&this.resizeContents()};o.WorkspaceSvg.prototype.clear=function(){this.setResizesEnabled(!1);o.WorkspaceSvg.superClass_.clear.call(this);this.setResizesEnabled(!0)};o.WorkspaceSvg.prototype.registerButtonCallback=function(e,t){if("function"!=typeof t)throw TypeError("Button callbacks must be functions.");this.flyoutButtonCallbacks_[e]=t};o.WorkspaceSvg.prototype.getButtonCallback=function(e){return(e=this.flyoutButtonCallbacks_[e])?e:null};o.WorkspaceSvg.prototype.removeButtonCallback=function(e){this.flyoutButtonCallbacks_[e]=null};o.WorkspaceSvg.prototype.registerToolboxCategoryCallback=function(e,t){if("function"!=typeof t)throw TypeError("Toolbox category callbacks must be functions.");this.toolboxCategoryCallbacks_[e]=t};o.WorkspaceSvg.prototype.getToolboxCategoryCallback=function(e){return this.toolboxCategoryCallbacks_[e]||null};o.WorkspaceSvg.prototype.removeToolboxCategoryCallback=function(e){this.toolboxCategoryCallbacks_[e]=null};o.WorkspaceSvg.prototype.getGesture=function(e){var t="mousedown"==e.type||"touchstart"==e.type||"pointerdown"==e.type,n=this.currentGesture_;return n?t&&n.hasStarted()?(console.warn("Tried to start the same gesture twice."),n.cancel(),null):n:t?this.currentGesture_=new o.TouchGesture(e,this):null};o.WorkspaceSvg.prototype.clearGesture=function(){this.currentGesture_=null};o.WorkspaceSvg.prototype.cancelCurrentGesture=function(){this.currentGesture_&&this.currentGesture_.cancel()};o.WorkspaceSvg.prototype.getAudioManager=function(){return this.audioManager_};o.WorkspaceSvg.prototype.getGrid=function(){return this.grid_};o.inject=function(t,n){o.checkBlockColourConstants();"string"==typeof t&&(t=document.getElementById(t)||document.querySelector(t));if(!t||!o.utils.dom.containsNode(document,t))throw Error("Error: container is not in current document.");n=new o.Options(n||{});var r=document.createElement("div");r.className="injectionDiv";r.tabIndex=0;o.utils.aria.setState(r,o.utils.aria.State.LABEL,o.Msg.WORKSPACE_ARIA_LABEL);t.appendChild(r);t=o.createDom_(r,n);var i=new o.BlockDragSurfaceSvg(r),s=new o.WorkspaceDragSurfaceSvg(r),e=o.createMainWorkspace_(t,n,i,s);o.user.keyMap.setKeyMap(n.keyMap);o.init_(e);o.mainWorkspace=e;o.svgResize(e);r.addEventListener("focusin",function(){o.mainWorkspace=e});return e};o.createDom_=function(e,t){e.setAttribute("dir","LTR");o.Component.defaultRightToLeft=t.RTL;o.Css.inject(t.hasCss,t.pathToMedia);e=o.utils.dom.createSvgElement("svg",{xmlns:o.utils.dom.SVG_NS,"xmlns:html":o.utils.dom.HTML_NS,"xmlns:xlink":o.utils.dom.XLINK_NS,version:"1.1",class:"blocklySvg",tabindex:"0"},e);var n=o.utils.dom.createSvgElement("defs",{},e),r=(Math.random()+"").substring(2);t.gridPattern=o.Grid.createDom(r,t.gridOptions,n);return e};o.createMainWorkspace_=function(t,n,r,i){n.parentWorkspace=null;var s=new o.WorkspaceSvg(n,r,i);n=s.options;s.scale=n.zoomOptions.startScale;t.appendChild(s.createDom("blocklyMainBackground"));o.utils.dom.addClass(s.getInjectionDiv(),(n.renderer||"geras")+"-renderer");o.utils.dom.addClass(s.getInjectionDiv(),s.getTheme().name+"-theme");!n.hasCategories&&n.languageTree&&(r=s.addFlyout("svg"),o.utils.dom.insertAfter(r,t));n.hasTrashcan&&s.addTrashcan();n.zoomOptions&&n.zoomOptions.controls&&s.addZoomControls();s.getThemeManager().subscribe(t,"workspaceBackgroundColour","background-color");s.translate(0,0);n.readOnly||s.isMovable()||s.addChangeListener(function(e){if(!s.isDragging()&&!s.isMovable()&&-1!=o.Events.BUMP_EVENTS.indexOf(e.type)){var t=Object.create(null),r=s.getMetrics(),i=s.scale;t.RTL=s.RTL;t.viewLeft=r.viewLeft/i;t.viewTop=r.viewTop/i;t.viewRight=(r.viewLeft+r.viewWidth)/i;t.viewBottom=(r.viewTop+r.viewHeight)/i;s.isContentBounded()?(r=s.getBlocksBoundingBox(),t.contentLeft=r.left,t.contentTop=r.top,t.contentRight=r.right,t.contentBottom=r.bottom):(t.contentLeft=r.contentLeft/i,t.contentTop=r.contentTop/i,t.contentRight=(r.contentLeft+r.contentWidth)/i,t.contentBottom=(r.contentTop+r.contentHeight)/i);if(t.contentTop<t.viewTop||t.contentBottom>t.viewBottom||t.contentLeft<t.viewLeft||t.contentRight>t.viewRight){r=null;e&&(r=o.Events.getGroup(),o.Events.setGroup(e.group));switch(e.type){case o.Events.BLOCK_CREATE:case o.Events.BLOCK_MOVE:var l=s.getBlockById(e.blockId);l&&(l=l.getRootBlock());break;case o.Events.COMMENT_CREATE:case o.Events.COMMENT_MOVE:l=s.getCommentById(e.commentId);}if(l){i=l.getBoundingRectangle();i.height=i.bottom-i.top;i.width=i.right-i.left;var a=t.viewTop,u=t.viewBottom-i.height;u=Math.max(a,u);a=o.utils.math.clamp(a,i.top,u)-i.top;u=t.viewLeft;var g=t.viewRight-i.width;t.RTL?u=Math.min(g,u):g=Math.max(u,g);t=o.utils.math.clamp(u,i.left,g)-i.left;l.moveBy(t,a)}e&&(!e.group&&l&&console.log("WARNING: Moved object in bounds but there was no event group. This may break undo."),null!==r&&o.Events.setGroup(r))}}});o.svgResize(s);o.WidgetDiv.createDom();o.DropDownDiv.createDom();o.Tooltip.createDom();return s};o.init_=function(e){var t=e.options,n=e.getParentSvg();o.bindEventWithChecks_(n.parentNode,"contextmenu",null,function(e){o.utils.isTargetInput(e)||e.preventDefault()});n=o.bindEventWithChecks_(window,"resize",null,function(){o.hideChaff(!0);o.svgResize(e)});e.setResizeHandlerWrapper(n);o.inject.bindDocumentEvents_();if(t.languageTree){n=e.getToolbox();var r=e.getFlyout(!0);n?n.init():r&&(r.init(e),r.show(t.languageTree.childNodes),r.scrollToStart())}n=o.Scrollbar.scrollbarThickness;t.hasTrashcan&&(n=e.trashcan.init(n));t.zoomOptions&&t.zoomOptions.controls&&e.zoomControls_.init(n);t.moveOptions&&t.moveOptions.scrollbars?(e.scrollbar=new o.ScrollbarPair(e),e.scrollbar.resize()):e.setMetrics({x:.5,y:.5});t.hasSounds&&o.inject.loadSounds_(t.pathToMedia,e)};o.inject.bindDocumentEvents_=function(){o.documentEventsBound_||(o.bindEventWithChecks_(document,"scroll",null,function(){for(var e=o.Workspace.getAll(),t=0,n;n=e[t];t++){n.updateInverseScreenCTM&&n.updateInverseScreenCTM()}}),o.bindEventWithChecks_(document,"keydown",null,o.onKeyDown),o.bindEvent_(document,"touchend",null,o.longStop_),o.bindEvent_(document,"touchcancel",null,o.longStop_),o.utils.userAgent.IPAD&&o.bindEventWithChecks_(window,"orientationchange",document,function(){o.svgResize(o.getMainWorkspace())}));o.documentEventsBound_=!0};o.inject.loadSounds_=function(e,t){var n=t.getAudioManager();n.load([e+"click.mp3",e+"click.wav",e+"click.ogg"],"click");n.load([e+"disconnect.wav",e+"disconnect.mp3",e+"disconnect.ogg"],"disconnect");n.load([e+"delete.mp3",e+"delete.ogg",e+"delete.wav"],"delete");var r=[];e=function(){for(;r.length;){o.unbindEvent_(r.pop())}n.preload()};r.push(o.bindEventWithChecks_(document,"mousemove",null,e,!0));r.push(o.bindEventWithChecks_(document,"touchstart",null,e,!0))};o.Names=function(e,t){this.variablePrefix_=t||"";this.reservedDict_=Object.create(null);if(e)for(e=e.split(","),t=0;t<e.length;t++){this.reservedDict_[e[t]]=!0}this.reset()};o.Names.DEVELOPER_VARIABLE_TYPE="DEVELOPER_VARIABLE";o.Names.prototype.reset=function(){this.db_=Object.create(null);this.dbReverse_=Object.create(null);this.variableMap_=null};o.Names.prototype.setVariableMap=function(e){this.variableMap_=e};o.Names.prototype.getNameForUserVariable_=function(e){return this.variableMap_?(e=this.variableMap_.getVariableById(e))?e.name:null:(console.log("Deprecated call to Blockly.Names.prototype.getName without defining a variable map. To fix, add the folowing code in your generator's init() function:\nBlockly.YourGeneratorName.variableDB_.setVariableMap(workspace.getVariableMap());"),null)};o.Names.prototype.getName=function(e,t){if(t==o.VARIABLE_CATEGORY_NAME){var n=this.getNameForUserVariable_(e);n&&(e=n)}n=e.toLowerCase()+"_"+t;var r=t==o.VARIABLE_CATEGORY_NAME||t==o.Names.DEVELOPER_VARIABLE_TYPE?this.variablePrefix_:"";if(n in this.db_)return r+this.db_[n];e=this.getDistinctName(e,t);this.db_[n]=e.substr(r.length);return e};o.Names.prototype.getDistinctName=function(e,t){e=this.safeName_(e);for(var n="";this.dbReverse_[e+n]||e+n in this.reservedDict_;){n=n?n+1:2}e+=n;this.dbReverse_[e]=!0;return(t==o.VARIABLE_CATEGORY_NAME||t==o.Names.DEVELOPER_VARIABLE_TYPE?this.variablePrefix_:"")+e};o.Names.prototype.safeName_=function(e){e?(e=encodeURI(e.replace(/ /g,"_")).replace(/[^\w]/g,"_"),-1!="0123456789".indexOf(e[0])&&(e="my_"+e)):e=o.Msg.UNNAMED_KEY||"unnamed";return e};o.Names.equals=function(e,t){return e.toLowerCase()==t.toLowerCase()};o.Procedures={};o.Procedures.NAME_TYPE=o.PROCEDURE_CATEGORY_NAME;o.Procedures.DEFAULT_ARG="x";o.Procedures.allProcedures=function(t){t=t.getAllBlocks(!1);for(var n=[],r=[],i=0;i<t.length;i++){if(t[i].getProcedureDef){var s=t[i].getProcedureDef();s&&(s[2]?n.push(s):r.push(s))}}r.sort(o.Procedures.procTupleComparator_);n.sort(o.Procedures.procTupleComparator_);return[r,n]};o.Procedures.procTupleComparator_=function(e,t){return e[0].toLowerCase().localeCompare(t[0].toLowerCase())};o.Procedures.findLegalName=function(e,t){if(t.isInFlyout)return e;for(e=e||o.Msg.UNNAMED_KEY||"unnamed";!o.Procedures.isLegalName_(e,t.workspace,t);){var n=e.match(/^(.*?)(\d+)$/);e=n?n[1]+(parseInt(n[2],10)+1):e+"2"}return e};o.Procedures.isLegalName_=function(e,t,n){return!o.Procedures.isNameUsed(e,t,n)};o.Procedures.isNameUsed=function(t,n,r){n=n.getAllBlocks(!1);for(var i=0;i<n.length;i++){if(n[i]!=r&&n[i].getProcedureDef){var s=n[i].getProcedureDef();if(o.Names.equals(s[0],t))return!0}}return!1};o.Procedures.rename=function(e){e=e.trim();var t=o.Procedures.findLegalName(e,this.getSourceBlock()),n=this.getValue();if(n!=e&&n!=t){e=this.getSourceBlock().workspace.getAllBlocks(!1);for(var r=0;r<e.length;r++){e[r].renameProcedure&&e[r].renameProcedure(n,t)}}return t};o.Procedures.flyoutCategory=function(t){function n(t,i){for(var s=0;s<t.length;s++){var l=t[s][0],a=t[s][1],c=o.utils.xml.createElement("block");c.setAttribute("type",i);c.setAttribute("gap",16);var u=o.utils.xml.createElement("mutation");u.setAttribute("name",l);c.appendChild(u);for(l=0;l<a.length;l++){var n=o.utils.xml.createElement("arg");n.setAttribute("name",a[l]);u.appendChild(n)}r.push(c)}}var r=[];if(o.Blocks.procedures_defnoreturn){var i=o.utils.xml.createElement("block");i.setAttribute("type","procedures_defnoreturn");i.setAttribute("gap",16);var s=o.utils.xml.createElement("field");s.setAttribute("name","NAME");s.appendChild(o.utils.xml.createTextNode(o.Msg.PROCEDURES_DEFNORETURN_PROCEDURE));i.appendChild(s);r.push(i)}o.Blocks.procedures_defreturn&&(i=o.utils.xml.createElement("block"),i.setAttribute("type","procedures_defreturn"),i.setAttribute("gap",16),s=o.utils.xml.createElement("field"),s.setAttribute("name","NAME"),s.appendChild(o.utils.xml.createTextNode(o.Msg.PROCEDURES_DEFRETURN_PROCEDURE)),i.appendChild(s),r.push(i));o.Blocks.procedures_ifreturn&&(i=o.utils.xml.createElement("block"),i.setAttribute("type","procedures_ifreturn"),i.setAttribute("gap",16),r.push(i));r.length&&r[r.length-1].setAttribute("gap",24);t=o.Procedures.allProcedures(t);n(t[0],"procedures_callnoreturn");n(t[1],"procedures_callreturn");return r};o.Procedures.updateMutatorFlyout_=function(t){for(var n=[],r=t.getBlocksByType("procedures_mutatorarg",!1),i=0,s;s=r[i];i++){n.push(s.getFieldValue("NAME"))}r=o.utils.xml.createElement("xml");i=o.utils.xml.createElement("block");i.setAttribute("type","procedures_mutatorarg");s=o.utils.xml.createElement("field");s.setAttribute("name","NAME");n=o.Variables.generateUniqueNameFromOptions(o.Procedures.DEFAULT_ARG,n);n=o.utils.xml.createTextNode(n);s.appendChild(n);i.appendChild(s);r.appendChild(i);t.updateToolbox(r)};o.Procedures.mutatorOpenListener=function(e){if(e.type==o.Events.UI&&"mutatorOpen"==e.element&&e.newValue){e=o.Workspace.getById(e.workspaceId).getBlockById(e.blockId);var t=e.type;if("procedures_defnoreturn"==t||"procedures_defreturn"==t)e=e.mutator.getWorkspace(),o.Procedures.updateMutatorFlyout_(e),e.addChangeListener(o.Procedures.mutatorChangeListener_)}};o.Procedures.mutatorChangeListener_=function(e){if(e.type==o.Events.BLOCK_CREATE||e.type==o.Events.BLOCK_DELETE||e.type==o.Events.BLOCK_CHANGE)e=o.Workspace.getById(e.workspaceId),o.Procedures.updateMutatorFlyout_(e)};o.Procedures.getCallers=function(t,n){var r=[];n=n.getAllBlocks(!1);for(var i=0;i<n.length;i++){if(n[i].getProcedureCall){var s=n[i].getProcedureCall();s&&o.Names.equals(s,t)&&r.push(n[i])}}return r};o.Procedures.mutateCallers=function(t){var n=o.Events.recordUndo,r=t.getProcedureDef()[0],i=t.mutationToDom(!0);t=o.Procedures.getCallers(r,t.workspace);r=0;for(var s,l;s=t[r];r++){l=s.mutationToDom();l=l&&o.Xml.domToText(l);s.domToMutation(i);var p=s.mutationToDom();p=p&&o.Xml.domToText(p);l!=p&&(o.Events.recordUndo=!1,o.Events.fire(new o.Events.BlockChange(s,"mutation",null,l,p)),o.Events.recordUndo=n)}};o.Procedures.getDefinition=function(e,t){t=t.getTopBlocks(!1);for(var n=0;n<t.length;n++){if(t[n].getProcedureDef){var r=t[n].getProcedureDef();if(r&&o.Names.equals(r[0],e))return t[n]}}return null};o.VariableModel=function(e,t,n,r){this.workspace=e;this.name=t;this.type=n||"";this.id_=r||o.utils.genUid();o.Events.fire(new o.Events.VarCreate(this))};o.VariableModel.prototype.getId=function(){return this.id_};o.VariableModel.compareByName=function(e,t){e=e.name.toLowerCase();t=t.name.toLowerCase();return e<t?-1:e==t?0:1};o.Variables={};o.Variables.NAME_TYPE=o.VARIABLE_CATEGORY_NAME;o.Variables.allUsedVarModels=function(t){var o=t.getAllBlocks(!1);t=Object.create(null);for(var n=0,r;n<o.length;n++){r=o[n].getVarModels();if(r)for(var i=0;i<r.length;i++){var s=r[i],l=s.getId();l&&(t[l]=s)}}o=[];for(l in t){o.push(t[l])}return o};o.Variables.allUsedVariables=function(){console.warn("Deprecated call to Blockly.Variables.allUsedVariables. Use Blockly.Variables.allUsedVarModels instead.\nIf this is a major issue please file a bug on GitHub.")};o.Variables.ALL_DEVELOPER_VARS_WARNINGS_BY_BLOCK_TYPE_={};o.Variables.allDeveloperVariables=function(t){t=t.getAllBlocks(!1);for(var n=Object.create(null),r=0,i,s;i=t[r];r++){s=i.getDeveloperVariables;!s&&i.getDeveloperVars&&(s=i.getDeveloperVars,o.Variables.ALL_DEVELOPER_VARS_WARNINGS_BY_BLOCK_TYPE_[i.type]||(console.warn("Function getDeveloperVars() deprecated. Use getDeveloperVariables() (block type '"+i.type+"')"),o.Variables.ALL_DEVELOPER_VARS_WARNINGS_BY_BLOCK_TYPE_[i.type]=!0));if(s)for(i=s(),s=0;s<i.length;s++){n[i[s]]=!0}}return Object.keys(n)};o.Variables.flyoutCategory=function(e){var t=[],n=document.createElement("button");n.setAttribute("text","%{BKY_NEW_VARIABLE}");n.setAttribute("callbackKey","CREATE_VARIABLE");e.registerButtonCallback("CREATE_VARIABLE",function(e){o.Variables.createVariableButtonHandler(e.getTargetWorkspace())});t.push(n);e=o.Variables.flyoutCategoryBlocks(e);return t=t.concat(e)};o.Variables.flyoutCategoryBlocks=function(t){t=t.getVariablesOfType("");var n=[];if(0<t.length){var r=t[t.length-1];if(o.Blocks.variables_set){var i=o.utils.xml.createElement("block");i.setAttribute("type","variables_set");i.setAttribute("gap",o.Blocks.math_change?8:24);i.appendChild(o.Variables.generateVariableFieldDom(r));n.push(i)}o.Blocks.math_change&&(i=o.utils.xml.createElement("block"),i.setAttribute("type","math_change"),i.setAttribute("gap",o.Blocks.variables_get?20:8),i.appendChild(o.Variables.generateVariableFieldDom(r)),r=o.Xml.textToDom("<value name=\"DELTA\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value>"),i.appendChild(r),n.push(i));if(o.Blocks.variables_get){t.sort(o.VariableModel.compareByName);r=0;for(var s;s=t[r];r++){i=o.utils.xml.createElement("block"),i.setAttribute("type","variables_get"),i.setAttribute("gap",8),i.appendChild(o.Variables.generateVariableFieldDom(s)),n.push(i)}}}return n};o.Variables.VAR_LETTER_OPTIONS="ijkmnopqrstuvwxyzabcdefgh";o.Variables.generateUniqueName=function(e){return o.Variables.generateUniqueNameFromOptions(o.Variables.VAR_LETTER_OPTIONS.charAt(0),e.getAllVariableNames())};o.Variables.generateUniqueNameFromOptions=function(t,n){if(!n.length)return t;for(var r=o.Variables.VAR_LETTER_OPTIONS,i="",s=r.indexOf(t);;){for(var l=!1,c=0;c<n.length;c++){if(n[c].toLowerCase()==t){l=!0;break}}if(!l)return t;s++;s==r.length&&(s=0,i=+i+1);t=r.charAt(s)+i}};o.Variables.createVariableButtonHandler=function(t,n,r){var i=r||"",s=function(e){o.Variables.promptName(o.Msg.NEW_VARIABLE_TITLE,e,function(e){if(e){var r=o.Variables.nameUsedWithAnyType_(e,t);if(r){if(r.type==i)var l=o.Msg.VARIABLE_ALREADY_EXISTS.replace("%1",r.name);else l=o.Msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE,l=l.replace("%1",r.name).replace("%2",r.type);o.alert(l,function(){s(e)})}else t.createVariable(e,i),n&&n(e)}else n&&n(null)})};s("")};o.Variables.createVariable=o.Variables.createVariableButtonHandler;o.Variables.renameVariable=function(t,n,r){var i=function(s){var e=o.Msg.RENAME_VARIABLE_TITLE.replace("%1",n.name);o.Variables.promptName(e,s,function(s){if(s){var e=o.Variables.nameUsedWithOtherType_(s,n.type,t);e?(e=o.Msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE.replace("%1",e.name).replace("%2",e.type),o.alert(e,function(){i(s)})):(t.renameVariableById(n.getId(),s),r&&r(s))}else r&&r(null)})};i("")};o.Variables.promptName=function(e,t,n){o.prompt(e,t,function(e){e&&(e=e.replace(/[\s\xa0]+/g," ").trim(),e==o.Msg.RENAME_VARIABLE||e==o.Msg.NEW_VARIABLE)&&(e=null);n(e)})};o.Variables.nameUsedWithOtherType_=function(t,o,n){n=n.getVariableMap().getAllVariables();t=t.toLowerCase();for(var r=0,i;i=n[r];r++){if(i.name.toLowerCase()==t&&i.type!=o)return i}return null};o.Variables.nameUsedWithAnyType_=function(e,t){t=t.getVariableMap().getAllVariables();e=e.toLowerCase();for(var o=0,n;n=t[o];o++){if(n.name.toLowerCase()==e)return n}return null};o.Variables.generateVariableFieldDom=function(e){var t=o.utils.xml.createElement("field");t.setAttribute("name","VAR");t.setAttribute("id",e.getId());t.setAttribute("variabletype",e.type);e=o.utils.xml.createTextNode(e.name);t.appendChild(e);return t};o.Variables.getOrCreateVariablePackage=function(t,n,r,i){var s=o.Variables.getVariable(t,n,r,i);s||(s=o.Variables.createVariable_(t,n,r,i));return s};o.Variables.getVariable=function(t,o,n,r){var i=t.getPotentialVariableMap(),e=null;if(o&&(e=t.getVariableById(o),!e&&i&&(e=i.getVariableById(o)),e))return e;if(n){if(void 0==r)throw Error("Tried to look up a variable by name without a type");e=t.getVariable(n,r);!e&&i&&(e=i.getVariable(n,r))}return e};o.Variables.createVariable_=function(t,n,r,i){var s=t.getPotentialVariableMap();r||(r=o.Variables.generateUniqueName(t.isFlyout?t.targetWorkspace:t));return s?s.createVariable(r,i,n):t.createVariable(r,i,n)};o.Variables.getAddedVariables=function(t,o){t=t.getAllVariables();var n=[];if(o.length!=t.length)for(var r=0,i;r<t.length;r++){i=t[r];-1==o.indexOf(i)&&n.push(i)}return n};o.WidgetDiv={};o.WidgetDiv.owner_=null;o.WidgetDiv.dispose_=null;o.WidgetDiv.rendererClassName_=null;o.WidgetDiv.themeClassName_=null;o.WidgetDiv.createDom=function(){o.WidgetDiv.DIV||(o.WidgetDiv.DIV=document.createElement("div"),o.WidgetDiv.DIV.className="blocklyWidgetDiv",document.body.appendChild(o.WidgetDiv.DIV))};o.WidgetDiv.show=function(e,t,n){o.WidgetDiv.hide();o.WidgetDiv.owner_=e;o.WidgetDiv.dispose_=n;e=o.WidgetDiv.DIV;e.style.direction=t?"rtl":"ltr";e.style.display="block";o.WidgetDiv.rendererClassName_=o.getMainWorkspace().getRenderer().name+"-renderer";o.WidgetDiv.themeClassName_=o.getMainWorkspace().getTheme().name+"-theme";o.utils.dom.addClass(e,o.WidgetDiv.rendererClassName_);o.utils.dom.addClass(e,o.WidgetDiv.themeClassName_)};o.WidgetDiv.hide=function(){var e=o.WidgetDiv.DIV;o.WidgetDiv.owner_&&(o.WidgetDiv.owner_=null,e.style.display="none",e.style.left="",e.style.top="",o.WidgetDiv.dispose_&&o.WidgetDiv.dispose_(),o.WidgetDiv.dispose_=null,e.innerHTML="");o.WidgetDiv.rendererClassName_&&(o.utils.dom.removeClass(e,o.WidgetDiv.rendererClassName_),o.WidgetDiv.rendererClassName_=null);o.WidgetDiv.themeClassName_&&(o.utils.dom.removeClass(e,o.WidgetDiv.themeClassName_),o.WidgetDiv.themeClassName_=null);o.getMainWorkspace().markFocused()};o.WidgetDiv.isVisible=function(){return!!o.WidgetDiv.owner_};o.WidgetDiv.hideIfOwner=function(e){o.WidgetDiv.owner_==e&&o.WidgetDiv.hide()};o.WidgetDiv.positionInternal_=function(e,t,n){o.WidgetDiv.DIV.style.left=e+"px";o.WidgetDiv.DIV.style.top=t+"px";o.WidgetDiv.DIV.style.height=n+"px"};o.WidgetDiv.positionWithAnchor=function(t,n,r,i){var s=o.WidgetDiv.calculateY_(t,n,r);t=o.WidgetDiv.calculateX_(t,n,r,i);0>s?o.WidgetDiv.positionInternal_(t,0,r.height+s):o.WidgetDiv.positionInternal_(t,s,r.height)};o.WidgetDiv.calculateX_=function(e,t,o,n){if(n)return t=Math.max(t.right-o.width,e.left),Math.min(t,e.right-o.width);t=Math.min(t.left,e.right-o.width);return Math.max(t,e.left)};o.WidgetDiv.calculateY_=function(e,t,o){return t.bottom+o.height>=e.bottom?t.top-o.height:t.bottom};o.VERSION="3.20200123.1";o.mainWorkspace=null;o.selected=null;o.draggingConnections=[];o.clipboardXml_=null;o.clipboardSource_=null;o.clipboardTypeCounts_=null;o.cache3dSupported_=null;o.svgSize=function(e){return{width:e.cachedWidth_,height:e.cachedHeight_}};o.resizeSvgContents=function(e){e.resizeContents()};o.svgResize=function(e){for(;e.options.parentWorkspace;){e=e.options.parentWorkspace}var t=e.getParentSvg(),o=t.parentNode;if(o){var n=o.offsetWidth;o=o.offsetHeight;t.cachedWidth_!=n&&(t.setAttribute("width",n+"px"),t.cachedWidth_=n);t.cachedHeight_!=o&&(t.setAttribute("height",o+"px"),t.cachedHeight_=o);e.resize()}};o.onKeyDown=function(e){var t=o.mainWorkspace;if(t&&!(o.utils.isTargetInput(e)||t.rendered&&!t.isVisible()))if(t.options.readOnly)o.navigation.onKeyPress(e);else{var n=!1;if(e.keyCode==o.utils.KeyCodes.ESC)o.hideChaff(),o.navigation.onBlocklyAction(o.navigation.ACTION_EXIT);else{if(o.navigation.onKeyPress(e))return;if(e.keyCode==o.utils.KeyCodes.BACKSPACE||e.keyCode==o.utils.KeyCodes.DELETE){e.preventDefault();if(o.Gesture.inProgress())return;o.selected&&o.selected.isDeletable()&&(n=!0)}else if(e.altKey||e.ctrlKey||e.metaKey){if(o.Gesture.inProgress())return;o.selected&&o.selected.isDeletable()&&o.selected.isMovable()&&(e.keyCode==o.utils.KeyCodes.C?(o.hideChaff(),o.copy_(o.selected)):e.keyCode!=o.utils.KeyCodes.X||o.selected.workspace.isFlyout||(o.copy_(o.selected),n=!0));e.keyCode==o.utils.KeyCodes.V?o.clipboardXml_&&(e=o.clipboardSource_,e.isFlyout&&(e=e.targetWorkspace),o.clipboardTypeCounts_&&e.isCapacityAvailable(o.clipboardTypeCounts_)&&(o.Events.setGroup(!0),e.paste(o.clipboardXml_),o.Events.setGroup(!1))):e.keyCode==o.utils.KeyCodes.Z&&(o.hideChaff(),t.undo(e.shiftKey))}}n&&!o.selected.workspace.isFlyout&&(o.Events.setGroup(!0),o.hideChaff(),o.selected.dispose(!0,!0),o.Events.setGroup(!1))}};o.copy_=function(e){if(e.isComment)var t=e.toXmlWithXY();else{t=o.Xml.blockToDom(e,!0);o.Xml.deleteNext(t);var n=e.getRelativeToSurfaceXY();t.setAttribute("x",e.RTL?-n.x:n.x);t.setAttribute("y",n.y)}o.clipboardXml_=t;o.clipboardSource_=e.workspace;o.clipboardTypeCounts_=e.isComment?null:o.utils.getBlockTypeCounts(e,!0)};o.duplicate=function(e){var t=o.clipboardXml_,n=o.clipboardSource_;o.copy_(e);e.workspace.paste(o.clipboardXml_);o.clipboardXml_=t;o.clipboardSource_=n};o.onContextMenu_=function(e){o.utils.isTargetInput(e)||e.preventDefault()};o.hideChaff=function(e){o.Tooltip.hide();o.WidgetDiv.hide();o.DropDownDiv.hideWithoutAnimation();e||(e=o.getMainWorkspace(),e.trashcan&&e.trashcan.flyout&&e.trashcan.flyout.hide(),(e=e.getToolbox())&&e.getFlyout()&&e.getFlyout().autoClose&&e.clearSelection())};o.getMainWorkspace=function(){return o.mainWorkspace};o.alert=function(e,t){alert(e);t&&t()};o.confirm=function(e,t){t(confirm(e))};o.prompt=function(e,t,o){o(prompt(e,t))};o.jsonInitFactory_=function(e){return function(){this.jsonInit(e)}};o.defineBlocksWithJsonArray=function(e){for(var t=0,n;t<e.length;t++){n=e[t];if(n){var r=n.type;null==r||""===r?console.warn("Block definition #"+t+" in JSON array is missing a type attribute. Skipping."):(o.Blocks[r]&&console.warn("Block definition #"+t+" in JSON array overwrites prior definition of \""+r+"\"."),o.Blocks[r]={init:o.jsonInitFactory_(n)})}else console.warn("Block definition #"+t+" in JSON array is "+n+". Skipping.")}};o.bindEventWithChecks_=function(t,r,i,s,a,e){var c=!1,p=function(e){e=o.Touch.splitEventByTouches(e);for(var t=0,n;n=e[t];t++){if(!!a||o.Touch.shouldHandleEvent(n))o.Touch.setClientFromTouch(n),i?s.call(i,n):s(n),c=!0}},d=[];if(o.utils.global.PointerEvent&&r in o.Touch.TOUCH_MAP)for(var u=0,_;_=o.Touch.TOUCH_MAP[r][u];u++){t.addEventListener(_,p,!1),d.push([t,_,p])}else if(t.addEventListener(r,p,!1),d.push([t,r,p]),r in o.Touch.TOUCH_MAP){var h=function(t){p(t);c&&!e&&t.preventDefault()};for(u=0;_=o.Touch.TOUCH_MAP[r][u];u++){t.addEventListener(_,h,!1),d.push([t,_,h])}}return d};o.bindEvent_=function(t,n,r,i){var s=function(e){r?i.call(r,e):i(e)},e=[];if(o.utils.global.PointerEvent&&n in o.Touch.TOUCH_MAP)for(var l=0,a;a=o.Touch.TOUCH_MAP[n][l];l++){t.addEventListener(a,s,!1),e.push([t,a,s])}else if(t.addEventListener(n,s,!1),e.push([t,n,s]),n in o.Touch.TOUCH_MAP){var c=function(e){if(e.changedTouches&&1==e.changedTouches.length){var t=e.changedTouches[0];e.clientX=t.clientX;e.clientY=t.clientY}s(e);e.preventDefault()};for(l=0;a=o.Touch.TOUCH_MAP[n][l];l++){t.addEventListener(a,c,!1),e.push([t,a,c])}}return e};o.unbindEvent_=function(e){for(;e.length;){var t=e.pop(),o=t[2];t[0].removeEventListener(t[1],o,!1)}return o};o.isNumber=function(e){return /^\s*-?\d+(\.\d+)?\s*$/.test(e)};o.hueToHex=function(e){return o.utils.colour.hsvToHex(e,o.HSV_SATURATION,255*o.HSV_VALUE)};o.checkBlockColourConstants=function(){o.checkBlockColourConstant_("LOGIC_HUE",["Blocks","logic","HUE"],void 0);o.checkBlockColourConstant_("LOGIC_HUE",["Constants","Logic","HUE"],210);o.checkBlockColourConstant_("LOOPS_HUE",["Blocks","loops","HUE"],void 0);o.checkBlockColourConstant_("LOOPS_HUE",["Constants","Loops","HUE"],120);o.checkBlockColourConstant_("MATH_HUE",["Blocks","math","HUE"],void 0);o.checkBlockColourConstant_("MATH_HUE",["Constants","Math","HUE"],230);o.checkBlockColourConstant_("TEXTS_HUE",["Blocks","texts","HUE"],void 0);o.checkBlockColourConstant_("TEXTS_HUE",["Constants","Text","HUE"],160);o.checkBlockColourConstant_("LISTS_HUE",["Blocks","lists","HUE"],void 0);o.checkBlockColourConstant_("LISTS_HUE",["Constants","Lists","HUE"],260);o.checkBlockColourConstant_("COLOUR_HUE",["Blocks","colour","HUE"],void 0);o.checkBlockColourConstant_("COLOUR_HUE",["Constants","Colour","HUE"],20);o.checkBlockColourConstant_("VARIABLES_HUE",["Blocks","variables","HUE"],void 0);o.checkBlockColourConstant_("VARIABLES_HUE",["Constants","Variables","HUE"],330);o.checkBlockColourConstant_("VARIABLES_DYNAMIC_HUE",["Constants","VariablesDynamic","HUE"],310);o.checkBlockColourConstant_("PROCEDURES_HUE",["Blocks","procedures","HUE"],void 0)};o.checkBlockColourConstant_=function(t,n,r){for(var i="Blockly",s=o,l=0;l<n.length;++l){i+="."+n[l],s&&(s=s[n[l]])}s&&s!==r&&(t=(void 0===r?"%1 has been removed. Use Blockly.Msg[\"%2\"].":"%1 is deprecated and unused. Override Blockly.Msg[\"%2\"].").replace("%1",i).replace("%2",t),console.warn(t))};o.Icon=function(e){this.block_=e};o.Icon.prototype.collapseHidden=!0;o.Icon.prototype.SIZE=17;o.Icon.prototype.bubble_=null;o.Icon.prototype.iconXY_=null;o.Icon.prototype.createIcon=function(){this.iconGroup_||(this.iconGroup_=o.utils.dom.createSvgElement("g",{class:"blocklyIconGroup"},null),this.block_.isInFlyout&&o.utils.dom.addClass(this.iconGroup_,"blocklyIconGroupReadonly"),this.drawIcon_(this.iconGroup_),this.block_.getSvgRoot().appendChild(this.iconGroup_),o.bindEventWithChecks_(this.iconGroup_,"mouseup",this,this.iconClick_),this.updateEditable())};o.Icon.prototype.dispose=function(){o.utils.dom.removeNode(this.iconGroup_);this.iconGroup_=null;this.setVisible(!1);this.block_=null};o.Icon.prototype.updateEditable=function(){};o.Icon.prototype.isVisible=function(){return!!this.bubble_};o.Icon.prototype.iconClick_=function(e){this.block_.workspace.isDragging()||this.block_.isInFlyout||o.utils.isRightButton(e)||this.setVisible(!this.isVisible())};o.Icon.prototype.applyColour=function(){this.isVisible()&&this.bubble_.setColour(this.block_.style.colourPrimary)};o.Icon.prototype.setIconLocation=function(e){this.iconXY_=e;this.isVisible()&&this.bubble_.setAnchorLocation(e)};o.Icon.prototype.computeIconLocation=function(){var e=this.block_.getRelativeToSurfaceXY(),t=o.utils.getRelativeXY(this.iconGroup_);e=new o.utils.Coordinate(e.x+t.x+this.SIZE/2,e.y+t.y+this.SIZE/2);o.utils.Coordinate.equals(this.getIconLocation(),e)||this.setIconLocation(e)};o.Icon.prototype.getIconLocation=function(){return this.iconXY_};o.Icon.prototype.getCorrectedSize=function(){return new o.utils.Size(o.Icon.prototype.SIZE,o.Icon.prototype.SIZE-2)};o.Warning=function(e){o.Warning.superClass_.constructor.call(this,e);this.createIcon();this.text_={}};o.utils.object.inherits(o.Warning,o.Icon);o.Warning.prototype.collapseHidden=!1;o.Warning.prototype.drawIcon_=function(e){o.utils.dom.createSvgElement("path",{class:"blocklyIconShape",d:"M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z"},e);o.utils.dom.createSvgElement("path",{class:"blocklyIconSymbol",d:"m7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z"},e);o.utils.dom.createSvgElement("rect",{class:"blocklyIconSymbol",x:"7",y:"11",height:"2",width:"2"},e)};o.Warning.textToDom_=function(t){var n=o.utils.dom.createSvgElement("text",{class:"blocklyText blocklyBubbleText blocklyNoPointerEvents",y:o.Bubble.BORDER_WIDTH},null);t=t.split("\n");for(var r=0;r<t.length;r++){var i=o.utils.dom.createSvgElement("tspan",{dy:"1em",x:o.Bubble.BORDER_WIDTH},n),s=document.createTextNode(t[r]);i.appendChild(s)}return n};o.Warning.prototype.setVisible=function(e){e!=this.isVisible()&&(o.Events.fire(new o.Events.Ui(this.block_,"warningOpen",!e,e)),e?this.createBubble():this.disposeBubble())};o.Warning.prototype.createBubble=function(){this.paragraphElement_=o.Warning.textToDom_(this.getText());this.bubble_=new o.Bubble(this.block_.workspace,this.paragraphElement_,this.block_.pathObject.svgPath,this.iconXY_,null,null);this.bubble_.setSvgId(this.block_.id);if(this.block_.RTL)for(var e=this.paragraphElement_.getBBox().width,t=0,n;n=this.paragraphElement_.childNodes[t];t++){n.setAttribute("text-anchor","end"),n.setAttribute("x",e+o.Bubble.BORDER_WIDTH)}this.applyColour()};o.Warning.prototype.disposeBubble=function(){this.bubble_.dispose();this.paragraphElement_=this.body_=this.bubble_=null};o.Warning.prototype.bodyFocus_=function(){this.bubble_.promote()};o.Warning.prototype.setText=function(e,t){this.text_[t]!=e&&(e?this.text_[t]=e:delete this.text_[t],this.isVisible()&&(this.setVisible(!1),this.setVisible(!0)))};o.Warning.prototype.getText=function(){var e=[],t;for(t in this.text_){e.push(this.text_[t])}return e.join("\n")};o.Warning.prototype.dispose=function(){this.block_.warning=null;o.Icon.prototype.dispose.call(this)};o.Comment=function(e){o.Comment.superClass_.constructor.call(this,e);this.model_=e.commentModel;this.model_.text=this.model_.text||"";this.cachedText_="";this.onInputWrapper_=this.onChangeWrapper_=this.onWheelWrapper_=this.onMouseUpWrapper_=null;this.createIcon()};o.utils.object.inherits(o.Comment,o.Icon);o.Comment.prototype.drawIcon_=function(e){o.utils.dom.createSvgElement("circle",{class:"blocklyIconShape",r:"8",cx:"8",cy:"8"},e);o.utils.dom.createSvgElement("path",{class:"blocklyIconSymbol",d:"m6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.4050.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25-1.201,0.998 -1.201,1.528 -1.204,2.19z"},e);o.utils.dom.createSvgElement("rect",{class:"blocklyIconSymbol",x:"6.8",y:"10.78",height:"2",width:"2"},e)};o.Comment.prototype.createEditor_=function(){this.foreignObject_=o.utils.dom.createSvgElement("foreignObject",{x:o.Bubble.BORDER_WIDTH,y:o.Bubble.BORDER_WIDTH},null);var e=document.createElementNS(o.utils.dom.HTML_NS,"body");e.setAttribute("xmlns",o.utils.dom.HTML_NS);e.className="blocklyMinimalBody";var t=this.textarea_=document.createElementNS(o.utils.dom.HTML_NS,"textarea");t.className="blocklyCommentTextarea";t.setAttribute("dir",this.block_.RTL?"RTL":"LTR");t.value=this.model_.text;this.resizeTextarea_();e.appendChild(t);this.foreignObject_.appendChild(e);this.onMouseUpWrapper_=o.bindEventWithChecks_(t,"mouseup",this,this.startEdit_,!0,!0);this.onWheelWrapper_=o.bindEventWithChecks_(t,"wheel",this,function(e){e.stopPropagation()});this.onChangeWrapper_=o.bindEventWithChecks_(t,"change",this,function(){this.cachedText_!=this.model_.text&&o.Events.fire(new o.Events.BlockChange(this.block_,"comment",null,this.cachedText_,this.model_.text))});this.onInputWrapper_=o.bindEventWithChecks_(t,"input",this,function(){this.model_.text=t.value});setTimeout(t.focus.bind(t),0);return this.foreignObject_};o.Comment.prototype.updateEditable=function(){o.Comment.superClass_.updateEditable.call(this);this.isVisible()&&(this.disposeBubble_(),this.createBubble_())};o.Comment.prototype.onBubbleResize_=function(){this.isVisible()&&(this.model_.size=this.bubble_.getBubbleSize(),this.resizeTextarea_())};o.Comment.prototype.resizeTextarea_=function(){var e=this.model_.size,t=2*o.Bubble.BORDER_WIDTH,n=e.width-t;e=e.height-t;this.foreignObject_.setAttribute("width",n);this.foreignObject_.setAttribute("height",e);this.textarea_.style.width=n-4+"px";this.textarea_.style.height=e-4+"px"};o.Comment.prototype.setVisible=function(e){e!=this.isVisible()&&(o.Events.fire(new o.Events.Ui(this.block_,"commentOpen",!e,e)),(this.model_.pinned=e)?this.createBubble_():this.disposeBubble_())};o.Comment.prototype.createBubble_=function(){!this.block_.isEditable()||o.utils.userAgent.IE?this.createNonEditableBubble_():this.createEditableBubble_()};o.Comment.prototype.createEditableBubble_=function(){this.bubble_=new o.Bubble(this.block_.workspace,this.createEditor_(),this.block_.pathObject.svgPath,this.iconXY_,this.model_.size.width,this.model_.size.height);this.bubble_.setSvgId(this.block_.id);this.bubble_.registerResizeEvent(this.onBubbleResize_.bind(this));this.applyColour()};o.Comment.prototype.createNonEditableBubble_=function(){o.Warning.prototype.createBubble.call(this)};o.Comment.prototype.disposeBubble_=function(){this.paragraphElement_?o.Warning.prototype.disposeBubble.call(this):(this.onMouseUpWrapper_&&(o.unbindEvent_(this.onMouseUpWrapper_),this.onMouseUpWrapper_=null),this.onWheelWrapper_&&(o.unbindEvent_(this.onWheelWrapper_),this.onWheelWrapper_=null),this.onChangeWrapper_&&(o.unbindEvent_(this.onChangeWrapper_),this.onChangeWrapper_=null),this.onInputWrapper_&&(o.unbindEvent_(this.onInputWrapper_),this.onInputWrapper_=null),this.bubble_.dispose(),this.foreignObject_=this.textarea_=this.bubble_=null)};o.Comment.prototype.startEdit_=function(){this.bubble_.promote()&&this.textarea_.focus();this.cachedText_=this.model_.text};o.Comment.prototype.getBubbleSize=function(){return this.model_.size};o.Comment.prototype.setBubbleSize=function(e,t){this.bubble_?this.bubble_.setBubbleSize(e,t):(this.model_.size.width=e,this.model_.size.height=t)};o.Comment.prototype.getText=function(){return this.model_.text||""};o.Comment.prototype.setText=function(e){this.model_.text!=e&&(this.model_.text=e,this.updateText())};o.Comment.prototype.updateText=function(){this.textarea_?this.textarea_.value=this.model_.text:this.paragraphElement_&&(this.paragraphElement_.firstChild.textContent=this.model_.text)};o.Comment.prototype.dispose=function(){this.block_.comment=null;o.Icon.prototype.dispose.call(this)};o.Css.register([".blocklyCommentTextarea {","background-color: #fef49c;","border: 0;","outline: 0;","margin: 0;","padding: 3px;","resize: none;","display: block;","overflow: hidden;","}"]);o.FlyoutCursor=function(){o.FlyoutCursor.superClass_.constructor.call(this)};o.utils.object.inherits(o.FlyoutCursor,o.Cursor);o.FlyoutCursor.prototype.onBlocklyAction=function(e){switch(e.name){case o.navigation.actionNames.PREVIOUS:return this.prev(),!0;case o.navigation.actionNames.NEXT:return this.next(),!0;default:return!1;}};o.FlyoutCursor.prototype.next=function(){var e=this.getCurNode();if(!e)return null;(e=e.next())&&this.setCurNode(e);return e};o.FlyoutCursor.prototype.in=function(){return null};o.FlyoutCursor.prototype.prev=function(){var e=this.getCurNode();if(!e)return null;(e=e.prev())&&this.setCurNode(e);return e};o.FlyoutCursor.prototype.out=function(){return null};o.Flyout=function(e){e.getMetrics=this.getMetrics_.bind(this);e.setMetrics=this.setMetrics_.bind(this);this.workspace_=new o.WorkspaceSvg(e);this.workspace_.isFlyout=!0;this.RTL=!!e.RTL;this.toolboxPosition_=e.toolboxPosition;this.eventWrappers_=[];this.mats_=[];this.buttons_=[];this.listeners_=[];this.permanentlyDisabled_=[];this.tabWidth_=this.workspace_.getRenderer().getConstants().TAB_WIDTH};o.Flyout.prototype.autoClose=!0;o.Flyout.prototype.isVisible_=!1;o.Flyout.prototype.containerVisible_=!0;o.Flyout.prototype.CORNER_RADIUS=8;o.Flyout.prototype.MARGIN=o.Flyout.prototype.CORNER_RADIUS;o.Flyout.prototype.GAP_X=3*o.Flyout.prototype.MARGIN;o.Flyout.prototype.GAP_Y=3*o.Flyout.prototype.MARGIN;o.Flyout.prototype.SCROLLBAR_PADDING=2;o.Flyout.prototype.width_=0;o.Flyout.prototype.height_=0;o.Flyout.prototype.dragAngleRange_=70;o.Flyout.prototype.createDom=function(e){this.svgGroup_=o.utils.dom.createSvgElement(e,{class:"blocklyFlyout",style:"display: none"},null);this.svgBackground_=o.utils.dom.createSvgElement("path",{class:"blocklyFlyoutBackground"},this.svgGroup_);this.svgGroup_.appendChild(this.workspace_.createDom());this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutBackgroundColour","fill");this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutOpacity","fill-opacity");this.workspace_.getMarkerManager().setCursor(new o.FlyoutCursor);return this.svgGroup_};o.Flyout.prototype.init=function(e){this.targetWorkspace_=e;this.workspace_.targetWorkspace=e;this.scrollbar_=new o.Scrollbar(this.workspace_,this.horizontalLayout_,!1,"blocklyFlyoutScrollbar");this.hide();Array.prototype.push.apply(this.eventWrappers_,o.bindEventWithChecks_(this.svgGroup_,"wheel",this,this.wheel_));this.autoClose||(this.filterWrapper_=this.filterForCapacity_.bind(this),this.targetWorkspace_.addChangeListener(this.filterWrapper_));Array.prototype.push.apply(this.eventWrappers_,o.bindEventWithChecks_(this.svgBackground_,"mousedown",this,this.onMouseDown_));this.workspace_.getGesture=this.targetWorkspace_.getGesture.bind(this.targetWorkspace_);this.workspace_.setVariableMap(this.targetWorkspace_.getVariableMap());this.workspace_.createPotentialVariableMap()};o.Flyout.prototype.dispose=function(){this.hide();o.unbindEvent_(this.eventWrappers_);this.filterWrapper_&&(this.targetWorkspace_.removeChangeListener(this.filterWrapper_),this.filterWrapper_=null);this.scrollbar_&&(this.scrollbar_.dispose(),this.scrollbar_=null);this.workspace_&&(this.workspace_.getThemeManager().unsubscribe(this.svgBackground_),this.workspace_.targetWorkspace=null,this.workspace_.dispose(),this.workspace_=null);this.svgGroup_&&(o.utils.dom.removeNode(this.svgGroup_),this.svgGroup_=null);this.targetWorkspace_=this.svgBackground_=null};o.Flyout.prototype.getWidth=function(){return this.width_};o.Flyout.prototype.getHeight=function(){return this.height_};o.Flyout.prototype.getWorkspace=function(){return this.workspace_};o.Flyout.prototype.isVisible=function(){return this.isVisible_};o.Flyout.prototype.setVisible=function(e){var t=e!=this.isVisible();this.isVisible_=e;t&&this.updateDisplay_()};o.Flyout.prototype.setContainerVisible=function(e){var t=e!=this.containerVisible_;this.containerVisible_=e;t&&this.updateDisplay_()};o.Flyout.prototype.updateDisplay_=function(){var e=this.containerVisible_?this.isVisible():!1;this.svgGroup_.style.display=e?"block":"none";this.scrollbar_.setContainerVisible(e)};o.Flyout.prototype.positionAt_=function(e,t,n,r){this.svgGroup_.setAttribute("width",e);this.svgGroup_.setAttribute("height",t);"svg"==this.svgGroup_.tagName?o.utils.dom.setCssTransform(this.svgGroup_,"translate("+n+"px,"+r+"px)"):this.svgGroup_.setAttribute("transform","translate("+n+","+r+")");this.scrollbar_&&(this.scrollbar_.setOrigin(n,r),this.scrollbar_.resize(),this.scrollbar_.setPosition_(this.scrollbar_.position_.x,this.scrollbar_.position_.y))};o.Flyout.prototype.hide=function(){if(this.isVisible()){this.setVisible(!1);for(var e=0,t;t=this.listeners_[e];e++){o.unbindEvent_(t)}this.listeners_.length=0;this.reflowWrapper_&&(this.workspace_.removeChangeListener(this.reflowWrapper_),this.reflowWrapper_=null)}};o.Flyout.prototype.show=function(t){this.workspace_.setResizesEnabled(!1);this.hide();this.clearOldBlocks_();if("string"==typeof t){t=this.workspace_.targetWorkspace.getToolboxCategoryCallback(t);if("function"!=typeof t)throw TypeError("Couldn't find a callback function when opening a toolbox category.");t=t(this.workspace_.targetWorkspace);if(!Array.isArray(t))throw TypeError("Result of toolbox category callback must be an array.")}this.setVisible(!0);var n=[],r=[];this.permanentlyDisabled_.length=0;for(var i=this.horizontalLayout_?this.GAP_X:this.GAP_Y,s=0,l;l=t[s];s++){if(l.tagName)switch(l.tagName.toUpperCase()){case"BLOCK":var c=o.Xml.domToBlock(l,this.workspace_);c.isEnabled()||this.permanentlyDisabled_.push(c);n.push({type:"block",block:c});l=parseInt(l.getAttribute("gap"),10);r.push(isNaN(l)?i:l);break;case"SEP":l=parseInt(l.getAttribute("gap"),10);!isNaN(l)&&0<r.length?r[r.length-1]=l:r.push(i);break;case"LABEL":case"BUTTON":c="LABEL"==l.tagName.toUpperCase();if(!o.FlyoutButton)throw Error("Missing require for Blockly.FlyoutButton");l=new o.FlyoutButton(this.workspace_,this.targetWorkspace_,l,c);n.push({type:"button",button:l});r.push(i);}}this.layout_(n,r);this.listeners_.push(o.bindEventWithChecks_(this.svgBackground_,"mouseover",this,function(){for(var e=this.workspace_.getTopBlocks(!1),t=0,o;o=e[t];t++){o.removeSelect()}}));this.horizontalLayout_?this.height_=0:this.width_=0;this.workspace_.setResizesEnabled(!0);this.reflow();this.filterForCapacity_();this.position();this.reflowWrapper_=this.reflow.bind(this);this.workspace_.addChangeListener(this.reflowWrapper_)};o.Flyout.prototype.clearOldBlocks_=function(){for(var e=this.workspace_.getTopBlocks(!1),t=0,n;n=e[t];t++){n.workspace==this.workspace_&&n.dispose(!1,!1)}for(t=0;t<this.mats_.length;t++){(e=this.mats_[t])&&o.utils.dom.removeNode(e)}for(t=this.mats_.length=0;e=this.buttons_[t];t++){e.dispose()}this.buttons_.length=0;this.workspace_.getPotentialVariableMap().clear()};o.Flyout.prototype.addBlockListeners_=function(e,t,n){this.listeners_.push(o.bindEventWithChecks_(e,"mousedown",null,this.blockMouseDown_(t)));this.listeners_.push(o.bindEventWithChecks_(n,"mousedown",null,this.blockMouseDown_(t)));this.listeners_.push(o.bindEvent_(e,"mouseenter",t,t.addSelect));this.listeners_.push(o.bindEvent_(e,"mouseleave",t,t.removeSelect));this.listeners_.push(o.bindEvent_(n,"mouseenter",t,t.addSelect));this.listeners_.push(o.bindEvent_(n,"mouseleave",t,t.removeSelect))};o.Flyout.prototype.blockMouseDown_=function(e){var t=this;return function(o){var n=t.targetWorkspace_.getGesture(o);n&&(n.setStartBlock(e),n.handleFlyoutStart(o,t))}};o.Flyout.prototype.onMouseDown_=function(e){var t=this.targetWorkspace_.getGesture(e);t&&t.handleFlyoutStart(e,this)};o.Flyout.prototype.isBlockCreatable_=function(e){return e.isEnabled()};o.Flyout.prototype.createBlock=function(e){var t=null;o.Events.disable();var n=this.targetWorkspace_.getAllVariables();this.targetWorkspace_.setResizesEnabled(!1);try{t=this.placeNewBlock_(e),o.hideChaff()}finally{o.Events.enable()}e=o.Variables.getAddedVariables(this.targetWorkspace_,n);if(o.Events.isEnabled())for(o.Events.setGroup(!0),o.Events.fire(new o.Events.Create(t)),n=0;n<e.length;n++){o.Events.fire(new o.Events.VarCreate(e[n]))}this.autoClose?this.hide():this.filterForCapacity_();return t};o.Flyout.prototype.initFlyoutButton_=function(e,t,n){var r=e.createDom();e.moveTo(t,n);e.show();this.listeners_.push(o.bindEventWithChecks_(r,"mousedown",this,this.onMouseDown_));this.buttons_.push(e)};o.Flyout.prototype.createRect_=function(t,n,r,i,s){n=o.utils.dom.createSvgElement("rect",{"fill-opacity":0,x:n,y:r,height:i.height,width:i.width},null);n.tooltip=t;o.Tooltip.bindMouseEvents(n);this.workspace_.getCanvas().insertBefore(n,t.getSvgRoot());t.flyoutRect_=n;return this.mats_[s]=n};o.Flyout.prototype.moveRectToBlock_=function(e,t){var o=t.getHeightWidth();e.setAttribute("width",o.width);e.setAttribute("height",o.height);t=t.getRelativeToSurfaceXY();e.setAttribute("y",t.y);e.setAttribute("x",this.RTL?t.x-o.width:t.x)};o.Flyout.prototype.filterForCapacity_=function(){for(var e=this.workspace_.getTopBlocks(!1),t=0,n;n=e[t];t++){if(-1==this.permanentlyDisabled_.indexOf(n))for(var r=this.targetWorkspace_.isCapacityAvailable(o.utils.getBlockTypeCounts(n));n;){n.setEnabled(r),n=n.getNextBlock()}}};o.Flyout.prototype.reflow=function(){this.reflowWrapper_&&this.workspace_.removeChangeListener(this.reflowWrapper_);this.reflowInternal_();this.reflowWrapper_&&this.workspace_.addChangeListener(this.reflowWrapper_)};o.Flyout.prototype.isScrollable=function(){return this.scrollbar_?this.scrollbar_.isVisible():!1};o.Flyout.prototype.placeNewBlock_=function(t){var n=this.targetWorkspace_;if(!t.getSvgRoot())throw Error("oldBlock is not rendered.");var r=o.Xml.blockToDom(t,!0);n.setResizesEnabled(!1);r=o.Xml.domToBlock(r,n);if(!r.getSvgRoot())throw Error("block is not rendered.");var i=n.getOriginOffsetInPixels(),s=this.workspace_.getOriginOffsetInPixels();t=t.getRelativeToSurfaceXY();t.scale(this.workspace_.scale);t=o.utils.Coordinate.sum(s,t);i=o.utils.Coordinate.difference(t,i);i.scale(1/n.scale);r.moveBy(i.x,i.y);return r};o.Flyout.prototype.onBlocklyAction=function(e){return this.workspace_.getCursor().onBlocklyAction(e)};o.HorizontalFlyout=function(e){e.getMetrics=this.getMetrics_.bind(this);e.setMetrics=this.setMetrics_.bind(this);o.HorizontalFlyout.superClass_.constructor.call(this,e);this.horizontalLayout_=!0};o.utils.object.inherits(o.HorizontalFlyout,o.Flyout);o.HorizontalFlyout.prototype.getMetrics_=function(){if(!this.isVisible())return null;try{var t=this.workspace_.getCanvas().getBBox()}catch(o){t={height:0,y:0,width:0,x:0}}var e=this.SCROLLBAR_PADDING,n=this.SCROLLBAR_PADDING;this.toolboxPosition_==o.TOOLBOX_AT_BOTTOM&&(e=0);var r=this.height_;this.toolboxPosition_==o.TOOLBOX_AT_TOP&&(r-=this.SCROLLBAR_PADDING);return{viewHeight:r,viewWidth:this.width_-2*this.SCROLLBAR_PADDING,contentHeight:(t.height+2*this.MARGIN)*this.workspace_.scale,contentWidth:(t.width+2*this.MARGIN)*this.workspace_.scale,viewTop:-this.workspace_.scrollY,viewLeft:-this.workspace_.scrollX,contentTop:0,contentLeft:0,absoluteTop:e,absoluteLeft:n}};o.HorizontalFlyout.prototype.setMetrics_=function(e){var t=this.getMetrics_();t&&("number"==typeof e.x&&(this.workspace_.scrollX=-t.contentWidth*e.x),this.workspace_.translate(this.workspace_.scrollX+t.absoluteLeft,this.workspace_.scrollY+t.absoluteTop))};o.HorizontalFlyout.prototype.position=function(){if(this.isVisible()){var e=this.targetWorkspace_.getMetrics();e&&(this.width_=e.viewWidth,this.setBackgroundPath_(e.viewWidth-2*this.CORNER_RADIUS,this.height_-this.CORNER_RADIUS),this.positionAt_(this.width_,this.height_,0,this.targetWorkspace_.toolboxPosition==this.toolboxPosition_?e.toolboxHeight?this.toolboxPosition_==o.TOOLBOX_AT_TOP?e.toolboxHeight:e.viewHeight-this.height_:this.toolboxPosition_==o.TOOLBOX_AT_TOP?0:e.viewHeight:this.toolboxPosition_==o.TOOLBOX_AT_TOP?0:e.viewHeight+e.absoluteTop-this.height_))}};o.HorizontalFlyout.prototype.setBackgroundPath_=function(e,t){var n=this.toolboxPosition_==o.TOOLBOX_AT_TOP,r=["M 0,"+(n?0:this.CORNER_RADIUS)];n?(r.push("h",e+2*this.CORNER_RADIUS),r.push("v",t),r.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,this.CORNER_RADIUS),r.push("h",-e),r.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,-this.CORNER_RADIUS)):(r.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,-this.CORNER_RADIUS),r.push("h",e),r.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,this.CORNER_RADIUS),r.push("v",t),r.push("h",-e-2*this.CORNER_RADIUS));r.push("z");this.svgBackground_.setAttribute("d",r.join(" "))};o.HorizontalFlyout.prototype.scrollToStart=function(){this.scrollbar_.set(this.RTL?1/0:0)};o.HorizontalFlyout.prototype.wheel_=function(e){var t=o.utils.getScrollDeltaPixels(e),n=t.x||t.y;n&&(t=this.getMetrics_(),n=t.viewLeft+n,n=Math.min(n,t.contentWidth-t.viewWidth),n=Math.max(n,0),this.scrollbar_.set(n),o.WidgetDiv.hide());e.preventDefault();e.stopPropagation()};o.HorizontalFlyout.prototype.layout_=function(t,o){this.workspace_.scale=this.targetWorkspace_.scale;var n=this.MARGIN,r=n+this.tabWidth_;this.RTL&&(t=t.reverse());for(var i=0,s;s=t[i];i++){if("block"==s.type){s=s.block;for(var l=s.getDescendants(!1),c=0,p;p=l[c];c++){p.isInFlyout=!0}s.render();l=s.getSvgRoot();c=s.getHeightWidth();p=s.outputConnection?this.tabWidth_:0;p=this.RTL?r+c.width:r-p;s.moveBy(p,n);p=this.createRect_(s,p,n,c,i);r+=c.width+o[i];this.addBlockListeners_(l,s,p)}else"button"==s.type&&(this.initFlyoutButton_(s.button,r,n),r+=s.button.width+o[i])}};o.HorizontalFlyout.prototype.isDragTowardWorkspace=function(e){e=180*(Math.atan2(e.y,e.x)/Math.PI);var t=this.dragAngleRange_;return e<90+t&&e>90-t||e>-90-t&&e<-90+t?!0:!1};o.HorizontalFlyout.prototype.getClientRect=function(){if(!this.svgGroup_)return null;var e=this.svgGroup_.getBoundingClientRect(),t=e.top;return this.toolboxPosition_==o.TOOLBOX_AT_TOP?new o.utils.Rect(-1E9,t+e.height,-1E9,1E9):new o.utils.Rect(t,1E9,-1E9,1E9)};o.HorizontalFlyout.prototype.reflowInternal_=function(){this.workspace_.scale=this.targetWorkspace_.scale;for(var e=0,t=this.workspace_.getTopBlocks(!1),n=0,r;r=t[n];n++){e=Math.max(e,r.getHeightWidth().height)}e+=1.5*this.MARGIN;e*=this.workspace_.scale;e+=o.Scrollbar.scrollbarThickness;if(this.height_!=e){for(n=0;r=t[n];n++){r.flyoutRect_&&this.moveRectToBlock_(r.flyoutRect_,r)}this.height_=e;this.position()}};o.VerticalFlyout=function(e){e.getMetrics=this.getMetrics_.bind(this);e.setMetrics=this.setMetrics_.bind(this);o.VerticalFlyout.superClass_.constructor.call(this,e);this.horizontalLayout_=!1};o.utils.object.inherits(o.VerticalFlyout,o.Flyout);o.VerticalFlyout.prototype.getMetrics_=function(){if(!this.isVisible())return null;try{var t=this.workspace_.getCanvas().getBBox()}catch(o){t={height:0,y:0,width:0,x:0}}var e=this.SCROLLBAR_PADDING,o=this.height_-2*this.SCROLLBAR_PADDING,n=this.width_;this.RTL||(n-=this.SCROLLBAR_PADDING);return{viewHeight:o,viewWidth:n,contentHeight:t.height*this.workspace_.scale+2*this.MARGIN,contentWidth:t.width*this.workspace_.scale+2*this.MARGIN,viewTop:-this.workspace_.scrollY+t.y,viewLeft:-this.workspace_.scrollX,contentTop:t.y,contentLeft:t.x,absoluteTop:e,absoluteLeft:0}};o.VerticalFlyout.prototype.setMetrics_=function(e){var t=this.getMetrics_();t&&("number"==typeof e.y&&(this.workspace_.scrollY=-t.contentHeight*e.y),this.workspace_.translate(this.workspace_.scrollX+t.absoluteLeft,this.workspace_.scrollY+t.absoluteTop))};o.VerticalFlyout.prototype.position=function(){if(this.isVisible()){var e=this.targetWorkspace_.getMetrics();e&&(this.height_=e.viewHeight,this.setBackgroundPath_(this.width_-this.CORNER_RADIUS,e.viewHeight-2*this.CORNER_RADIUS),this.positionAt_(this.width_,this.height_,this.targetWorkspace_.toolboxPosition==this.toolboxPosition_?e.toolboxWidth?this.toolboxPosition_==o.TOOLBOX_AT_LEFT?e.toolboxWidth:e.viewWidth-this.width_:this.toolboxPosition_==o.TOOLBOX_AT_LEFT?0:e.viewWidth:this.toolboxPosition_==o.TOOLBOX_AT_LEFT?0:e.viewWidth+e.absoluteLeft-this.width_,0))}};o.VerticalFlyout.prototype.setBackgroundPath_=function(e,t){var n=this.toolboxPosition_==o.TOOLBOX_AT_RIGHT,r=e+this.CORNER_RADIUS;r=["M "+(n?r:0)+",0"];r.push("h",n?-e:e);r.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,n?0:1,n?-this.CORNER_RADIUS:this.CORNER_RADIUS,this.CORNER_RADIUS);r.push("v",Math.max(0,t));r.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,n?0:1,n?this.CORNER_RADIUS:-this.CORNER_RADIUS,this.CORNER_RADIUS);r.push("h",n?e:-e);r.push("z");this.svgBackground_.setAttribute("d",r.join(" "))};o.VerticalFlyout.prototype.scrollToStart=function(){this.scrollbar_.set(0)};o.VerticalFlyout.prototype.wheel_=function(e){var t=o.utils.getScrollDeltaPixels(e);if(t.y){var n=this.getMetrics_();t=n.viewTop-n.contentTop+t.y;t=Math.min(t,n.contentHeight-n.viewHeight);t=Math.max(t,0);this.scrollbar_.set(t);o.WidgetDiv.hide()}e.preventDefault();e.stopPropagation()};o.VerticalFlyout.prototype.layout_=function(t,o){this.workspace_.scale=this.targetWorkspace_.scale;for(var n=this.MARGIN,r=this.RTL?n:n+this.tabWidth_,i=0,s;s=t[i];i++){if("block"==s.type){s=s.block;for(var l=s.getDescendants(!1),a=0,p;p=l[a];a++){p.isInFlyout=!0}s.render();l=s.getSvgRoot();a=s.getHeightWidth();p=s.outputConnection?r-this.tabWidth_:r;s.moveBy(p,n);p=this.createRect_(s,this.RTL?p-a.width:p,n,a,i);this.addBlockListeners_(l,s,p);n+=a.height+o[i]}else"button"==s.type&&(this.initFlyoutButton_(s.button,r,n),n+=s.button.height+o[i])}};o.VerticalFlyout.prototype.isDragTowardWorkspace=function(e){e=180*(Math.atan2(e.y,e.x)/Math.PI);var t=this.dragAngleRange_;return e<t&&e>-t||e<-180+t||e>180-t?!0:!1};o.VerticalFlyout.prototype.getClientRect=function(){if(!this.svgGroup_)return null;var e=this.svgGroup_.getBoundingClientRect(),t=e.left;return this.toolboxPosition_==o.TOOLBOX_AT_LEFT?new o.utils.Rect(-1E9,1E9,-1E9,t+e.width):new o.utils.Rect(-1E9,1E9,t,1E9)};o.VerticalFlyout.prototype.reflowInternal_=function(){this.workspace_.scale=this.targetWorkspace_.scale;for(var t=0,n=this.workspace_.getTopBlocks(!1),r=0,i,s;i=n[r];r++){s=i.getHeightWidth().width;i.outputConnection&&(s-=this.tabWidth_);t=Math.max(t,s)}for(r=0;i=this.buttons_[r];r++){t=Math.max(t,i.width)}t+=1.5*this.MARGIN+this.tabWidth_;t*=this.workspace_.scale;t+=o.Scrollbar.scrollbarThickness;if(this.width_!=t){for(r=0;i=n[r];r++){if(this.RTL){s=i.getRelativeToSurfaceXY().x;var l=t/this.workspace_.scale-this.MARGIN;i.outputConnection||(l-=this.tabWidth_);i.moveBy(l-s,0)}i.flyoutRect_&&this.moveRectToBlock_(i.flyoutRect_,i)}if(this.RTL)for(r=0;i=this.buttons_[r];r++){n=i.getPosition().y,i.moveTo(t/this.workspace_.scale-i.width-this.MARGIN-this.tabWidth_,n)}this.width_=t;this.position()}};o.FlyoutButton=function(e,t,n,r){this.workspace_=e;this.targetWorkspace_=t;this.text_=n.getAttribute("text");this.position_=new o.utils.Coordinate(0,0);this.isLabel_=r;this.callbackKey_=n.getAttribute("callbackKey")||n.getAttribute("callbackkey");this.cssClass_=n.getAttribute("web-class")||null;this.onMouseUpWrapper_=null};o.FlyoutButton.MARGIN=5;o.FlyoutButton.prototype.width=0;o.FlyoutButton.prototype.height=0;o.FlyoutButton.prototype.createDom=function(){var e=this.isLabel_?"blocklyFlyoutLabel":"blocklyFlyoutButton";this.cssClass_&&(e+=" "+this.cssClass_);this.svgGroup_=o.utils.dom.createSvgElement("g",{class:e},this.workspace_.getCanvas());if(!this.isLabel_)var t=o.utils.dom.createSvgElement("rect",{class:"blocklyFlyoutButtonShadow",rx:4,ry:4,x:1,y:1},this.svgGroup_);e=o.utils.dom.createSvgElement("rect",{class:this.isLabel_?"blocklyFlyoutLabelBackground":"blocklyFlyoutButtonBackground",rx:4,ry:4},this.svgGroup_);var n=o.utils.dom.createSvgElement("text",{class:this.isLabel_?"blocklyFlyoutLabelText":"blocklyText",x:0,y:0,"text-anchor":"middle"},this.svgGroup_),r=o.utils.replaceMessageReferences(this.text_);this.workspace_.RTL&&(r+="\u200F");n.textContent=r;this.isLabel_&&(this.svgText_=n,this.workspace_.getThemeManager().subscribe(this.svgText_,"flyoutForegroundColour","fill"));this.width=o.utils.dom.getTextWidth(n);this.height=20;this.isLabel_||(this.width+=2*o.FlyoutButton.MARGIN,t.setAttribute("width",this.width),t.setAttribute("height",this.height));e.setAttribute("width",this.width);e.setAttribute("height",this.height);n.setAttribute("x",this.width/2);n.setAttribute("y",this.height-o.FlyoutButton.MARGIN);this.updateTransform_();this.onMouseUpWrapper_=o.bindEventWithChecks_(this.svgGroup_,"mouseup",this,this.onMouseUp_);return this.svgGroup_};o.FlyoutButton.prototype.show=function(){this.updateTransform_();this.svgGroup_.setAttribute("display","block")};o.FlyoutButton.prototype.updateTransform_=function(){this.svgGroup_.setAttribute("transform","translate("+this.position_.x+","+this.position_.y+")")};o.FlyoutButton.prototype.moveTo=function(e,t){this.position_.x=e;this.position_.y=t;this.updateTransform_()};o.FlyoutButton.prototype.getPosition=function(){return this.position_};o.FlyoutButton.prototype.getTargetWorkspace=function(){return this.targetWorkspace_};o.FlyoutButton.prototype.dispose=function(){this.onMouseUpWrapper_&&o.unbindEvent_(this.onMouseUpWrapper_);this.svgGroup_&&o.utils.dom.removeNode(this.svgGroup_);this.svgText_&&this.workspace_.getThemeManager().unsubscribe(this.svgText_)};o.FlyoutButton.prototype.onMouseUp_=function(e){(e=this.targetWorkspace_.getGesture(e))&&e.cancel();this.isLabel_&&this.callbackKey_?console.warn("Labels should not have callbacks. Label text: "+this.text_):this.isLabel_||this.callbackKey_&&this.targetWorkspace_.getButtonCallback(this.callbackKey_)?this.isLabel_||this.targetWorkspace_.getButtonCallback(this.callbackKey_)(this):console.warn("Buttons should have callbacks. Button text: "+this.text_)};o.Css.register([".blocklyFlyoutButton {","fill: #888;","cursor: default;","}",".blocklyFlyoutButtonShadow {","fill: #666;","}",".blocklyFlyoutButton:hover {","fill: #aaa;","}",".blocklyFlyoutLabel {","cursor: default;","}",".blocklyFlyoutLabelBackground {","opacity: 0;","}",".blocklyFlyoutLabelText {","fill: #000;","}"]);o.Generator=function(e){this.name_=e;this.FUNCTION_NAME_PLACEHOLDER_REGEXP_=new RegExp(this.FUNCTION_NAME_PLACEHOLDER_,"g")};o.Generator.NAME_TYPE="generated_function";o.Generator.prototype.INFINITE_LOOP_TRAP=null;o.Generator.prototype.STATEMENT_PREFIX=null;o.Generator.prototype.STATEMENT_SUFFIX=null;o.Generator.prototype.INDENT="  ";o.Generator.prototype.COMMENT_WRAP=60;o.Generator.prototype.ORDER_OVERRIDES=[];o.Generator.prototype.workspaceToCode=function(t){t||(console.warn("No workspace specified in workspaceToCode call.  Guessing."),t=o.getMainWorkspace());var n=[];this.init(t);t=t.getTopBlocks(!0);for(var r=0,i,s;i=t[r];r++){s=this.blockToCode(i);Array.isArray(s)&&(s=s[0]);s&&(i.outputConnection&&(s=this.scrubNakedValue(s),this.STATEMENT_PREFIX&&!i.suppressPrefixSuffix&&(s=this.injectId(this.STATEMENT_PREFIX,i)+s),this.STATEMENT_SUFFIX&&!i.suppressPrefixSuffix&&(s+=this.injectId(this.STATEMENT_SUFFIX,i))),n.push(s))}n=n.join("\n");n=this.finish(n);n=n.replace(/^\s+\n/,"");n=n.replace(/\n\s+$/,"\n");return n=n.replace(/[ \t]+\n/g,"\n")};o.Generator.prototype.prefixLines=function(e,t){return t+e.replace(/(?!\n$)\n/g,"\n"+t)};o.Generator.prototype.allNestedComments=function(e){var t=[];e=e.getDescendants(!0);for(var o=0,n;o<e.length;o++){n=e[o].getCommentText();n&&t.push(n)}t.length&&t.push("");return t.join("\n")};o.Generator.prototype.blockToCode=function(e,t){if(!e)return"";if(!e.isEnabled())return t?"":this.blockToCode(e.getNextBlock());var o=this[e.type];if("function"!=typeof o)throw Error("Language \""+this.name_+"\" does not know how to generate  code for block type \""+e.type+"\".");o=o.call(e,e);if(Array.isArray(o)){if(!e.outputConnection)throw TypeError("Expecting string from statement block: "+e.type);return[this.scrub_(e,o[0],t),o[1]]}if("string"==typeof o)return this.STATEMENT_PREFIX&&!e.suppressPrefixSuffix&&(o=this.injectId(this.STATEMENT_PREFIX,e)+o),this.STATEMENT_SUFFIX&&!e.suppressPrefixSuffix&&(o+=this.injectId(this.STATEMENT_SUFFIX,e)),this.scrub_(e,o,t);if(null===o)return"";throw SyntaxError("Invalid code generated: "+o)};o.Generator.prototype.valueToCode=function(t,o,n){if(isNaN(n))throw TypeError("Expecting valid order from block: "+t.type);var r=t.getInputTargetBlock(o);if(!r)return"";o=this.blockToCode(r);if(""===o)return"";if(!Array.isArray(o))throw TypeError("Expecting tuple from value block: "+r.type);t=o[0];o=o[1];if(isNaN(o))throw TypeError("Expecting valid order from value block: "+r.type);if(!t)return"";r=!1;var i=Math.floor(n),s=Math.floor(o);if(i<=s&&(i!=s||0!=i&&99!=i))for(r=!0,i=0;i<this.ORDER_OVERRIDES.length;i++){if(this.ORDER_OVERRIDES[i][0]==n&&this.ORDER_OVERRIDES[i][1]==o){r=!1;break}}r&&(t="("+t+")");return t};o.Generator.prototype.statementToCode=function(e,t){e=e.getInputTargetBlock(t);t=this.blockToCode(e);if("string"!=typeof t)throw TypeError("Expecting code from statement block: "+(e&&e.type));t&&(t=this.prefixLines(t,this.INDENT));return t};o.Generator.prototype.addLoopTrap=function(e,t){this.INFINITE_LOOP_TRAP&&(e=this.prefixLines(this.injectId(this.INFINITE_LOOP_TRAP,t),this.INDENT)+e);this.STATEMENT_SUFFIX&&!t.suppressPrefixSuffix&&(e=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+e);this.STATEMENT_PREFIX&&!t.suppressPrefixSuffix&&(e+=this.prefixLines(this.injectId(this.STATEMENT_PREFIX,t),this.INDENT));return e};o.Generator.prototype.injectId=function(e,t){t=t.id.replace(/\$/g,"$$$$");return e.replace(/%1/g,"'"+t+"'")};o.Generator.prototype.RESERVED_WORDS_="";o.Generator.prototype.addReservedWords=function(e){this.RESERVED_WORDS_+=e+","};o.Generator.prototype.FUNCTION_NAME_PLACEHOLDER_="{leCUI8hutHZI4480Dc}";o.Generator.prototype.provideFunction_=function(e,t){if(!this.definitions_[e]){var n=this.variableDB_.getDistinctName(e,o.PROCEDURE_CATEGORY_NAME);this.functionNames_[e]=n;t=t.join("\n").replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_,n);for(var r;r!=t;){r=t,t=t.replace(/^(( {2})*) {2}/gm,"$1\0")}t=t.replace(/\0/g,this.INDENT);this.definitions_[e]=t}return this.functionNames_[e]};o.Generator.prototype.init=function(){};o.Generator.prototype.scrub_=function(e,t){return t};o.Generator.prototype.finish=function(e){return e};o.Generator.prototype.scrubNakedValue=function(e){return e};o.tree={};o.tree.BaseNode=function(e,t){o.Component.call(this);this.config_=t;this.content_=e;this.expanded_=this.selected_=!1;this.toolTip_=null;this.isUserCollapsible_=!0;this.depth_=-1};o.utils.object.inherits(o.tree.BaseNode,o.Component);o.tree.BaseNode.allNodes={};o.tree.BaseNode.prototype.disposeInternal=function(){o.tree.BaseNode.superClass_.disposeInternal.call(this);this.tree&&(this.tree=null);this.setElementInternal(null)};o.tree.BaseNode.prototype.initAccessibility=function(){var e=this.getElement();if(e){var t=this.getLabelElement();t&&!t.id&&(t.id=this.getId()+".label");o.utils.aria.setRole(e,o.utils.aria.Role.TREEITEM);o.utils.aria.setState(e,o.utils.aria.State.SELECTED,!1);o.utils.aria.setState(e,o.utils.aria.State.LEVEL,this.getDepth());t&&o.utils.aria.setState(e,o.utils.aria.State.LABELLEDBY,t.id);(t=this.getIconElement())&&o.utils.aria.setRole(t,o.utils.aria.Role.PRESENTATION);if(t=this.getChildrenElement())if(o.utils.aria.setRole(t,o.utils.aria.Role.GROUP),t.hasChildNodes())for(o.utils.aria.setState(e,o.utils.aria.State.EXPANDED,!1),e=this.getChildCount(),t=1;t<=e;t++){var n=this.getChildAt(t-1).getElement();o.utils.aria.setState(n,o.utils.aria.State.SETSIZE,e);o.utils.aria.setState(n,o.utils.aria.State.POSINSET,t)}}};o.tree.BaseNode.prototype.createDom=function(){var e=document.createElement("div");e.appendChild(this.toDom());this.setElementInternal(e)};o.tree.BaseNode.prototype.enterDocument=function(){o.tree.BaseNode.superClass_.enterDocument.call(this);o.tree.BaseNode.allNodes[this.getId()]=this;this.initAccessibility()};o.tree.BaseNode.prototype.exitDocument=function(){o.tree.BaseNode.superClass_.exitDocument.call(this);delete o.tree.BaseNode.allNodes[this.getId()]};o.tree.BaseNode.prototype.addChildAt=function(t,n){var r=this.getChildAt(n-1),i=this.getChildAt(n);o.tree.BaseNode.superClass_.addChildAt.call(this,t,n);t.previousSibling_=r;t.nextSibling_=i;r?r.nextSibling_=t:this.firstChild_=t;i?i.previousSibling_=t:this.lastChild_=t;(n=this.getTree())&&t.setTreeInternal(n);t.setDepth_(this.getDepth()+1);if(n=this.getElement())if(this.updateExpandIcon(),o.utils.aria.setState(n,o.utils.aria.State.EXPANDED,this.getExpanded()),this.getExpanded()){n=this.getChildrenElement();t.getElement()||t.createDom();var s=t.getElement(),e=i&&i.getElement();n.insertBefore(s,e);this.isInDocument()&&t.enterDocument();i||(r?r.updateExpandIcon():(o.utils.style.setElementShown(n,!0),this.setExpanded(this.getExpanded())))}};o.tree.BaseNode.prototype.add=function(e){if(e.getParent())throw Error(o.Component.Error.PARENT_UNABLE_TO_BE_SET);this.addChildAt(e,this.getChildCount())};o.tree.BaseNode.prototype.getTree=function(){return null};o.tree.BaseNode.prototype.getDepth=function(){var e=this.depth_;0>e&&(e=this.computeDepth_(),this.setDepth_(e));return e};o.tree.BaseNode.prototype.computeDepth_=function(){var e=this.getParent();return e?e.getDepth()+1:0};o.tree.BaseNode.prototype.setDepth_=function(e){if(e!=this.depth_){this.depth_=e;var t=this.getRowElement();if(t){var o=this.getPixelIndent_()+"px";this.isRightToLeft()?t.style.paddingRight=o:t.style.paddingLeft=o}this.forEachChild(function(t){t.setDepth_(e+1)})}};o.tree.BaseNode.prototype.contains=function(e){for(;e;){if(e==this)return!0;e=e.getParent()}return!1};o.tree.BaseNode.prototype.getChildren=function(){var e=[];this.forEachChild(function(t){e.push(t)});return e};o.tree.BaseNode.prototype.getFirstChild=function(){return this.getChildAt(0)};o.tree.BaseNode.prototype.getLastChild=function(){return this.getChildAt(this.getChildCount()-1)};o.tree.BaseNode.prototype.getPreviousSibling=function(){return this.previousSibling_};o.tree.BaseNode.prototype.getNextSibling=function(){return this.nextSibling_};o.tree.BaseNode.prototype.isLastSibling=function(){return!this.nextSibling_};o.tree.BaseNode.prototype.isSelected=function(){return this.selected_};o.tree.BaseNode.prototype.select=function(){var e=this.getTree();e&&e.setSelectedItem(this)};o.tree.BaseNode.prototype.selectFirst=function(){var e=this.getTree();e&&this.firstChild_&&e.setSelectedItem(this.firstChild_)};o.tree.BaseNode.prototype.setSelectedInternal=function(e){if(this.selected_!=e){this.selected_=e;this.updateRow();var t=this.getElement();t&&(o.utils.aria.setState(t,o.utils.aria.State.SELECTED,e),e&&(e=this.getTree().getElement(),o.utils.aria.setState(e,o.utils.aria.State.ACTIVEDESCENDANT,this.getId())))}};o.tree.BaseNode.prototype.getExpanded=function(){return this.expanded_};o.tree.BaseNode.prototype.setExpandedInternal=function(e){this.expanded_=e};o.tree.BaseNode.prototype.setExpanded=function(t){var n=t!=this.expanded_,r;this.expanded_=t;var i=this.getTree(),s=this.getElement();if(this.hasChildren()){if(!t&&i&&this.contains(i.getSelectedItem())&&this.select(),s){if(r=this.getChildrenElement())o.utils.style.setElementShown(r,t),o.utils.aria.setState(s,o.utils.aria.State.EXPANDED,t),t&&this.isInDocument()&&!r.hasChildNodes()&&(this.forEachChild(function(e){r.appendChild(e.toDom())}),this.forEachChild(function(e){e.enterDocument()}));this.updateExpandIcon()}}else(r=this.getChildrenElement())&&o.utils.style.setElementShown(r,!1);s&&this.updateIcon_();n&&(t?this.doNodeExpanded():this.doNodeCollapsed())};o.tree.BaseNode.prototype.doNodeExpanded=function(){};o.tree.BaseNode.prototype.doNodeCollapsed=function(){};o.tree.BaseNode.prototype.toggle=function(){this.setExpanded(!this.getExpanded())};o.tree.BaseNode.prototype.isUserCollapsible=function(){return this.isUserCollapsible_};o.tree.BaseNode.prototype.toDom=function(){var e=this.getExpanded()&&this.hasChildren(),t=document.createElement("div");t.style.backgroundPosition=this.getBackgroundPosition();e||(t.style.display="none");e&&this.forEachChild(function(e){t.appendChild(e.toDom())});e=document.createElement("div");e.id=this.getId();e.appendChild(this.getRowDom());e.appendChild(t);return e};o.tree.BaseNode.prototype.getPixelIndent_=function(){return Math.max(0,(this.getDepth()-1)*this.config_.indentWidth)};o.tree.BaseNode.prototype.getRowDom=function(){var e=document.createElement("div");e.className=this.getRowClassName();e.style["padding-"+(this.isRightToLeft()?"right":"left")]=this.getPixelIndent_()+"px";e.appendChild(this.getIconDom());e.appendChild(this.getLabelDom());return e};o.tree.BaseNode.prototype.getRowClassName=function(){var e="";this.isSelected()&&(e=" "+(this.config_.cssSelectedRow||""));return this.config_.cssTreeRow+e};o.tree.BaseNode.prototype.getLabelDom=function(){var e=document.createElement("span");e.className=this.config_.cssItemLabel||"";e.textContent=this.getText();return e};o.tree.BaseNode.prototype.getIconDom=function(){var e=document.createElement("span");e.style.display="inline-block";e.className=this.getCalculatedIconClass();return e};o.tree.BaseNode.prototype.getCalculatedIconClass=function(){throw Error("unimplemented abstract method")};o.tree.BaseNode.prototype.getBackgroundPosition=function(){return(this.isLastSibling()?"-100":(this.getDepth()-1)*this.config_.indentWidth)+"px 0"};o.tree.BaseNode.prototype.getElement=function(){var e=o.tree.BaseNode.superClass_.getElement.call(this);e||(e=document.getElementById(this.getId()),this.setElementInternal(e));return e};o.tree.BaseNode.prototype.getRowElement=function(){var e=this.getElement();return e?e.firstChild:null};o.tree.BaseNode.prototype.getIconElement=function(){var e=this.getRowElement();return e?e.firstChild:null};o.tree.BaseNode.prototype.getLabelElement=function(){var e=this.getRowElement();return e&&e.lastChild?e.lastChild.previousSibling:null};o.tree.BaseNode.prototype.getChildrenElement=function(){var e=this.getElement();return e?e.lastChild:null};o.tree.BaseNode.prototype.getIconClass=function(){return this.iconClass_};o.tree.BaseNode.prototype.getExpandedIconClass=function(){return this.expandedIconClass_};o.tree.BaseNode.prototype.setText=function(e){this.content_=e};o.tree.BaseNode.prototype.getText=function(){return this.content_};o.tree.BaseNode.prototype.updateRow=function(){var e=this.getRowElement();e&&(e.className=this.getRowClassName())};o.tree.BaseNode.prototype.updateExpandIcon=function(){var e=this.getChildrenElement();e&&(e.style.backgroundPosition=this.getBackgroundPosition())};o.tree.BaseNode.prototype.updateIcon_=function(){this.getIconElement().className=this.getCalculatedIconClass()};o.tree.BaseNode.prototype.onMouseDown=function(e){"expand"==e.target.getAttribute("type")&&this.hasChildren()?this.isUserCollapsible_&&this.toggle():(this.select(),this.updateRow())};o.tree.BaseNode.prototype.onClick_=function(e){e.preventDefault()};o.tree.BaseNode.prototype.onKeyDown=function(e){var t=!0;switch(e.keyCode){case o.utils.KeyCodes.RIGHT:if(e.altKey)break;t=this.selectChild();break;case o.utils.KeyCodes.LEFT:if(e.altKey)break;t=this.selectParent();break;case o.utils.KeyCodes.DOWN:t=this.selectNext();break;case o.utils.KeyCodes.UP:t=this.selectPrevious();break;default:t=!1;}t&&e.preventDefault();return t};o.tree.BaseNode.prototype.selectNext=function(){var e=this.getNextShownNode();e&&e.select();return!0};o.tree.BaseNode.prototype.selectPrevious=function(){var e=this.getPreviousShownNode();e&&e.select();return!0};o.tree.BaseNode.prototype.selectParent=function(){if(this.hasChildren()&&this.getExpanded()&&this.isUserCollapsible_)this.setExpanded(!1);else{var e=this.getParent(),t=this.getTree();e&&e!=t&&e.select()}return!0};o.tree.BaseNode.prototype.selectChild=function(){return this.hasChildren()?(this.getExpanded()?this.getFirstChild().select():this.setExpanded(!0),!0):!1};o.tree.BaseNode.prototype.getLastShownDescendant=function(){return this.getExpanded()&&this.hasChildren()?this.getLastChild().getLastShownDescendant():this};o.tree.BaseNode.prototype.getNextShownNode=function(){if(this.hasChildren()&&this.getExpanded())return this.getFirstChild();for(var e=this,t;e!=this.getTree();){t=e.getNextSibling();if(null!=t)return t;e=e.getParent()}return null};o.tree.BaseNode.prototype.getPreviousShownNode=function(){var e=this.getPreviousSibling();if(null!=e)return e.getLastShownDescendant();e=this.getParent();var t=this.getTree();return e==t||this==t?null:e};o.tree.BaseNode.prototype.getConfig=function(){return this.config_};o.tree.BaseNode.prototype.setTreeInternal=function(e){this.tree!=e&&(this.tree=e,this.forEachChild(function(t){t.setTreeInternal(e)}))};o.tree.TreeNode=function(e,t,n){this.toolbox_=e;o.tree.BaseNode.call(this,t,n)};o.utils.object.inherits(o.tree.TreeNode,o.tree.BaseNode);o.tree.TreeNode.prototype.getTree=function(){if(this.tree)return this.tree;var e=this.getParent();return e&&(e=e.getTree())?(this.setTreeInternal(e),e):null};o.tree.TreeNode.prototype.getCalculatedIconClass=function(){var e=this.getExpanded(),t=this.getExpandedIconClass();if(e&&t)return t;t=this.getIconClass();if(!e&&t)return t;t=this.getConfig();if(this.hasChildren()){if(e&&t.cssExpandedFolderIcon)return t.cssTreeIcon+" "+t.cssExpandedFolderIcon;if(!e&&t.cssCollapsedFolderIcon)return t.cssTreeIcon+" "+t.cssCollapsedFolderIcon}else if(t.cssFileIcon)return t.cssTreeIcon+" "+t.cssFileIcon;return""};o.tree.TreeNode.prototype.onClick_=function(){this.hasChildren()&&this.isUserCollapsible()?(this.toggle(),this.select()):this.isSelected()?this.getTree().setSelectedItem(null):this.select();this.updateRow()};o.tree.TreeNode.prototype.onMouseDown=function(){};o.tree.TreeNode.prototype.onKeyDown=function(e){if(this.tree.toolbox_.horizontalLayout_){var t={},n=o.utils.KeyCodes.DOWN,r=o.utils.KeyCodes.UP;t[o.utils.KeyCodes.RIGHT]=this.isRightToLeft()?r:n;t[o.utils.KeyCodes.LEFT]=this.isRightToLeft()?n:r;t[o.utils.KeyCodes.UP]=o.utils.KeyCodes.LEFT;t[o.utils.KeyCodes.DOWN]=o.utils.KeyCodes.RIGHT;Object.defineProperties(e,{keyCode:{value:t[e.keyCode]||e.keyCode}})}return o.tree.TreeNode.superClass_.onKeyDown.call(this,e)};o.tree.TreeNode.prototype.onSizeChanged=function(e){this.onSizeChanged_=e};o.tree.TreeNode.prototype.resizeToolbox_=function(){this.onSizeChanged_&&this.onSizeChanged_.call(this.toolbox_)};o.tree.TreeNode.prototype.doNodeExpanded=o.tree.TreeNode.prototype.resizeToolbox_;o.tree.TreeNode.prototype.doNodeCollapsed=o.tree.TreeNode.prototype.resizeToolbox_;o.tree.TreeControl=function(e,t){this.toolbox_=e;this.onKeydownWrapper_=this.onClickWrapper_=this.onBlurWrapper_=this.onFocusWrapper_=null;o.tree.BaseNode.call(this,"",t);this.setExpandedInternal(!0);this.setSelectedInternal(!0);this.selectedItem_=this};o.utils.object.inherits(o.tree.TreeControl,o.tree.BaseNode);o.tree.TreeControl.prototype.getTree=function(){return this};o.tree.TreeControl.prototype.getToolbox=function(){return this.toolbox_};o.tree.TreeControl.prototype.getDepth=function(){return 0};o.tree.TreeControl.prototype.handleFocus_=function(e){this.focused_=!0;e=this.getElement();o.utils.dom.addClass(e,"focused");this.selectedItem_&&this.selectedItem_.select()};o.tree.TreeControl.prototype.handleBlur_=function(e){this.focused_=!1;e=this.getElement();o.utils.dom.removeClass(e,"focused")};o.tree.TreeControl.prototype.hasFocus=function(){return this.focused_};o.tree.TreeControl.prototype.getExpanded=function(){return!0};o.tree.TreeControl.prototype.setExpanded=function(e){this.setExpandedInternal(e)};o.tree.TreeControl.prototype.getIconElement=function(){var e=this.getRowElement();return e?e.firstChild:null};o.tree.TreeControl.prototype.updateExpandIcon=function(){};o.tree.TreeControl.prototype.getRowClassName=function(){return o.tree.TreeControl.superClass_.getRowClassName.call(this)+" "+this.getConfig().cssHideRoot};o.tree.TreeControl.prototype.getCalculatedIconClass=function(){var e=this.getExpanded(),t=this.getExpandedIconClass();if(e&&t)return t;t=this.getIconClass();if(!e&&t)return t;t=this.getConfig();return e&&t.cssExpandedRootIcon?t.cssTreeIcon+" "+t.cssExpandedRootIcon:""};o.tree.TreeControl.prototype.setSelectedItem=function(e){if(e!=this.selectedItem_&&(!this.onBeforeSelected_||this.onBeforeSelected_.call(this.toolbox_,e))){var t=this.getSelectedItem();this.selectedItem_&&this.selectedItem_.setSelectedInternal(!1);(this.selectedItem_=e)&&e.setSelectedInternal(!0);this.onAfterSelected_&&this.onAfterSelected_.call(this.toolbox_,t,e)}};o.tree.TreeControl.prototype.onBeforeSelected=function(e){this.onBeforeSelected_=e};o.tree.TreeControl.prototype.onAfterSelected=function(e){this.onAfterSelected_=e};o.tree.TreeControl.prototype.getSelectedItem=function(){return this.selectedItem_};o.tree.TreeControl.prototype.initAccessibility=function(){o.tree.TreeControl.superClass_.initAccessibility.call(this);var e=this.getElement();o.utils.aria.setRole(e,o.utils.aria.Role.TREE);o.utils.aria.setState(e,o.utils.aria.State.LABELLEDBY,this.getLabelElement().id)};o.tree.TreeControl.prototype.enterDocument=function(){o.tree.TreeControl.superClass_.enterDocument.call(this);var e=this.getElement();e.className=this.getConfig().cssRoot;e.setAttribute("hideFocus","true");this.attachEvents_();this.initAccessibility()};o.tree.TreeControl.prototype.exitDocument=function(){o.tree.TreeControl.superClass_.exitDocument.call(this);this.detachEvents_()};o.tree.TreeControl.prototype.attachEvents_=function(){var e=this.getElement();e.tabIndex=0;this.onFocusWrapper_=o.bindEvent_(e,"focus",this,this.handleFocus_);this.onBlurWrapper_=o.bindEvent_(e,"blur",this,this.handleBlur_);this.onClickWrapper_=o.bindEventWithChecks_(e,"click",this,this.handleMouseEvent_);this.onKeydownWrapper_=o.bindEvent_(e,"keydown",this,this.handleKeyEvent_)};o.tree.TreeControl.prototype.detachEvents_=function(){this.onFocusWrapper_&&(o.unbindEvent_(this.onFocusWrapper_),this.onFocusWrapper_=null);this.onBlurWrapper_&&(o.unbindEvent_(this.onBlurWrapper_),this.onBlurWrapper_=null);this.onClickWrapper_&&(o.unbindEvent_(this.onClickWrapper_),this.onClickWrapper_=null);this.onKeydownWrapper_&&(o.unbindEvent_(this.onKeydownWrapper_),this.onKeydownWrapper_=null)};o.tree.TreeControl.prototype.handleMouseEvent_=function(e){var t=this.getNodeFromEvent_(e);if(t)switch(e.type){case"mousedown":t.onMouseDown(e);break;case"click":t.onClick_(e);}};o.tree.TreeControl.prototype.handleKeyEvent_=function(e){var t=!1;if(t=this.selectedItem_&&this.selectedItem_.onKeyDown(e)||t)o.utils.style.scrollIntoContainerView(this.selectedItem_.getElement(),this.getElement().parentNode),e.preventDefault();return t};o.tree.TreeControl.prototype.getNodeFromEvent_=function(e){for(var t=e.target;null!=t;){if(e=o.tree.BaseNode.allNodes[t.id])return e;if(t==this.getElement())break;t=t.parentNode}return null};o.tree.TreeControl.prototype.createNode=function(e){return new o.tree.TreeNode(this.toolbox_,e||"",this.getConfig())};o.Toolbox=function(e){this.workspace_=e;this.RTL=e.options.RTL;this.horizontalLayout_=e.options.horizontalLayout;this.toolboxPosition=e.options.toolboxPosition;this.config_={indentWidth:19,cssRoot:"blocklyTreeRoot",cssHideRoot:"blocklyHidden",cssTreeRow:"blocklyTreeRow",cssItemLabel:"blocklyTreeLabel",cssTreeIcon:"blocklyTreeIcon",cssExpandedFolderIcon:"blocklyTreeIconOpen",cssFileIcon:"blocklyTreeIconNone",cssSelectedRow:"blocklyTreeSelected"};this.treeSeparatorConfig_={cssTreeRow:"blocklyTreeSeparator"};this.horizontalLayout_&&(this.config_.cssTreeRow+=e.RTL?" blocklyHorizontalTreeRtl":" blocklyHorizontalTree",this.treeSeparatorConfig_.cssTreeRow="blocklyTreeSeparatorHorizontal "+(e.RTL?"blocklyHorizontalTreeRtl":"blocklyHorizontalTree"),this.config_.cssTreeIcon="");this.flyout_=null};o.Toolbox.prototype.width=0;o.Toolbox.prototype.height=0;o.Toolbox.prototype.selectedOption_=null;o.Toolbox.prototype.lastCategory_=null;o.Toolbox.prototype.init=function(){var e=this.workspace_,t=this.workspace_.getParentSvg();this.HtmlDiv=document.createElement("div");this.HtmlDiv.className="blocklyToolboxDiv blocklyNonSelectable";this.HtmlDiv.setAttribute("dir",e.RTL?"RTL":"LTR");t.parentNode.insertBefore(this.HtmlDiv,t);var n=e.getThemeManager();n.subscribe(this.HtmlDiv,"toolboxBackgroundColour","background-color");n.subscribe(this.HtmlDiv,"toolboxForegroundColour","color");o.bindEventWithChecks_(this.HtmlDiv,"mousedown",this,function(e){o.utils.isRightButton(e)||e.target==this.HtmlDiv?o.hideChaff(!1):o.hideChaff(!0);o.Touch.clearTouchIdentifier()},!1,!0);n=new o.Options({parentWorkspace:e,rtl:e.RTL,oneBasedIndex:e.options.oneBasedIndex,horizontalLayout:e.horizontalLayout,renderer:e.options.renderer});n.toolboxPosition=e.options.toolboxPosition;if(e.horizontalLayout){if(!o.HorizontalFlyout)throw Error("Missing require for Blockly.HorizontalFlyout");this.flyout_=new o.HorizontalFlyout(n)}else{if(!o.VerticalFlyout)throw Error("Missing require for Blockly.VerticalFlyout");this.flyout_=new o.VerticalFlyout(n)}if(!this.flyout_)throw Error("One of Blockly.VerticalFlyout or Blockly.Horizontal must berequired.");o.utils.dom.insertAfter(this.flyout_.createDom("svg"),t);this.flyout_.init(e);this.config_.cleardotPath=e.options.pathToMedia+"1x1.gif";this.config_.cssCollapsedFolderIcon="blocklyTreeIconClosed"+(e.RTL?"Rtl":"Ltr");this.renderTree(e.options.languageTree)};o.Toolbox.prototype.renderTree=function(e){this.tree_&&(this.tree_.dispose(),this.lastCategory_=null);var t=new o.tree.TreeControl(this,this.config_);this.tree_=t;t.setSelectedItem(null);t.onBeforeSelected(this.handleBeforeTreeSelected_);t.onAfterSelected(this.handleAfterTreeSelected_);var n=null;if(e){this.tree_.blocks=[];this.hasColours_=!1;n=this.syncTrees_(e,this.tree_,this.workspace_.options.pathToMedia);if(this.tree_.blocks.length)throw Error("Toolbox cannot have both blocks and categories in the root level.");this.workspace_.resizeContents()}t.render(this.HtmlDiv);n&&t.setSelectedItem(n);this.addColour_();this.position();this.horizontalLayout_&&o.utils.aria.setState(this.tree_.getElement(),o.utils.aria.State.ORIENTATION,"horizontal")};o.Toolbox.prototype.handleBeforeTreeSelected_=function(e){if(e==this.tree_)return!1;this.lastCategory_&&(this.lastCategory_.getRowElement().style.backgroundColor="");if(e){var t=e.hexColour||"#57e";e.getRowElement().style.backgroundColor=t;this.addColour_(e)}return!0};o.Toolbox.prototype.handleAfterTreeSelected_=function(e,t){t&&t.blocks&&t.blocks.length?(this.flyout_.show(t.blocks),this.lastCategory_!=t&&this.flyout_.scrollToStart(),this.workspace_.keyboardAccessibilityMode&&o.navigation.setState(o.navigation.STATE_TOOLBOX)):(this.flyout_.hide(),!this.workspace_.keyboardAccessibilityMode||t instanceof o.Toolbox.TreeSeparator||o.navigation.setState(o.navigation.STATE_WS));e!=t&&e!=this&&(e=new o.Events.Ui(null,"category",e&&e.getText(),t&&t.getText()),e.workspaceId=this.workspace_.id,o.Events.fire(e));t&&(this.lastCategory_=t)};o.Toolbox.prototype.handleNodeSizeChanged_=function(){o.svgResize(this.workspace_)};o.Toolbox.prototype.onBlocklyAction=function(e){var t=this.tree_.getSelectedItem();if(!t)return!1;switch(e.name){case o.navigation.actionNames.PREVIOUS:return t.selectPrevious();case o.navigation.actionNames.OUT:return t.selectParent();case o.navigation.actionNames.NEXT:return t.selectNext();case o.navigation.actionNames.IN:return t.selectChild();default:return!1;}};o.Toolbox.prototype.dispose=function(){this.flyout_.dispose();this.tree_.dispose();this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv);o.utils.dom.removeNode(this.HtmlDiv);this.lastCategory_=null};o.Toolbox.prototype.getWidth=function(){return this.width};o.Toolbox.prototype.getHeight=function(){return this.height};o.Toolbox.prototype.getFlyout=function(){return this.flyout_};o.Toolbox.prototype.position=function(){var e=this.HtmlDiv;if(e){var t=o.svgSize(this.workspace_.getParentSvg());this.horizontalLayout_?(e.style.left="0",e.style.height="auto",e.style.width=t.width+"px",this.height=e.offsetHeight,this.toolboxPosition==o.TOOLBOX_AT_TOP?e.style.top="0":e.style.bottom="0"):(this.toolboxPosition==o.TOOLBOX_AT_RIGHT?e.style.right="0":e.style.left="0",e.style.height=t.height+"px",this.width=e.offsetWidth);this.flyout_.position()}};o.Toolbox.prototype.syncTrees_=function(t,n,r){for(var i=null,s=null,a=0,c;c=t.childNodes[a];a++){if(c.tagName)switch(c.tagName.toUpperCase()){case"CATEGORY":s=o.utils.replaceMessageReferences(c.getAttribute("name"));var p=this.tree_.createNode(s);p.onSizeChanged(this.handleNodeSizeChanged_);p.blocks=[];n.add(p);var u=c.getAttribute("custom");u?p.blocks=u:(u=this.syncTrees_(c,p,r))&&(i=u);u=c.getAttribute("categorystyle");var _=c.getAttribute("colour");_&&u?(p.hexColour="",console.warn("Toolbox category \""+s+"\" can not have both a style and a colour")):u?this.setColourFromStyle_(u,p,s):this.setColour_(_,p,s);"true"==c.getAttribute("expanded")?(p.blocks.length&&(i=p),p.setExpanded(!0)):p.setExpanded(!1);s=c;break;case"SEP":if(s&&"CATEGORY"==s.tagName.toUpperCase()){n.add(new o.Toolbox.TreeSeparator(this.treeSeparatorConfig_));break}case"BLOCK":case"SHADOW":case"LABEL":case"BUTTON":n.blocks.push(c),s=c;}}return i};o.Toolbox.prototype.setColour_=function(e,t,n){e=o.utils.replaceMessageReferences(e);if(null===e||""===e)t.hexColour="";else{var r=+e;isNaN(r)?(r=o.utils.colour.parse(e))?(t.hexColour=r,this.hasColours_=!0):(t.hexColour="",console.warn("Toolbox category \""+n+"\" has unrecognized colour attribute: "+e)):(t.hexColour=o.hueToHex(r),this.hasColours_=!0)}};o.Toolbox.prototype.setColourFromStyle_=function(e,t,o){t.styleName=e;var n=this.workspace_.getTheme();e&&n&&((n=n.categoryStyles[e])&&n.colour?this.setColour_(n.colour,t,o):console.warn("Style \""+e+"\" must exist and contain a colour value"))};o.Toolbox.prototype.updateColourFromTheme_=function(e){if(e=e||this.tree_){e=e.getChildren(!1);for(var t=0,o;o=e[t];t++){o.styleName&&(this.setColourFromStyle_(o.styleName,o,""),this.addColour_()),this.updateColourFromTheme_(o)}}};o.Toolbox.prototype.updateColourFromTheme=function(){var e=this.tree_;e&&(this.updateColourFromTheme_(e),this.updateSelectedItemColour_(e))};o.Toolbox.prototype.updateSelectedItemColour_=function(e){if(e=e.getSelectedItem()){var t=e.hexColour||"#57e";e.getRowElement().style.backgroundColor=t;this.addColour_(e)}};o.Toolbox.prototype.addColour_=function(t){t=(t||this.tree_).getChildren(!1);for(var o=0,n,r;n=t[o];o++){r=n.getRowElement();if(r){var i=this.hasColours_?"8px solid "+(n.hexColour||"#ddd"):"none";this.workspace_.RTL?r.style.borderRight=i:r.style.borderLeft=i}this.addColour_(n)}};o.Toolbox.prototype.clearSelection=function(){this.tree_.setSelectedItem(null)};o.Toolbox.prototype.addStyle=function(e){o.utils.dom.addClass(this.HtmlDiv,e)};o.Toolbox.prototype.removeStyle=function(e){o.utils.dom.removeClass(this.HtmlDiv,e)};o.Toolbox.prototype.getClientRect=function(){if(!this.HtmlDiv)return null;var e=this.HtmlDiv.getBoundingClientRect(),t=e.top,n=t+e.height,r=e.left;e=r+e.width;return this.toolboxPosition==o.TOOLBOX_AT_TOP?new o.utils.Rect(-1E7,n,-1E7,1E7):this.toolboxPosition==o.TOOLBOX_AT_BOTTOM?new o.utils.Rect(t,1E7,-1E7,1E7):this.toolboxPosition==o.TOOLBOX_AT_LEFT?new o.utils.Rect(-1E7,1E7,-1E7,e):new o.utils.Rect(-1E7,1E7,r,1E7)};o.Toolbox.prototype.refreshSelection=function(){var e=this.tree_.getSelectedItem();e&&e.blocks&&this.flyout_.show(e.blocks)};o.Toolbox.prototype.selectFirstCategory=function(){this.tree_.getSelectedItem()||this.tree_.selectFirst()};o.Toolbox.TreeSeparator=function(e){o.tree.TreeNode.call(this,null,"",e)};o.utils.object.inherits(o.Toolbox.TreeSeparator,o.tree.TreeNode);o.Css.register([".blocklyToolboxDelete {","cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;","}",".blocklyToolboxGrab {","cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;","cursor: grabbing;","cursor: -webkit-grabbing;","}",".blocklyToolboxDiv {","background-color: #ddd;","overflow-x: visible;","overflow-y: auto;","position: absolute;","z-index: 70;","-webkit-tap-highlight-color: transparent;","}",".blocklyTreeRoot {","padding: 4px 0;","}",".blocklyTreeRoot:focus {","outline: none;","}",".blocklyTreeRow {","height: 22px;","line-height: 22px;","margin-bottom: 3px;","padding-right: 8px;","white-space: nowrap;","}",".blocklyHorizontalTree {","float: left;","margin: 1px 5px 8px 0;","}",".blocklyHorizontalTreeRtl {","float: right;","margin: 1px 0 8px 5px;","}",".blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeRow {","margin-left: 8px;","}",".blocklyTreeRow:not(.blocklyTreeSelected):hover {","background-color: #e4e4e4;","}",".blocklyTreeSeparator {","border-bottom: solid #e5e5e5 1px;","height: 0;","margin: 5px 0;","}",".blocklyTreeSeparatorHorizontal {","border-right: solid #e5e5e5 1px;","width: 0;","padding: 5px 0;","margin: 0 5px;","}",".blocklyTreeIcon {","background-image: url(<<<PATH>>>/sprites.png);","height: 16px;","vertical-align: middle;","width: 16px;","}",".blocklyTreeIconClosedLtr {","background-position: -32px -1px;","}",".blocklyTreeIconClosedRtl {","background-position: 0 -1px;","}",".blocklyTreeIconOpen {","background-position: -16px -1px;","}",".blocklyTreeSelected>.blocklyTreeIconClosedLtr {","background-position: -32px -17px;","}",".blocklyTreeSelected>.blocklyTreeIconClosedRtl {","background-position: 0 -17px;","}",".blocklyTreeSelected>.blocklyTreeIconOpen {","background-position: -16px -17px;","}",".blocklyTreeIconNone,",".blocklyTreeSelected>.blocklyTreeIconNone {","background-position: -48px -1px;","}",".blocklyTreeLabel {","cursor: default;","font-family: sans-serif;","font-size: 16px;","padding: 0 3px;","vertical-align: middle;","}",".blocklyToolboxDelete .blocklyTreeLabel {","cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;","}",".blocklyTreeSelected .blocklyTreeLabel {","color: #fff;","}"]);o.Trashcan=function(e){this.workspace_=e;this.contents_=[];this.flyout=null;if(!(0>=this.workspace_.options.maxTrashcanContents)){e=new o.Options({scrollbars:!0,parentWorkspace:this.workspace_,rtl:this.workspace_.RTL,oneBasedIndex:this.workspace_.options.oneBasedIndex,renderer:this.workspace_.options.renderer});if(this.workspace_.horizontalLayout){e.toolboxPosition=this.workspace_.toolboxPosition==o.TOOLBOX_AT_TOP?o.TOOLBOX_AT_BOTTOM:o.TOOLBOX_AT_TOP;if(!o.HorizontalFlyout)throw Error("Missing require for Blockly.HorizontalFlyout");this.flyout=new o.HorizontalFlyout(e)}else{e.toolboxPosition=this.workspace_.toolboxPosition==o.TOOLBOX_AT_RIGHT?o.TOOLBOX_AT_LEFT:o.TOOLBOX_AT_RIGHT;if(!o.VerticalFlyout)throw Error("Missing require for Blockly.VerticalFlyout");this.flyout=new o.VerticalFlyout(e)}this.workspace_.addChangeListener(this.onDelete_.bind(this))}};o.Trashcan.prototype.WIDTH_=47;o.Trashcan.prototype.BODY_HEIGHT_=44;o.Trashcan.prototype.LID_HEIGHT_=16;o.Trashcan.prototype.MARGIN_BOTTOM_=20;o.Trashcan.prototype.MARGIN_SIDE_=20;o.Trashcan.prototype.MARGIN_HOTSPOT_=10;o.Trashcan.prototype.SPRITE_LEFT_=0;o.Trashcan.prototype.SPRITE_TOP_=32;o.Trashcan.prototype.HAS_BLOCKS_LID_ANGLE=.1;o.Trashcan.prototype.isOpen=!1;o.Trashcan.prototype.minOpenness_=0;o.Trashcan.prototype.svgGroup_=null;o.Trashcan.prototype.svgLid_=null;o.Trashcan.prototype.lidTask_=0;o.Trashcan.prototype.lidOpen_=0;o.Trashcan.prototype.left_=0;o.Trashcan.prototype.top_=0;o.Trashcan.prototype.createDom=function(){this.svgGroup_=o.utils.dom.createSvgElement("g",{class:"blocklyTrash"},null);var e=(Math.random()+"").substring(2),t=o.utils.dom.createSvgElement("clipPath",{id:"blocklyTrashBodyClipPath"+e},this.svgGroup_);o.utils.dom.createSvgElement("rect",{width:this.WIDTH_,height:this.BODY_HEIGHT_,y:this.LID_HEIGHT_},t);var n=o.utils.dom.createSvgElement("image",{width:o.SPRITE.width,x:-this.SPRITE_LEFT_,height:o.SPRITE.height,y:-this.SPRITE_TOP_,"clip-path":"url(#blocklyTrashBodyClipPath"+e+")"},this.svgGroup_);n.setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",this.workspace_.options.pathToMedia+o.SPRITE.url);t=o.utils.dom.createSvgElement("clipPath",{id:"blocklyTrashLidClipPath"+e},this.svgGroup_);o.utils.dom.createSvgElement("rect",{width:this.WIDTH_,height:this.LID_HEIGHT_},t);this.svgLid_=o.utils.dom.createSvgElement("image",{width:o.SPRITE.width,x:-this.SPRITE_LEFT_,height:o.SPRITE.height,y:-this.SPRITE_TOP_,"clip-path":"url(#blocklyTrashLidClipPath"+e+")"},this.svgGroup_);this.svgLid_.setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",this.workspace_.options.pathToMedia+o.SPRITE.url);o.bindEventWithChecks_(this.svgGroup_,"mouseup",this,this.click);o.bindEvent_(n,"mouseover",this,this.mouseOver_);o.bindEvent_(n,"mouseout",this,this.mouseOut_);this.animateLid_();return this.svgGroup_};o.Trashcan.prototype.init=function(e){0<this.workspace_.options.maxTrashcanContents&&(o.utils.dom.insertAfter(this.flyout.createDom("svg"),this.workspace_.getParentSvg()),this.flyout.init(this.workspace_));this.verticalSpacing_=this.MARGIN_BOTTOM_+e;this.setOpen(!1);return this.verticalSpacing_+this.BODY_HEIGHT_+this.LID_HEIGHT_};o.Trashcan.prototype.dispose=function(){this.svgGroup_&&(o.utils.dom.removeNode(this.svgGroup_),this.svgGroup_=null);this.workspace_=this.svgLid_=null;clearTimeout(this.lidTask_)};o.Trashcan.prototype.position=function(){if(this.verticalSpacing_){var e=this.workspace_.getMetrics();e&&(this.left_=e.toolboxPosition==o.TOOLBOX_AT_LEFT||this.workspace_.horizontalLayout&&!this.workspace_.RTL?e.viewWidth+e.absoluteLeft-this.WIDTH_-this.MARGIN_SIDE_-o.Scrollbar.scrollbarThickness:this.MARGIN_SIDE_+o.Scrollbar.scrollbarThickness,this.top_=e.toolboxPosition==o.TOOLBOX_AT_BOTTOM?this.verticalSpacing_:e.viewHeight+e.absoluteTop-(this.BODY_HEIGHT_+this.LID_HEIGHT_)-this.verticalSpacing_,this.svgGroup_.setAttribute("transform","translate("+this.left_+","+this.top_+")"))}};o.Trashcan.prototype.getClientRect=function(){if(!this.svgGroup_)return null;var e=this.svgGroup_.getBoundingClientRect(),t=e.top+this.SPRITE_TOP_-this.MARGIN_HOTSPOT_;e=e.left+this.SPRITE_LEFT_-this.MARGIN_HOTSPOT_;return new o.utils.Rect(t,t+this.LID_HEIGHT_+this.BODY_HEIGHT_+2*this.MARGIN_HOTSPOT_,e,e+this.WIDTH_+2*this.MARGIN_HOTSPOT_)};o.Trashcan.prototype.setOpen=function(e){this.isOpen!=e&&(clearTimeout(this.lidTask_),this.isOpen=e,this.animateLid_())};o.Trashcan.prototype.animateLid_=function(){this.lidOpen_+=this.isOpen?.2:-.2;this.lidOpen_=Math.min(Math.max(this.lidOpen_,this.minOpenness_),1);this.setLidAngle_(45*this.lidOpen_);this.svgGroup_.style.opacity=.4+.4*this.lidOpen_;this.lidOpen_>this.minOpenness_&&1>this.lidOpen_&&(this.lidTask_=setTimeout(this.animateLid_.bind(this),20))};o.Trashcan.prototype.setLidAngle_=function(e){var t=this.workspace_.toolboxPosition==o.TOOLBOX_AT_RIGHT||this.workspace_.horizontalLayout&&this.workspace_.RTL;this.svgLid_.setAttribute("transform","rotate("+(t?-e:e)+","+(t?4:this.WIDTH_-4)+","+(this.LID_HEIGHT_-2)+")")};o.Trashcan.prototype.close=function(){this.setOpen(!1)};o.Trashcan.prototype.click=function(){if(this.contents_.length){for(var e=[],t=0,n;n=this.contents_[t];t++){e[t]=o.Xml.textToDom(n)}this.flyout.show(e)}};o.Trashcan.prototype.mouseOver_=function(){this.contents_.length&&this.setOpen(!0)};o.Trashcan.prototype.mouseOut_=function(){this.setOpen(!1)};o.Trashcan.prototype.onDelete_=function(e){if(!(0>=this.workspace_.options.maxTrashcanContents)&&e.type==o.Events.BLOCK_DELETE&&"shadow"!=e.oldXml.tagName.toLowerCase()&&(e=this.cleanBlockXML_(e.oldXml),-1==this.contents_.indexOf(e))){for(this.contents_.unshift(e);this.contents_.length>this.workspace_.options.maxTrashcanContents;){this.contents_.pop()}this.minOpenness_=this.HAS_BLOCKS_LID_ANGLE;this.setLidAngle_(45*this.minOpenness_)}};o.Trashcan.prototype.cleanBlockXML_=function(e){for(var t=e=e.cloneNode(!0);t;){t.removeAttribute&&(t.removeAttribute("x"),t.removeAttribute("y"),t.removeAttribute("id"),t.removeAttribute("disabled"),"comment"==t.nodeName&&(t.removeAttribute("h"),t.removeAttribute("w"),t.removeAttribute("pinned")));var n=t.firstChild||t.nextSibling;if(!n)for(n=t.parentNode;n;){if(n.nextSibling){n=n.nextSibling;break}n=n.parentNode}t=n}return o.Xml.domToText(e)};o.VariablesDynamic={};o.VariablesDynamic.onCreateVariableButtonClick_String=function(e){o.Variables.createVariableButtonHandler(e.getTargetWorkspace(),void 0,"String")};o.VariablesDynamic.onCreateVariableButtonClick_Number=function(e){o.Variables.createVariableButtonHandler(e.getTargetWorkspace(),void 0,"Number")};o.VariablesDynamic.onCreateVariableButtonClick_Colour=function(e){o.Variables.createVariableButtonHandler(e.getTargetWorkspace(),void 0,"Colour")};o.VariablesDynamic.flyoutCategory=function(e){var t=[],n=document.createElement("button");n.setAttribute("text",o.Msg.NEW_STRING_VARIABLE);n.setAttribute("callbackKey","CREATE_VARIABLE_STRING");t.push(n);n=document.createElement("button");n.setAttribute("text",o.Msg.NEW_NUMBER_VARIABLE);n.setAttribute("callbackKey","CREATE_VARIABLE_NUMBER");t.push(n);n=document.createElement("button");n.setAttribute("text",o.Msg.NEW_COLOUR_VARIABLE);n.setAttribute("callbackKey","CREATE_VARIABLE_COLOUR");t.push(n);e.registerButtonCallback("CREATE_VARIABLE_STRING",o.VariablesDynamic.onCreateVariableButtonClick_String);e.registerButtonCallback("CREATE_VARIABLE_NUMBER",o.VariablesDynamic.onCreateVariableButtonClick_Number);e.registerButtonCallback("CREATE_VARIABLE_COLOUR",o.VariablesDynamic.onCreateVariableButtonClick_Colour);e=o.VariablesDynamic.flyoutCategoryBlocks(e);return t=t.concat(e)};o.VariablesDynamic.flyoutCategoryBlocks=function(t){t=t.getAllVariables();var n=[];if(0<t.length){if(o.Blocks.variables_set_dynamic){var r=t[t.length-1],i=o.utils.xml.createElement("block");i.setAttribute("type","variables_set_dynamic");i.setAttribute("gap",24);i.appendChild(o.Variables.generateVariableFieldDom(r));n.push(i)}if(o.Blocks.variables_get_dynamic){t.sort(o.VariableModel.compareByName);r=0;for(var s;s=t[r];r++){i=o.utils.xml.createElement("block"),i.setAttribute("type","variables_get_dynamic"),i.setAttribute("gap",8),i.appendChild(o.Variables.generateVariableFieldDom(s)),n.push(i)}}}return n};o.ZoomControls=function(e){this.workspace_=e};o.ZoomControls.prototype.WIDTH_=32;o.ZoomControls.prototype.HEIGHT_=110;o.ZoomControls.prototype.MARGIN_BOTTOM_=20;o.ZoomControls.prototype.MARGIN_SIDE_=20;o.ZoomControls.prototype.svgGroup_=null;o.ZoomControls.prototype.left_=0;o.ZoomControls.prototype.top_=0;o.ZoomControls.prototype.createDom=function(){this.svgGroup_=o.utils.dom.createSvgElement("g",{},null);var e=(Math.random()+"").substring(2);this.createZoomOutSvg_(e);this.createZoomInSvg_(e);this.workspace_.isMovable()&&this.createZoomResetSvg_(e);return this.svgGroup_};o.ZoomControls.prototype.init=function(e){this.verticalSpacing_=this.MARGIN_BOTTOM_+e;return this.verticalSpacing_+this.HEIGHT_};o.ZoomControls.prototype.dispose=function(){this.svgGroup_&&o.utils.dom.removeNode(this.svgGroup_)};o.ZoomControls.prototype.position=function(){if(this.verticalSpacing_){var e=this.workspace_.getMetrics();e&&(this.left_=e.toolboxPosition==o.TOOLBOX_AT_LEFT||this.workspace_.horizontalLayout&&!this.workspace_.RTL?e.viewWidth+e.absoluteLeft-this.WIDTH_-this.MARGIN_SIDE_-o.Scrollbar.scrollbarThickness:this.MARGIN_SIDE_+o.Scrollbar.scrollbarThickness,e.toolboxPosition==o.TOOLBOX_AT_BOTTOM?(this.top_=this.verticalSpacing_,this.zoomInGroup_.setAttribute("transform","translate(0, 34)"),this.zoomResetGroup_&&this.zoomResetGroup_.setAttribute("transform","translate(0, 77)")):(this.top_=e.viewHeight+e.absoluteTop-this.HEIGHT_-this.verticalSpacing_,this.zoomInGroup_.setAttribute("transform","translate(0, 43)"),this.zoomOutGroup_.setAttribute("transform","translate(0, 77)")),this.svgGroup_.setAttribute("transform","translate("+this.left_+","+this.top_+")"))}};o.ZoomControls.prototype.createZoomOutSvg_=function(e){var t=this.workspace_;this.zoomOutGroup_=o.utils.dom.createSvgElement("g",{class:"blocklyZoom"},this.svgGroup_);var n=o.utils.dom.createSvgElement("clipPath",{id:"blocklyZoomoutClipPath"+e},this.zoomOutGroup_);o.utils.dom.createSvgElement("rect",{width:32,height:32},n);e=o.utils.dom.createSvgElement("image",{width:o.SPRITE.width,height:o.SPRITE.height,x:-64,y:-92,"clip-path":"url(#blocklyZoomoutClipPath"+e+")"},this.zoomOutGroup_);e.setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",t.options.pathToMedia+o.SPRITE.url);o.bindEventWithChecks_(e,"mousedown",null,function(e){t.markFocused();t.zoomCenter(-1);o.Touch.clearTouchIdentifier();e.stopPropagation();e.preventDefault()})};o.ZoomControls.prototype.createZoomInSvg_=function(e){var t=this.workspace_;this.zoomInGroup_=o.utils.dom.createSvgElement("g",{class:"blocklyZoom"},this.svgGroup_);var n=o.utils.dom.createSvgElement("clipPath",{id:"blocklyZoominClipPath"+e},this.zoomInGroup_);o.utils.dom.createSvgElement("rect",{width:32,height:32},n);e=o.utils.dom.createSvgElement("image",{width:o.SPRITE.width,height:o.SPRITE.height,x:-32,y:-92,"clip-path":"url(#blocklyZoominClipPath"+e+")"},this.zoomInGroup_);e.setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",t.options.pathToMedia+o.SPRITE.url);o.bindEventWithChecks_(e,"mousedown",null,function(e){t.markFocused();t.zoomCenter(1);o.Touch.clearTouchIdentifier();e.stopPropagation();e.preventDefault()})};o.ZoomControls.prototype.createZoomResetSvg_=function(e){var t=this.workspace_;this.zoomResetGroup_=o.utils.dom.createSvgElement("g",{class:"blocklyZoom"},this.svgGroup_);var n=o.utils.dom.createSvgElement("clipPath",{id:"blocklyZoomresetClipPath"+e},this.zoomResetGroup_);o.utils.dom.createSvgElement("rect",{width:32,height:32},n);e=o.utils.dom.createSvgElement("image",{width:o.SPRITE.width,height:o.SPRITE.height,y:-92,"clip-path":"url(#blocklyZoomresetClipPath"+e+")"},this.zoomResetGroup_);e.setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",t.options.pathToMedia+o.SPRITE.url);o.bindEventWithChecks_(e,"mousedown",null,function(e){t.markFocused();t.setScale(t.options.zoomOptions.startScale);t.beginCanvasTransition();t.scrollCenter();setTimeout(t.endCanvasTransition.bind(t),500);o.Touch.clearTouchIdentifier();e.stopPropagation();e.preventDefault()})};o.Css.register([".blocklyZoom>image, .blocklyZoom>svg>image {","opacity: .4;","}",".blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {","opacity: .6;","}",".blocklyZoom>image:active, .blocklyZoom>svg>image:active {","opacity: .8;","}"]);o.Mutator=function(e){o.Mutator.superClass_.constructor.call(this,null);this.quarkNames_=e};o.utils.object.inherits(o.Mutator,o.Icon);o.Mutator.prototype.workspaceWidth_=0;o.Mutator.prototype.workspaceHeight_=0;o.Mutator.prototype.setBlock=function(e){this.block_=e};o.Mutator.prototype.getWorkspace=function(){return this.workspace_};o.Mutator.prototype.drawIcon_=function(e){o.utils.dom.createSvgElement("rect",{class:"blocklyIconShape",rx:"4",ry:"4",height:"16",width:"16"},e);o.utils.dom.createSvgElement("path",{class:"blocklyIconSymbol",d:"m4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 -0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z"},e);o.utils.dom.createSvgElement("circle",{class:"blocklyIconShape",r:"2.7",cx:"8",cy:"8"},e)};o.Mutator.prototype.iconClick_=function(e){this.block_.isEditable()&&o.Icon.prototype.iconClick_.call(this,e)};o.Mutator.prototype.createEditor_=function(){this.svgDialog_=o.utils.dom.createSvgElement("svg",{x:o.Bubble.BORDER_WIDTH,y:o.Bubble.BORDER_WIDTH},null);if(this.quarkNames_.length)for(var e=o.utils.xml.createElement("xml"),t=0,n,r;n=this.quarkNames_[t];t++){r=o.utils.xml.createElement("block");r.setAttribute("type",n);e.appendChild(r)}else e=null;t=new o.Options({disable:!1,parentWorkspace:this.block_.workspace,media:this.block_.workspace.options.pathToMedia,rtl:this.block_.RTL,horizontalLayout:!1,renderer:this.block_.workspace.options.renderer});t.toolboxPosition=this.block_.RTL?o.TOOLBOX_AT_RIGHT:o.TOOLBOX_AT_LEFT;t.languageTree=e;t.getMetrics=this.getFlyoutMetrics_.bind(this);this.workspace_=new o.WorkspaceSvg(t);this.workspace_.isMutator=!0;this.workspace_.addChangeListener(o.Events.disableOrphans);e=this.workspace_.addFlyout("g");t=this.workspace_.createDom("blocklyMutatorBackground");t.insertBefore(e,this.workspace_.svgBlockCanvas_);this.svgDialog_.appendChild(t);return this.svgDialog_};o.Mutator.prototype.updateEditable=function(){o.Mutator.superClass_.updateEditable.call(this);this.block_.isInFlyout||(this.block_.isEditable()?this.iconGroup_&&o.utils.dom.removeClass(this.iconGroup_,"blocklyIconGroupReadonly"):(this.setVisible(!1),this.iconGroup_&&o.utils.dom.addClass(this.iconGroup_,"blocklyIconGroupReadonly")))};o.Mutator.prototype.resizeBubble_=function(){var e=2*o.Bubble.BORDER_WIDTH,t=this.workspace_.getCanvas().getBBox(),n=this.block_.RTL?-t.x:t.width+t.x;t=t.height+3*e;var r=this.workspace_.getFlyout();r&&(r=r.getMetrics_(),t=Math.max(t,r.contentHeight+20));n+=3*e;if(Math.abs(this.workspaceWidth_-n)>e||Math.abs(this.workspaceHeight_-t)>e)this.workspaceWidth_=n,this.workspaceHeight_=t,this.bubble_.setBubbleSize(n+e,t+e),this.svgDialog_.setAttribute("width",this.workspaceWidth_),this.svgDialog_.setAttribute("height",this.workspaceHeight_);this.block_.RTL&&(e="translate("+this.workspaceWidth_+",0)",this.workspace_.getCanvas().setAttribute("transform",e));this.workspace_.resize()};o.Mutator.prototype.onBubbleMove_=function(){this.workspace_&&this.workspace_.recordDeleteAreas()};o.Mutator.prototype.setVisible=function(t){if(t!=this.isVisible())if(o.Events.fire(new o.Events.Ui(this.block_,"mutatorOpen",!t,t)),t){this.bubble_=new o.Bubble(this.block_.workspace,this.createEditor_(),this.block_.pathObject.svgPath,this.iconXY_,null,null);this.bubble_.setSvgId(this.block_.id);this.bubble_.registerMoveEvent(this.onBubbleMove_.bind(this));var n=this.workspace_.options.languageTree;t=this.workspace_.getFlyout();n&&(t.init(this.workspace_),t.show(n.childNodes));this.rootBlock_=this.block_.decompose(this.workspace_);n=this.rootBlock_.getDescendants(!1);for(var r=0,i;i=n[r];r++){i.render()}this.rootBlock_.setMovable(!1);this.rootBlock_.setDeletable(!1);t?(n=2*t.CORNER_RADIUS,t=t.getWidth()+n):t=n=16;this.block_.RTL&&(t=-t);this.rootBlock_.moveBy(t,n);if(this.block_.saveConnections){var s=this,e=this.block_;e.saveConnections(this.rootBlock_);this.sourceListener_=function(){e.saveConnections(s.rootBlock_)};this.block_.workspace.addChangeListener(this.sourceListener_)}this.resizeBubble_();this.workspace_.addChangeListener(this.workspaceChanged_.bind(this));this.applyColour()}else this.svgDialog_=null,this.workspace_.dispose(),this.rootBlock_=this.workspace_=null,this.bubble_.dispose(),this.bubble_=null,this.workspaceHeight_=this.workspaceWidth_=0,this.sourceListener_&&(this.block_.workspace.removeChangeListener(this.sourceListener_),this.sourceListener_=null)};o.Mutator.prototype.workspaceChanged_=function(t){if(t.type!=o.Events.UI&&(t.type!=o.Events.CHANGE||"disabled"!=t.element)){if(!this.workspace_.isDragging()){t=this.workspace_.getTopBlocks(!1);for(var n=0,r;r=t[n];n++){var i=r.getRelativeToSurfaceXY(),s=r.getHeightWidth();20>i.y+s.height&&r.moveBy(0,20-s.height-i.y)}}if(this.rootBlock_.workspace==this.workspace_){o.Events.setGroup(!0);r=this.block_;t=(t=r.mutationToDom())&&o.Xml.domToText(t);r.compose(this.rootBlock_);r.initSvg();r.render();o.getMainWorkspace().keyboardAccessibilityMode&&o.navigation.moveCursorOnBlockMutation(r);n=(n=r.mutationToDom())&&o.Xml.domToText(n);if(t!=n){o.Events.fire(new o.Events.BlockChange(r,"mutation",null,t,n));var e=o.Events.getGroup();setTimeout(function(){o.Events.setGroup(e);r.bumpNeighbours();o.Events.setGroup(!1)},o.BUMP_DELAY)}this.workspace_.isDragging()||this.resizeBubble_();o.Events.setGroup(!1)}}};o.Mutator.prototype.getFlyoutMetrics_=function(){return{viewHeight:this.workspaceHeight_,viewWidth:this.workspaceWidth_-this.workspace_.getFlyout().getWidth(),absoluteTop:0,absoluteLeft:this.workspace_.RTL?0:this.workspace_.getFlyout().getWidth()}};o.Mutator.prototype.dispose=function(){this.block_.mutator=null;o.Icon.prototype.dispose.call(this)};o.Mutator.prototype.updateBlockStyle=function(){var e=this.workspace_;if(e&&e.getAllBlocks(!1)){for(var t=e.getAllBlocks(!1),o=0,n;o<t.length;o++){n=t[o];n.setStyle(n.getStyleName())}e=e.getFlyout().workspace_.getAllBlocks(!1);for(o=0;o<e.length;o++){n=e[o],n.setStyle(n.getStyleName())}}};o.Mutator.reconnect=function(e,t,o){if(!e||!e.getSourceBlock().workspace)return!1;o=t.getInput(o).connection;var n=e.targetBlock();return n&&n!=t||o.targetConnection==e?!1:(o.isConnected()&&o.disconnect(),o.connect(e),!0)};o.Mutator.findParentWs=function(e){var t=null;if(e&&e.options){var o=e.options.parentWorkspace;e.isFlyout?o&&o.options&&(t=o.options.parentWorkspace):o&&(t=o)}return t};o.FieldTextInput=function(e,t,n){this.spellcheck_=!0;null==e&&(e="");o.FieldTextInput.superClass_.constructor.call(this,e,t,n);this.onKeyInputWrapper_=this.onKeyDownWrapper_=this.htmlInput_=null;this.fullBlockClickTarget_=!1};o.utils.object.inherits(o.FieldTextInput,o.Field);o.FieldTextInput.fromJson=function(e){var t=o.utils.replaceMessageReferences(e.text);return new o.FieldTextInput(t,void 0,e)};o.FieldTextInput.prototype.SERIALIZABLE=!0;o.FieldTextInput.BORDERRADIUS=4;o.FieldTextInput.prototype.CURSOR="text";o.FieldTextInput.prototype.configure_=function(e){o.FieldTextInput.superClass_.configure_.call(this,e);"boolean"==typeof e.spellcheck&&(this.spellcheck_=e.spellcheck)};o.FieldTextInput.prototype.initView=function(){if(this.constants_.FULL_BLOCK_FIELDS){for(var t=0,o=0,n=0,r;r=this.sourceBlock_.inputList[n];n++){for(var i=0;r.fieldRow[i];i++){t++}r.connection&&o++}this.fullBlockClickTarget_=1>=t&&this.sourceBlock_.outputConnection&&!o}else this.fullBlockClickTarget_=!1;this.fullBlockClickTarget_?this.clickTarget_=this.sourceBlock_.getSvgRoot():this.createBorderRect_();this.createTextElement_()};o.FieldTextInput.prototype.doClassValidation_=function(e){return null===e||void 0===e?null:e+""};o.FieldTextInput.prototype.doValueInvalid_=function(e){this.isBeingEdited_&&(this.isTextValid_=!1,e=this.value_,this.value_=this.htmlInput_.untypedDefaultValue_,this.sourceBlock_&&o.Events.isEnabled()&&o.Events.fire(new o.Events.BlockChange(this.sourceBlock_,"field",this.name||null,e,this.value_)))};o.FieldTextInput.prototype.doValueUpdate_=function(e){this.isTextValid_=!0;this.value_=e;this.isBeingEdited_||(this.isDirty_=!0)};o.FieldTextInput.prototype.applyColour=function(){this.sourceBlock_&&this.constants_.FULL_BLOCK_FIELDS&&(this.borderRect_?this.borderRect_.setAttribute("stroke",this.sourceBlock_.style.colourTertiary):this.sourceBlock_.pathObject.svgPath.setAttribute("fill",this.constants_.FIELD_BORDER_RECT_COLOUR))};o.FieldTextInput.prototype.render_=function(){o.FieldTextInput.superClass_.render_.call(this);if(this.isBeingEdited_){this.resizeEditor_();var e=this.htmlInput_;this.isTextValid_?(o.utils.dom.removeClass(e,"blocklyInvalidInput"),o.utils.aria.setState(e,o.utils.aria.State.INVALID,!1)):(o.utils.dom.addClass(e,"blocklyInvalidInput"),o.utils.aria.setState(e,o.utils.aria.State.INVALID,!0))}};o.FieldTextInput.prototype.setSpellcheck=function(e){e!=this.spellcheck_&&(this.spellcheck_=e,this.htmlInput_&&this.htmlInput_.setAttribute("spellcheck",this.spellcheck_))};o.FieldTextInput.prototype.showEditor_=function(e,t){this.workspace_=this.sourceBlock_.workspace;e=t||!1;!e&&(o.utils.userAgent.MOBILE||o.utils.userAgent.ANDROID||o.utils.userAgent.IPAD)?this.showPromptEditor_():this.showInlineEditor_(e)};o.FieldTextInput.prototype.showPromptEditor_=function(){var e=this;o.prompt(o.Msg.CHANGE_VALUE_TITLE,this.getText(),function(t){e.setValue(t)})};o.FieldTextInput.prototype.showInlineEditor_=function(e){o.WidgetDiv.show(this,this.sourceBlock_.RTL,this.widgetDispose_.bind(this));this.htmlInput_=this.widgetCreate_();this.isBeingEdited_=!0;e||(this.htmlInput_.focus({preventScroll:!0}),this.htmlInput_.select())};o.FieldTextInput.prototype.widgetCreate_=function(){var t=o.WidgetDiv.DIV;o.utils.dom.addClass(this.getClickTarget_(),"editing");var n=document.createElement("input");n.className="blocklyHtmlInput";n.setAttribute("spellcheck",this.spellcheck_);var r=this.workspace_.scale,i=this.constants_.FIELD_TEXT_FONTSIZE*r+"pt";t.style.fontSize=i;n.style.fontSize=i;i=o.FieldTextInput.BORDERRADIUS*r+"px";if(this.fullBlockClickTarget_){i=this.getScaledBBox();i=(i.bottom-i.top)/2+"px";var s=this.sourceBlock_.getParent()?this.sourceBlock_.getParent().style.colourTertiary:this.sourceBlock_.style.colourTertiary;n.style.border=1*r+"px solid "+s;t.style.borderRadius=i;t.style.transition="box-shadow 0.25s ease 0s";this.constants_.FIELD_TEXTINPUT_BOX_SHADOW&&(t.style.boxShadow="rgba(255, 255, 255, 0.3) 0px 0px 0px "+4*r+"px")}n.style.borderRadius=i;t.appendChild(n);n.value=n.defaultValue=this.getEditorText_(this.value_);n.untypedDefaultValue_=this.value_;n.oldValue_=null;this.resizeEditor_();this.bindInputEvents_(n);return n};o.FieldTextInput.prototype.widgetDispose_=function(){this.isBeingEdited_=!1;this.isTextValid_=!0;this.forceRerender();if(this.onFinishEditing_)this.onFinishEditing_(this.value_);this.unbindInputEvents_();var e=o.WidgetDiv.DIV.style;e.width="auto";e.height="auto";e.fontSize="";e.transition="";e.boxShadow="";this.htmlInput_=null;o.utils.dom.removeClass(this.getClickTarget_(),"editing")};o.FieldTextInput.prototype.bindInputEvents_=function(e){this.onKeyDownWrapper_=o.bindEventWithChecks_(e,"keydown",this,this.onHtmlInputKeyDown_);this.onKeyInputWrapper_=o.bindEventWithChecks_(e,"input",this,this.onHtmlInputChange_)};o.FieldTextInput.prototype.unbindInputEvents_=function(){this.onKeyDownWrapper_&&(o.unbindEvent_(this.onKeyDownWrapper_),this.onKeyDownWrapper_=null);this.onKeyInputWrapper_&&(o.unbindEvent_(this.onKeyInputWrapper_),this.onKeyInputWrapper_=null)};o.FieldTextInput.prototype.onHtmlInputKeyDown_=function(e){e.keyCode==o.utils.KeyCodes.ENTER?(o.WidgetDiv.hide(),o.DropDownDiv.hideWithoutAnimation()):e.keyCode==o.utils.KeyCodes.ESC?(this.htmlInput_.value=this.htmlInput_.defaultValue,o.WidgetDiv.hide(),o.DropDownDiv.hideWithoutAnimation()):e.keyCode==o.utils.KeyCodes.TAB&&(o.WidgetDiv.hide(),o.DropDownDiv.hideWithoutAnimation(),this.sourceBlock_.tab(this,!e.shiftKey),e.preventDefault())};o.FieldTextInput.prototype.onHtmlInputChange_=function(e){e=this.htmlInput_.value;e!==this.htmlInput_.oldValue_&&(this.htmlInput_.oldValue_=e,o.Events.setGroup(!0),e=this.getValueFromEditorText_(e),this.setValue(e),this.forceRerender(),this.resizeEditor_(),o.Events.setGroup(!1))};o.FieldTextInput.prototype.setEditorValue_=function(e){this.isDirty_=!0;this.isBeingEdited_&&(this.htmlInput_.value=this.getEditorText_(e));this.setValue(e)};o.FieldTextInput.prototype.resizeEditor_=function(){var e=o.WidgetDiv.DIV,t=this.getScaledBBox();e.style.width=t.right-t.left+"px";e.style.height=t.bottom-t.top+"px";t=new o.utils.Coordinate(this.sourceBlock_.RTL?t.right-e.offsetWidth:t.left,t.top);e.style.left=t.x+"px";e.style.top=t.y+"px"};o.FieldTextInput.numberValidator=function(e){console.warn("Blockly.FieldTextInput.numberValidator is deprecated. Use Blockly.FieldNumber instead.");if(null===e)return null;e=e+"";e=e.replace(/O/ig,"0");e=e.replace(/,/g,"");e=+(e||0);return isNaN(e)?null:e+""};o.FieldTextInput.nonnegativeIntegerValidator=function(e){(e=o.FieldTextInput.numberValidator(e))&&(e=Math.max(0,Math.floor(e))+"");return e};o.FieldTextInput.prototype.isTabNavigable=function(){return!0};o.FieldTextInput.prototype.getText_=function(){return this.isBeingEdited_&&this.htmlInput_?this.htmlInput_.value:null};o.FieldTextInput.prototype.getEditorText_=function(e){return e+""};o.FieldTextInput.prototype.getValueFromEditorText_=function(e){return e};o.fieldRegistry.register("field_input",o.FieldTextInput);o.FieldAngle=function(e,t,n){this.clockwise_=o.FieldAngle.CLOCKWISE;this.offset_=o.FieldAngle.OFFSET;this.wrap_=o.FieldAngle.WRAP;this.round_=o.FieldAngle.ROUND;o.FieldAngle.superClass_.constructor.call(this,e||0,t,n);this.moveSurfaceWrapper_=this.clickSurfaceWrapper_=this.clickWrapper_=this.line_=this.gauge_=null};o.utils.object.inherits(o.FieldAngle,o.FieldTextInput);o.FieldAngle.fromJson=function(e){return new o.FieldAngle(e.angle,void 0,e)};o.FieldAngle.prototype.SERIALIZABLE=!0;o.FieldAngle.ROUND=15;o.FieldAngle.HALF=50;o.FieldAngle.CLOCKWISE=!1;o.FieldAngle.OFFSET=0;o.FieldAngle.WRAP=360;o.FieldAngle.RADIUS=o.FieldAngle.HALF-1;o.FieldAngle.prototype.configure_=function(e){o.FieldAngle.superClass_.configure_.call(this,e);switch(e.mode){case"compass":this.clockwise_=!0;this.offset_=90;break;case"protractor":this.clockwise_=!1,this.offset_=0;}var t=e.clockwise;"boolean"==typeof t&&(this.clockwise_=t);t=e.offset;null!=t&&(t=+t,isNaN(t)||(this.offset_=t));t=e.wrap;null!=t&&(t=+t,isNaN(t)||(this.wrap_=t));e=e.round;null!=e&&(e=+e,isNaN(e)||(this.round_=e))};o.FieldAngle.prototype.initView=function(){o.FieldAngle.superClass_.initView.call(this);this.symbol_=o.utils.dom.createSvgElement("tspan",{},null);this.symbol_.appendChild(document.createTextNode("\xB0"));this.textElement_.appendChild(this.symbol_)};o.FieldAngle.prototype.render_=function(){o.FieldAngle.superClass_.render_.call(this);this.updateGraph_()};o.FieldAngle.prototype.showEditor_=function(e){o.FieldAngle.superClass_.showEditor_.call(this,e,o.utils.userAgent.MOBILE||o.utils.userAgent.ANDROID||o.utils.userAgent.IPAD);e=this.dropdownCreate_();o.DropDownDiv.getContentDiv().appendChild(e);o.DropDownDiv.setColour(this.sourceBlock_.style.colourPrimary,this.sourceBlock_.style.colourTertiary);o.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this));this.updateGraph_()};o.FieldAngle.prototype.dropdownCreate_=function(){var e=o.utils.dom.createSvgElement("svg",{xmlns:o.utils.dom.SVG_NS,"xmlns:html":o.utils.dom.HTML_NS,"xmlns:xlink":o.utils.dom.XLINK_NS,version:"1.1",height:2*o.FieldAngle.HALF+"px",width:2*o.FieldAngle.HALF+"px",style:"touch-action: none"},null),t=o.utils.dom.createSvgElement("circle",{cx:o.FieldAngle.HALF,cy:o.FieldAngle.HALF,r:o.FieldAngle.RADIUS,class:"blocklyAngleCircle"},e);this.gauge_=o.utils.dom.createSvgElement("path",{class:"blocklyAngleGauge"},e);this.line_=o.utils.dom.createSvgElement("line",{x1:o.FieldAngle.HALF,y1:o.FieldAngle.HALF,class:"blocklyAngleLine"},e);for(var n=0;360>n;n+=15){o.utils.dom.createSvgElement("line",{x1:o.FieldAngle.HALF+o.FieldAngle.RADIUS,y1:o.FieldAngle.HALF,x2:o.FieldAngle.HALF+o.FieldAngle.RADIUS-(0==n%45?10:5),y2:o.FieldAngle.HALF,class:"blocklyAngleMarks",transform:"rotate("+n+","+o.FieldAngle.HALF+","+o.FieldAngle.HALF+")"},e)}this.clickWrapper_=o.bindEventWithChecks_(e,"click",this,this.hide_);this.clickSurfaceWrapper_=o.bindEventWithChecks_(t,"click",this,this.onMouseMove_,!0,!0);this.moveSurfaceWrapper_=o.bindEventWithChecks_(t,"mousemove",this,this.onMouseMove_,!0,!0);return e};o.FieldAngle.prototype.dropdownDispose_=function(){this.clickWrapper_&&(o.unbindEvent_(this.clickWrapper_),this.clickWrapper_=null);this.clickSurfaceWrapper_&&(o.unbindEvent_(this.clickSurfaceWrapper_),this.clickSurfaceWrapper_=null);this.moveSurfaceWrapper_&&(o.unbindEvent_(this.moveSurfaceWrapper_),this.moveSurfaceWrapper_=null);this.line_=this.gauge_=null};o.FieldAngle.prototype.hide_=function(){o.DropDownDiv.hideIfOwner(this);o.WidgetDiv.hide()};o.FieldAngle.prototype.onMouseMove_=function(e){var t=this.gauge_.ownerSVGElement.getBoundingClientRect(),n=e.clientX-t.left-o.FieldAngle.HALF;e=e.clientY-t.top-o.FieldAngle.HALF;t=Math.atan(-e/n);isNaN(t)||(t=o.utils.math.toDegrees(t),0>n?t+=180:0<e&&(t+=360),t=this.clockwise_?this.offset_+360-t:360-(this.offset_-t),this.displayMouseOrKeyboardValue_(t))};o.FieldAngle.prototype.displayMouseOrKeyboardValue_=function(e){this.round_&&(e=Math.round(e/this.round_)*this.round_);e=this.wrapValue_(e);e!=this.value_&&this.setEditorValue_(e)};o.FieldAngle.prototype.updateGraph_=function(){if(this.gauge_){var t=+this.getText()+this.offset_,n=o.utils.math.toRadians(t%360);t=["M ",o.FieldAngle.HALF,",",o.FieldAngle.HALF];var r=o.FieldAngle.HALF,i=o.FieldAngle.HALF;if(!isNaN(n)){var s=+this.clockwise_,e=o.utils.math.toRadians(this.offset_),l=Math.cos(e)*o.FieldAngle.RADIUS,p=Math.sin(e)*-o.FieldAngle.RADIUS;s&&(n=2*e-n);r+=Math.cos(n)*o.FieldAngle.RADIUS;i-=Math.sin(n)*o.FieldAngle.RADIUS;n=Math.abs(Math.floor((n-e)/Math.PI)%2);s&&(n=1-n);t.push(" l ",l,",",p," A ",o.FieldAngle.RADIUS,",",o.FieldAngle.RADIUS," 0 ",n," ",s," ",r,",",i," z")}this.gauge_.setAttribute("d",t.join(""));this.line_.setAttribute("x2",r);this.line_.setAttribute("y2",i)}};o.FieldAngle.prototype.onHtmlInputKeyDown_=function(e){o.FieldAngle.superClass_.onHtmlInputKeyDown_.call(this,e);var t;e.keyCode===o.utils.KeyCodes.LEFT?t=this.sourceBlock_.RTL?1:-1:e.keyCode===o.utils.KeyCodes.RIGHT?t=this.sourceBlock_.RTL?-1:1:e.keyCode===o.utils.KeyCodes.DOWN?t=-1:e.keyCode===o.utils.KeyCodes.UP&&(t=1);if(t){var n=this.getValue();this.displayMouseOrKeyboardValue_(n+t*this.round_);e.preventDefault();e.stopPropagation()}};o.FieldAngle.prototype.doClassValidation_=function(e){e=+e;return isNaN(e)||!isFinite(e)?null:this.wrapValue_(e)};o.FieldAngle.prototype.wrapValue_=function(e){e%=360;0>e&&(e+=360);e>this.wrap_&&(e-=360);return e};o.Css.register([".blocklyAngleCircle {","stroke: #444;","stroke-width: 1;","fill: #ddd;","fill-opacity: .8;","}",".blocklyAngleMarks {","stroke: #444;","stroke-width: 1;","}",".blocklyAngleGauge {","fill: #f88;","fill-opacity: .8;","pointer-events: none;","}",".blocklyAngleLine {","stroke: #f00;","stroke-width: 2;","stroke-linecap: round;","pointer-events: none;","}"]);o.fieldRegistry.register("field_angle",o.FieldAngle);o.FieldCheckbox=function(e,t,n){this.checkChar_=null;null==e&&(e="FALSE");o.FieldCheckbox.superClass_.constructor.call(this,e,t,n)};o.utils.object.inherits(o.FieldCheckbox,o.Field);o.FieldCheckbox.fromJson=function(e){return new o.FieldCheckbox(e.checked,void 0,e)};o.FieldCheckbox.CHECK_CHAR="\u2713";o.FieldCheckbox.prototype.SERIALIZABLE=!0;o.FieldCheckbox.prototype.CURSOR="default";o.FieldCheckbox.prototype.isDirty_=!1;o.FieldCheckbox.prototype.configure_=function(e){o.FieldCheckbox.superClass_.configure_.call(this,e);e.checkCharacter&&(this.checkChar_=e.checkCharacter)};o.FieldCheckbox.prototype.initView=function(){this.size_.width=this.constants_.FIELD_CHECKBOX_DEFAULT_WIDTH;o.FieldCheckbox.superClass_.initView.call(this);this.textElement_.setAttribute("x",this.constants_.FIELD_CHECKBOX_X_OFFSET);this.textElement_.setAttribute("y",this.constants_.FIELD_CHECKBOX_Y_OFFSET);this.textElement_.removeAttribute("dominant-baseline");o.utils.dom.addClass(this.textElement_,"blocklyCheckbox");this.textContent_.nodeValue=this.checkChar_||o.FieldCheckbox.CHECK_CHAR;this.textElement_.style.display=this.value_?"block":"none"};o.FieldCheckbox.prototype.setCheckCharacter=function(e){this.checkChar_=e;this.textContent_&&(this.textContent_.nodeValue=e||o.FieldCheckbox.CHECK_CHAR)};o.FieldCheckbox.prototype.showEditor_=function(){this.setValue(!this.value_)};o.FieldCheckbox.prototype.doClassValidation_=function(e){return!0===e||"TRUE"===e?"TRUE":!1===e||"FALSE"===e?"FALSE":null};o.FieldCheckbox.prototype.doValueUpdate_=function(e){this.value_=this.convertValueToBool_(e);this.textElement_&&(this.textElement_.style.display=this.value_?"block":"none")};o.FieldCheckbox.prototype.getValue=function(){return this.value_?"TRUE":"FALSE"};o.FieldCheckbox.prototype.getValueBoolean=function(){return this.value_};o.FieldCheckbox.prototype.getText=function(){return this.convertValueToBool_(this.value_)+""};o.FieldCheckbox.prototype.convertValueToBool_=function(e){return"string"==typeof e?"TRUE"==e:!!e};o.fieldRegistry.register("field_checkbox",o.FieldCheckbox);o.FieldColour=function(e,t,n){o.FieldColour.superClass_.constructor.call(this,e||o.FieldColour.COLOURS[0],t,n);this.onKeyDownWrapper_=this.onMouseLeaveWrapper_=this.onMouseEnterWrapper_=this.onMouseMoveWrapper_=this.onClickWrapper_=this.highlightedIndex_=this.picker_=null};o.utils.object.inherits(o.FieldColour,o.Field);o.FieldColour.fromJson=function(e){return new o.FieldColour(e.colour,void 0,e)};o.FieldColour.prototype.SERIALIZABLE=!0;o.FieldColour.prototype.CURSOR="default";o.FieldColour.prototype.isDirty_=!1;o.FieldColour.prototype.colours_=null;o.FieldColour.prototype.titles_=null;o.FieldColour.prototype.columns_=0;o.FieldColour.prototype.configure_=function(e){o.FieldColour.superClass_.configure_.call(this,e);e.colourOptions&&(this.colours_=e.colourOptions,this.titles_=e.colourTitles);e.columns&&(this.columns_=e.columns)};o.FieldColour.prototype.initView=function(){this.size_=new o.utils.Size(this.constants_.FIELD_COLOUR_DEFAULT_WIDTH,this.constants_.FIELD_COLOUR_DEFAULT_HEIGHT);this.constants_.FIELD_COLOUR_FULL_BLOCK?this.clickTarget_=this.sourceBlock_.getSvgRoot():(this.createBorderRect_(),this.borderRect_.style.fillOpacity="1")};o.FieldColour.prototype.applyColour=function(){this.constants_.FIELD_COLOUR_FULL_BLOCK?(this.sourceBlock_.pathObject.svgPath.setAttribute("fill",this.getValue()),this.sourceBlock_.pathObject.svgPath.setAttribute("stroke","#fff")):this.borderRect_&&(this.borderRect_.style.fill=this.getValue())};o.FieldColour.prototype.doClassValidation_=function(e){return"string"!=typeof e?null:o.utils.colour.parse(e)};o.FieldColour.prototype.doValueUpdate_=function(e){this.value_=e;this.borderRect_?this.borderRect_.style.fill=e:this.sourceBlock_&&(this.sourceBlock_.pathObject.svgPath.setAttribute("fill",e),this.sourceBlock_.pathObject.svgPath.setAttribute("stroke","#fff"))};o.FieldColour.prototype.getText=function(){var e=this.value_;/^#(.)\1(.)\2(.)\3$/.test(e)&&(e="#"+e[1]+e[3]+e[5]);return e};o.FieldColour.COLOURS=["#ffffff","#cccccc","#c0c0c0","#999999","#666666","#333333","#000000","#ffcccc","#ff6666","#ff0000","#cc0000","#990000","#660000","#330000","#ffcc99","#ff9966","#ff9900","#ff6600","#cc6600","#993300","#663300","#ffff99","#ffff66","#ffcc66","#ffcc33","#cc9933","#996633","#663333","#ffffcc","#ffff33","#ffff00","#ffcc00","#999900","#666600","#333300","#99ff99","#66ff99","#33ff33","#33cc00","#009900","#006600","#003300","#99ffff","#33ffff","#66cccc","#00cccc","#339999","#336666","#003333","#ccffff","#66ffff","#33ccff","#3366ff","#3333ff","#000099","#000066","#ccccff","#9999ff","#6666cc","#6633ff","#6600cc","#333399","#330099","#ffccff","#ff99ff","#cc66cc","#cc33cc","#993399","#663366","#330033"];o.FieldColour.TITLES=[];o.FieldColour.COLUMNS=7;o.FieldColour.prototype.setColours=function(e,t){this.colours_=e;t&&(this.titles_=t);return this};o.FieldColour.prototype.setColumns=function(e){this.columns_=e;return this};o.FieldColour.prototype.showEditor_=function(){this.picker_=this.dropdownCreate_();o.DropDownDiv.getContentDiv().appendChild(this.picker_);o.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this));this.picker_.focus({preventScroll:!0})};o.FieldColour.prototype.onClick_=function(e){e=(e=e.target)&&e.label;null!==e&&(this.setValue(e),o.DropDownDiv.hideIfOwner(this))};o.FieldColour.prototype.onKeyDown_=function(e){var t=!1;if(e.keyCode===o.utils.KeyCodes.UP)this.moveHighlightBy_(0,-1),t=!0;else if(e.keyCode===o.utils.KeyCodes.DOWN)this.moveHighlightBy_(0,1),t=!0;else if(e.keyCode===o.utils.KeyCodes.LEFT)this.moveHighlightBy_(-1,0),t=!0;else if(e.keyCode===o.utils.KeyCodes.RIGHT)this.moveHighlightBy_(1,0),t=!0;else if(e.keyCode===o.utils.KeyCodes.ENTER){if(t=this.getHighlighted_())t=t&&t.label,null!==t&&this.setValue(t);o.DropDownDiv.hideWithoutAnimation();t=!0}t&&e.stopPropagation()};o.FieldColour.prototype.onBlocklyAction=function(e){if(this.picker_){if(e===o.navigation.ACTION_PREVIOUS)return this.moveHighlightBy_(0,-1),!0;if(e===o.navigation.ACTION_NEXT)return this.moveHighlightBy_(0,1),!0;if(e===o.navigation.ACTION_OUT)return this.moveHighlightBy_(-1,0),!0;if(e===o.navigation.ACTION_IN)return this.moveHighlightBy_(1,0),!0}return o.FieldColour.superClass_.onBlocklyAction.call(this,e)};o.FieldColour.prototype.moveHighlightBy_=function(t,n){var r=this.colours_||o.FieldColour.COLOURS,i=this.columns_||o.FieldColour.COLUMNS,s=this.highlightedIndex_%i,l=Math.floor(this.highlightedIndex_/i);s+=t;l+=n;0>t?0>s&&0<l?(s=i-1,l--):0>s&&(s=0):0<t?s>i-1&&l<Math.floor(r.length/i)-1?(s=0,l++):s>i-1&&s--:0>n?0>l&&(l=0):0<n&&l>Math.floor(r.length/i)-1&&(l=Math.floor(r.length/i)-1);this.setHighlightedCell_(this.picker_.childNodes[l].childNodes[s],l*i+s)};o.FieldColour.prototype.onMouseMove_=function(e){var t=(e=e.target)&&+e.getAttribute("data-index");null!==t&&t!==this.highlightedIndex_&&this.setHighlightedCell_(e,t)};o.FieldColour.prototype.onMouseEnter_=function(){this.picker_.focus({preventScroll:!0})};o.FieldColour.prototype.onMouseLeave_=function(){this.picker_.blur();var e=this.getHighlighted_();e&&o.utils.dom.removeClass(e,"blocklyColourHighlighted")};o.FieldColour.prototype.getHighlighted_=function(){var e=this.columns_||o.FieldColour.COLUMNS,t=this.picker_.childNodes[Math.floor(this.highlightedIndex_/e)];return t?t.childNodes[this.highlightedIndex_%e]:null};o.FieldColour.prototype.setHighlightedCell_=function(e,t){var n=this.getHighlighted_();n&&o.utils.dom.removeClass(n,"blocklyColourHighlighted");o.utils.dom.addClass(e,"blocklyColourHighlighted");this.highlightedIndex_=t;o.utils.aria.setState(this.picker_,o.utils.aria.State.ACTIVEDESCENDANT,e.getAttribute("id"))};o.FieldColour.prototype.dropdownCreate_=function(){var t=this.columns_||o.FieldColour.COLUMNS,n=this.colours_||o.FieldColour.COLOURS,r=this.titles_||o.FieldColour.TITLES,i=this.getValue(),s=document.createElement("table");s.className="blocklyColourTable";s.tabIndex=0;s.dir="ltr";o.utils.aria.setRole(s,o.utils.aria.Role.GRID);o.utils.aria.setState(s,o.utils.aria.State.EXPANDED,!0);o.utils.aria.setState(s,o.utils.aria.State.ROWCOUNT,Math.floor(n.length/t));o.utils.aria.setState(s,o.utils.aria.State.COLCOUNT,t);for(var e,l=0;l<n.length;l++){0==l%t&&(e=document.createElement("tr"),o.utils.aria.setRole(e,o.utils.aria.Role.ROW),s.appendChild(e));var a=document.createElement("td");e.appendChild(a);a.label=n[l];a.title=r[l]||n[l];a.id=o.utils.IdGenerator.getNextUniqueId();a.setAttribute("data-index",l);o.utils.aria.setRole(a,o.utils.aria.Role.GRIDCELL);o.utils.aria.setState(a,o.utils.aria.State.LABEL,n[l]);o.utils.aria.setState(a,o.utils.aria.State.SELECTED,n[l]==i);a.style.backgroundColor=n[l];n[l]==i&&(a.className="blocklyColourSelected",this.highlightedIndex_=l)}this.onClickWrapper_=o.bindEventWithChecks_(s,"click",this,this.onClick_,!0);this.onMouseMoveWrapper_=o.bindEventWithChecks_(s,"mousemove",this,this.onMouseMove_,!0);this.onMouseEnterWrapper_=o.bindEventWithChecks_(s,"mouseenter",this,this.onMouseEnter_,!0);this.onMouseLeaveWrapper_=o.bindEventWithChecks_(s,"mouseleave",this,this.onMouseLeave_,!0);this.onKeyDownWrapper_=o.bindEventWithChecks_(s,"keydown",this,this.onKeyDown_);return s};o.FieldColour.prototype.dropdownDispose_=function(){this.onClickWrapper_&&(o.unbindEvent_(this.onClickWrapper_),this.onClickWrapper_=null);this.onMouseMoveWrapper_&&(o.unbindEvent_(this.onMouseMoveWrapper_),this.onMouseMoveWrapper_=null);this.onMouseEnterWrapper_&&(o.unbindEvent_(this.onMouseEnterWrapper_),this.onMouseEnterWrapper_=null);this.onMouseLeaveWrapper_&&(o.unbindEvent_(this.onMouseLeaveWrapper_),this.onMouseLeaveWrapper_=null);this.onKeyDownWrapper_&&(o.unbindEvent_(this.onKeyDownWrapper_),this.onKeyDownWrapper_=null);this.highlightedIndex_=this.picker_=null};o.Css.register([".blocklyColourTable {","border-collapse: collapse;","display: block;","outline: none;","padding: 1px;","}",".blocklyColourTable>tr>td {","border: .5px solid #888;","box-sizing: border-box;","cursor: pointer;","display: inline-block;","height: 20px;","padding: 0;","width: 20px;","}",".blocklyColourTable>tr>td.blocklyColourHighlighted {","border-color: #eee;","box-shadow: 2px 2px 7px 2px rgba(0,0,0,.3);","position: relative;","}",".blocklyColourSelected, .blocklyColourSelected:hover {","border-color: #eee !important;","outline: 1px solid #333;","position: relative;","}"]);o.fieldRegistry.register("field_colour",o.FieldColour);o.FieldDropdown=function(e,t,n){"function"!=typeof e&&o.FieldDropdown.validateOptions_(e);this.menuGenerator_=e;this.generatedOptions_=null;this.trimOptions_();this.selectedOption_=this.getOptions(!1)[0];o.FieldDropdown.superClass_.constructor.call(this,this.selectedOption_[1],t,n);this.svgArrow_=this.arrow_=this.imageElement_=this.menu_=this.selectedMenuItem_=null};o.utils.object.inherits(o.FieldDropdown,o.Field);o.FieldDropdown.fromJson=function(e){return new o.FieldDropdown(e.options,void 0,e)};o.FieldDropdown.prototype.SERIALIZABLE=!0;o.FieldDropdown.CHECKMARK_OVERHANG=25;o.FieldDropdown.MAX_MENU_HEIGHT_VH=.45;o.FieldDropdown.IMAGE_Y_OFFSET=5;o.FieldDropdown.IMAGE_Y_PADDING=2*o.FieldDropdown.IMAGE_Y_OFFSET;o.FieldDropdown.ARROW_CHAR=o.utils.userAgent.ANDROID?"\u25BC":"\u25BE";o.FieldDropdown.prototype.CURSOR="default";o.FieldDropdown.prototype.initView=function(){this.shouldAddBorderRect_()?this.createBorderRect_():this.clickTarget_=this.sourceBlock_.getSvgRoot();this.createTextElement_();this.imageElement_=o.utils.dom.createSvgElement("image",{},this.fieldGroup_);this.constants_.FIELD_DROPDOWN_SVG_ARROW?this.createSVGArrow_():this.createTextArrow_();this.borderRect_&&o.utils.dom.addClass(this.borderRect_,"blocklyDropdownRect")};o.FieldDropdown.prototype.shouldAddBorderRect_=function(){return!this.constants_.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||this.constants_.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW&&!this.sourceBlock_.isShadow()};o.FieldDropdown.prototype.createTextArrow_=function(){this.arrow_=o.utils.dom.createSvgElement("tspan",{},this.textElement_);this.arrow_.appendChild(document.createTextNode(this.sourceBlock_.RTL?o.FieldDropdown.ARROW_CHAR+" ":" "+o.FieldDropdown.ARROW_CHAR));this.sourceBlock_.RTL?this.textElement_.insertBefore(this.arrow_,this.textContent_):this.textElement_.appendChild(this.arrow_)};o.FieldDropdown.prototype.createSVGArrow_=function(){this.svgArrow_=o.utils.dom.createSvgElement("image",{height:this.constants_.FIELD_DROPDOWN_SVG_ARROW_SIZE+"px",width:this.constants_.FIELD_DROPDOWN_SVG_ARROW_SIZE+"px"},this.fieldGroup_);this.svgArrow_.setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",this.constants_.FIELD_DROPDOWN_SVG_ARROW_DATAURI)};o.FieldDropdown.prototype.showEditor_=function(e){this.menu_=this.dropdownCreate_();this.menu_.openingCoords=e&&"number"==typeof e.clientX?new o.utils.Coordinate(e.clientX,e.clientY):null;this.menu_.render(o.DropDownDiv.getContentDiv());o.utils.dom.addClass(this.menu_.getElement(),"blocklyDropdownMenu");if(this.constants_.FIELD_DROPDOWN_COLOURED_DIV){e=this.sourceBlock_.isShadow()?this.sourceBlock_.getParent().getColour():this.sourceBlock_.getColour();var t=this.sourceBlock_.isShadow()?this.sourceBlock_.getParent().style.colourTertiary:this.sourceBlock_.style.colourTertiary;o.DropDownDiv.setColour(e,t)}o.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this));this.menu_.focus();this.selectedMenuItem_&&o.utils.style.scrollIntoContainerView(this.selectedMenuItem_.getElement(),this.menu_.getElement());this.applyColour()};o.FieldDropdown.prototype.dropdownCreate_=function(){var t=new o.Menu;t.setRightToLeft(this.sourceBlock_.RTL);t.setRole(o.utils.aria.Role.LISTBOX);var n=this.getOptions(!1);this.selectedMenuItem_=null;for(var r=0;r<n.length;r++){var i=n[r][0],s=n[r][1];if("object"==_typeof(i)){var e=new Image(i.width,i.height);e.src=i.src;e.alt=i.alt||"";i=e}i=new o.MenuItem(i);i.setRole(o.utils.aria.Role.OPTION);i.setRightToLeft(this.sourceBlock_.RTL);i.setValue(s);i.setCheckable(!0);t.addChild(i,!0);i.setChecked(s==this.value_);s==this.value_&&(this.selectedMenuItem_=i);i.onAction(this.handleMenuActionEvent_,this)}o.utils.aria.setState(t.getElement(),o.utils.aria.State.ACTIVEDESCENDANT,this.selectedMenuItem_?this.selectedMenuItem_.getId():"");return t};o.FieldDropdown.prototype.dropdownDispose_=function(){this.menu_&&this.menu_.dispose();this.selectedMenuItem_=this.menu_=null;this.applyColour()};o.FieldDropdown.prototype.handleMenuActionEvent_=function(e){o.DropDownDiv.hideIfOwner(this,!0);this.onItemSelected_(this.menu_,e)};o.FieldDropdown.prototype.onItemSelected_=function(e,t){this.setValue(t.getValue())};o.FieldDropdown.prototype.trimOptions_=function(){this.suffixField=this.prefixField=null;var t=this.menuGenerator_;if(Array.isArray(t)){for(var n=!1,r=0,i;r<t.length;r++){i=t[r][0];"string"==typeof i?t[r][0]=o.utils.replaceMessageReferences(i):(null!=i.alt&&(t[r][0].alt=o.utils.replaceMessageReferences(i.alt)),n=!0)}if(!(n||2>t.length)){n=[];for(r=0;r<t.length;r++){n.push(t[r][0])}r=o.utils.string.shortestStringLength(n);i=o.utils.string.commonWordPrefix(n,r);var s=o.utils.string.commonWordSuffix(n,r);(i||s)&&!(r<=i+s)&&(i&&(this.prefixField=n[0].substring(0,i-1)),s&&(this.suffixField=n[0].substr(1-s)),this.menuGenerator_=o.FieldDropdown.applyTrim_(t,i,s))}}};o.FieldDropdown.applyTrim_=function(t,o,n){for(var r=[],i=0;i<t.length;i++){var s=t[i][0],l=t[i][1];s=s.substring(o,s.length-n);r[i]=[s,l]}return r};o.FieldDropdown.prototype.isOptionListDynamic=function(){return"function"==typeof this.menuGenerator_};o.FieldDropdown.prototype.getOptions=function(e){return this.isOptionListDynamic()?(this.generatedOptions_&&e||(this.generatedOptions_=this.menuGenerator_.call(this),o.FieldDropdown.validateOptions_(this.generatedOptions_)),this.generatedOptions_):this.menuGenerator_};o.FieldDropdown.prototype.doClassValidation_=function(t){for(var o=!1,n=this.getOptions(!0),r=0,i;i=n[r];r++){if(i[1]==t){o=!0;break}}return o?t:(this.sourceBlock_&&console.warn("Cannot set the dropdown's value to an unavailable option. Block type: "+this.sourceBlock_.type+", Field name: "+this.name+", Value: "+t),null)};o.FieldDropdown.prototype.doValueUpdate_=function(e){o.FieldDropdown.superClass_.doValueUpdate_.call(this,e);e=this.getOptions(!0);for(var t=0,n;n=e[t];t++){n[1]==this.value_&&(this.selectedOption_=n)}};o.FieldDropdown.prototype.applyColour=function(){this.borderRect_&&(this.borderRect_.setAttribute("stroke",this.sourceBlock_.style.colourTertiary),this.menu_?this.borderRect_.setAttribute("fill",this.sourceBlock_.style.colourTertiary):this.borderRect_.setAttribute("fill","transparent"));this.sourceBlock_&&this.arrow_&&(this.sourceBlock_.isShadow()?this.arrow_.style.fill=this.sourceBlock_.style.colourSecondary:this.arrow_.style.fill=this.sourceBlock_.style.colourPrimary)};o.FieldDropdown.prototype.render_=function(){this.textContent_.nodeValue="";this.imageElement_.style.display="none";var e=this.selectedOption_&&this.selectedOption_[0];e&&"object"==_typeof(e)?this.renderSelectedImage_(e):this.renderSelectedText_();this.borderRect_&&(this.borderRect_.setAttribute("height",this.size_.height),this.borderRect_.setAttribute("width",this.size_.width))};o.FieldDropdown.prototype.renderSelectedImage_=function(t){this.imageElement_.style.display="";this.imageElement_.setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",t.src);this.imageElement_.setAttribute("height",t.height);this.imageElement_.setAttribute("width",t.width);var n=+t.height,r=+t.width,i=!!this.borderRect_;this.size_.height=Math.max(i?this.constants_.FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,n+o.FieldDropdown.IMAGE_Y_PADDING);t=this.size_.height/2;i=i?this.constants_.FIELD_BORDER_RECT_X_PADDING:0;var s=this.svgArrow_?this.positionSVGArrow_(r+i,t-this.constants_.FIELD_DROPDOWN_SVG_ARROW_SIZE/2):o.utils.dom.getFastTextWidth(this.arrow_,this.constants_.FIELD_TEXT_FONTSIZE,this.constants_.FIELD_TEXT_FONTWEIGHT,this.constants_.FIELD_TEXT_FONTFAMILY);this.size_.width=r+s+2*i;this.sourceBlock_.RTL?(r=i-1,this.imageElement_.setAttribute("x",i+s),this.textElement_.setAttribute("x",r)):(r=r+s+i+1,this.textElement_.setAttribute("text-anchor","end"),this.textElement_.setAttribute("x",r),this.imageElement_.setAttribute("x",i));this.imageElement_.setAttribute("y",t-n/2)};o.FieldDropdown.prototype.renderSelectedText_=function(){this.textContent_.nodeValue=this.getDisplayText_();o.utils.dom.addClass(this.textElement_,"blocklyDropdownText");this.textElement_.setAttribute("text-anchor","start");var e=!!this.borderRect_;this.size_.height=Math.max(e?this.constants_.FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,this.constants_.FIELD_TEXT_HEIGHT);var t=this.size_.height/2,n=o.utils.dom.getFastTextWidth(this.textElement_,this.constants_.FIELD_TEXT_FONTSIZE,this.constants_.FIELD_TEXT_FONTWEIGHT,this.constants_.FIELD_TEXT_FONTFAMILY);e=e?this.constants_.FIELD_BORDER_RECT_X_PADDING:0;var r=0;this.svgArrow_&&(r=this.positionSVGArrow_(n+e,t-this.constants_.FIELD_DROPDOWN_SVG_ARROW_SIZE/2));this.size_.width=n+r+2*e;this.textElement_.setAttribute("x",this.sourceBlock_.RTL?this.size_.width-n-e:e);this.textElement_.setAttribute("y",t);this.constants_.FIELD_TEXT_BASELINE_CENTER||this.textElement_.setAttribute("dy",this.constants_.FIELD_TEXT_BASELINE_Y-this.constants_.FIELD_TEXT_HEIGHT/2+this.constants_.FIELD_TEXT_Y_OFFSET)};o.FieldDropdown.prototype.positionSVGArrow_=function(t,o){if(!this.svgArrow_)return 0;var n=this.borderRect_?this.constants_.FIELD_BORDER_RECT_X_PADDING:0,r=this.constants_.FIELD_DROPDOWN_SVG_ARROW_PADDING,i=this.constants_.FIELD_DROPDOWN_SVG_ARROW_SIZE;this.svgArrow_.setAttribute("transform","translate("+(this.sourceBlock_.RTL?n:t+r)+","+o+")");return i+r};o.FieldDropdown.prototype.getText_=function(){if(!this.selectedOption_)return null;var e=this.selectedOption_[0];return"object"==_typeof(e)?e.alt:e};o.FieldDropdown.validateOptions_=function(e){if(!Array.isArray(e))throw TypeError("FieldDropdown options must be an array.");if(!e.length)throw TypeError("FieldDropdown options must not be an empty array.");for(var t=!1,o=0,n;o<e.length;++o){n=e[o];Array.isArray(n)?"string"!=typeof n[1]?(t=!0,console.error("Invalid option["+o+"]: Each FieldDropdown option id must be a string. Found "+n[1]+" in: ",n)):n[0]&&"string"!=typeof n[0]&&"string"!=typeof n[0].src&&(t=!0,console.error("Invalid option["+o+"]: Each FieldDropdown option must have a string label or image description. Found"+n[0]+" in: ",n)):(t=!0,console.error("Invalid option["+o+"]: Each FieldDropdown option must be an array. Found: ",n))}if(t)throw TypeError("Found invalid FieldDropdown options.")};o.FieldDropdown.prototype.onBlocklyAction=function(e){if(this.menu_){if(e===o.navigation.ACTION_PREVIOUS)return this.menu_.highlightPrevious(),!0;if(e===o.navigation.ACTION_NEXT)return this.menu_.highlightNext(),!0}return o.FieldDropdown.superClass_.onBlocklyAction.call(this,e)};o.fieldRegistry.register("field_dropdown",o.FieldDropdown);o.FieldLabelSerializable=function(e,t,n){o.FieldLabelSerializable.superClass_.constructor.call(this,e,t,n)};o.utils.object.inherits(o.FieldLabelSerializable,o.FieldLabel);o.FieldLabelSerializable.fromJson=function(e){var t=o.utils.replaceMessageReferences(e.text);return new o.FieldLabelSerializable(t,void 0,e)};o.FieldLabelSerializable.prototype.EDITABLE=!1;o.FieldLabelSerializable.prototype.SERIALIZABLE=!0;o.fieldRegistry.register("field_label_serializable",o.FieldLabelSerializable);o.FieldImage=function(t,n,r,i,s,e,l){if(!t)throw Error("Src value of an image field is required");t=o.utils.replaceMessageReferences(t);r=+o.utils.replaceMessageReferences(r);n=+o.utils.replaceMessageReferences(n);if(isNaN(r)||isNaN(n))throw Error("Height and width values of an image field must cast to numbers.");if(0>=r||0>=n)throw Error("Height and width values of an image field must be greater than 0.");this.flipRtl_=!1;this.altText_="";o.FieldImage.superClass_.constructor.call(this,t||"",null,l);l||(this.flipRtl_=!!e,this.altText_=o.utils.replaceMessageReferences(i)||"");this.size_=new o.utils.Size(n,r+o.FieldImage.Y_PADDING);this.imageHeight_=r;this.clickHandler_=null;"function"==typeof s&&(this.clickHandler_=s);this.imageElement_=null};o.utils.object.inherits(o.FieldImage,o.Field);o.FieldImage.fromJson=function(e){return new o.FieldImage(e.src,e.width,e.height,void 0,void 0,void 0,e)};o.FieldImage.Y_PADDING=1;o.FieldImage.prototype.EDITABLE=!1;o.FieldImage.prototype.isDirty_=!1;o.FieldImage.prototype.configure_=function(e){o.FieldImage.superClass_.configure_.call(this,e);this.flipRtl_=!!e.flipRtl;this.altText_=o.utils.replaceMessageReferences(e.alt)||""};o.FieldImage.prototype.initView=function(){this.imageElement_=o.utils.dom.createSvgElement("image",{height:this.imageHeight_+"px",width:this.size_.width+"px",alt:this.altText_},this.fieldGroup_);this.imageElement_.setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",this.value_)};o.FieldImage.prototype.doClassValidation_=function(e){return"string"!=typeof e?null:e};o.FieldImage.prototype.doValueUpdate_=function(e){this.value_=e;this.imageElement_&&this.imageElement_.setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",this.value_+"")};o.FieldImage.prototype.getFlipRtl=function(){return this.flipRtl_};o.FieldImage.prototype.setAlt=function(e){e!=this.altText_&&(this.altText_=e||"",this.imageElement_&&this.imageElement_.setAttribute("alt",this.altText_))};o.FieldImage.prototype.showEditor_=function(){this.clickHandler_&&this.clickHandler_(this)};o.FieldImage.prototype.setOnClickHandler=function(e){this.clickHandler_=e};o.FieldImage.prototype.getText_=function(){return this.altText_};o.fieldRegistry.register("field_image",o.FieldImage);o.FieldMultilineInput=function(e,t,n){null==e&&(e="");o.FieldMultilineInput.superClass_.constructor.call(this,e,t,n);this.textGroup_=null};o.utils.object.inherits(o.FieldMultilineInput,o.FieldTextInput);o.FieldMultilineInput.LINE_HEIGHT=20;o.FieldMultilineInput.fromJson=function(e){var t=o.utils.replaceMessageReferences(e.text);return new o.FieldMultilineInput(t,void 0,e)};o.FieldMultilineInput.prototype.initView=function(){this.createBorderRect_();this.textGroup_=o.utils.dom.createSvgElement("g",{class:"blocklyEditableText"},this.fieldGroup_)};o.FieldMultilineInput.prototype.getDisplayText_=function(){var e=this.value_;if(!e)return o.Field.NBSP;var t=e.split("\n");e="";for(var n=0,r;n<t.length;n++){r=t[n];r.length>this.maxDisplayLength&&(r=r.substring(0,this.maxDisplayLength-4)+"...");r=r.replace(/\s/g,o.Field.NBSP);e+=r;n!=t.length-1&&(e+="\n")}this.sourceBlock_.RTL&&(e+="\u200F");return e};o.FieldMultilineInput.prototype.render_=function(){for(var e;e=this.textGroup_.firstChild;){this.textGroup_.removeChild(e)}e=this.getDisplayText_().split("\n");for(var t=0,n=0;n<e.length;n++){o.utils.dom.createSvgElement("text",{class:"blocklyText blocklyMultilineText",x:this.constants_.FIELD_BORDER_RECT_X_PADDING,y:t+this.constants_.FIELD_BORDER_RECT_Y_PADDING,dy:o.FieldMultilineInput.LINE_HEIGHT/2},this.textGroup_).appendChild(document.createTextNode(e[n])),t+=o.FieldMultilineInput.LINE_HEIGHT}this.updateSize_();this.isBeingEdited_&&(this.sourceBlock_.RTL?setTimeout(this.resizeEditor_.bind(this),0):this.resizeEditor_(),e=this.htmlInput_,this.isTextValid_?(o.utils.dom.removeClass(e,"blocklyInvalidInput"),o.utils.aria.setState(e,o.utils.aria.State.INVALID,!1)):(o.utils.dom.addClass(e,"blocklyInvalidInput"),o.utils.aria.setState(e,o.utils.aria.State.INVALID,!0)))};o.FieldMultilineInput.prototype.updateSize_=function(){for(var t=this.textGroup_.childNodes,n=0,r=0,i=0,s;i<t.length;i++){s=o.utils.dom.getTextWidth(t[i]);s>n&&(n=s);r+=o.FieldMultilineInput.LINE_HEIGHT}this.borderRect_&&(n+=2*this.constants_.FIELD_BORDER_RECT_X_PADDING,this.borderRect_.setAttribute("width",n),this.borderRect_.setAttribute("height",r));this.size_.width=n;this.size_.height=r};o.FieldMultilineInput.prototype.resizeEditor_=function(){var e=o.WidgetDiv.DIV,t=this.getScaledBBox();e.style.width=t.right-t.left+"px";e.style.height=t.bottom-t.top+"px";t=new o.utils.Coordinate(this.sourceBlock_.RTL?t.right-e.offsetWidth:t.left,t.top);e.style.left=t.x+"px";e.style.top=t.y+"px"};o.FieldMultilineInput.prototype.widgetCreate_=function(){var e=o.WidgetDiv.DIV,t=this.workspace_.scale,n=document.createElement("textarea");n.className="blocklyHtmlInput blocklyHtmlTextAreaInput";n.setAttribute("spellcheck",this.spellcheck_);var r=this.constants_.FIELD_TEXT_FONTSIZE*t+"pt";e.style.fontSize=r;n.style.fontSize=r;n.style.borderRadius=o.FieldTextInput.BORDERRADIUS*t+"px";r=this.constants_.FIELD_BORDER_RECT_X_PADDING*t;n.style.paddingLeft=r+"px";n.style.width="calc(100% - "+r+"px)";n.style.lineHeight=o.FieldMultilineInput.LINE_HEIGHT*t+"px";e.appendChild(n);n.value=n.defaultValue=this.getEditorText_(this.value_);n.untypedDefaultValue_=this.value_;n.oldValue_=null;o.utils.userAgent.GECKO?setTimeout(this.resizeEditor_.bind(this),0):this.resizeEditor_();this.bindInputEvents_(n);return n};o.FieldMultilineInput.prototype.onHtmlInputKeyDown_=function(e){e.keyCode!==o.utils.KeyCodes.ENTER&&o.FieldMultilineInput.superClass_.onHtmlInputKeyDown_.call(this,e)};o.Css.register([".blocklyHtmlTextAreaInput {","font-family: monospace;","resize: none;","overflow: hidden;","height: 100%;","text-align: left;","}"]);o.fieldRegistry.register("field_multilinetext",o.FieldMultilineInput);o.FieldNumber=function(t,n,r,i,s,e){this.min_=-Infinity;this.max_=1/0;this.precision_=0;this.decimalPlaces_=null;o.FieldNumber.superClass_.constructor.call(this,t||0,s,e);e||this.setConstraints(n,r,i)};o.utils.object.inherits(o.FieldNumber,o.FieldTextInput);o.FieldNumber.fromJson=function(e){return new o.FieldNumber(e.value,void 0,void 0,void 0,void 0,e)};o.FieldNumber.prototype.SERIALIZABLE=!0;o.FieldNumber.prototype.configure_=function(e){o.FieldNumber.superClass_.configure_.call(this,e);this.setMinInternal_(e.min);this.setMaxInternal_(e.max);this.setPrecisionInternal_(e.precision)};o.FieldNumber.prototype.setConstraints=function(e,t,o){this.setMinInternal_(e);this.setMaxInternal_(t);this.setPrecisionInternal_(o);this.setValue(this.getValue())};o.FieldNumber.prototype.setMin=function(e){this.setMinInternal_(e);this.setValue(this.getValue())};o.FieldNumber.prototype.setMinInternal_=function(e){null==e?this.min_=-Infinity:(e=+e,isNaN(e)||(this.min_=e))};o.FieldNumber.prototype.getMin=function(){return this.min_};o.FieldNumber.prototype.setMax=function(e){this.setMaxInternal_(e);this.setValue(this.getValue())};o.FieldNumber.prototype.setMaxInternal_=function(e){null==e?this.max_=1/0:(e=+e,isNaN(e)||(this.max_=e))};o.FieldNumber.prototype.getMax=function(){return this.max_};o.FieldNumber.prototype.setPrecision=function(e){this.setPrecisionInternal_(e);this.setValue(this.getValue())};o.FieldNumber.prototype.setPrecisionInternal_=function(e){null==e?this.precision_=0:(e=+e,isNaN(e)||(this.precision_=e));var t=this.precision_.toString(),o=t.indexOf(".");this.decimalPlaces_=-1==o?e?0:null:t.length-o-1};o.FieldNumber.prototype.getPrecision=function(){return this.precision_};o.FieldNumber.prototype.doClassValidation_=function(e){if(null===e)return null;e=e+"";e=e.replace(/O/ig,"0");e=e.replace(/,/g,"");e=e.replace(/infinity/i,"Infinity");e=+(e||0);if(isNaN(e))return null;e=Math.min(Math.max(e,this.min_),this.max_);this.precision_&&isFinite(e)&&(e=Math.round(e/this.precision_)*this.precision_);null!=this.decimalPlaces_&&(e=+e.toFixed(this.decimalPlaces_));return e};o.FieldNumber.prototype.widgetCreate_=function(){var e=o.FieldNumber.superClass_.widgetCreate_.call(this);-Infinity<this.min_&&o.utils.aria.setState(e,o.utils.aria.State.VALUEMIN,this.min_);1/0>this.max_&&o.utils.aria.setState(e,o.utils.aria.State.VALUEMAX,this.max_);return e};o.fieldRegistry.register("field_number",o.FieldNumber);o.FieldVariable=function(t,n,r,i,s){this.menuGenerator_=o.FieldVariable.dropdownCreate;this.defaultVariableName=t||"";this.size_=new o.utils.Size(0,0);s&&this.configure_(s);n&&this.setValidator(n);s||this.setTypes_(r,i)};o.utils.object.inherits(o.FieldVariable,o.FieldDropdown);o.FieldVariable.fromJson=function(e){var t=o.utils.replaceMessageReferences(e.variable);return new o.FieldVariable(t,void 0,void 0,void 0,e)};o.FieldVariable.prototype.workspace_=null;o.FieldVariable.prototype.SERIALIZABLE=!0;o.FieldVariable.prototype.configure_=function(e){o.FieldVariable.superClass_.configure_.call(this,e);this.setTypes_(e.variableTypes,e.defaultType)};o.FieldVariable.prototype.initModel=function(){if(!this.variable_){var e=o.Variables.getOrCreateVariablePackage(this.sourceBlock_.workspace,null,this.defaultVariableName,this.defaultType_);this.doValueUpdate_(e.getId())}};o.FieldVariable.prototype.shouldAddBorderRect_=function(){return o.FieldVariable.superClass_.shouldAddBorderRect_.call(this)&&(!this.constants_.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||"variables_get"!=this.sourceBlock_.type)};o.FieldVariable.prototype.fromXml=function(e){var t=e.getAttribute("id"),n=e.textContent,r=e.getAttribute("variabletype")||e.getAttribute("variableType")||"";t=o.Variables.getOrCreateVariablePackage(this.sourceBlock_.workspace,t,n,r);if(null!=r&&r!==t.type)throw Error("Serialized variable type with id '"+t.getId()+"' had type "+t.type+", and does not match variable field that references it: "+o.Xml.domToText(e)+".");this.setValue(t.getId())};o.FieldVariable.prototype.toXml=function(e){this.initModel();e.id=this.variable_.getId();e.textContent=this.variable_.name;this.variable_.type&&e.setAttribute("variabletype",this.variable_.type);return e};o.FieldVariable.prototype.setSourceBlock=function(e){if(e.isShadow())throw Error("Variable fields are not allowed to exist on shadow blocks.");o.FieldVariable.superClass_.setSourceBlock.call(this,e)};o.FieldVariable.prototype.getValue=function(){return this.variable_?this.variable_.getId():null};o.FieldVariable.prototype.getText=function(){return this.variable_?this.variable_.name:""};o.FieldVariable.prototype.getVariable=function(){return this.variable_};o.FieldVariable.prototype.getValidator=function(){return this.variable_?this.validator_:null};o.FieldVariable.prototype.doClassValidation_=function(e){if(null===e)return null;var t=o.Variables.getVariable(this.sourceBlock_.workspace,e);if(!t)return console.warn("Variable id doesn't point to a real variable! ID was "+e),null;t=t.type;return this.typeIsAllowed_(t)?e:(console.warn("Variable type doesn't match this field!  Type was "+t),null)};o.FieldVariable.prototype.doValueUpdate_=function(e){this.variable_=o.Variables.getVariable(this.sourceBlock_.workspace,e);o.FieldVariable.superClass_.doValueUpdate_.call(this,e)};o.FieldVariable.prototype.typeIsAllowed_=function(e){var t=this.getVariableTypes_();if(!t)return!0;for(var o=0;o<t.length;o++){if(e==t[o])return!0}return!1};o.FieldVariable.prototype.getVariableTypes_=function(){var e=this.variableTypes;if(null===e&&this.sourceBlock_&&this.sourceBlock_.workspace)return this.sourceBlock_.workspace.getVariableTypes();e=e||[""];if(0==e.length)throw e=this.getText(),Error("'variableTypes' of field variable "+e+" was an empty list");return e};o.FieldVariable.prototype.setTypes_=function(e,t){t=t||"";if(null==e||void 0==e)e=null;else if(Array.isArray(e)){for(var o=!1,n=0;n<e.length;n++){e[n]==t&&(o=!0)}if(!o)throw Error("Invalid default type '"+t+"' in the definition of a FieldVariable")}else throw Error("'variableTypes' was not an array in the definition of a FieldVariable");this.defaultType_=t;this.variableTypes=e};o.FieldVariable.prototype.refreshVariableName=function(){this.forceRerender()};o.FieldVariable.dropdownCreate=function(){if(!this.variable_)throw Error("Tried to call dropdownCreate on a variable field with no variable selected.");var t=this.getText(),n=[];if(this.sourceBlock_&&this.sourceBlock_.workspace)for(var r=this.getVariableTypes_(),i=0,s;i<r.length;i++){s=this.sourceBlock_.workspace.getVariablesOfType(r[i]);n=n.concat(s)}n.sort(o.VariableModel.compareByName);r=[];for(i=0;i<n.length;i++){r[i]=[n[i].name,n[i].getId()]}r.push([o.Msg.RENAME_VARIABLE,o.RENAME_VARIABLE_ID]);o.Msg.DELETE_VARIABLE&&r.push([o.Msg.DELETE_VARIABLE.replace("%1",t),o.DELETE_VARIABLE_ID]);return r};o.FieldVariable.prototype.onItemSelected_=function(e,t){e=t.getValue();if(this.sourceBlock_&&this.sourceBlock_.workspace){if(e==o.RENAME_VARIABLE_ID){o.Variables.renameVariable(this.sourceBlock_.workspace,this.variable_);return}if(e==o.DELETE_VARIABLE_ID){this.sourceBlock_.workspace.deleteVariableById(this.variable_.getId());return}}this.setValue(e)};o.FieldVariable.prototype.referencesVariables=function(){return!0};o.fieldRegistry.register("field_variable",o.FieldVariable);o.utils.svgPaths={};o.utils.svgPaths.point=function(e,t){return" "+e+","+t+" "};o.utils.svgPaths.curve=function(e,t){return" "+e+t.join("")};o.utils.svgPaths.moveTo=function(e,t){return" M "+e+","+t+" "};o.utils.svgPaths.moveBy=function(e,t){return" m "+e+","+t+" "};o.utils.svgPaths.lineTo=function(e,t){return" l "+e+","+t+" "};o.utils.svgPaths.line=function(e){return" l"+e.join("")};o.utils.svgPaths.lineOnAxis=function(e,t){return" "+e+" "+t+" "};o.utils.svgPaths.arc=function(e,t,o,n){return e+" "+o+" "+o+" "+t+n};o.blockRendering.ConstantProvider=function(){this.NO_PADDING=0;this.SMALL_PADDING=3;this.MEDIUM_PADDING=5;this.MEDIUM_LARGE_PADDING=8;this.LARGE_PADDING=10;this.TALL_INPUT_FIELD_OFFSET_Y=this.MEDIUM_PADDING;this.TAB_HEIGHT=15;this.TAB_OFFSET_FROM_TOP=5;this.TAB_VERTICAL_OVERLAP=2.5;this.TAB_WIDTH=8;this.NOTCH_WIDTH=15;this.NOTCH_HEIGHT=4;this.MIN_BLOCK_WIDTH=12;this.EMPTY_BLOCK_SPACER_HEIGHT=16;this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=this.DUMMY_INPUT_MIN_HEIGHT=this.TAB_HEIGHT;this.CORNER_RADIUS=8;this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT=15;this.STATEMENT_BOTTOM_SPACER=0;this.STATEMENT_INPUT_PADDING_LEFT=20;this.BETWEEN_STATEMENT_PADDING_Y=4;this.TOP_ROW_MIN_HEIGHT=this.MEDIUM_PADDING;this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING;this.BOTTOM_ROW_MIN_HEIGHT=this.MEDIUM_PADDING;this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING;this.ADD_START_HATS=!1;this.START_HAT_HEIGHT=15;this.START_HAT_WIDTH=100;this.SPACER_DEFAULT_HEIGHT=15;this.MIN_BLOCK_HEIGHT=24;this.EMPTY_INLINE_INPUT_PADDING=14.5;this.EMPTY_INLINE_INPUT_HEIGHT=this.TAB_HEIGHT+11;this.EXTERNAL_VALUE_INPUT_PADDING=2;this.EMPTY_STATEMENT_INPUT_HEIGHT=this.MIN_BLOCK_HEIGHT;this.START_POINT=o.utils.svgPaths.moveBy(0,0);this.JAGGED_TEETH_HEIGHT=12;this.JAGGED_TEETH_WIDTH=6;this.FIELD_TEXT_FONTSIZE=11;this.FIELD_TEXT_HEIGHT=16;this.FIELD_TEXT_FONTWEIGHT="normal";this.FIELD_TEXT_FONTFAMILY="sans-serif";this.FIELD_BORDER_RECT_RADIUS=4;this.FIELD_BORDER_RECT_HEIGHT=16;this.FIELD_BORDER_RECT_X_PADDING=5;this.FIELD_BORDER_RECT_Y_PADDING=3;this.FIELD_BORDER_RECT_COLOUR="#fff";this.FIELD_TEXT_BASELINE_Y=o.utils.userAgent.GECKO?12:13.09;this.FIELD_TEXT_Y_OFFSET=0;this.FIELD_TEXT_BASELINE_CENTER=!o.utils.userAgent.IE&&!o.utils.userAgent.EDGE;this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT;this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!1;this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING;this.FIELD_DROPDOWN_SVG_ARROW_SIZE=12;this.FIELD_DROPDOWN_SVG_ARROW_DATAURI="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=";this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=!1;this.FIELD_COLOUR_DEFAULT_WIDTH=26;this.FIELD_COLOUR_DEFAULT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT;this.FIELD_CHECKBOX_X_OFFSET=this.FIELD_BORDER_RECT_X_PADDING-3;this.FIELD_CHECKBOX_Y_OFFSET=14;this.FIELD_CHECKBOX_DEFAULT_WIDTH=15;this.randomIdentifier_=(Math.random()+"").substring(2);this.embossFilterId="";this.embossFilter_=null;this.disabledPatternId="";this.disabledPattern_=null;this.CURSOR_COLOUR="#cc0a0a";this.MARKER_COLOUR="#4286f4";this.CURSOR_WS_WIDTH=100;this.WS_CURSOR_HEIGHT=5;this.CURSOR_STACK_PADDING=10;this.CURSOR_BLOCK_PADDING=2;this.CURSOR_STROKE_WIDTH=4;this.FULL_BLOCK_FIELDS=!1;this.SHAPES={PUZZLE:1,NOTCH:2}};o.blockRendering.ConstantProvider.prototype.init=function(){this.JAGGED_TEETH=this.makeJaggedTeeth();this.NOTCH=this.makeNotch();this.START_HAT=this.makeStartHat();this.PUZZLE_TAB=this.makePuzzleTab();this.INSIDE_CORNERS=this.makeInsideCorners();this.OUTSIDE_CORNERS=this.makeOutsideCorners()};o.blockRendering.ConstantProvider.prototype.refreshTheme=function(e){this.blockStyles={};e=e.blockStyles;for(var t in e){this.blockStyles[t]=this.validatedBlockStyle_(e[t])}};o.blockRendering.ConstantProvider.prototype.getBlockStyleForColour=function(e){var t="auto_"+e;this.blockStyles[t]||(this.blockStyles[t]=this.createBlockStyle_(e));return{style:this.blockStyles[t],name:t}};o.blockRendering.ConstantProvider.prototype.getBlockStyle=function(e){return this.blockStyles[e||""]||this.createBlockStyle_("#000000")};o.blockRendering.ConstantProvider.prototype.createBlockStyle_=function(e){return this.validatedBlockStyle_({colourPrimary:e})};o.blockRendering.ConstantProvider.prototype.validatedBlockStyle_=function(e){var t={};e&&o.utils.object.mixin(t,e);e=o.utils.parseBlockColour(t.colourPrimary||"#000");t.colourPrimary=e.hex;t.colourSecondary=t.colourSecondary?o.utils.parseBlockColour(t.colourSecondary).hex:this.generateSecondaryColour_(t.colourPrimary);t.colourTertiary=t.colourTertiary?o.utils.parseBlockColour(t.colourTertiary).hex:this.generateTertiaryColour_(t.colourPrimary);t.hat=t.hat||"";return t};o.blockRendering.ConstantProvider.prototype.generateSecondaryColour_=function(e){return o.utils.colour.blend("#fff",e,.6)||e};o.blockRendering.ConstantProvider.prototype.generateTertiaryColour_=function(e){return o.utils.colour.blend("#fff",e,.3)||e};o.blockRendering.ConstantProvider.prototype.dispose=function(){this.embossFilter_&&o.utils.dom.removeNode(this.embossFilter_);this.disabledPattern_&&o.utils.dom.removeNode(this.disabledPattern_)};o.blockRendering.ConstantProvider.prototype.makeJaggedTeeth=function(){var e=this.JAGGED_TEETH_HEIGHT,t=this.JAGGED_TEETH_WIDTH,n=o.utils.svgPaths.line([o.utils.svgPaths.point(t,e/4),o.utils.svgPaths.point(2*-t,e/2),o.utils.svgPaths.point(t,e/4)]);return{height:e,width:t,path:n}};o.blockRendering.ConstantProvider.prototype.makeStartHat=function(){var e=this.START_HAT_HEIGHT,t=this.START_HAT_WIDTH,n=o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(30,-e),o.utils.svgPaths.point(70,-e),o.utils.svgPaths.point(t,0)]);return{height:e,width:t,path:n}};o.blockRendering.ConstantProvider.prototype.makePuzzleTab=function(){function t(t){t=t?-1:1;var i=-t,s=r/2,c=s+2.5,p=s+.5,l=o.utils.svgPaths.point(-n,t*s);s=o.utils.svgPaths.point(n,t*s);return o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(0,t*c),o.utils.svgPaths.point(-n,i*p),l])+o.utils.svgPaths.curve("s",[o.utils.svgPaths.point(n,2.5*i),s])}var n=this.TAB_WIDTH,r=this.TAB_HEIGHT,i=t(!0),s=t(!1);return{type:this.SHAPES.PUZZLE,width:n,height:r,pathDown:s,pathUp:i}};o.blockRendering.ConstantProvider.prototype.makeNotch=function(){function t(e){return o.utils.svgPaths.line([o.utils.svgPaths.point(e*i,r),o.utils.svgPaths.point(3*e,0),o.utils.svgPaths.point(e*i,-r)])}var n=this.NOTCH_WIDTH,r=this.NOTCH_HEIGHT,i=(n-3)/2,s=t(1),e=t(-1);return{type:this.SHAPES.NOTCH,width:n,height:r,pathLeft:s,pathRight:e}};o.blockRendering.ConstantProvider.prototype.makeInsideCorners=function(){var e=this.CORNER_RADIUS,t=o.utils.svgPaths.arc("a","0 0,0",e,o.utils.svgPaths.point(-e,e)),n=o.utils.svgPaths.arc("a","0 0,0",e,o.utils.svgPaths.point(e,e));return{width:e,height:e,pathTop:t,pathBottom:n}};o.blockRendering.ConstantProvider.prototype.makeOutsideCorners=function(){var t=this.CORNER_RADIUS,n=o.utils.svgPaths.moveBy(0,t)+o.utils.svgPaths.arc("a","0 0,1",t,o.utils.svgPaths.point(t,-t)),r=o.utils.svgPaths.arc("a","0 0,1",t,o.utils.svgPaths.point(t,t)),i=o.utils.svgPaths.arc("a","0 0,1",t,o.utils.svgPaths.point(-t,-t)),s=o.utils.svgPaths.arc("a","0 0,1",t,o.utils.svgPaths.point(-t,t));return{topLeft:n,topRight:r,bottomRight:s,bottomLeft:i,rightHeight:t}};o.blockRendering.ConstantProvider.prototype.shapeFor=function(e){switch(e.type){case o.INPUT_VALUE:case o.OUTPUT_VALUE:return this.PUZZLE_TAB;case o.PREVIOUS_STATEMENT:case o.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown connection type");}};o.blockRendering.ConstantProvider.prototype.createDom=function(e){e=o.utils.dom.createSvgElement("defs",{},e);var t=o.utils.dom.createSvgElement("filter",{id:"blocklyEmbossFilter"+this.randomIdentifier_},e);o.utils.dom.createSvgElement("feGaussianBlur",{in:"SourceAlpha",stdDeviation:1,result:"blur"},t);var n=o.utils.dom.createSvgElement("feSpecularLighting",{in:"blur",surfaceScale:1,specularConstant:.5,specularExponent:10,"lighting-color":"white",result:"specOut"},t);o.utils.dom.createSvgElement("fePointLight",{x:-5E3,y:-1E4,z:2E4},n);o.utils.dom.createSvgElement("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},t);o.utils.dom.createSvgElement("feComposite",{in:"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},t);this.embossFilterId=t.id;this.embossFilter_=t;e=o.utils.dom.createSvgElement("pattern",{id:"blocklyDisabledPattern"+this.randomIdentifier_,patternUnits:"userSpaceOnUse",width:10,height:10},e);o.utils.dom.createSvgElement("rect",{width:10,height:10,fill:"#aaa"},e);o.utils.dom.createSvgElement("path",{d:"M 0 0 L 10 10 M 10 0 L 0 10",stroke:"#cc0"},e);this.disabledPatternId=e.id;this.disabledPattern_=e};o.blockRendering.ConstantProvider.prototype.injectCSS=function(e){var t=this.getCSS_(e);e="blockly-renderer-style-"+e;if(!document.getElementById(e)){var o=t.join("\n");t=document.createElement("style");t.id=e;e=document.createTextNode(o);t.appendChild(e);document.head.insertBefore(t,document.head.firstChild)}};o.blockRendering.ConstantProvider.prototype.getCSS_=function(e){e="."+e+"-renderer";return[e+" .blocklyText {","fill: #fff;","font-family: "+this.FIELD_TEXT_FONTFAMILY+";","font-size: "+this.FIELD_TEXT_FONTSIZE+"pt;","font-weight: "+this.FIELD_TEXT_FONTWEIGHT+";","}",e+" .blocklyNonEditableText>rect,",e+" .blocklyEditableText>rect {","fill: "+this.FIELD_BORDER_RECT_COLOUR+";","fill-opacity: .6;","stroke: none;","}",e+" .blocklyNonEditableText>text,",e+" .blocklyEditableText>text {","fill: #000;","}",e+" .blocklyEditableText:not(.editing):hover>rect {","stroke: #fff;","stroke-width: 2;","}",e+" .blocklyHtmlInput {","font-family: "+this.FIELD_TEXT_FONTFAMILY+";","font-weight: "+this.FIELD_TEXT_FONTWEIGHT+";","}",e+" .blocklySelected>.blocklyPath {","stroke: #fc3;","stroke-width: 3px;","}",e+" .blocklyHighlightedConnectionPath {","stroke: #fc3;","}",e+" .blocklyReplaceable .blocklyPath {","fill-opacity: .5;","}",e+" .blocklyReplaceable .blocklyPathLight,",e+" .blocklyReplaceable .blocklyPathDark {","display: none;","}"]};o.blockRendering.MarkerSvg=function(e,t,o){this.workspace_=e;this.marker_=o;this.parent_=null;this.constants_=t;this.currentMarkerSvg=null;e=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR;this.colour_=o.colour||e};o.blockRendering.MarkerSvg.CURSOR_CLASS="blocklyCursor";o.blockRendering.MarkerSvg.MARKER_CLASS="blocklyMarker";o.blockRendering.MarkerSvg.HEIGHT_MULTIPLIER=.75;o.blockRendering.MarkerSvg.prototype.getSvgRoot=function(){return this.svgGroup_};o.blockRendering.MarkerSvg.prototype.isCursor=function(){return"cursor"==this.marker_.type};o.blockRendering.MarkerSvg.prototype.createDom=function(){var e=this.isCursor()?o.blockRendering.MarkerSvg.CURSOR_CLASS:o.blockRendering.MarkerSvg.MARKER_CLASS;this.svgGroup_=o.utils.dom.createSvgElement("g",{class:e},null);this.createDomInternal_();return this.svgGroup_};o.blockRendering.MarkerSvg.prototype.setParent_=function(e){this.isCursor()?(this.parent_&&this.parent_.setCursorSvg(null),e.setCursorSvg(this.getSvgRoot())):(this.parent_&&this.parent_.setMarkerSvg(null),e.setMarkerSvg(this.getSvgRoot()));this.parent_=e};o.blockRendering.MarkerSvg.prototype.showWithBlockPrevOutput_=function(t){if(t){var n=t.width,r=t.height,i=r*o.blockRendering.MarkerSvg.HEIGHT_MULTIPLIER,s=this.constants_.CURSOR_BLOCK_PADDING;if(t.previousConnection){var e=this.constants_.shapeFor(t.previousConnection);this.positionPrevious_(n,s,i,e)}else t.outputConnection?(e=this.constants_.shapeFor(t.outputConnection),this.positionOutput_(n,r,e)):this.positionBlock_(n,s,i);this.setParent_(t);this.showCurrent_()}};o.blockRendering.MarkerSvg.prototype.showWithCoordinates_=function(e){var t=e.getWsCoordinate();e=t.x;t=t.y;this.workspace_.RTL&&(e-=this.constants_.CURSOR_WS_WIDTH);this.positionLine_(e,t,this.constants_.CURSOR_WS_WIDTH);this.setParent_(this.workspace_);this.showCurrent_()};o.blockRendering.MarkerSvg.prototype.showWithField_=function(e){e=e.getLocation();var t=e.getSize().width,o=e.getSize().height;this.positionRect_(0,0,t,o);this.setParent_(e);this.showCurrent_()};o.blockRendering.MarkerSvg.prototype.showWithInput_=function(e){e=e.getLocation();var t=e.getSourceBlock();this.positionInput_(e);this.setParent_(t);this.showCurrent_()};o.blockRendering.MarkerSvg.prototype.showWithNext_=function(e){var t=e.getLocation();e=t.getSourceBlock();var o=0;t=t.getOffsetInBlock().y;var n=e.getHeightWidth().width;this.workspace_.RTL&&(o=-n);this.positionLine_(o,t,n);this.setParent_(e);this.showCurrent_()};o.blockRendering.MarkerSvg.prototype.showWithStack_=function(t){t=t.getLocation();var o=t.getHeightWidth(),n=o.width+this.constants_.CURSOR_STACK_PADDING;o=o.height+this.constants_.CURSOR_STACK_PADDING;var r=-this.constants_.CURSOR_STACK_PADDING/2,i=-this.constants_.CURSOR_STACK_PADDING/2,e=r;this.workspace_.RTL&&(e=-(n+r));this.positionRect_(e,i,n,o);this.setParent_(t);this.showCurrent_()};o.blockRendering.MarkerSvg.prototype.showCurrent_=function(){this.hide();this.currentMarkerSvg.style.display=""};o.blockRendering.MarkerSvg.prototype.positionBlock_=function(e,t,n){e=o.utils.svgPaths.moveBy(-t,n)+o.utils.svgPaths.lineOnAxis("V",-t)+o.utils.svgPaths.lineOnAxis("H",e+2*t)+o.utils.svgPaths.lineOnAxis("V",n);this.markerBlock_.setAttribute("d",e);this.workspace_.RTL&&this.flipRtl_(this.markerBlock_);this.currentMarkerSvg=this.markerBlock_};o.blockRendering.MarkerSvg.prototype.positionInput_=function(e){var t=e.getOffsetInBlock().x,n=e.getOffsetInBlock().y;e=o.utils.svgPaths.moveTo(0,0)+this.constants_.shapeFor(e).pathDown;this.markerInput_.setAttribute("d",e);this.markerInput_.setAttribute("transform","translate("+t+","+n+")"+(this.workspace_.RTL?" scale(-1 1)":""));this.currentMarkerSvg=this.markerInput_};o.blockRendering.MarkerSvg.prototype.positionLine_=function(e,t,o){this.markerSvgLine_.setAttribute("x",e);this.markerSvgLine_.setAttribute("y",t);this.markerSvgLine_.setAttribute("width",o);this.currentMarkerSvg=this.markerSvgLine_};o.blockRendering.MarkerSvg.prototype.positionOutput_=function(e,t,n){e=o.utils.svgPaths.moveBy(e,0)+o.utils.svgPaths.lineOnAxis("h",-(e-n.width))+o.utils.svgPaths.lineOnAxis("v",this.constants_.TAB_OFFSET_FROM_TOP)+n.pathDown+o.utils.svgPaths.lineOnAxis("V",t)+o.utils.svgPaths.lineOnAxis("H",e);this.markerBlock_.setAttribute("d",e);this.workspace_.RTL&&this.flipRtl_(this.markerBlock_);this.currentMarkerSvg=this.markerBlock_};o.blockRendering.MarkerSvg.prototype.positionPrevious_=function(e,t,n,r){e=o.utils.svgPaths.moveBy(-t,n)+o.utils.svgPaths.lineOnAxis("V",-t)+o.utils.svgPaths.lineOnAxis("H",this.constants_.NOTCH_OFFSET_LEFT)+r.pathLeft+o.utils.svgPaths.lineOnAxis("H",e+2*t)+o.utils.svgPaths.lineOnAxis("V",n);this.markerBlock_.setAttribute("d",e);this.workspace_.RTL&&this.flipRtl_(this.markerBlock_);this.currentMarkerSvg=this.markerBlock_};o.blockRendering.MarkerSvg.prototype.positionRect_=function(e,t,o,n){this.markerSvgRect_.setAttribute("x",e);this.markerSvgRect_.setAttribute("y",t);this.markerSvgRect_.setAttribute("width",o);this.markerSvgRect_.setAttribute("height",n);this.currentMarkerSvg=this.markerSvgRect_};o.blockRendering.MarkerSvg.prototype.flipRtl_=function(e){e.setAttribute("transform","scale(-1 1)")};o.blockRendering.MarkerSvg.prototype.hide=function(){this.markerSvgLine_.style.display="none";this.markerSvgRect_.style.display="none";this.markerInput_.style.display="none";this.markerBlock_.style.display="none"};o.blockRendering.MarkerSvg.prototype.draw=function(e,t){t?(this.showAtLocation_(t),this.firemarkerEvent_(e,t),e=this.currentMarkerSvg.childNodes[0],void 0!==e&&e.beginElement&&e.beginElement()):this.hide()};o.blockRendering.MarkerSvg.prototype.showAtLocation_=function(e){e.getType()==o.ASTNode.types.BLOCK?(e=e.getLocation(),this.showWithBlockPrevOutput_(e)):e.getType()==o.ASTNode.types.OUTPUT?(e=e.getLocation().getSourceBlock(),this.showWithBlockPrevOutput_(e)):e.getLocation().type==o.INPUT_VALUE?this.showWithInput_(e):e.getLocation().type==o.NEXT_STATEMENT?this.showWithNext_(e):e.getType()==o.ASTNode.types.PREVIOUS?(e=e.getLocation().getSourceBlock(),this.showWithBlockPrevOutput_(e)):e.getType()==o.ASTNode.types.FIELD?this.showWithField_(e):e.getType()==o.ASTNode.types.WORKSPACE?this.showWithCoordinates_(e):e.getType()==o.ASTNode.types.STACK&&this.showWithStack_(e)};o.blockRendering.MarkerSvg.prototype.firemarkerEvent_=function(e,t){var n=t.getSourceBlock(),r=this.isCursor()?"cursorMove":"markerMove";e=new o.Events.Ui(n,r,e,t);t.getType()==o.ASTNode.types.WORKSPACE&&(e.workspaceId=t.getLocation().id);o.Events.fire(e)};o.blockRendering.MarkerSvg.prototype.getBlinkProperties_=function(){return{attributeType:"XML",attributeName:"fill",dur:"1s",values:this.colour_+";transparent;transparent;",repeatCount:"indefinite"}};o.blockRendering.MarkerSvg.prototype.createDomInternal_=function(){this.markerSvg_=o.utils.dom.createSvgElement("g",{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.svgGroup_);this.markerSvgLine_=o.utils.dom.createSvgElement("rect",{fill:this.colour_,width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT,style:"display: none"},this.markerSvg_);this.markerSvgRect_=o.utils.dom.createSvgElement("rect",{class:"blocklyVerticalMarker",rx:10,ry:10,style:"display: none",stroke:this.colour_},this.markerSvg_);this.markerInput_=o.utils.dom.createSvgElement("path",{transform:"",style:"display: none",fill:this.colour_},this.markerSvg_);this.markerBlock_=o.utils.dom.createSvgElement("path",{transform:"",style:"display: none",fill:"none",stroke:this.colour_,"stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_);if(this.isCursor()){var e=this.getBlinkProperties_();o.utils.dom.createSvgElement("animate",this.getBlinkProperties_(),this.markerSvgLine_);o.utils.dom.createSvgElement("animate",e,this.markerInput_);e.attributeName="stroke";o.utils.dom.createSvgElement("animate",e,this.markerBlock_)}return this.markerSvg_};o.blockRendering.MarkerSvg.prototype.dispose=function(){this.svgGroup_&&o.utils.dom.removeNode(this.svgGroup_)};o.blockRendering.Types={NONE:0,FIELD:1,HAT:2,ICON:4,SPACER:8,BETWEEN_ROW_SPACER:16,IN_ROW_SPACER:32,EXTERNAL_VALUE_INPUT:64,INPUT:128,INLINE_INPUT:256,STATEMENT_INPUT:512,CONNECTION:1024,PREVIOUS_CONNECTION:2048,NEXT_CONNECTION:4096,OUTPUT_CONNECTION:8192,CORNER:16384,LEFT_SQUARE_CORNER:32768,LEFT_ROUND_CORNER:65536,RIGHT_SQUARE_CORNER:131072,RIGHT_ROUND_CORNER:262144,JAGGED_EDGE:524288,ROW:1048576,TOP_ROW:2097152,BOTTOM_ROW:4194304,INPUT_ROW:8388608};o.blockRendering.Types.LEFT_CORNER=o.blockRendering.Types.LEFT_SQUARE_CORNER|o.blockRendering.Types.LEFT_ROUND_CORNER;o.blockRendering.Types.RIGHT_CORNER=o.blockRendering.Types.RIGHT_SQUARE_CORNER|o.blockRendering.Types.RIGHT_ROUND_CORNER;o.blockRendering.Types.nextTypeValue_=16777216;o.blockRendering.Types.getType=function(e){o.blockRendering.Types.hasOwnProperty(e)||(o.blockRendering.Types[e]=o.blockRendering.Types.nextTypeValue_,o.blockRendering.Types.nextTypeValue_<<=1);return o.blockRendering.Types[e]};o.blockRendering.Types.isField=function(e){return e.type&o.blockRendering.Types.FIELD};o.blockRendering.Types.isHat=function(e){return e.type&o.blockRendering.Types.HAT};o.blockRendering.Types.isIcon=function(e){return e.type&o.blockRendering.Types.ICON};o.blockRendering.Types.isSpacer=function(e){return e.type&o.blockRendering.Types.SPACER};o.blockRendering.Types.isInRowSpacer=function(e){return e.type&o.blockRendering.Types.IN_ROW_SPACER};o.blockRendering.Types.isInput=function(e){return e.type&o.blockRendering.Types.INPUT};o.blockRendering.Types.isExternalInput=function(e){return e.type&o.blockRendering.Types.EXTERNAL_VALUE_INPUT};o.blockRendering.Types.isInlineInput=function(e){return e.type&o.blockRendering.Types.INLINE_INPUT};o.blockRendering.Types.isStatementInput=function(e){return e.type&o.blockRendering.Types.STATEMENT_INPUT};o.blockRendering.Types.isPreviousConnection=function(e){return e.type&o.blockRendering.Types.PREVIOUS_CONNECTION};o.blockRendering.Types.isNextConnection=function(e){return e.type&o.blockRendering.Types.NEXT_CONNECTION};o.blockRendering.Types.isPreviousOrNextConnection=function(e){return e.type&(o.blockRendering.Types.PREVIOUS_CONNECTION|o.blockRendering.Types.NEXT_CONNECTION)};o.blockRendering.Types.isLeftRoundedCorner=function(e){return e.type&o.blockRendering.Types.LEFT_ROUND_CORNER};o.blockRendering.Types.isRightRoundedCorner=function(e){return e.type&o.blockRendering.Types.RIGHT_ROUND_CORNER};o.blockRendering.Types.isLeftSquareCorner=function(e){return e.type&o.blockRendering.Types.LEFT_SQUARE_CORNER};o.blockRendering.Types.isRightSquareCorner=function(e){return e.type&o.blockRendering.Types.RIGHT_SQUARE_CORNER};o.blockRendering.Types.isCorner=function(e){return e.type&o.blockRendering.Types.CORNER};o.blockRendering.Types.isJaggedEdge=function(e){return e.type&o.blockRendering.Types.JAGGED_EDGE};o.blockRendering.Types.isRow=function(e){return e.type&o.blockRendering.Types.ROW};o.blockRendering.Types.isBetweenRowSpacer=function(e){return e.type&o.blockRendering.Types.BETWEEN_ROW_SPACER};o.blockRendering.Types.isTopRow=function(e){return e.type&o.blockRendering.Types.TOP_ROW};o.blockRendering.Types.isBottomRow=function(e){return e.type&o.blockRendering.Types.BOTTOM_ROW};o.blockRendering.Types.isTopOrBottomRow=function(e){return e.type&(o.blockRendering.Types.TOP_ROW|o.blockRendering.Types.BOTTOM_ROW)};o.blockRendering.Types.isInputRow=function(e){return e.type&o.blockRendering.Types.INPUT_ROW};o.blockRendering.Measurable=function(e){this.height=this.width=0;this.type=o.blockRendering.Types.NONE;this.centerline=this.xPos=0;this.constants_=e;this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT};o.blockRendering.Connection=function(e,t){o.blockRendering.Connection.superClass_.constructor.call(this,e);this.connectionModel=t;this.shape=this.constants_.shapeFor(t);this.isDynamicShape=!!this.shape.isDynamic;this.type|=o.blockRendering.Types.CONNECTION};o.utils.object.inherits(o.blockRendering.Connection,o.blockRendering.Measurable);o.blockRendering.OutputConnection=function(e,t){o.blockRendering.OutputConnection.superClass_.constructor.call(this,e,t);this.type|=o.blockRendering.Types.OUTPUT_CONNECTION;this.height=this.isDynamicShape?0:this.shape.height;this.startX=this.width=this.isDynamicShape?0:this.shape.width;this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP;this.connectionOffsetX=0};o.utils.object.inherits(o.blockRendering.OutputConnection,o.blockRendering.Connection);o.blockRendering.PreviousConnection=function(e,t){o.blockRendering.PreviousConnection.superClass_.constructor.call(this,e,t);this.type|=o.blockRendering.Types.PREVIOUS_CONNECTION;this.height=this.shape.height;this.width=this.shape.width};o.utils.object.inherits(o.blockRendering.PreviousConnection,o.blockRendering.Connection);o.blockRendering.NextConnection=function(e,t){o.blockRendering.NextConnection.superClass_.constructor.call(this,e,t);this.type|=o.blockRendering.Types.NEXT_CONNECTION;this.height=this.shape.height;this.width=this.shape.width};o.utils.object.inherits(o.blockRendering.NextConnection,o.blockRendering.Connection);o.blockRendering.InputConnection=function(e,t){o.blockRendering.InputConnection.superClass_.constructor.call(this,e,t.connection);this.type|=o.blockRendering.Types.INPUT;this.input=t;this.align=t.align;(this.connectedBlock=t.connection&&t.connection.targetBlock()?t.connection.targetBlock():null)?(e=this.connectedBlock.getHeightWidth(),this.connectedBlockWidth=e.width,this.connectedBlockHeight=e.height):this.connectedBlockHeight=this.connectedBlockWidth=0;this.connectionOffsetY=this.connectionOffsetX=0};o.utils.object.inherits(o.blockRendering.InputConnection,o.blockRendering.Connection);o.blockRendering.InlineInput=function(e,t){o.blockRendering.InlineInput.superClass_.constructor.call(this,e,t);this.type|=o.blockRendering.Types.INLINE_INPUT;this.connectedBlock?(this.width=this.connectedBlockWidth,this.height=this.connectedBlockHeight):(this.height=this.constants_.EMPTY_INLINE_INPUT_HEIGHT,this.width=this.constants_.EMPTY_INLINE_INPUT_PADDING);this.connectionHeight=this.isDynamicShape?this.shape.height(this.height):this.shape.height;this.connectionWidth=this.isDynamicShape?this.shape.width(this.height):this.shape.width;this.connectedBlock||(this.width+=this.connectionWidth*(this.isDynamicShape?2:1));this.connectionOffsetY=this.isDynamicShape?this.shape.connectionOffsetY(this.connectionHeight):this.constants_.TAB_OFFSET_FROM_TOP;this.connectionOffsetX=this.isDynamicShape?this.shape.connectionOffsetX(this.connectionWidth):0};o.utils.object.inherits(o.blockRendering.InlineInput,o.blockRendering.InputConnection);o.blockRendering.StatementInput=function(e,t){o.blockRendering.StatementInput.superClass_.constructor.call(this,e,t);this.type|=o.blockRendering.Types.STATEMENT_INPUT;this.height=this.connectedBlock?this.connectedBlockHeight+this.constants_.STATEMENT_BOTTOM_SPACER:this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT;this.width=this.constants_.STATEMENT_INPUT_NOTCH_OFFSET+this.shape.width};o.utils.object.inherits(o.blockRendering.StatementInput,o.blockRendering.InputConnection);o.blockRendering.ExternalValueInput=function(e,t){o.blockRendering.ExternalValueInput.superClass_.constructor.call(this,e,t);this.type|=o.blockRendering.Types.EXTERNAL_VALUE_INPUT;this.height=this.connectedBlock?this.connectedBlockHeight-this.constants_.TAB_OFFSET_FROM_TOP-this.constants_.MEDIUM_PADDING:this.shape.height;this.width=this.shape.width+this.constants_.EXTERNAL_VALUE_INPUT_PADDING;this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP;this.connectionHeight=this.shape.height;this.connectionWidth=this.shape.width};o.utils.object.inherits(o.blockRendering.ExternalValueInput,o.blockRendering.InputConnection);o.blockRendering.Icon=function(e,t){o.blockRendering.Icon.superClass_.constructor.call(this,e);this.icon=t;this.isVisible=t.isVisible();this.type|=o.blockRendering.Types.ICON;e=t.getCorrectedSize();this.height=e.height;this.width=e.width};o.utils.object.inherits(o.blockRendering.Icon,o.blockRendering.Measurable);o.blockRendering.JaggedEdge=function(e){o.blockRendering.JaggedEdge.superClass_.constructor.call(this,e);this.type|=o.blockRendering.Types.JAGGED_EDGE;this.height=this.constants_.JAGGED_TEETH.height;this.width=this.constants_.JAGGED_TEETH.width};o.utils.object.inherits(o.blockRendering.JaggedEdge,o.blockRendering.Measurable);o.blockRendering.Field=function(e,t,n){o.blockRendering.Field.superClass_.constructor.call(this,e);this.field=t;this.isEditable=t.EDITABLE;this.flipRtl=t.getFlipRtl();this.type|=o.blockRendering.Types.FIELD;e=this.field.getSize();this.height=e.height;this.width=e.width;this.parentInput=n};o.utils.object.inherits(o.blockRendering.Field,o.blockRendering.Measurable);o.blockRendering.Hat=function(e){o.blockRendering.Hat.superClass_.constructor.call(this,e);this.type|=o.blockRendering.Types.HAT;this.height=this.constants_.START_HAT.height;this.width=this.constants_.START_HAT.width;this.ascenderHeight=this.height};o.utils.object.inherits(o.blockRendering.Hat,o.blockRendering.Measurable);o.blockRendering.SquareCorner=function(e,t){o.blockRendering.SquareCorner.superClass_.constructor.call(this,e);this.type=(t&&"left"!=t?o.blockRendering.Types.RIGHT_SQUARE_CORNER:o.blockRendering.Types.LEFT_SQUARE_CORNER)|o.blockRendering.Types.CORNER;this.width=this.height=this.constants_.NO_PADDING};o.utils.object.inherits(o.blockRendering.SquareCorner,o.blockRendering.Measurable);o.blockRendering.RoundCorner=function(e,t){o.blockRendering.RoundCorner.superClass_.constructor.call(this,e);this.type=(t&&"left"!=t?o.blockRendering.Types.RIGHT_ROUND_CORNER:o.blockRendering.Types.LEFT_ROUND_CORNER)|o.blockRendering.Types.CORNER;this.width=this.constants_.CORNER_RADIUS;this.height=this.constants_.CORNER_RADIUS/2};o.utils.object.inherits(o.blockRendering.RoundCorner,o.blockRendering.Measurable);o.blockRendering.InRowSpacer=function(e,t){o.blockRendering.InRowSpacer.superClass_.constructor.call(this,e);this.type=this.type|o.blockRendering.Types.SPACER|o.blockRendering.Types.IN_ROW_SPACER;this.width=t;this.height=this.constants_.SPACER_DEFAULT_HEIGHT};o.utils.object.inherits(o.blockRendering.InRowSpacer,o.blockRendering.Measurable);o.blockRendering.Row=function(e){this.type=o.blockRendering.Types.ROW;this.elements=[];this.xPos=this.yPos=this.widthWithConnectedBlocks=this.minWidth=this.minHeight=this.width=this.height=0;this.hasJaggedEdge=this.hasDummyInput=this.hasInlineInput=this.hasStatement=this.hasExternalInput=!1;this.constants_=e;this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT;this.align=null};o.blockRendering.Row.prototype.measure=function(){throw Error("Unexpected attempt to measure a base Row.")};o.blockRendering.Row.prototype.getLastInput=function(){for(var e=this.elements.length-1,t;t=this.elements[e];e--){if(o.blockRendering.Types.isInput(t))return t}return null};o.blockRendering.Row.prototype.startsWithElemSpacer=function(){return!0};o.blockRendering.Row.prototype.endsWithElemSpacer=function(){return!0};o.blockRendering.Row.prototype.getFirstSpacer=function(){for(var e=0,t;t=this.elements[e];e++){if(o.blockRendering.Types.isSpacer(t))return t}return null};o.blockRendering.Row.prototype.getLastSpacer=function(){for(var e=this.elements.length-1,t;t=this.elements[e];e--){if(o.blockRendering.Types.isSpacer(t))return t}return null};o.blockRendering.TopRow=function(e){o.blockRendering.TopRow.superClass_.constructor.call(this,e);this.type|=o.blockRendering.Types.TOP_ROW;this.ascenderHeight=this.capline=0;this.hasPreviousConnection=!1;this.connection=null};o.utils.object.inherits(o.blockRendering.TopRow,o.blockRendering.Row);o.blockRendering.TopRow.prototype.hasLeftSquareCorner=function(e){var t=(e.hat?"cap"===e.hat:this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection,o=e.getPreviousBlock();return!!e.outputConnection||t||(o?o.getNextBlock()==e:!1)};o.blockRendering.TopRow.prototype.hasRightSquareCorner=function(){return!0};o.blockRendering.TopRow.prototype.measure=function(){for(var t=0,n=0,r=0,i=0,s;s=this.elements[i];i++){n+=s.width,o.blockRendering.Types.isSpacer(s)||(o.blockRendering.Types.isHat(s)?r=Math.max(r,s.ascenderHeight):t=Math.max(t,s.height))}this.width=Math.max(this.minWidth,n);this.height=Math.max(this.minHeight,t)+r;this.capline=this.ascenderHeight=r;this.widthWithConnectedBlocks=this.width};o.blockRendering.TopRow.prototype.startsWithElemSpacer=function(){return!1};o.blockRendering.TopRow.prototype.endsWithElemSpacer=function(){return!1};o.blockRendering.BottomRow=function(e){o.blockRendering.BottomRow.superClass_.constructor.call(this,e);this.type|=o.blockRendering.Types.BOTTOM_ROW;this.hasNextConnection=!1;this.connection=null;this.baseline=this.descenderHeight=0};o.utils.object.inherits(o.blockRendering.BottomRow,o.blockRendering.Row);o.blockRendering.BottomRow.prototype.hasLeftSquareCorner=function(e){return!!e.outputConnection||!!e.getNextBlock()};o.blockRendering.BottomRow.prototype.hasRightSquareCorner=function(){return!0};o.blockRendering.BottomRow.prototype.measure=function(){for(var t=0,n=0,r=0,i=0,s;s=this.elements[i];i++){n+=s.width,o.blockRendering.Types.isSpacer(s)||(o.blockRendering.Types.isNextConnection(s)?r=Math.max(r,s.height):t=Math.max(t,s.height))}this.width=Math.max(this.minWidth,n);this.height=Math.max(this.minHeight,t)+r;this.descenderHeight=r;this.widthWithConnectedBlocks=this.width};o.blockRendering.BottomRow.prototype.startsWithElemSpacer=function(){return!1};o.blockRendering.BottomRow.prototype.endsWithElemSpacer=function(){return!1};o.blockRendering.SpacerRow=function(e,t,n){o.blockRendering.SpacerRow.superClass_.constructor.call(this,e);this.type=this.type|o.blockRendering.Types.SPACER|o.blockRendering.Types.BETWEEN_ROW_SPACER;this.width=n;this.height=t;this.followsStatement=!1;this.widthWithConnectedBlocks=0;this.elements=[new o.blockRendering.InRowSpacer(this.constants_,n)]};o.utils.object.inherits(o.blockRendering.SpacerRow,o.blockRendering.Row);o.blockRendering.SpacerRow.prototype.measure=function(){};o.blockRendering.InputRow=function(e){o.blockRendering.InputRow.superClass_.constructor.call(this,e);this.type|=o.blockRendering.Types.INPUT_ROW;this.connectedBlockWidths=0};o.utils.object.inherits(o.blockRendering.InputRow,o.blockRendering.Row);o.blockRendering.InputRow.prototype.measure=function(){this.width=this.minWidth;this.height=this.minHeight;for(var e=0,t=0,n;n=this.elements[t];t++){this.width+=n.width,o.blockRendering.Types.isInput(n)&&(o.blockRendering.Types.isStatementInput(n)?e+=n.connectedBlockWidth:o.blockRendering.Types.isExternalInput(n)&&0!=n.connectedBlockWidth&&(e+=n.connectedBlockWidth-n.connectionWidth)),o.blockRendering.Types.isSpacer(n)||(this.height=Math.max(this.height,n.height))}this.connectedBlockWidths=e;this.widthWithConnectedBlocks=this.width+e};o.blockRendering.InputRow.prototype.endsWithElemSpacer=function(){return!this.hasExternalInput&&!this.hasStatement};o.blockRendering.RenderInfo=function(e,t){this.block_=t;this.renderer_=e;this.constants_=this.renderer_.getConstants();this.outputConnection=t.outputConnection?new o.blockRendering.OutputConnection(this.constants_,t.outputConnection):null;this.isInline=t.getInputsInline()&&!t.isCollapsed();this.isCollapsed=t.isCollapsed();this.isInsertionMarker=t.isInsertionMarker();this.RTL=t.RTL;this.statementEdge=this.width=this.widthWithChildren=this.height=0;this.rows=[];this.inputRowNum_=1;this.hiddenIcons=[];this.topRow=new o.blockRendering.TopRow(this.constants_);this.bottomRow=new o.blockRendering.BottomRow(this.constants_);this.startY=this.startX=0};o.blockRendering.RenderInfo.prototype.getRenderer=function(){return this.renderer_};o.blockRendering.RenderInfo.prototype.measure=function(){this.createRows_();this.addElemSpacing_();this.addRowSpacing_();this.computeBounds_();this.alignRowElements_();this.finalize_()};o.blockRendering.RenderInfo.prototype.createRows_=function(){this.populateTopRow_();this.rows.push(this.topRow);var t=new o.blockRendering.InputRow(this.constants_),n=this.block_.getIcons();if(n.length)for(var r=0,i,s;i=n[r];r++){s=new o.blockRendering.Icon(this.constants_,i);this.isCollapsed&&i.collapseHidden?this.hiddenIcons.push(s):t.elements.push(s)}i=null;for(r=0;n=this.block_.inputList[r];r++){if(n.isVisible()){this.shouldStartNewRow_(n,i)&&(this.rows.push(t),t=new o.blockRendering.InputRow(this.constants_),this.inputRowNum_++);for(i=0;s=n.fieldRow[i];i++){t.elements.push(new o.blockRendering.Field(this.constants_,s,n))}this.addInput_(n,t);i=n}}this.isCollapsed&&(t.hasJaggedEdge=!0,t.elements.push(new o.blockRendering.JaggedEdge(this.constants_)));(t.elements.length||t.hasDummyInput)&&this.rows.push(t);this.populateBottomRow_();this.rows.push(this.bottomRow)};o.blockRendering.RenderInfo.prototype.populateTopRow_=function(){var e=!!this.block_.previousConnection,t=(this.block_.hat?"cap"===this.block_.hat:this.constants_.ADD_START_HATS)&&!this.outputConnection&&!e;this.topRow.hasLeftSquareCorner(this.block_)?this.topRow.elements.push(new o.blockRendering.SquareCorner(this.constants_)):this.topRow.elements.push(new o.blockRendering.RoundCorner(this.constants_));t?(e=new o.blockRendering.Hat(this.constants_),this.topRow.elements.push(e),this.topRow.capline=e.ascenderHeight):e&&(this.topRow.hasPreviousConnection=!0,this.topRow.connection=new o.blockRendering.PreviousConnection(this.constants_,this.block_.previousConnection),this.topRow.elements.push(this.topRow.connection));this.block_.inputList.length&&this.block_.inputList[0].type==o.NEXT_STATEMENT&&!this.block_.isCollapsed()?this.topRow.minHeight=this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT:this.topRow.minHeight=this.constants_.TOP_ROW_MIN_HEIGHT;this.topRow.hasRightSquareCorner(this.block_)?this.topRow.elements.push(new o.blockRendering.SquareCorner(this.constants_,"right")):this.topRow.elements.push(new o.blockRendering.RoundCorner(this.constants_,"right"))};o.blockRendering.RenderInfo.prototype.populateBottomRow_=function(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection;this.bottomRow.minHeight=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1].type==o.NEXT_STATEMENT?this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT:this.constants_.BOTTOM_ROW_MIN_HEIGHT;this.bottomRow.hasLeftSquareCorner(this.block_)?this.bottomRow.elements.push(new o.blockRendering.SquareCorner(this.constants_)):this.bottomRow.elements.push(new o.blockRendering.RoundCorner(this.constants_));this.bottomRow.hasNextConnection&&(this.bottomRow.connection=new o.blockRendering.NextConnection(this.constants_,this.block_.nextConnection),this.bottomRow.elements.push(this.bottomRow.connection));this.bottomRow.hasRightSquareCorner(this.block_)?this.bottomRow.elements.push(new o.blockRendering.SquareCorner(this.constants_,"right")):this.bottomRow.elements.push(new o.blockRendering.RoundCorner(this.constants_,"right"))};o.blockRendering.RenderInfo.prototype.addInput_=function(e,t){this.isInline&&e.type==o.INPUT_VALUE?(t.elements.push(new o.blockRendering.InlineInput(this.constants_,e)),t.hasInlineInput=!0):e.type==o.NEXT_STATEMENT?(t.elements.push(new o.blockRendering.StatementInput(this.constants_,e)),t.hasStatement=!0):e.type==o.INPUT_VALUE?(t.elements.push(new o.blockRendering.ExternalValueInput(this.constants_,e)),t.hasExternalInput=!0):e.type==o.DUMMY_INPUT&&(t.minHeight=Math.max(t.minHeight,e.getSourceBlock()&&e.getSourceBlock().isShadow()?this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT:this.constants_.DUMMY_INPUT_MIN_HEIGHT),t.hasDummyInput=!0);null==t.align&&(t.align=e.align)};o.blockRendering.RenderInfo.prototype.shouldStartNewRow_=function(e,t){return t?e.type==o.NEXT_STATEMENT||t.type==o.NEXT_STATEMENT?!0:e.type==o.INPUT_VALUE||e.type==o.DUMMY_INPUT?!this.isInline:!1:!1};o.blockRendering.RenderInfo.prototype.addElemSpacing_=function(){for(var t=0,n,r;n=this.rows[t];t++){r=n.elements;n.elements=[];n.startsWithElemSpacer()&&n.elements.push(new o.blockRendering.InRowSpacer(this.constants_,this.getInRowSpacing_(null,r[0])));if(r.length){for(var i=0;i<r.length-1;i++){n.elements.push(r[i]);var s=this.getInRowSpacing_(r[i],r[i+1]);n.elements.push(new o.blockRendering.InRowSpacer(this.constants_,s))}n.elements.push(r[r.length-1]);n.endsWithElemSpacer()&&n.elements.push(new o.blockRendering.InRowSpacer(this.constants_,this.getInRowSpacing_(r[r.length-1],null)))}}};o.blockRendering.RenderInfo.prototype.getInRowSpacing_=function(e,t){if(!e&&t&&o.blockRendering.Types.isStatementInput(t))return this.constants_.STATEMENT_INPUT_PADDING_LEFT;if(e&&o.blockRendering.Types.isInput(e)&&!t){if(o.blockRendering.Types.isExternalInput(e))return this.constants_.NO_PADDING;if(o.blockRendering.Types.isInlineInput(e))return this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isStatementInput(e))return this.constants_.NO_PADDING}return e&&o.blockRendering.Types.isLeftSquareCorner(e)&&t&&(o.blockRendering.Types.isPreviousConnection(t)||o.blockRendering.Types.isNextConnection(t))?t.notchOffset:e&&o.blockRendering.Types.isLeftRoundedCorner(e)&&t&&(o.blockRendering.Types.isPreviousConnection(t)||o.blockRendering.Types.isNextConnection(t))?t.notchOffset-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING};o.blockRendering.RenderInfo.prototype.computeBounds_=function(){for(var t=0,o=0,n=0,r=0,i;i=this.rows[r];r++){i.measure();o=Math.max(o,i.width);if(i.hasStatement){var s=i.getLastInput();t=Math.max(t,i.width-s.width)}n=Math.max(n,i.widthWithConnectedBlocks)}this.statementEdge=t;this.width=o;for(r=0;i=this.rows[r];r++){i.hasStatement&&(i.statementEdge=this.statementEdge)}this.widthWithChildren=Math.max(o,n);this.outputConnection&&(this.startX=this.outputConnection.width,this.width+=this.outputConnection.width,this.widthWithChildren+=this.outputConnection.width)};o.blockRendering.RenderInfo.prototype.alignRowElements_=function(){for(var e=0,t;t=this.rows[e];e++){if(t.hasStatement)this.alignStatementRow_(t);else{var o=t.width;o=this.getDesiredRowWidth_(t)-o;0<o&&this.addAlignmentPadding_(t,o)}}};o.blockRendering.RenderInfo.prototype.getDesiredRowWidth_=function(){return this.width-this.startX};o.blockRendering.RenderInfo.prototype.addAlignmentPadding_=function(e,t){var n=e.getFirstSpacer(),r=e.getLastSpacer();if(e.hasExternalInput||e.hasStatement)e.widthWithConnectedBlocks+=t;e.align==o.ALIGN_LEFT?r.width+=t:e.align==o.ALIGN_CENTRE?(n.width+=t/2,r.width+=t/2):e.align==o.ALIGN_RIGHT?n.width+=t:r.width+=t;e.width+=t};o.blockRendering.RenderInfo.prototype.alignStatementRow_=function(e){var t=e.getLastInput(),o=e.width-t.width,n=this.statementEdge;o=n-o;0<o&&this.addAlignmentPadding_(e,o);o=e.width;n=this.getDesiredRowWidth_(e);t.width+=n-o;t.height=Math.max(t.height,e.height);e.width+=n-o;e.widthWithConnectedBlocks=Math.max(e.width,this.statementEdge+e.connectedBlockWidths)};o.blockRendering.RenderInfo.prototype.addRowSpacing_=function(){var e=this.rows;this.rows=[];for(var t=0;t<e.length;t++){this.rows.push(e[t]),t!=e.length-1&&this.rows.push(this.makeSpacerRow_(e[t],e[t+1]))}};o.blockRendering.RenderInfo.prototype.makeSpacerRow_=function(e,t){var n=this.getSpacerRowHeight_(e,t),r=this.getSpacerRowWidth_(e,t);n=new o.blockRendering.SpacerRow(this.constants_,n,r);e.hasStatement&&(n.followsStatement=!0);t.hasStatement&&(n.precedesStatement=!0);return n};o.blockRendering.RenderInfo.prototype.getSpacerRowWidth_=function(){return this.width-this.startX};o.blockRendering.RenderInfo.prototype.getSpacerRowHeight_=function(){return this.constants_.MEDIUM_PADDING};o.blockRendering.RenderInfo.prototype.getElemCenterline_=function(e,t){return o.blockRendering.Types.isSpacer(t)?e.yPos+t.height/2:o.blockRendering.Types.isBottomRow(e)?(e=e.yPos+e.height-e.descenderHeight,o.blockRendering.Types.isNextConnection(t)?e+t.height/2:e-t.height/2):o.blockRendering.Types.isTopRow(e)?o.blockRendering.Types.isHat(t)?e.capline-t.height/2:e.capline+t.height/2:e.yPos+e.height/2};o.blockRendering.RenderInfo.prototype.recordElemPositions_=function(e){for(var t=e.xPos,n=0,r;r=e.elements[n];n++){o.blockRendering.Types.isSpacer(r)&&(r.height=e.height),r.xPos=t,r.centerline=this.getElemCenterline_(e,r),t+=r.width}};o.blockRendering.RenderInfo.prototype.finalize_=function(){for(var e=0,t=0,o=0,n;n=this.rows[o];o++){n.yPos=t,n.xPos=this.startX,t+=n.height,e=Math.max(e,n.widthWithConnectedBlocks),this.recordElemPositions_(n)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(e=Math.max(e,this.block_.nextConnection.targetBlock().getHeightWidth().width));this.widthWithChildren=Math.max(this.widthWithChildren,e+this.startX);this.height=t;this.startY=this.topRow.capline;this.bottomRow.baseline=t-this.bottomRow.descenderHeight};o.blockRendering.Drawer=function(e,t){this.block_=e;this.info_=t;this.topLeft_=e.getRelativeToSurfaceXY();this.inlinePath_=this.outlinePath_="";this.constants_=t.getRenderer().getConstants()};o.blockRendering.Drawer.prototype.draw=function(){this.hideHiddenIcons_();this.drawOutline_();this.drawInternals_();this.block_.pathObject.setPath(this.outlinePath_+"\n"+this.inlinePath_);this.info_.RTL&&this.block_.pathObject.flipRTL();o.blockRendering.useDebugger&&this.block_.renderingDebugger.drawDebug(this.block_,this.info_);this.recordSizeOnBlock_()};o.blockRendering.Drawer.prototype.recordSizeOnBlock_=function(){this.block_.height=this.info_.height;this.block_.width=this.info_.widthWithChildren};o.blockRendering.Drawer.prototype.hideHiddenIcons_=function(){for(var e=0,t;t=this.info_.hiddenIcons[e];e++){t.icon.iconGroup_.setAttribute("display","none")}};o.blockRendering.Drawer.prototype.drawOutline_=function(){this.drawTop_();for(var e=1,t;e<this.info_.rows.length-1;e++){t=this.info_.rows[e];t.hasJaggedEdge?this.drawJaggedEdge_(t):t.hasStatement?this.drawStatementInput_(t):t.hasExternalInput?this.drawValueInput_(t):this.drawRightSideRow_(t)}this.drawBottom_();this.drawLeft_()};o.blockRendering.Drawer.prototype.drawTop_=function(){var e=this.info_.topRow,t=e.elements;this.positionPreviousConnection_();this.outlinePath_+=o.utils.svgPaths.moveBy(e.xPos,this.info_.startY);for(var n=0,r;r=t[n];n++){o.blockRendering.Types.isLeftRoundedCorner(r)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topLeft:o.blockRendering.Types.isRightRoundedCorner(r)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topRight:o.blockRendering.Types.isPreviousConnection(r)?this.outlinePath_+=r.shape.pathLeft:o.blockRendering.Types.isHat(r)?this.outlinePath_+=this.constants_.START_HAT.path:o.blockRendering.Types.isSpacer(r)&&(this.outlinePath_+=o.utils.svgPaths.lineOnAxis("h",r.width))}this.outlinePath_+=o.utils.svgPaths.lineOnAxis("v",e.height)};o.blockRendering.Drawer.prototype.drawJaggedEdge_=function(e){this.outlinePath_+=this.constants_.JAGGED_TEETH.path+o.utils.svgPaths.lineOnAxis("v",e.height-this.constants_.JAGGED_TEETH.height)};o.blockRendering.Drawer.prototype.drawValueInput_=function(e){var t=e.getLastInput();this.positionExternalValueConnection_(e);var n="function"==typeof t.shape.pathDown?t.shape.pathDown(t.height):t.shape.pathDown;this.outlinePath_+=o.utils.svgPaths.lineOnAxis("H",t.xPos+t.width)+n+o.utils.svgPaths.lineOnAxis("v",e.height-t.connectionHeight)};o.blockRendering.Drawer.prototype.drawStatementInput_=function(e){var t=e.getLastInput(),n=t.xPos+t.notchOffset+t.shape.width;t=t.shape.pathRight+o.utils.svgPaths.lineOnAxis("h",-(t.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop;var r=e.height-2*this.constants_.INSIDE_CORNERS.height;this.outlinePath_+=o.utils.svgPaths.lineOnAxis("H",n)+t+o.utils.svgPaths.lineOnAxis("v",r)+this.constants_.INSIDE_CORNERS.pathBottom+o.utils.svgPaths.lineOnAxis("H",e.xPos+e.width);this.positionStatementInputConnection_(e)};o.blockRendering.Drawer.prototype.drawRightSideRow_=function(e){this.outlinePath_+=o.utils.svgPaths.lineOnAxis("V",e.yPos+e.height)};o.blockRendering.Drawer.prototype.drawBottom_=function(){var t=this.info_.bottomRow,n=t.elements;this.positionNextConnection_();for(var r=0,i="",s=n.length-1,l;l=n[s];s--){o.blockRendering.Types.isNextConnection(l)?i+=l.shape.pathRight:o.blockRendering.Types.isLeftSquareCorner(l)?i+=o.utils.svgPaths.lineOnAxis("H",t.xPos):o.blockRendering.Types.isLeftRoundedCorner(l)?i+=this.constants_.OUTSIDE_CORNERS.bottomLeft:o.blockRendering.Types.isRightRoundedCorner(l)?(i+=this.constants_.OUTSIDE_CORNERS.bottomRight,r=this.constants_.OUTSIDE_CORNERS.rightHeight):o.blockRendering.Types.isSpacer(l)&&(i+=o.utils.svgPaths.lineOnAxis("h",-1*l.width))}this.outlinePath_+=o.utils.svgPaths.lineOnAxis("V",t.baseline-r);this.outlinePath_+=i};o.blockRendering.Drawer.prototype.drawLeft_=function(){var e=this.info_.outputConnection;this.positionOutputConnection_();if(e){var t=e.connectionOffsetY+e.height;e="function"==typeof e.shape.pathUp?e.shape.pathUp(e.height):e.shape.pathUp;this.outlinePath_+=o.utils.svgPaths.lineOnAxis("V",t)+e}this.outlinePath_+="z"};o.blockRendering.Drawer.prototype.drawInternals_=function(){for(var e=0,t;t=this.info_.rows[e];e++){for(var n=0,r;r=t.elements[n];n++){o.blockRendering.Types.isInlineInput(r)?this.drawInlineInput_(r):(o.blockRendering.Types.isIcon(r)||o.blockRendering.Types.isField(r))&&this.layoutField_(r)}}};o.blockRendering.Drawer.prototype.layoutField_=function(t){if(o.blockRendering.Types.isField(t))var n=t.field.getSvgRoot();else o.blockRendering.Types.isIcon(t)&&(n=t.icon.iconGroup_);var r=t.centerline-t.height/2,i=t.xPos,s="";this.info_.RTL&&(i=-(i+t.width),t.flipRtl&&(i+=t.width,s="scale(-1 1)"));o.blockRendering.Types.isIcon(t)?(n.setAttribute("display","block"),n.setAttribute("transform","translate("+i+","+r+")"),t.icon.computeIconLocation()):n.setAttribute("transform","translate("+i+","+r+")"+s);this.info_.isInsertionMarker&&n.setAttribute("display","none")};o.blockRendering.Drawer.prototype.drawInlineInput_=function(t){var n=t.width,r=t.height,i=t.connectionOffsetY,s=t.connectionHeight+i;this.inlinePath_+=o.utils.svgPaths.moveTo(t.xPos+t.connectionWidth,t.centerline-r/2)+o.utils.svgPaths.lineOnAxis("v",i)+t.shape.pathDown+o.utils.svgPaths.lineOnAxis("v",r-s)+o.utils.svgPaths.lineOnAxis("h",n-t.connectionWidth)+o.utils.svgPaths.lineOnAxis("v",-r)+"z";this.positionInlineInputConnection_(t)};o.blockRendering.Drawer.prototype.positionInlineInputConnection_=function(e){var t=e.centerline-e.height/2;if(e.connectionModel){var o=e.xPos+e.connectionWidth+e.connectionOffsetX;this.info_.RTL&&(o*=-1);e.connectionModel.setOffsetInBlock(o,t+e.connectionOffsetY)}};o.blockRendering.Drawer.prototype.positionStatementInputConnection_=function(e){var t=e.getLastInput();if(t.connectionModel){var o=e.xPos+e.statementEdge+t.notchOffset;this.info_.RTL&&(o*=-1);t.connectionModel.setOffsetInBlock(o,e.yPos)}};o.blockRendering.Drawer.prototype.positionExternalValueConnection_=function(e){var t=e.getLastInput();if(t.connectionModel){var o=e.xPos+e.width;this.info_.RTL&&(o*=-1);t.connectionModel.setOffsetInBlock(o,e.yPos)}};o.blockRendering.Drawer.prototype.positionPreviousConnection_=function(){var e=this.info_.topRow;if(e.connection){var t=e.xPos+e.notchOffset;e.connection.connectionModel.setOffsetInBlock(this.info_.RTL?-t:t,0)}};o.blockRendering.Drawer.prototype.positionNextConnection_=function(){var e=this.info_.bottomRow;if(e.connection){var t=e.connection,o=t.xPos;t.connectionModel.setOffsetInBlock(this.info_.RTL?-o:o,e.baseline)}};o.blockRendering.Drawer.prototype.positionOutputConnection_=function(){if(this.info_.outputConnection){var e=this.info_.startX+this.info_.outputConnection.connectionOffsetX;this.block_.outputConnection.setOffsetInBlock(this.info_.RTL?-e:e,this.info_.outputConnection.connectionOffsetY)}};o.blockRendering.PathObject=function(e,t,n){this.constants_=n;this.svgRoot=e;this.svgPath=o.utils.dom.createSvgElement("path",{class:"blocklyPath"},this.svgRoot);this.style=t;this.markerSvg_=this.cursorSvg_=null};o.blockRendering.PathObject.prototype.setPath=function(e){this.svgPath.setAttribute("d",e)};o.blockRendering.PathObject.prototype.flipRTL=function(){this.svgPath.setAttribute("transform","scale(-1 1)")};o.blockRendering.PathObject.prototype.setCursorSvg=function(e){e?(this.svgRoot.appendChild(e),this.cursorSvg_=e):this.cursorSvg_=null};o.blockRendering.PathObject.prototype.setMarkerSvg=function(e){e?(this.cursorSvg_?this.svgRoot.insertBefore(e,this.cursorSvg_):this.svgRoot.appendChild(e),this.markerSvg_=e):this.markerSvg_=null};o.blockRendering.PathObject.prototype.applyColour=function(e){this.svgPath.setAttribute("stroke",this.style.colourTertiary);this.svgPath.setAttribute("fill",this.style.colourPrimary);this.updateShadow_(e.isShadow());this.updateDisabled_(!e.isEnabled()||e.getInheritedDisabled())};o.blockRendering.PathObject.prototype.setStyle=function(e){this.style=e};o.blockRendering.PathObject.prototype.setClass_=function(e,t){t?o.utils.dom.addClass(this.svgRoot,e):o.utils.dom.removeClass(this.svgRoot,e)};o.blockRendering.PathObject.prototype.updateHighlighted=function(e){e?this.svgPath.setAttribute("filter","url(#"+this.constants_.embossFilterId+")"):this.svgPath.setAttribute("filter","none")};o.blockRendering.PathObject.prototype.updateShadow_=function(e){e&&(this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary))};o.blockRendering.PathObject.prototype.updateDisabled_=function(e){this.setClass_("blocklyDisabled",e);e&&this.svgPath.setAttribute("fill","url(#"+this.constants_.disabledPatternId+")")};o.blockRendering.PathObject.prototype.updateSelected=function(e){this.setClass_("blocklySelected",e)};o.blockRendering.PathObject.prototype.updateDraggingDelete=function(e){this.setClass_("blocklyDraggingDelete",e)};o.blockRendering.PathObject.prototype.updateInsertionMarker=function(e){this.setClass_("blocklyInsertionMarker",e)};o.blockRendering.PathObject.prototype.updateMovable=function(e){this.setClass_("blocklyDraggable",e)};o.blockRendering.PathObject.prototype.updateReplacementHighlight=function(e){this.setClass_("blocklyReplaceable",e)};o.blockRendering.PathObject.prototype.updateShapeForInputHighlight=function(){};o.blockRendering.Renderer=function(e){this.name=e;this.constants_=null};o.blockRendering.Renderer.prototype.init=function(){this.constants_=this.makeConstants_();this.constants_.init()};o.blockRendering.Renderer.prototype.makeConstants_=function(){return new o.blockRendering.ConstantProvider};o.blockRendering.Renderer.prototype.makeRenderInfo_=function(e){return new o.blockRendering.RenderInfo(this,e)};o.blockRendering.Renderer.prototype.makeDrawer_=function(e,t){return new o.blockRendering.Drawer(e,t)};o.blockRendering.Renderer.prototype.makeDebugger_=function(){if(!o.blockRendering.Debug)throw Error("Missing require for Blockly.blockRendering.Debug");return new o.blockRendering.Debug};o.blockRendering.Renderer.prototype.makeMarkerDrawer=function(e,t){return new o.blockRendering.MarkerSvg(e,this.getConstants(),t)};o.blockRendering.Renderer.prototype.makePathObject=function(e,t){return new o.blockRendering.PathObject(e,t,this.constants_)};o.blockRendering.Renderer.prototype.getConstants=function(){return this.constants_};o.blockRendering.Renderer.prototype.shouldHighlightConnection=function(){return!0};o.blockRendering.Renderer.prototype.shouldInsertDraggedBlock=function(e,t){return!t.isConnected()||!!o.Connection.lastConnectionInRow(e,t.targetConnection.getSourceBlock())};o.blockRendering.Renderer.prototype.render=function(e){o.blockRendering.useDebugger&&!e.renderingDebugger&&(e.renderingDebugger=this.makeDebugger_());var t=this.makeRenderInfo_(e);t.measure();this.makeDrawer_(e,t).draw()};o.geras={};o.geras.ConstantProvider=function(){o.geras.ConstantProvider.superClass_.constructor.call(this);this.FIELD_TEXT_BASELINE_CENTER=!1;this.DARK_PATH_OFFSET=1;this.MAX_BOTTOM_WIDTH=30};o.utils.object.inherits(o.geras.ConstantProvider,o.blockRendering.ConstantProvider);o.geras.Highlighter=function(e){this.info_=e;this.inlineSteps_=this.steps_="";this.RTL_=this.info_.RTL;e=e.getRenderer();this.constants_=e.getConstants();this.highlightConstants_=e.getHighlightConstants();this.highlightOffset_=this.highlightConstants_.OFFSET;this.outsideCornerPaths_=this.highlightConstants_.OUTSIDE_CORNER;this.insideCornerPaths_=this.highlightConstants_.INSIDE_CORNER;this.puzzleTabPaths_=this.highlightConstants_.PUZZLE_TAB;this.notchPaths_=this.highlightConstants_.NOTCH;this.startPaths_=this.highlightConstants_.START_HAT;this.jaggedTeethPaths_=this.highlightConstants_.JAGGED_TEETH};o.geras.Highlighter.prototype.getPath=function(){return this.steps_+"\n"+this.inlineSteps_};o.geras.Highlighter.prototype.drawTopCorner=function(e){this.steps_+=o.utils.svgPaths.moveBy(e.xPos,this.info_.startY);for(var t=0,n;n=e.elements[t];t++){o.blockRendering.Types.isLeftSquareCorner(n)?this.steps_+=this.highlightConstants_.START_POINT:o.blockRendering.Types.isLeftRoundedCorner(n)?this.steps_+=this.outsideCornerPaths_.topLeft(this.RTL_):o.blockRendering.Types.isPreviousConnection(n)?this.steps_+=this.notchPaths_.pathLeft:o.blockRendering.Types.isHat(n)?this.steps_+=this.startPaths_.path(this.RTL_):o.blockRendering.Types.isSpacer(n)&&0!=n.width&&(this.steps_+=o.utils.svgPaths.lineOnAxis("H",n.xPos+n.width-this.highlightOffset_))}this.steps_+=o.utils.svgPaths.lineOnAxis("H",e.xPos+e.width-this.highlightOffset_)};o.geras.Highlighter.prototype.drawJaggedEdge_=function(e){this.info_.RTL&&(this.steps_+=o.utils.svgPaths.lineOnAxis("H",e.width-this.highlightOffset_),this.steps_+=this.jaggedTeethPaths_.pathLeft,this.steps_+=o.utils.svgPaths.lineOnAxis("v",e.height-this.jaggedTeethPaths_.height-this.highlightOffset_))};o.geras.Highlighter.prototype.drawValueInput=function(e){var t=e.getLastInput();if(this.RTL_){var n=e.height-t.connectionHeight;this.steps_+=o.utils.svgPaths.moveTo(t.xPos+t.width-this.highlightOffset_,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)+o.utils.svgPaths.lineOnAxis("v",n)}else this.steps_+=o.utils.svgPaths.moveTo(t.xPos+t.width,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)};o.geras.Highlighter.prototype.drawStatementInput=function(e){var t=e.getLastInput();if(this.RTL_){var n=e.height-2*this.insideCornerPaths_.height;this.steps_+=o.utils.svgPaths.moveTo(t.xPos,e.yPos)+this.insideCornerPaths_.pathTop(this.RTL_)+o.utils.svgPaths.lineOnAxis("v",n)+this.insideCornerPaths_.pathBottom(this.RTL_)+o.utils.svgPaths.lineTo(e.width-t.xPos-this.insideCornerPaths_.width,0)}else this.steps_+=o.utils.svgPaths.moveTo(t.xPos,e.yPos+e.height)+this.insideCornerPaths_.pathBottom(this.RTL_)+o.utils.svgPaths.lineTo(e.width-t.xPos-this.insideCornerPaths_.width,0)};o.geras.Highlighter.prototype.drawRightSideRow=function(e){var t=e.xPos+e.width-this.highlightOffset_;e.followsStatement&&(this.steps_+=o.utils.svgPaths.lineOnAxis("H",t));this.RTL_&&(this.steps_+=o.utils.svgPaths.lineOnAxis("H",t),e.height>this.highlightOffset_&&(this.steps_+=o.utils.svgPaths.lineOnAxis("V",e.yPos+e.height-this.highlightOffset_)))};o.geras.Highlighter.prototype.drawBottomRow=function(e){if(this.RTL_)this.steps_+=o.utils.svgPaths.lineOnAxis("V",e.baseline-this.highlightOffset_);else{var t=this.info_.bottomRow.elements[0];o.blockRendering.Types.isLeftSquareCorner(t)?this.steps_+=o.utils.svgPaths.moveTo(e.xPos+this.highlightOffset_,e.baseline-this.highlightOffset_):o.blockRendering.Types.isLeftRoundedCorner(t)&&(this.steps_+=o.utils.svgPaths.moveTo(e.xPos,e.baseline),this.steps_+=this.outsideCornerPaths_.bottomLeft())}};o.geras.Highlighter.prototype.drawLeft=function(){var e=this.info_.outputConnection;e&&(e=e.connectionOffsetY+e.height,this.RTL_?this.steps_+=o.utils.svgPaths.moveTo(this.info_.startX,e):(this.steps_+=o.utils.svgPaths.moveTo(this.info_.startX+this.highlightOffset_,this.info_.bottomRow.baseline-this.highlightOffset_),this.steps_+=o.utils.svgPaths.lineOnAxis("V",e)),this.steps_+=this.puzzleTabPaths_.pathUp(this.RTL_));this.RTL_||(e=this.info_.topRow,o.blockRendering.Types.isLeftRoundedCorner(e.elements[0])?this.steps_+=o.utils.svgPaths.lineOnAxis("V",this.outsideCornerPaths_.height):this.steps_+=o.utils.svgPaths.lineOnAxis("V",e.capline+this.highlightOffset_))};o.geras.Highlighter.prototype.drawInlineInput=function(t){var n=this.highlightOffset_,r=t.xPos+t.connectionWidth,i=t.centerline-t.height/2,s=t.width-t.connectionWidth,e=i+n;this.RTL_?(i=t.connectionOffsetY-n,t=t.height-(t.connectionOffsetY+t.connectionHeight)+n,this.inlineSteps_+=o.utils.svgPaths.moveTo(r-n,e)+o.utils.svgPaths.lineOnAxis("v",i)+this.puzzleTabPaths_.pathDown(this.RTL_)+o.utils.svgPaths.lineOnAxis("v",t)+o.utils.svgPaths.lineOnAxis("h",s)):this.inlineSteps_+=o.utils.svgPaths.moveTo(t.xPos+t.width+n,e)+o.utils.svgPaths.lineOnAxis("v",t.height)+o.utils.svgPaths.lineOnAxis("h",-s)+o.utils.svgPaths.moveTo(r,i+t.connectionOffsetY)+this.puzzleTabPaths_.pathDown(this.RTL_)};o.geras.InlineInput=function(e,t){o.geras.InlineInput.superClass_.constructor.call(this,e,t);this.connectedBlock&&(this.width+=this.constants_.DARK_PATH_OFFSET,this.height+=this.constants_.DARK_PATH_OFFSET)};o.utils.object.inherits(o.geras.InlineInput,o.blockRendering.InlineInput);o.geras.StatementInput=function(e,t){o.geras.StatementInput.superClass_.constructor.call(this,e,t);this.connectedBlock&&(this.height+=this.constants_.DARK_PATH_OFFSET)};o.utils.object.inherits(o.geras.StatementInput,o.blockRendering.StatementInput);o.geras.RenderInfo=function(e,t){o.geras.RenderInfo.superClass_.constructor.call(this,e,t)};o.utils.object.inherits(o.geras.RenderInfo,o.blockRendering.RenderInfo);o.geras.RenderInfo.prototype.getRenderer=function(){return this.renderer_};o.geras.RenderInfo.prototype.populateBottomRow_=function(){o.geras.RenderInfo.superClass_.populateBottomRow_.call(this);this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1].type==o.NEXT_STATEMENT||(this.bottomRow.minHeight=this.constants_.MEDIUM_PADDING-this.constants_.DARK_PATH_OFFSET)};o.geras.RenderInfo.prototype.addInput_=function(e,t){this.isInline&&e.type==o.INPUT_VALUE?(t.elements.push(new o.geras.InlineInput(this.constants_,e)),t.hasInlineInput=!0):e.type==o.NEXT_STATEMENT?(t.elements.push(new o.geras.StatementInput(this.constants_,e)),t.hasStatement=!0):e.type==o.INPUT_VALUE?(t.elements.push(new o.blockRendering.ExternalValueInput(this.constants_,e)),t.hasExternalInput=!0):e.type==o.DUMMY_INPUT&&(t.minHeight=Math.max(t.minHeight,this.constants_.DUMMY_INPUT_MIN_HEIGHT),t.hasDummyInput=!0);this.isInline||null!=t.align||(t.align=e.align)};o.geras.RenderInfo.prototype.addElemSpacing_=function(){for(var t=!1,n=0,r;r=this.rows[n];n++){r.hasExternalInput&&(t=!0)}for(n=0;r=this.rows[n];n++){var i=r.elements;r.elements=[];r.startsWithElemSpacer()&&r.elements.push(new o.blockRendering.InRowSpacer(this.constants_,this.getInRowSpacing_(null,i[0])));if(i.length){for(var s=0;s<i.length-1;s++){r.elements.push(i[s]);var l=this.getInRowSpacing_(i[s],i[s+1]);r.elements.push(new o.blockRendering.InRowSpacer(this.constants_,l))}r.elements.push(i[i.length-1]);r.endsWithElemSpacer()&&(l=this.getInRowSpacing_(i[i.length-1],null),t&&r.hasDummyInput&&(l+=this.constants_.TAB_WIDTH),r.elements.push(new o.blockRendering.InRowSpacer(this.constants_,l)))}}};o.geras.RenderInfo.prototype.getInRowSpacing_=function(e,t){if(!e)return t&&o.blockRendering.Types.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:t&&o.blockRendering.Types.isInlineInput(t)?this.constants_.MEDIUM_LARGE_PADDING:t&&o.blockRendering.Types.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!o.blockRendering.Types.isInput(e)&&(!t||o.blockRendering.Types.isStatementInput(t)))return o.blockRendering.Types.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:o.blockRendering.Types.isIcon(e)?2*this.constants_.LARGE_PADDING+1:o.blockRendering.Types.isHat(e)?this.constants_.NO_PADDING:o.blockRendering.Types.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:o.blockRendering.Types.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:o.blockRendering.Types.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isInput(e)&&!t){if(o.blockRendering.Types.isExternalInput(e))return this.constants_.NO_PADDING;if(o.blockRendering.Types.isInlineInput(e))return this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isStatementInput(e))return this.constants_.NO_PADDING}if(!o.blockRendering.Types.isInput(e)&&t&&o.blockRendering.Types.isInput(t)){if(o.blockRendering.Types.isField(e)&&e.isEditable){if(o.blockRendering.Types.isInlineInput(t)||o.blockRendering.Types.isExternalInput(t))return this.constants_.SMALL_PADDING}else{if(o.blockRendering.Types.isInlineInput(t)||o.blockRendering.Types.isExternalInput(t))return this.constants_.MEDIUM_LARGE_PADDING;if(o.blockRendering.Types.isStatementInput(t))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(o.blockRendering.Types.isIcon(e)&&t&&!o.blockRendering.Types.isInput(t))return this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isInlineInput(e)&&t&&o.blockRendering.Types.isField(t))return t.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isLeftSquareCorner(e)&&t){if(o.blockRendering.Types.isHat(t))return this.constants_.NO_PADDING;if(o.blockRendering.Types.isPreviousConnection(t))return t.notchOffset;if(o.blockRendering.Types.isNextConnection(t))return e=(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2,t.notchOffset+e}if(o.blockRendering.Types.isLeftRoundedCorner(e)&&t){if(o.blockRendering.Types.isPreviousConnection(t))return t.notchOffset-this.constants_.CORNER_RADIUS;if(o.blockRendering.Types.isNextConnection(t))return e=(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2,t.notchOffset-this.constants_.CORNER_RADIUS+e}return o.blockRendering.Types.isField(e)&&t&&o.blockRendering.Types.isField(t)&&e.isEditable==t.isEditable||t&&o.blockRendering.Types.isJaggedEdge(t)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING};o.geras.RenderInfo.prototype.getSpacerRowHeight_=function(e,t){return o.blockRendering.Types.isTopRow(e)&&o.blockRendering.Types.isBottomRow(t)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:o.blockRendering.Types.isTopRow(e)||o.blockRendering.Types.isBottomRow(t)?this.constants_.NO_PADDING:e.hasExternalInput&&t.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&t.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&t.hasStatement||!e.hasStatement&&t.hasDummyInput||e.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING};o.geras.RenderInfo.prototype.getElemCenterline_=function(e,t){if(o.blockRendering.Types.isSpacer(t))return e.yPos+t.height/2;if(o.blockRendering.Types.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,o.blockRendering.Types.isNextConnection(t)?e+t.height/2:e-t.height/2;if(o.blockRendering.Types.isTopRow(e))return o.blockRendering.Types.isHat(t)?e.capline-t.height/2:e.capline+t.height/2;var n=e.yPos;o.blockRendering.Types.isField(t)||o.blockRendering.Types.isIcon(t)?(n+=t.height/2,(e.hasInlineInput||e.hasStatement)&&t.height+this.constants_.TALL_INPUT_FIELD_OFFSET_Y<=e.height&&(n+=this.constants_.TALL_INPUT_FIELD_OFFSET_Y)):n=o.blockRendering.Types.isInlineInput(t)?n+t.height/2:n+e.height/2;return n};o.geras.RenderInfo.prototype.alignRowElements_=function(){if(this.isInline){for(var e=0,t=null,n=this.rows.length-1,r;r=this.rows[n];n--){r.nextRightEdge=e,o.blockRendering.Types.isInputRow(r)&&(r.hasStatement&&this.alignStatementRow_(r),t&&t.hasStatement&&r.width<t.width?r.nextRightEdge=t.width:e=r.width,t=r)}for(n=e=0;r=this.rows[n];n++){r.hasStatement?e=this.getDesiredRowWidth_(r):o.blockRendering.Types.isSpacer(r)?r.width=Math.max(e,r.nextRightEdge):(e=Math.max(e,r.nextRightEdge)-r.width,0<e&&this.addAlignmentPadding_(r,e),e=r.width)}}else o.geras.RenderInfo.superClass_.alignRowElements_.call(this)};o.geras.RenderInfo.prototype.getDesiredRowWidth_=function(e){return this.isInline&&e.hasStatement?this.statementEdge+this.constants_.MAX_BOTTOM_WIDTH+this.startX:o.geras.RenderInfo.superClass_.getDesiredRowWidth_.call(this,e)};o.geras.RenderInfo.prototype.finalize_=function(){for(var t=0,o=0,n=0,r;r=this.rows[n];n++){r.yPos=o;r.xPos=this.startX;o+=r.height;t=Math.max(t,r.widthWithConnectedBlocks);var i=o-this.topRow.ascenderHeight;r==this.bottomRow&&i<this.constants_.MIN_BLOCK_HEIGHT&&(i=this.constants_.MIN_BLOCK_HEIGHT-i,this.bottomRow.height+=i,o+=i);this.recordElemPositions_(r)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(t=Math.max(t,this.block_.nextConnection.targetBlock().getHeightWidth().width-this.constants_.DARK_PATH_OFFSET));this.bottomRow.baseline=o-this.bottomRow.descenderHeight;this.widthWithChildren=t+this.startX+this.constants_.DARK_PATH_OFFSET;this.width+=this.constants_.DARK_PATH_OFFSET;this.height=o+this.constants_.DARK_PATH_OFFSET;this.startY=this.topRow.capline};o.geras.Drawer=function(e,t){o.geras.Drawer.superClass_.constructor.call(this,e,t);this.highlighter_=new o.geras.Highlighter(t)};o.utils.object.inherits(o.geras.Drawer,o.blockRendering.Drawer);o.geras.Drawer.prototype.draw=function(){this.hideHiddenIcons_();this.drawOutline_();this.drawInternals_();var e=this.block_.pathObject;e.setPath(this.outlinePath_+"\n"+this.inlinePath_);e.setHighlightPath(this.highlighter_.getPath());this.info_.RTL&&e.flipRTL();o.blockRendering.useDebugger&&this.block_.renderingDebugger.drawDebug(this.block_,this.info_);this.recordSizeOnBlock_()};o.geras.Drawer.prototype.drawTop_=function(){this.highlighter_.drawTopCorner(this.info_.topRow);this.highlighter_.drawRightSideRow(this.info_.topRow);o.geras.Drawer.superClass_.drawTop_.call(this)};o.geras.Drawer.prototype.drawJaggedEdge_=function(e){this.highlighter_.drawJaggedEdge_(e);o.geras.Drawer.superClass_.drawJaggedEdge_.call(this,e)};o.geras.Drawer.prototype.drawValueInput_=function(e){this.highlighter_.drawValueInput(e);o.geras.Drawer.superClass_.drawValueInput_.call(this,e)};o.geras.Drawer.prototype.drawStatementInput_=function(e){this.highlighter_.drawStatementInput(e);o.geras.Drawer.superClass_.drawStatementInput_.call(this,e)};o.geras.Drawer.prototype.drawRightSideRow_=function(e){this.highlighter_.drawRightSideRow(e);this.outlinePath_+=o.utils.svgPaths.lineOnAxis("H",e.xPos+e.width)+o.utils.svgPaths.lineOnAxis("V",e.yPos+e.height)};o.geras.Drawer.prototype.drawBottom_=function(){this.highlighter_.drawBottomRow(this.info_.bottomRow);o.geras.Drawer.superClass_.drawBottom_.call(this)};o.geras.Drawer.prototype.drawLeft_=function(){this.highlighter_.drawLeft();o.geras.Drawer.superClass_.drawLeft_.call(this)};o.geras.Drawer.prototype.drawInlineInput_=function(e){this.highlighter_.drawInlineInput(e);o.geras.Drawer.superClass_.drawInlineInput_.call(this,e)};o.geras.Drawer.prototype.positionInlineInputConnection_=function(e){var t=e.centerline-e.height/2;if(e.connectionModel){var o=e.xPos+e.connectionWidth+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(o*=-1);e.connectionModel.setOffsetInBlock(o,t+e.connectionOffsetY+this.constants_.DARK_PATH_OFFSET)}};o.geras.Drawer.prototype.positionStatementInputConnection_=function(e){var t=e.getLastInput();if(t.connectionModel){var o=e.xPos+e.statementEdge+t.notchOffset;o=this.info_.RTL?-1*o:o+this.constants_.DARK_PATH_OFFSET;t.connectionModel.setOffsetInBlock(o,e.yPos+this.constants_.DARK_PATH_OFFSET)}};o.geras.Drawer.prototype.positionExternalValueConnection_=function(e){var t=e.getLastInput();if(t.connectionModel){var o=e.xPos+e.width+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(o*=-1);t.connectionModel.setOffsetInBlock(o,e.yPos)}};o.geras.Drawer.prototype.positionNextConnection_=function(){var e=this.info_.bottomRow;if(e.connection){var t=e.connection,o=t.xPos;t.connectionModel.setOffsetInBlock((this.info_.RTL?-o:o)+this.constants_.DARK_PATH_OFFSET/2,e.baseline+this.constants_.DARK_PATH_OFFSET)}};o.geras.HighlightConstantProvider=function(e){this.constantProvider=e;this.OFFSET=.5;this.START_POINT=o.utils.svgPaths.moveBy(this.OFFSET,this.OFFSET);this.INSIDE_CORNER=this.makeInsideCorner();this.OUTSIDE_CORNER=this.makeOutsideCorner();this.PUZZLE_TAB=this.makePuzzleTab();this.NOTCH=this.makeNotch();this.JAGGED_TEETH=this.makeJaggedTeeth();this.START_HAT=this.makeStartHat()};o.geras.HighlightConstantProvider.prototype.makeInsideCorner=function(){var t=this.constantProvider.CORNER_RADIUS,n=this.OFFSET,r=(1-Math.SQRT1_2)*(t+n)-n,i=o.utils.svgPaths.moveBy(r,r)+o.utils.svgPaths.arc("a","0 0,0",t,o.utils.svgPaths.point(-r-n,t-r)),s=o.utils.svgPaths.arc("a","0 0,0",t+n,o.utils.svgPaths.point(t+n,t+n)),e=o.utils.svgPaths.moveBy(r,-r)+o.utils.svgPaths.arc("a","0 0,0",t+n,o.utils.svgPaths.point(t-r,r+n));return{width:t+n,height:t,pathTop:function pathTop(e){return e?i:""},pathBottom:function pathBottom(t){return t?s:e}}};o.geras.HighlightConstantProvider.prototype.makeOutsideCorner=function(){var t=this.constantProvider.CORNER_RADIUS,n=this.OFFSET,r=(1-Math.SQRT1_2)*(t-n)+n,i=o.utils.svgPaths.moveBy(r,r)+o.utils.svgPaths.arc("a","0 0,1",t-n,o.utils.svgPaths.point(t-r,-r+n)),s=o.utils.svgPaths.moveBy(n,t)+o.utils.svgPaths.arc("a","0 0,1",t-n,o.utils.svgPaths.point(t,-t+n)),e=-r,l=o.utils.svgPaths.moveBy(r,e)+o.utils.svgPaths.arc("a","0 0,1",t-n,o.utils.svgPaths.point(-r+n,-e-t));return{height:t,topLeft:function topLeft(e){return e?i:s},bottomLeft:function bottomLeft(){return l}}};o.geras.HighlightConstantProvider.prototype.makePuzzleTab=function(){var t=this.constantProvider.TAB_WIDTH,n=this.constantProvider.TAB_HEIGHT,r=o.utils.svgPaths.moveBy(-2,-n+3.4)+o.utils.svgPaths.lineTo(-.45*t,-2.1),i=o.utils.svgPaths.lineOnAxis("v",2.5)+o.utils.svgPaths.moveBy(.97*-t,2.5)+o.utils.svgPaths.curve("q",[o.utils.svgPaths.point(.05*-t,10),o.utils.svgPaths.point(.3*t,9.5)])+o.utils.svgPaths.moveBy(.67*t,-1.9)+o.utils.svgPaths.lineOnAxis("v",2.5),s=o.utils.svgPaths.lineOnAxis("v",-1.5)+o.utils.svgPaths.moveBy(-.92*t,-.5)+o.utils.svgPaths.curve("q",[o.utils.svgPaths.point(-.19*t,-5.5),o.utils.svgPaths.point(0,-11)])+o.utils.svgPaths.moveBy(.92*t,1),e=o.utils.svgPaths.moveBy(-5,n-.7)+o.utils.svgPaths.lineTo(.46*t,-2.1);return{width:t,height:n,pathUp:function pathUp(e){return e?r:s},pathDown:function pathDown(t){return t?i:e}}};o.geras.HighlightConstantProvider.prototype.makeNotch=function(){return{pathLeft:o.utils.svgPaths.lineOnAxis("h",this.OFFSET)+this.constantProvider.NOTCH.pathLeft}};o.geras.HighlightConstantProvider.prototype.makeJaggedTeeth=function(){return{pathLeft:o.utils.svgPaths.lineTo(5.1,2.6)+o.utils.svgPaths.moveBy(-10.2,6.8)+o.utils.svgPaths.lineTo(5.1,2.6)}};o.geras.HighlightConstantProvider.prototype.makeStartHat=function(){var e=this.constantProvider.START_HAT.height,t=o.utils.svgPaths.moveBy(25,-8.7)+o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(29.7,-6.2),o.utils.svgPaths.point(57.2,-.5),o.utils.svgPaths.point(75,8.7)]),n=o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(17.8,-9.2),o.utils.svgPaths.point(45.3,-14.9),o.utils.svgPaths.point(75,-8.7)])+o.utils.svgPaths.moveTo(100.5,e+.5);return{path:function path(e){return e?t:n}}};o.geras.PathObject=function(e,t,n){this.constants_=n;this.svgRoot=e;this.svgPathDark=o.utils.dom.createSvgElement("path",{class:"blocklyPathDark",transform:"translate(1,1)"},this.svgRoot);this.svgPath=o.utils.dom.createSvgElement("path",{class:"blocklyPath"},this.svgRoot);this.svgPathLight=o.utils.dom.createSvgElement("path",{class:"blocklyPathLight"},this.svgRoot);this.colourDark="#000000";this.style=t};o.utils.object.inherits(o.geras.PathObject,o.blockRendering.PathObject);o.geras.PathObject.prototype.setPath=function(e){this.svgPath.setAttribute("d",e);this.svgPathDark.setAttribute("d",e)};o.geras.PathObject.prototype.setHighlightPath=function(e){this.svgPathLight.setAttribute("d",e)};o.geras.PathObject.prototype.flipRTL=function(){this.svgPath.setAttribute("transform","scale(-1 1)");this.svgPathLight.setAttribute("transform","scale(-1 1)");this.svgPathDark.setAttribute("transform","translate(1,1) scale(-1 1)")};o.geras.PathObject.prototype.applyColour=function(e){this.svgPathLight.style.display="";this.svgPathDark.style.display="";this.svgPathLight.setAttribute("stroke",this.style.colourTertiary);this.svgPathDark.setAttribute("fill",this.colourDark);o.geras.PathObject.superClass_.applyColour.call(this,e);this.svgPath.setAttribute("stroke","none")};o.geras.PathObject.prototype.setStyle=function(e){this.style=e;this.colourDark=o.utils.colour.blend("#000",this.style.colourPrimary,.2)||this.colourDark};o.geras.PathObject.prototype.updateHighlighted=function(e){e?(this.svgPath.setAttribute("filter","url(#"+this.constants_.embossFilterId+")"),this.svgPathLight.style.display="none"):(this.svgPath.setAttribute("filter","none"),this.svgPathLight.style.display="inline")};o.geras.PathObject.prototype.updateShadow_=function(e){e&&(this.svgPathLight.style.display="none",this.svgPathDark.setAttribute("fill",this.style.colourSecondary),this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary))};o.geras.PathObject.prototype.updateDisabled_=function(e){o.geras.PathObject.superClass_.updateDisabled_.call(this,e);e&&this.svgPath.setAttribute("stroke","none")};o.geras.Renderer=function(e){o.geras.Renderer.superClass_.constructor.call(this,e);this.highlightConstants_=null};o.utils.object.inherits(o.geras.Renderer,o.blockRendering.Renderer);o.geras.Renderer.prototype.init=function(){o.geras.Renderer.superClass_.init.call(this);this.highlightConstants_=this.makeHighlightConstants_()};o.geras.Renderer.prototype.makeConstants_=function(){return new o.geras.ConstantProvider};o.geras.Renderer.prototype.makeRenderInfo_=function(e){return new o.geras.RenderInfo(this,e)};o.geras.Renderer.prototype.makeDrawer_=function(e,t){return new o.geras.Drawer(e,t)};o.geras.Renderer.prototype.makePathObject=function(e,t){return new o.geras.PathObject(e,t,this.getConstants())};o.geras.Renderer.prototype.makeHighlightConstants_=function(){return new o.geras.HighlightConstantProvider(this.getConstants())};o.geras.Renderer.prototype.getHighlightConstants=function(){return this.highlightConstants_};o.blockRendering.register("geras",o.geras.Renderer);o.thrasos={};o.thrasos.RenderInfo=function(e,t){o.thrasos.RenderInfo.superClass_.constructor.call(this,e,t)};o.utils.object.inherits(o.thrasos.RenderInfo,o.blockRendering.RenderInfo);o.thrasos.RenderInfo.prototype.getRenderer=function(){return this.renderer_};o.thrasos.RenderInfo.prototype.addElemSpacing_=function(){for(var t=!1,n=0,r;r=this.rows[n];n++){r.hasExternalInput&&(t=!0)}for(n=0;r=this.rows[n];n++){var i=r.elements;r.elements=[];r.startsWithElemSpacer()&&r.elements.push(new o.blockRendering.InRowSpacer(this.constants_,this.getInRowSpacing_(null,i[0])));for(var s=0;s<i.length-1;s++){r.elements.push(i[s]);var l=this.getInRowSpacing_(i[s],i[s+1]);r.elements.push(new o.blockRendering.InRowSpacer(this.constants_,l))}r.elements.push(i[i.length-1]);r.endsWithElemSpacer()&&(l=this.getInRowSpacing_(i[i.length-1],null),t&&r.hasDummyInput&&(l+=this.constants_.TAB_WIDTH),r.elements.push(new o.blockRendering.InRowSpacer(this.constants_,l)))}};o.thrasos.RenderInfo.prototype.getInRowSpacing_=function(e,t){if(!e)return t&&o.blockRendering.Types.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:t&&o.blockRendering.Types.isInlineInput(t)?this.constants_.MEDIUM_LARGE_PADDING:t&&o.blockRendering.Types.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!o.blockRendering.Types.isInput(e)&&!t)return o.blockRendering.Types.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:o.blockRendering.Types.isIcon(e)?2*this.constants_.LARGE_PADDING+1:o.blockRendering.Types.isHat(e)?this.constants_.NO_PADDING:o.blockRendering.Types.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:o.blockRendering.Types.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:o.blockRendering.Types.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isInput(e)&&!t){if(o.blockRendering.Types.isExternalInput(e))return this.constants_.NO_PADDING;if(o.blockRendering.Types.isInlineInput(e))return this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isStatementInput(e))return this.constants_.NO_PADDING}if(!o.blockRendering.Types.isInput(e)&&t&&o.blockRendering.Types.isInput(t)){if(o.blockRendering.Types.isField(e)&&e.isEditable){if(o.blockRendering.Types.isInlineInput(t)||o.blockRendering.Types.isExternalInput(t))return this.constants_.SMALL_PADDING}else{if(o.blockRendering.Types.isInlineInput(t)||o.blockRendering.Types.isExternalInput(t))return this.constants_.MEDIUM_LARGE_PADDING;if(o.blockRendering.Types.isStatementInput(t))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(o.blockRendering.Types.isIcon(e)&&t&&!o.blockRendering.Types.isInput(t))return this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isInlineInput(e)&&t&&o.blockRendering.Types.isField(t))return t.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isLeftSquareCorner(e)&&t){if(o.blockRendering.Types.isHat(t))return this.constants_.NO_PADDING;if(o.blockRendering.Types.isPreviousConnection(t)||o.blockRendering.Types.isNextConnection(t))return t.notchOffset}return o.blockRendering.Types.isLeftRoundedCorner(e)&&t?t.notchOffset-this.constants_.CORNER_RADIUS:o.blockRendering.Types.isField(e)&&t&&o.blockRendering.Types.isField(t)&&e.isEditable==t.isEditable||t&&o.blockRendering.Types.isJaggedEdge(t)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING};o.thrasos.RenderInfo.prototype.getSpacerRowHeight_=function(e,t){return o.blockRendering.Types.isTopRow(e)&&o.blockRendering.Types.isBottomRow(t)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:o.blockRendering.Types.isTopRow(e)||o.blockRendering.Types.isBottomRow(t)?this.constants_.NO_PADDING:e.hasExternalInput&&t.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&t.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&t.hasStatement||e.hasDummyInput||t.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING};o.thrasos.RenderInfo.prototype.getElemCenterline_=function(e,t){if(o.blockRendering.Types.isSpacer(t))return e.yPos+t.height/2;if(o.blockRendering.Types.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,o.blockRendering.Types.isNextConnection(t)?e+t.height/2:e-t.height/2;if(o.blockRendering.Types.isTopRow(e))return o.blockRendering.Types.isHat(t)?e.capline-t.height/2:e.capline+t.height/2;var n=e.yPos;return n=o.blockRendering.Types.isField(t)&&e.hasStatement?n+(this.constants_.TALL_INPUT_FIELD_OFFSET_Y+t.height/2):n+e.height/2};o.thrasos.RenderInfo.prototype.finalize_=function(){for(var t=0,o=0,n=0,r;r=this.rows[n];n++){r.yPos=o;r.xPos=this.startX;o+=r.height;t=Math.max(t,r.widthWithConnectedBlocks);var i=o-this.topRow.ascenderHeight;r==this.bottomRow&&i<this.constants_.MIN_BLOCK_HEIGHT&&(i=this.constants_.MIN_BLOCK_HEIGHT-i,this.bottomRow.height+=i,o+=i);this.recordElemPositions_(r)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(t=Math.max(t,this.block_.nextConnection.targetBlock().getHeightWidth().width));this.bottomRow.baseline=o-this.bottomRow.descenderHeight;this.widthWithChildren=t+this.startX;this.height=o;this.startY=this.topRow.capline};o.thrasos.Renderer=function(e){o.thrasos.Renderer.superClass_.constructor.call(this,e)};o.utils.object.inherits(o.thrasos.Renderer,o.blockRendering.Renderer);o.thrasos.Renderer.prototype.makeRenderInfo_=function(e){return new o.thrasos.RenderInfo(this,e)};o.blockRendering.register("thrasos",o.thrasos.Renderer);o.zelos={};o.zelos.ConstantProvider=function(){o.zelos.ConstantProvider.superClass_.constructor.call(this);this.SMALL_PADDING=this.GRID_UNIT=4;this.MEDIUM_PADDING=2*this.GRID_UNIT;this.MEDIUM_LARGE_PADDING=3*this.GRID_UNIT;this.LARGE_PADDING=4*this.GRID_UNIT;this.CORNER_RADIUS=1*this.GRID_UNIT;this.NOTCH_WIDTH=9*this.GRID_UNIT;this.NOTCH_HEIGHT=2*this.GRID_UNIT;this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT=3*this.GRID_UNIT;this.MIN_BLOCK_WIDTH=2*this.GRID_UNIT;this.MIN_BLOCK_HEIGHT=12*this.GRID_UNIT;this.EMPTY_STATEMENT_INPUT_HEIGHT=6*this.GRID_UNIT;this.TAB_OFFSET_FROM_TOP=0;this.TOP_ROW_MIN_HEIGHT=this.GRID_UNIT;this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING;this.BOTTOM_ROW_MIN_HEIGHT=this.GRID_UNIT;this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=6*this.GRID_UNIT;this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT;this.STATEMENT_INPUT_SPACER_MIN_WIDTH=40*this.GRID_UNIT;this.STATEMENT_INPUT_PADDING_LEFT=4*this.GRID_UNIT;this.EMPTY_INLINE_INPUT_PADDING=4*this.GRID_UNIT;this.EMPTY_INLINE_INPUT_HEIGHT=8*this.GRID_UNIT;this.DUMMY_INPUT_MIN_HEIGHT=8*this.GRID_UNIT;this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=6*this.GRID_UNIT;this.CURSOR_WS_WIDTH=20*this.GRID_UNIT;this.CURSOR_COLOUR="#ffa200";this.CURSOR_RADIUS=5;this.JAGGED_TEETH_WIDTH=this.JAGGED_TEETH_HEIGHT=0;this.START_HAT_HEIGHT=22;this.START_HAT_WIDTH=96;this.SHAPES={HEXAGONAL:1,ROUND:2,SQUARE:3,PUZZLE:4,NOTCH:5};this.SHAPE_IN_SHAPE_PADDING={1:{0:5*this.GRID_UNIT,1:2*this.GRID_UNIT,2:5*this.GRID_UNIT,3:5*this.GRID_UNIT},2:{0:3*this.GRID_UNIT,1:3*this.GRID_UNIT,2:1*this.GRID_UNIT,3:2*this.GRID_UNIT},3:{0:2*this.GRID_UNIT,1:2*this.GRID_UNIT,2:2*this.GRID_UNIT,3:2*this.GRID_UNIT}};this.FULL_BLOCK_FIELDS=!0;this.FIELD_TEXT_FONTSIZE=3*this.GRID_UNIT;this.FIELD_TEXT_FONTWEIGHT="bold";this.FIELD_TEXT_FONTFAMILY="\"Helvetica Neue\", \"Segoe UI\", Helvetica, sans-serif";this.FIELD_TEXT_BASELINE_Y=this.FIELD_TEXT_HEIGHT=13.1;this.FIELD_BORDER_RECT_RADIUS=this.CORNER_RADIUS;this.FIELD_BORDER_RECT_X_PADDING=2*this.GRID_UNIT;this.FIELD_BORDER_RECT_Y_PADDING=1*this.GRID_UNIT;this.FIELD_BORDER_RECT_HEIGHT=8*this.GRID_UNIT;this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=8*this.GRID_UNIT;this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!0;this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING;this.FIELD_TEXTINPUT_BOX_SHADOW=!0;this.FIELD_TEXT_Y_OFFSET=o.utils.userAgent.CHROME?-.45:0;this.FIELD_COLOUR_FULL_BLOCK=!0;this.FIELD_COLOUR_DEFAULT_WIDTH=2*this.GRID_UNIT;this.FIELD_COLOUR_DEFAULT_HEIGHT=4*this.GRID_UNIT;this.FIELD_CHECKBOX_X_OFFSET=this.FIELD_BORDER_RECT_X_PADDING-3;this.FIELD_CHECKBOX_Y_OFFSET=22;this.FIELD_CHECKBOX_DEFAULT_WIDTH=6*this.GRID_UNIT;this.highlightGlowFilterId="";this.highlightGlowFilter_=null;this.replacementGlowFilterId="";this.replacementGlowFilter_=null};o.utils.object.inherits(o.zelos.ConstantProvider,o.blockRendering.ConstantProvider);o.zelos.ConstantProvider.prototype.init=function(){o.zelos.ConstantProvider.superClass_.init.call(this);this.HEXAGONAL=this.makeHexagonal();this.ROUNDED=this.makeRounded();this.SQUARED=this.makeSquared();this.STATEMENT_INPUT_NOTCH_OFFSET+=this.INSIDE_CORNERS.rightWidth};o.zelos.ConstantProvider.prototype.dispose=function(){o.zelos.ConstantProvider.superClass_.dispose.call(this);this.highlightGlowFilter_&&o.utils.dom.removeNode(this.highlightGlowFilter_)};o.zelos.ConstantProvider.prototype.makeStartHat=function(){var e=this.START_HAT_HEIGHT,t=this.START_HAT_WIDTH,n=o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(25,-e),o.utils.svgPaths.point(71,-e),o.utils.svgPaths.point(t,0)]);return{height:e,width:t,path:n}};o.zelos.ConstantProvider.prototype.makeHexagonal=function(){function e(e,t,n){var r=e/2;n=n?-1:1;e=(t?-1:1)*e/2;return o.utils.svgPaths.lineTo(-n*r,e)+o.utils.svgPaths.lineTo(n*r,e)}return{type:this.SHAPES.HEXAGONAL,isDynamic:!0,width:function width(e){return e/2},height:function height(e){return e},connectionOffsetY:function connectionOffsetY(e){return e/2},connectionOffsetX:function connectionOffsetX(e){return-e},pathDown:function pathDown(t){return e(t,!1,!1)},pathUp:function pathUp(t){return e(t,!0,!1)},pathRightDown:function pathRightDown(t){return e(t,!1,!0)},pathRightUp:function pathRightUp(t){return e(t,!1,!0)}}};o.zelos.ConstantProvider.prototype.makeRounded=function(){function e(e,t,n){e/=2;return o.utils.svgPaths.arc("a","0 0 "+(t||n?1:0),e,o.utils.svgPaths.point(0,2*((t?-1:1)*e)))}return{type:this.SHAPES.ROUND,isDynamic:!0,width:function width(e){return e/2},height:function height(e){return e},connectionOffsetY:function connectionOffsetY(e){return e/2},connectionOffsetX:function connectionOffsetX(e){return-e},pathDown:function pathDown(t){return e(t,!1,!1)},pathUp:function pathUp(t){return e(t,!0,!1)},pathRightDown:function pathRightDown(t){return e(t,!1,!0)},pathRightUp:function pathRightUp(t){return e(t,!1,!0)}}};o.zelos.ConstantProvider.prototype.makeSquared=function(){function e(n,r,i){n-=2*t;return o.utils.svgPaths.arc("a","0 0,1",t,o.utils.svgPaths.point((r?-1:1)*t,(r?-1:1)*t))+o.utils.svgPaths.lineOnAxis("v",(i?1:-1)*n)+o.utils.svgPaths.arc("a","0 0,1",t,o.utils.svgPaths.point((r?1:-1)*t,(r?-1:1)*t))}var t=this.CORNER_RADIUS;return{type:this.SHAPES.SQUARE,isDynamic:!0,width:function width(){return t},height:function height(e){return e},connectionOffsetY:function connectionOffsetY(e){return e/2},connectionOffsetX:function connectionOffsetX(e){return-e},pathDown:function pathDown(t){return e(t,!1,!1)},pathUp:function pathUp(t){return e(t,!0,!1)},pathRightDown:function pathRightDown(t){return e(t,!1,!0)},pathRightUp:function pathRightUp(t){return e(t,!1,!0)}}};o.zelos.ConstantProvider.prototype.shapeFor=function(e){var t=e.getCheck();!t&&e.targetConnection&&(t=e.targetConnection.getCheck());switch(e.type){case o.INPUT_VALUE:case o.OUTPUT_VALUE:e=e.getSourceBlock().getOutputShape();if(null!=e)switch(e){case this.SHAPES.HEXAGONAL:return this.HEXAGONAL;case this.SHAPES.ROUND:return this.ROUNDED;case this.SHAPES.SQUARE:return this.SQUARED;}if(t&&-1!=t.indexOf("Boolean"))return this.HEXAGONAL;if(t&&-1!=t.indexOf("Number"))return this.ROUNDED;t&&t.indexOf("String");return this.ROUNDED;case o.PREVIOUS_STATEMENT:case o.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown type");}};o.zelos.ConstantProvider.prototype.makeNotch=function(){function t(t){return o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(t*s/2,0),o.utils.svgPaths.point(3*(t*s)/4,l/2),o.utils.svgPaths.point(t*s,l)])+o.utils.svgPaths.line([o.utils.svgPaths.point(t*s,e)])+o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(t*s/4,l/2),o.utils.svgPaths.point(t*s/2,l),o.utils.svgPaths.point(t*s,l)])+o.utils.svgPaths.lineOnAxis("h",t*i)+o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(t*s/2,0),o.utils.svgPaths.point(3*(t*s)/4,-(l/2)),o.utils.svgPaths.point(t*s,-l)])+o.utils.svgPaths.line([o.utils.svgPaths.point(t*s,-e)])+o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(t*s/4,-(l/2)),o.utils.svgPaths.point(t*s/2,-l),o.utils.svgPaths.point(t*s,-l)])}var n=this.NOTCH_WIDTH,r=this.NOTCH_HEIGHT,i=n/3,s=i/3,e=r/2,l=e/2,a=t(1),c=t(-1);return{type:this.SHAPES.NOTCH,width:n,height:r,pathLeft:a,pathRight:c}};o.zelos.ConstantProvider.prototype.makeInsideCorners=function(){var t=this.CORNER_RADIUS,n=o.utils.svgPaths.arc("a","0 0,0",t,o.utils.svgPaths.point(-t,t)),r=o.utils.svgPaths.arc("a","0 0,1",t,o.utils.svgPaths.point(-t,t)),i=o.utils.svgPaths.arc("a","0 0,0",t,o.utils.svgPaths.point(t,t)),s=o.utils.svgPaths.arc("a","0 0,1",t,o.utils.svgPaths.point(t,t));return{width:t,height:t,pathTop:n,pathBottom:i,rightWidth:t,rightHeight:t,pathTopRight:r,pathBottomRight:s}};o.zelos.ConstantProvider.prototype.generateSecondaryColour_=function(e){return o.utils.colour.blend("#000",e,.15)||e};o.zelos.ConstantProvider.prototype.generateTertiaryColour_=function(e){return o.utils.colour.blend("#000",e,.25)||e};o.zelos.ConstantProvider.prototype.createDom=function(e){o.zelos.ConstantProvider.superClass_.createDom.call(this,e);e=o.utils.dom.createSvgElement("defs",{},e);var t=o.utils.dom.createSvgElement("filter",{id:"blocklyHighlightGlowFilter"+this.randomIdentifier_,height:"160%",width:"180%",y:"-30%",x:"-40%"},e);o.utils.dom.createSvgElement("feGaussianBlur",{in:"SourceGraphic",stdDeviation:.5},t);var n=o.utils.dom.createSvgElement("feComponentTransfer",{result:"outBlur"},t);o.utils.dom.createSvgElement("feFuncA",{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},n);o.utils.dom.createSvgElement("feFlood",{"flood-color":"#fff200","flood-opacity":1,result:"outColor"},t);o.utils.dom.createSvgElement("feComposite",{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},t);this.highlightGlowFilterId=t.id;this.highlightGlowFilter_=t;e=o.utils.dom.createSvgElement("filter",{id:"blocklyReplacementGlowFilter"+this.randomIdentifier_,height:"160%",width:"180%",y:"-30%",x:"-40%"},e);o.utils.dom.createSvgElement("feGaussianBlur",{in:"SourceGraphic",stdDeviation:2},e);t=o.utils.dom.createSvgElement("feComponentTransfer",{result:"outBlur"},e);o.utils.dom.createSvgElement("feFuncA",{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},t);o.utils.dom.createSvgElement("feFlood",{"flood-color":"#fff200","flood-opacity":1,result:"outColor"},e);o.utils.dom.createSvgElement("feComposite",{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e);o.utils.dom.createSvgElement("feComposite",{in:"SourceGraphic",in2:"outGlow",operator:"over"},e);this.replacementGlowFilterId=e.id;this.replacementGlowFilter_=e};o.zelos.ConstantProvider.prototype.getCSS_=function(e){e="."+e+"-renderer";return[e+" .blocklyText {","fill: #fff;","font-family: "+this.FIELD_TEXT_FONTFAMILY+";","font-size: "+this.FIELD_TEXT_FONTSIZE+"pt;","font-weight: "+this.FIELD_TEXT_FONTWEIGHT+";","}",e+" .blocklyNonEditableText>rect:not(.blocklyDropdownRect),",e+" .blocklyEditableText>rect:not(.blocklyDropdownRect) {","fill: "+this.FIELD_BORDER_RECT_COLOUR+";","}",e+" .blocklyNonEditableText>text,",e+" .blocklyEditableText>text,",e+" .blocklyNonEditableText>g>text,",e+" .blocklyEditableText>g>text {","fill: #575E75;","}",e+" .blocklyDraggable:not(.blocklyDisabled)"," .blocklyEditableText:not(.editing):hover>rect ,",e+" .blocklyDraggable:not(.blocklyDisabled)"," .blocklyEditableText:not(.editing):hover>.blocklyPath {","stroke: #fff;","stroke-width: 2;","}",e+" .blocklyHtmlInput {","font-family: "+this.FIELD_TEXT_FONTFAMILY+";","font-weight: "+this.FIELD_TEXT_FONTWEIGHT+";","color: #575E75;","}",e+" .blocklyDropdownText {","fill: #fff !important;","}",e+".blocklyWidgetDiv .goog-menuitem,",e+".blocklyDropDownDiv .goog-menuitem {","font-family: "+this.FIELD_TEXT_FONTFAMILY+";","}",e+".blocklyDropDownDiv .goog-menuitem-content {","color: #fff;","}",e+" .blocklyHighlightedConnectionPath {","stroke: #fff200;","}",e+" .blocklyDisabled > .blocklyOutlinePath {","fill: url(#blocklyDisabledPattern"+this.randomIdentifier_+")","}"]};o.zelos.TopRow=function(e){o.zelos.TopRow.superClass_.constructor.call(this,e)};o.utils.object.inherits(o.zelos.TopRow,o.blockRendering.TopRow);o.zelos.TopRow.prototype.endsWithElemSpacer=function(){return!1};o.zelos.TopRow.prototype.hasLeftSquareCorner=function(e){var t=(e.hat?"cap"===e.hat:this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection;return!!e.outputConnection||t};o.zelos.TopRow.prototype.hasRightSquareCorner=function(e){return!!e.outputConnection};o.zelos.BottomRow=function(e){o.zelos.BottomRow.superClass_.constructor.call(this,e)};o.utils.object.inherits(o.zelos.BottomRow,o.blockRendering.BottomRow);o.zelos.BottomRow.prototype.endsWithElemSpacer=function(){return!1};o.zelos.BottomRow.prototype.hasLeftSquareCorner=function(e){return!!e.outputConnection};o.zelos.BottomRow.prototype.hasRightSquareCorner=function(e){return!!e.outputConnection};o.zelos.RightConnectionShape=function(e){o.zelos.RightConnectionShape.superClass_.constructor.call(this,e);this.type|=o.blockRendering.Types.getType("RIGHT_CONNECTION");this.width=this.height=0};o.utils.object.inherits(o.zelos.RightConnectionShape,o.blockRendering.Measurable);o.zelos.StatementInput=function(e,t){o.zelos.StatementInput.superClass_.constructor.call(this,e,t);if(this.connectedBlock){for(e=this.connectedBlock;e.getNextBlock();){e=e.getNextBlock()}e.nextConnection||(this.height=this.connectedBlockHeight,this.connectedBottomNextConnection=!0)}};o.utils.object.inherits(o.zelos.StatementInput,o.blockRendering.StatementInput);o.zelos.RenderInfo=function(e,t){o.zelos.RenderInfo.superClass_.constructor.call(this,e,t);this.topRow=new o.zelos.TopRow(this.constants_);this.bottomRow=new o.zelos.BottomRow(this.constants_);this.isInline=!0;this.isMultiRow=!t.getInputsInline()||t.isCollapsed();this.rightSide=this.outputConnection?new o.zelos.RightConnectionShape(this.constants_):null};o.utils.object.inherits(o.zelos.RenderInfo,o.blockRendering.RenderInfo);o.zelos.RenderInfo.prototype.getRenderer=function(){return this.renderer_};o.zelos.RenderInfo.prototype.measure=function(){this.createRows_();this.addElemSpacing_();this.addRowSpacing_();this.adjustXPosition_();this.computeBounds_();this.alignRowElements_();this.finalize_()};o.zelos.RenderInfo.prototype.shouldStartNewRow_=function(e,t){return t?e.type==o.NEXT_STATEMENT||t.type==o.NEXT_STATEMENT?!0:e.type==o.INPUT_VALUE||e.type==o.DUMMY_INPUT?!this.isInline||this.isMultiRow:!1:!1};o.zelos.RenderInfo.prototype.getDesiredRowWidth_=function(e){return e.hasStatement?this.width-this.startX-(this.constants_.INSIDE_CORNERS.rightWidth||0):o.zelos.RenderInfo.superClass_.getDesiredRowWidth_.call(this,e)};o.zelos.RenderInfo.prototype.getInRowSpacing_=function(e,t){return e&&t||!this.outputConnection||!this.outputConnection.isDynamicShape?!e&&t&&o.blockRendering.Types.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:e&&o.blockRendering.Types.isLeftRoundedCorner(e)&&t&&(o.blockRendering.Types.isPreviousConnection(t)||o.blockRendering.Types.isNextConnection(t))?t.notchOffset-this.constants_.CORNER_RADIUS:e&&o.blockRendering.Types.isLeftSquareCorner(e)&&t&&o.blockRendering.Types.isHat(t)?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING:this.constants_.NO_PADDING};o.zelos.RenderInfo.prototype.getSpacerRowHeight_=function(e,t){if(o.blockRendering.Types.isTopRow(e)&&o.blockRendering.Types.isBottomRow(t))return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;var n=o.blockRendering.Types.isInputRow(e)&&e.hasStatement,r=o.blockRendering.Types.isInputRow(t)&&t.hasStatement;return r||n?(e=Math.max(this.constants_.MEDIUM_PADDING,Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.INSIDE_CORNERS.rightHeight||0)),r&&n?Math.max(e,this.constants_.DUMMY_INPUT_MIN_HEIGHT):e):o.blockRendering.Types.isTopRow(e)?e.hasPreviousConnection||this.outputConnection?this.constants_.NO_PADDING:this.constants_.SMALL_PADDING:o.blockRendering.Types.isBottomRow(t)?this.outputConnection?this.constants_.NO_PADDING:this.constants_.SMALL_PADDING:this.constants_.MEDIUM_PADDING};o.zelos.RenderInfo.prototype.getSpacerRowWidth_=function(e,t){var n=this.width-this.startX;return o.blockRendering.Types.isInputRow(e)&&e.hasStatement||o.blockRendering.Types.isInputRow(t)&&t.hasStatement?Math.max(n,this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH):n};o.zelos.RenderInfo.prototype.getElemCenterline_=function(e,t){return e.hasStatement&&!o.blockRendering.Types.isSpacer(t)?e.yPos+this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT/2:o.zelos.RenderInfo.superClass_.getElemCenterline_.call(this,e,t)};o.zelos.RenderInfo.prototype.addInput_=function(e,t){e.type==o.DUMMY_INPUT&&t.hasDummyInput&&t.align==o.ALIGN_LEFT&&e.align==o.ALIGN_RIGHT&&(t.rightAlignedDummyInput=e);this.isInline&&e.type==o.INPUT_VALUE?(t.elements.push(new o.blockRendering.InlineInput(this.constants_,e)),t.hasInlineInput=!0):e.type==o.NEXT_STATEMENT?(t.elements.push(new o.zelos.StatementInput(this.constants_,e)),t.hasStatement=!0):e.type==o.INPUT_VALUE?(t.elements.push(new o.blockRendering.ExternalValueInput(this.constants_,e)),t.hasExternalInput=!0):e.type==o.DUMMY_INPUT&&(t.minHeight=Math.max(t.minHeight,e.getSourceBlock()&&e.getSourceBlock().isShadow()?this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT:this.constants_.DUMMY_INPUT_MIN_HEIGHT),t.hasDummyInput=!0);null==t.align&&(t.align=e.align)};o.zelos.RenderInfo.prototype.addAlignmentPadding_=function(t,n){if(t.rightAlignedDummyInput){for(var r,i=0,s;(s=t.elements[i])&&(o.blockRendering.Types.isSpacer(s)&&(r=s),!o.blockRendering.Types.isField(s)||s.parentInput!=t.rightAlignedDummyInput);i++){}if(r){r.width+=n;t.width+=n;return}}o.zelos.RenderInfo.superClass_.addAlignmentPadding_.call(this,t,n)};o.zelos.RenderInfo.prototype.adjustXPosition_=function(){for(var t=this.constants_.NOTCH_OFFSET_LEFT+this.constants_.NOTCH_WIDTH,n=t,r=2;r<this.rows.length-1;r+=2){var i=this.rows[r-1],s=this.rows[r],e=this.rows[r+1];i=2==r?!!this.topRow.hasPreviousConnection:!!i.followsStatement;e=r+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!e.precedesStatement;if(o.blockRendering.Types.isInputRow(s)&&s.hasStatement)s.measure(),n=s.width-s.getLastInput().width+t;else if(i&&(2==r||e)&&o.blockRendering.Types.isInputRow(s)&&!s.hasStatement){e=s.xPos;i=null;for(var l=0,a;a=s.elements[l];l++){o.blockRendering.Types.isSpacer(a)&&(i=a),!(i&&(o.blockRendering.Types.isField(a)||o.blockRendering.Types.isInput(a))&&e<n)||o.blockRendering.Types.isField(a)&&(a.field instanceof o.FieldLabel||a.field instanceof o.FieldImage)||(i.width+=n-e),e+=a.width}}}};o.zelos.RenderInfo.prototype.finalizeOutputConnection_=function(){if(this.outputConnection&&this.outputConnection.isDynamicShape){for(var e=0,t=0,o;o=this.rows[t];t++){o.yPos=e,e+=o.height}this.height=e;t=this.outputConnection.shape.height(e);e=this.outputConnection.shape.width(e);this.outputConnection.height=t;this.outputConnection.width=e;this.outputConnection.startX=e;this.outputConnection.connectionOffsetY=this.outputConnection.shape.connectionOffsetY(t);this.outputConnection.connectionOffsetX=this.outputConnection.shape.connectionOffsetX(e);this.rightSide.height=t;this.rightSide.width=e;this.rightSide.centerline=t/2;this.rightSide.xPos=this.width+e;this.startX=e;this.width+=2*e;this.widthWithChildren+=2*e}};o.zelos.RenderInfo.prototype.finalizeHorizontalAlignment_=function(){if(this.outputConnection){for(var t=0,n=0,r;r=this.rows[n];n++){if(o.blockRendering.Types.isInputRow(r)){t=r.elements[r.elements.length-2];var i=this.getNegativeSpacing_(r.elements[1]),s=this.getNegativeSpacing_(t);t=i+s;var l=this.constants_.MIN_BLOCK_WIDTH+2*this.outputConnection.width;this.width-t<l&&(t=this.width-l,i=t/2,s=t/2);r.elements.unshift(new o.blockRendering.InRowSpacer(this.constants_,-i));r.elements.push(new o.blockRendering.InRowSpacer(this.constants_,-s))}}if(t)for(this.width-=t,this.widthWithChildren-=t,this.rightSide.xPos-=t,n=0;r=this.rows[n];n++){if(o.blockRendering.Types.isTopRow(r)||o.blockRendering.Types.isBottomRow(r))r.elements[1].width-=t;r.width-=t;r.widthWithConnectedBlocks-=t}}};o.zelos.RenderInfo.prototype.getNegativeSpacing_=function(e){if(!e)return 0;var t=this.outputConnection.width,n=this.outputConnection.shape.type,r=this.constants_;if(this.isMultiRow&&1<this.inputRowNum_)switch(n){case r.SHAPES.ROUND:return n=this.height/2,t-n*(1-Math.sin(Math.acos((n-this.constants_.SMALL_PADDING)/n)));default:return 0;}return o.blockRendering.Types.isInlineInput(e)?(e=e.connectedBlock?e.connectedBlock.pathObject.outputShapeType:e.shape.type,n==r.SHAPES.HEXAGONAL&&n!=e?0:t-this.constants_.SHAPE_IN_SHAPE_PADDING[n][e]):o.blockRendering.Types.isField(e)?n==r.SHAPES.ROUND&&e.field instanceof o.FieldTextInput?t-2.75*r.GRID_UNIT:t-this.constants_.SHAPE_IN_SHAPE_PADDING[n][0]:o.blockRendering.Types.isIcon(e)?this.constants_.SMALL_PADDING:0};o.zelos.RenderInfo.prototype.finalizeVerticalAlignment_=function(){if(!this.outputConnection)for(var t=2;t<this.rows.length-1;t+=2){var n=this.rows[t-1],r=this.rows[t],i=this.rows[t+1],s=2==t,l=t+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!i.precedesStatement;if(s?this.topRow.hasPreviousConnection:n.followsStatement){var c=3==r.elements.length&&(r.elements[1].field instanceof o.FieldLabel||r.elements[1].field instanceof o.FieldImage);if(!s&&c)n.height-=this.constants_.SMALL_PADDING,i.height-=this.constants_.SMALL_PADDING,r.height-=this.constants_.MEDIUM_PADDING;else if(!s&&!l)n.height+=this.constants_.SMALL_PADDING;else if(l){s=!1;for(l=0;c=r.elements[l];l++){if(o.blockRendering.Types.isInlineInput(c)&&c.connectedBlock&&!c.connectedBlock.isShadow()&&40<=c.connectedBlock.getHeightWidth().height){s=!0;break}}s&&(n.height-=this.constants_.SMALL_PADDING,i.height-=this.constants_.SMALL_PADDING)}}}};o.zelos.RenderInfo.prototype.finalize_=function(){this.finalizeOutputConnection_();this.finalizeHorizontalAlignment_();this.finalizeVerticalAlignment_();o.zelos.RenderInfo.superClass_.finalize_.call(this)};o.zelos.Drawer=function(e,t){o.zelos.Drawer.superClass_.constructor.call(this,e,t)};o.utils.object.inherits(o.zelos.Drawer,o.blockRendering.Drawer);o.zelos.Drawer.prototype.draw=function(){var e=this.block_.pathObject;e.beginDrawing();this.hideHiddenIcons_();this.drawOutline_();this.drawInternals_();e.setPath(this.outlinePath_+"\n"+this.inlinePath_);this.info_.RTL&&e.flipRTL();o.blockRendering.useDebugger&&this.block_.renderingDebugger.drawDebug(this.block_,this.info_);this.recordSizeOnBlock_();this.info_.outputConnection&&(e.outputShapeType=this.info_.outputConnection.shape.type);e.endDrawing()};o.zelos.Drawer.prototype.drawOutline_=function(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape?(this.drawFlatTop_(),this.drawRightDynamicConnection_(),this.drawFlatBottom_(),this.drawLeftDynamicConnection_()):o.zelos.Drawer.superClass_.drawOutline_.call(this)};o.zelos.Drawer.prototype.drawRightSideRow_=function(e){if(!(0>=e.height))if(e.precedesStatement||e.followsStatement){var t=this.constants_.INSIDE_CORNERS.rightHeight;t=e.height-(e.precedesStatement?t:0);this.outlinePath_+=(e.followsStatement?this.constants_.INSIDE_CORNERS.pathBottomRight:"")+(0<t?o.utils.svgPaths.lineOnAxis("V",e.yPos+t):"")+(e.precedesStatement?this.constants_.INSIDE_CORNERS.pathTopRight:"")}else this.outlinePath_+=o.utils.svgPaths.lineOnAxis("V",e.yPos+e.height)};o.zelos.Drawer.prototype.drawRightDynamicConnection_=function(){this.outlinePath_+=this.info_.outputConnection.shape.pathRightDown(this.info_.outputConnection.height)};o.zelos.Drawer.prototype.drawLeftDynamicConnection_=function(){this.positionOutputConnection_();this.outlinePath_+=this.info_.outputConnection.shape.pathUp(this.info_.outputConnection.height);this.outlinePath_+="z"};o.zelos.Drawer.prototype.drawFlatTop_=function(){var e=this.info_.topRow;this.positionPreviousConnection_();this.outlinePath_+=o.utils.svgPaths.moveBy(e.xPos,this.info_.startY);this.outlinePath_+=o.utils.svgPaths.lineOnAxis("h",e.width)};o.zelos.Drawer.prototype.drawFlatBottom_=function(){var e=this.info_.bottomRow;this.positionNextConnection_();this.outlinePath_+=o.utils.svgPaths.lineOnAxis("V",e.baseline);this.outlinePath_+=o.utils.svgPaths.lineOnAxis("h",-e.width)};o.zelos.Drawer.prototype.drawInlineInput_=function(e){this.positionInlineInputConnection_(e);var t=e.input.name;if(!e.connectedBlock&&!this.info_.isInsertionMarker){var n=e.width-2*e.connectionWidth;e=o.utils.svgPaths.moveTo(e.xPos+e.connectionWidth,e.centerline-e.height/2)+o.utils.svgPaths.lineOnAxis("h",n)+e.shape.pathRightDown(e.height)+o.utils.svgPaths.lineOnAxis("h",-n)+e.shape.pathUp(e.height)+"z";this.block_.pathObject.setOutlinePath(t,e)}};o.zelos.Drawer.prototype.drawStatementInput_=function(t){var n=t.getLastInput(),r=n.xPos+n.notchOffset+n.shape.width,i=n.shape.pathRight+o.utils.svgPaths.lineOnAxis("h",-(n.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop,s=t.height-2*this.constants_.INSIDE_CORNERS.height;n=this.constants_.INSIDE_CORNERS.pathBottom+o.utils.svgPaths.lineOnAxis("h",n.notchOffset-this.constants_.INSIDE_CORNERS.width)+(n.connectedBottomNextConnection?"":n.shape.pathLeft);this.outlinePath_+=o.utils.svgPaths.lineOnAxis("H",r)+i+o.utils.svgPaths.lineOnAxis("v",s)+n+o.utils.svgPaths.lineOnAxis("H",t.xPos+t.width);this.positionStatementInputConnection_(t)};o.zelos.PathObject=function(e,t,n){o.zelos.PathObject.superClass_.constructor.call(this,e,t,n);this.constants_=n;this.svgPathSelected_=null;this.outlines_={};this.outputShapeType=this.remainingOutlines_=null};o.utils.object.inherits(o.zelos.PathObject,o.blockRendering.PathObject);o.zelos.PathObject.prototype.setPath=function(e){o.zelos.PathObject.superClass_.setPath.call(this,e);this.svgPathSelected_&&this.svgPathSelected_.setAttribute("d",e)};o.zelos.PathObject.prototype.applyColour=function(e){o.zelos.PathObject.superClass_.applyColour.call(this,e);e.isShadow()&&e.getParent()&&this.svgPath.setAttribute("stroke",e.getParent().style.colourTertiary);e=0;for(var t=Object.keys(this.outlines_),n;n=t[e];e++){this.outlines_[n].setAttribute("fill",this.style.colourTertiary)}};o.zelos.PathObject.prototype.flipRTL=function(){o.zelos.PathObject.superClass_.flipRTL.call(this);for(var e=0,t=Object.keys(this.outlines_),n;n=t[e];e++){this.outlines_[n].setAttribute("transform","scale(-1 1)")}};o.zelos.PathObject.prototype.updateSelected=function(e){this.setClass_("blocklySelected",e);e?this.svgPathSelected_||(this.svgPathSelected_=this.svgPath.cloneNode(!0),this.svgPathSelected_.setAttribute("fill","none"),this.svgPathSelected_.setAttribute("filter","url(#"+this.constants_.highlightGlowFilterId+")"),this.svgRoot.appendChild(this.svgPathSelected_)):this.svgPathSelected_&&(this.svgRoot.removeChild(this.svgPathSelected_),this.svgPathSelected_=null)};o.zelos.PathObject.prototype.updateReplacementHighlight=function(e){this.setClass_("blocklyReplaceable",e);e?this.svgPath.setAttribute("filter","url(#"+this.constants_.replacementGlowFilterId+")"):this.svgPath.removeAttribute("filter")};o.zelos.PathObject.prototype.updateShapeForInputHighlight=function(e,t){e=e.getParentInput().name;(e=this.getOutlinePath_(e))&&(t?e.setAttribute("filter","url(#"+this.constants_.replacementGlowFilterId+")"):e.removeAttribute("filter"))};o.zelos.PathObject.prototype.beginDrawing=function(){this.remainingOutlines_={};for(var e=0,t=Object.keys(this.outlines_),o;o=t[e];e++){this.remainingOutlines_[o]=1}};o.zelos.PathObject.prototype.endDrawing=function(){if(this.remainingOutlines_)for(var e=0,t=Object.keys(this.remainingOutlines_),o;o=t[e];e++){this.removeOutlinePath_(o)}this.remainingOutlines_=null};o.zelos.PathObject.prototype.setOutlinePath=function(e,t){e=this.getOutlinePath_(e);e.setAttribute("d",t);e.setAttribute("fill",this.style.colourTertiary)};o.zelos.PathObject.prototype.getOutlinePath_=function(e){this.outlines_[e]||(this.outlines_[e]=o.utils.dom.createSvgElement("path",{class:"blocklyOutlinePath",d:""},this.svgRoot));this.remainingOutlines_&&delete this.remainingOutlines_[e];return this.outlines_[e]};o.zelos.PathObject.prototype.removeOutlinePath_=function(e){this.outlines_[e].parentNode.removeChild(this.outlines_[e]);delete this.outlines_[e]};o.zelos.MarkerSvg=function(e,t,n){o.zelos.MarkerSvg.superClass_.constructor.call(this,e,t,n)};o.utils.object.inherits(o.zelos.MarkerSvg,o.blockRendering.MarkerSvg);o.zelos.MarkerSvg.prototype.showWithInput_=function(e){var t=e.getSourceBlock();e=e.getLocation().getOffsetInBlock();this.positionCircle_(e.x,e.y+this.constants_.CURSOR_RADIUS);this.setParent_(t);this.showCurrent_()};o.zelos.MarkerSvg.prototype.showWithBlock_=function(e){e=e.getLocation();var t=e.getHeightWidth();this.positionRect_(0,0,t.width,t.height);this.setParent_(e);this.showCurrent_()};o.zelos.MarkerSvg.prototype.positionCircle_=function(e,t){this.markerCircle_.setAttribute("cx",e);this.markerCircle_.setAttribute("cy",t);this.currentMarkerSvg=this.markerCircle_};o.zelos.MarkerSvg.prototype.showAtLocation_=function(e){var t=!1;e.getType()==o.ASTNode.types.OUTPUT?(this.showWithInput_(e),t=!0):e.getType()==o.ASTNode.types.BLOCK&&(this.showWithBlock_(e),t=!0);t||o.zelos.MarkerSvg.superClass_.showAtLocation_.call(this,e)};o.zelos.MarkerSvg.prototype.hide=function(){o.zelos.MarkerSvg.superClass_.hide.call(this);this.markerCircle_.style.display="none"};o.zelos.MarkerSvg.prototype.createDomInternal_=function(){o.zelos.MarkerSvg.superClass_.createDomInternal_.call(this);this.markerCircle_=o.utils.dom.createSvgElement("circle",{r:this.constants_.CURSOR_RADIUS,style:"display: none",fill:this.colour_,stroke:this.colour_,"stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_);if(this.isCursor()){var e=this.getBlinkProperties_();o.utils.dom.createSvgElement("animate",e,this.markerCircle_)}return this.markerSvg_};o.zelos.Renderer=function(e){o.zelos.Renderer.superClass_.constructor.call(this,e)};o.utils.object.inherits(o.zelos.Renderer,o.blockRendering.Renderer);o.zelos.Renderer.prototype.makeConstants_=function(){return new o.zelos.ConstantProvider};o.zelos.Renderer.prototype.makeRenderInfo_=function(e){return new o.zelos.RenderInfo(this,e)};o.zelos.Renderer.prototype.makeDrawer_=function(e,t){return new o.zelos.Drawer(e,t)};o.zelos.Renderer.prototype.makeMarkerDrawer=function(e,t){return new o.zelos.MarkerSvg(e,this.getConstants(),t)};o.zelos.Renderer.prototype.makePathObject=function(e,t){return new o.zelos.PathObject(e,t,this.getConstants())};o.zelos.Renderer.prototype.shouldHighlightConnection=function(e){return e.type!=o.INPUT_VALUE&&e.type!==o.OUTPUT_VALUE};o.zelos.Renderer.prototype.shouldInsertDraggedBlock=function(){return!1};o.blockRendering.register("zelos",o.zelos.Renderer);o.Themes.Dark={};o.Themes.Dark.defaultBlockStyles={colour_blocks:{colourPrimary:"#a5745b",colourSecondary:"#dbc7bd",colourTertiary:"#845d49"},list_blocks:{colourPrimary:"#745ba5",colourSecondary:"#c7bddb",colourTertiary:"#5d4984"},logic_blocks:{colourPrimary:"#5b80a5",colourSecondary:"#bdccdb",colourTertiary:"#496684"},loop_blocks:{colourPrimary:"#5ba55b",colourSecondary:"#bddbbd",colourTertiary:"#498449"},math_blocks:{colourPrimary:"#5b67a5",colourSecondary:"#bdc2db",colourTertiary:"#495284"},procedure_blocks:{colourPrimary:"#995ba5",colourSecondary:"#d6bddb",colourTertiary:"#7a4984"},text_blocks:{colourPrimary:"#5ba58c",colourSecondary:"#bddbd1",colourTertiary:"#498470"},variable_blocks:{colourPrimary:"#a55b99",colourSecondary:"#dbbdd6",colourTertiary:"#84497a"},variable_dynamic_blocks:{colourPrimary:"#a55b99",colourSecondary:"#dbbdd6",colourTertiary:"#84497a"},hat_blocks:{colourPrimary:"#a55b99",colourSecondary:"#dbbdd6",colourTertiary:"#84497a",hat:"cap"}};o.Themes.Dark.categoryStyles={colour_category:{colour:"#a5745b"},list_category:{colour:"#745ba5"},logic_category:{colour:"#5b80a5"},loop_category:{colour:"#5ba55b"},math_category:{colour:"#5b67a5"},procedure_category:{colour:"#995ba5"},text_category:{colour:"#5ba58c"},variable_category:{colour:"#a55b99"},variable_dynamic_category:{colour:"#a55b99"}};o.Themes.Dark=new o.Theme("dark",o.Themes.Dark.defaultBlockStyles,o.Themes.Dark.categoryStyles);o.Themes.Dark.setComponentStyle("workspaceBackgroundColour","#1e1e1e");o.Themes.Dark.setComponentStyle("toolboxBackgroundColour","#333");o.Themes.Dark.setComponentStyle("toolboxForegroundColour","#fff");o.Themes.Dark.setComponentStyle("flyoutBackgroundColour","#252526");o.Themes.Dark.setComponentStyle("flyoutForegroundColour","#ccc");o.Themes.Dark.setComponentStyle("flyoutOpacity",1);o.Themes.Dark.setComponentStyle("scrollbarColour","#797979");o.Themes.Dark.setComponentStyle("scrollbarOpacity",.4);(function(){o.Css.register([".dark-theme .blocklyTreeRow:not(.blocklyTreeSelected):hover {","background-color: #2a2d2e;","}",".dark-theme.blocklyWidgetDiv .goog-menu, ",".dark-theme.blocklyDropDownDiv {","background-color: #3c3c3c;","}",".dark-theme.blocklyDropDownDiv {","border-color: #565656;","}",".dark-theme.blocklyWidgetDiv .goog-menuitem-content, ",".dark-theme.blocklyDropDownDiv .goog-menuitem-content {","color: #f0f0f0;","}",".dark-theme.blocklyWidgetDiv .goog-menuitem-disabled"," .goog-menuitem-content,",".dark-theme.blocklyDropDownDiv .goog-menuitem-disabled"," .goog-menuitem-content {","color: #8a8a8a !important;","}"])})();o.Themes.Deuteranopia={};o.Themes.Deuteranopia.defaultBlockStyles={colour_blocks:{colourPrimary:"#f2a72c",colourSecondary:"#f1c172",colourTertiary:"#da921c"},list_blocks:{colourPrimary:"#7d65ab",colourSecondary:"#a88be0",colourTertiary:"#66518e"},logic_blocks:{colourPrimary:"#9fd2f1",colourSecondary:"#c0e0f4",colourTertiary:"#74bae5"},loop_blocks:{colourPrimary:"#795a07",colourSecondary:"#ac8726",colourTertiary:"#c4a03f"},math_blocks:{colourPrimary:"#e6da39",colourSecondary:"#f3ec8e",colourTertiary:"#f2eeb7"},procedure_blocks:{colourPrimary:"#590721",colourSecondary:"#8c475d",colourTertiary:"#885464"},text_blocks:{colourPrimary:"#058863",colourSecondary:"#5ecfaf",colourTertiary:"#04684c"},variable_blocks:{colourPrimary:"#47025a",colourSecondary:"#820fa1",colourTertiary:"#8e579d"},variable_dynamic_blocks:{colourPrimary:"#47025a",colourSecondary:"#820fa1",colourTertiary:"#8e579d"}};o.Themes.Deuteranopia.categoryStyles={colour_category:{colour:"#f2a72c"},list_category:{colour:"#7d65ab"},logic_category:{colour:"#9fd2f1"},loop_category:{colour:"#795a07"},math_category:{colour:"#e6da39"},procedure_category:{colour:"#590721"},text_category:{colour:"#058863"},variable_category:{colour:"#47025a"},variable_dynamic_category:{colour:"#47025a"}};o.Themes.Deuteranopia=new o.Theme("deuteranopia",o.Themes.Deuteranopia.defaultBlockStyles,o.Themes.Deuteranopia.categoryStyles);o.Themes.HighContrast={};o.Themes.HighContrast.defaultBlockStyles={colour_blocks:{colourPrimary:"#a52714",colourSecondary:"#FB9B8C",colourTertiary:"#FBE1DD"},list_blocks:{colourPrimary:"#4a148c",colourSecondary:"#AD7BE9",colourTertiary:"#CDB6E9"},logic_blocks:{colourPrimary:"#01579b",colourSecondary:"#64C7FF",colourTertiary:"#C5EAFF"},loop_blocks:{colourPrimary:"#33691e",colourSecondary:"#9AFF78",colourTertiary:"#E1FFD7"},math_blocks:{colourPrimary:"#1a237e",colourSecondary:"#8A9EFF",colourTertiary:"#DCE2FF"},procedure_blocks:{colourPrimary:"#006064",colourSecondary:"#77E6EE",colourTertiary:"#CFECEE"},text_blocks:{colourPrimary:"#004d40",colourSecondary:"#5ae27c",colourTertiary:"#D2FFDD"},variable_blocks:{colourPrimary:"#880e4f",colourSecondary:"#FF73BE",colourTertiary:"#FFD4EB"},variable_dynamic_blocks:{colourPrimary:"#880e4f",colourSecondary:"#FF73BE",colourTertiary:"#FFD4EB"},hat_blocks:{colourPrimary:"#880e4f",colourSecondary:"#FF73BE",colourTertiary:"#FFD4EB",hat:"cap"}};o.Themes.HighContrast.categoryStyles={colour_category:{colour:"#a52714"},list_category:{colour:"#4a148c"},logic_category:{colour:"#01579b"},loop_category:{colour:"#33691e"},math_category:{colour:"#1a237e"},procedure_category:{colour:"#006064"},text_category:{colour:"#004d40"},variable_category:{colour:"#880e4f"},variable_dynamic_category:{colour:"#880e4f"}};o.Themes.HighContrast=new o.Theme("highcontrast",o.Themes.HighContrast.defaultBlockStyles,o.Themes.HighContrast.categoryStyles);o.Themes.Tritanopia={};o.Themes.Tritanopia.defaultBlockStyles={colour_blocks:{colourPrimary:"#05427f",colourSecondary:"#2974c0",colourTertiary:"#2d74bb"},list_blocks:{colourPrimary:"#b69ce8",colourSecondary:"#ccbaef",colourTertiary:"#9176c5"},logic_blocks:{colourPrimary:"#9fd2f1",colourSecondary:"#c0e0f4",colourTertiary:"#74bae5"},loop_blocks:{colourPrimary:"#aa1846",colourSecondary:"#d36185",colourTertiary:"#7c1636"},math_blocks:{colourPrimary:"#e6da39",colourSecondary:"#f3ec8e",colourTertiary:"#f2eeb7"},procedure_blocks:{colourPrimary:"#590721",colourSecondary:"#8c475d",colourTertiary:"#885464"},text_blocks:{colourPrimary:"#058863",colourSecondary:"#5ecfaf",colourTertiary:"#04684c"},variable_blocks:{colourPrimary:"#4b2d84",colourSecondary:"#816ea7",colourTertiary:"#83759e"},variable_dynamic_blocks:{colourPrimary:"#4b2d84",colourSecondary:"#816ea7",colourTertiary:"#83759e"}};o.Themes.Tritanopia.categoryStyles={colour_category:{colour:"#05427f"},list_category:{colour:"#b69ce8"},logic_category:{colour:"#9fd2f1"},loop_category:{colour:"#aa1846"},math_category:{colour:"#e6da39"},procedure_category:{colour:"#590721"},text_category:{colour:"#058863"},variable_category:{colour:"#4b2d84"},variable_dynamic_category:{colour:"#4b2d84"}};o.Themes.Tritanopia=new o.Theme("tritanopia",o.Themes.Tritanopia.defaultBlockStyles,o.Themes.Tritanopia.categoryStyles);o.requires={};return o});
//# sourceMappingURL=blockly_compressed.min.js.map
